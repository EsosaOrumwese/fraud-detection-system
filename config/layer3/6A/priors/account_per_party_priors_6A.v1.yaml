schema_version: 1
prior_id: account_per_party_priors_6A
prior_version: v1

bindings:
  party_taxonomy_ref: taxonomy_party_6A
  account_taxonomy_ref: taxonomy_account_types_6A
  base_cell: [region_id, party_type, segment_id]
  account_cell: [region_id, party_type, segment_id, account_type]

supported_count_models:
  - count_model_id: bernoulli_cap1_v1
    required_params: [K_max, p_zero_weight, sigma, weight_floor_eps]
    description: "k in {0,1}; mean matched via q=clamp(lambda,0,1)"
  - count_model_id: zi_nb2_capK_v1
    required_params: [K_max, p_zero, kappa, p_zero_weight, sigma, weight_floor_eps]
    description: "ZI NB2 with hard cap."
  - count_model_id: zi_poisson_capK_v1
    required_params: [K_max, p_zero, p_zero_weight, sigma, weight_floor_eps]
    description: "ZI Poisson with hard cap."

rules:
  - party_type: BUSINESS
    account_type: BUSINESS_CREDIT_CARD
    count_model_id: zi_nb2_capK_v1
    params: { K_max: 5, p_zero: 0.40, kappa: 1.6, p_zero_weight: 0.35, sigma: 1.15, weight_floor_eps: 1.0e-6 }
  - party_type: BUSINESS
    account_type: BUSINESS_CURRENT
    count_model_id: zi_poisson_capK_v1
    params: { K_max: 3, p_zero: 0.01, p_zero_weight: 0.01, sigma: 0.30, weight_floor_eps: 1.0e-6 }
  - party_type: BUSINESS
    account_type: BUSINESS_SAVINGS
    count_model_id: zi_nb2_capK_v1
    params: { K_max: 3, p_zero: 0.60, kappa: 2.0, p_zero_weight: 0.55, sigma: 0.85, weight_floor_eps: 1.0e-6 }
  - party_type: BUSINESS
    account_type: BUSINESS_TERM_LOAN
    count_model_id: zi_poisson_capK_v1
    params: { K_max: 2, p_zero: 0.85, p_zero_weight: 0.80, sigma: 0.60, weight_floor_eps: 1.0e-6 }

  - party_type: OTHER
    account_type: OTHER_CURRENT_BASIC
    count_model_id: zi_poisson_capK_v1
    params: { K_max: 2, p_zero: 0.05, p_zero_weight: 0.04, sigma: 0.25, weight_floor_eps: 1.0e-6 }
  - party_type: OTHER
    account_type: OTHER_SAVINGS
    count_model_id: zi_nb2_capK_v1
    params: { K_max: 3, p_zero: 0.55, kappa: 2.0, p_zero_weight: 0.50, sigma: 0.80, weight_floor_eps: 1.0e-6 }

  - party_type: RETAIL
    account_type: RETAIL_CREDIT_CARD_PREMIUM
    count_model_id: zi_nb2_capK_v1
    params: { K_max: 3, p_zero: 0.75, kappa: 1.8, p_zero_weight: 0.70, sigma: 1.10, weight_floor_eps: 1.0e-6 }
  - party_type: RETAIL
    account_type: RETAIL_CREDIT_CARD_STANDARD
    count_model_id: zi_nb2_capK_v1
    params: { K_max: 4, p_zero: 0.40, kappa: 1.6, p_zero_weight: 0.35, sigma: 1.00, weight_floor_eps: 1.0e-6 }
  - party_type: RETAIL
    account_type: RETAIL_CURRENT_BASIC
    count_model_id: zi_poisson_capK_v1
    params: { K_max: 2, p_zero: 0.02, p_zero_weight: 0.01, sigma: 0.25, weight_floor_eps: 1.0e-6 }
  - party_type: RETAIL
    account_type: RETAIL_CURRENT_PREMIUM
    count_model_id: zi_poisson_capK_v1
    params: { K_max: 2, p_zero: 0.60, p_zero_weight: 0.55, sigma: 0.60, weight_floor_eps: 1.0e-6 }
  - party_type: RETAIL
    account_type: RETAIL_PERSONAL_LOAN_UNSECURED
    count_model_id: zi_poisson_capK_v1
    params: { K_max: 2, p_zero: 0.88, p_zero_weight: 0.85, sigma: 0.70, weight_floor_eps: 1.0e-6 }
  - party_type: RETAIL
    account_type: RETAIL_SAVINGS_FIXED
    count_model_id: zi_nb2_capK_v1
    params: { K_max: 3, p_zero: 0.70, kappa: 2.0, p_zero_weight: 0.65, sigma: 0.95, weight_floor_eps: 1.0e-6 }
  - party_type: RETAIL
    account_type: RETAIL_SAVINGS_INSTANT
    count_model_id: zi_nb2_capK_v1
    params: { K_max: 4, p_zero: 0.55, kappa: 2.2, p_zero_weight: 0.50, sigma: 0.90, weight_floor_eps: 1.0e-6 }

tag_adjustments:
  - tag: DIGITAL_HEAVY
    account_type: RETAIL_CREDIT_CARD_STANDARD
    p_zero_weight_multiplier: 0.85
    sigma_multiplier: 1.05
    multipliers_clip: { min: 0.50, max: 1.50 }
  - tag: CREDIT_AVOIDER
    account_type: RETAIL_CREDIT_CARD_STANDARD
    p_zero_weight_multiplier: 1.20
    sigma_multiplier: 0.90
    multipliers_clip: { min: 0.60, max: 1.40 }
  - tag: CROSS_BORDER_HEAVY
    account_type: RETAIL_CREDIT_CARD_PREMIUM
    p_zero_weight_multiplier: 0.90
    sigma_multiplier: 1.10
    multipliers_clip: { min: 0.60, max: 1.50 }

constraints:
  coverage_mode: fail_on_missing_rule
  required_types_min_weighted_coverage:
    RETAIL: 0.90
    BUSINESS: 0.95
    OTHER: 0.80
  cap_enforcement_mode: hard_global_postmerge
  max_allowed_kmax_violations: 0
  K_max_global_upper_bound: 8
  sigma_global_upper_bound: 2.0

realism_targets:
  p_zero_weight_ranges_by_account_group:
    CREDIT: { min: 0.15, max: 0.90 }
    DEPOSIT_PRIMARY: { min: 0.00, max: 0.08 }
    LOAN: { min: 0.60, max: 0.99 }
    SAVINGS: { min: 0.30, max: 0.95 }
  sigma_ranges_by_account_group:
    CREDIT: { min: 0.40, max: 1.80 }
    DEPOSIT_PRIMARY: { min: 0.05, max: 0.80 }
    LOAN: { min: 0.20, max: 1.20 }
    SAVINGS: { min: 0.30, max: 1.60 }
  K_max_ranges_by_account_group:
    CREDIT: { min: 1, max: 6 }
    DEPOSIT_PRIMARY: { min: 1, max: 3 }
    LOAN: { min: 1, max: 3 }
    SAVINGS: { min: 2, max: 6 }
  min_fraction_of_rules_with_sigma_ge: { sigma: 0.6, frac: 0.30 }

notes: >
  Rules follow product eligibility and keep realistic zero inflation with
  heavier tails for credit products while ensuring primary deposits are near-universal.
