# Logbook
### Date: 28th August 2025
### Project: Fraud Detection System
### Issues Resolved: [SD-02](https://github.com/EsosaOrumwese/fraud-detection-system/issues/25) `in-progress`
### Reference commits: Check commits on this date (if any)

* 8:31am
  * spec(S1): fix issues S1.1–S1.V — envelope, partitions, RNG, gating, validator
    * **S1.1 Inputs/Preconditions/Targets**
      * Pin frozen design vector & β loading (atomic, aligned shapes).
      * Fix lineage context (seed/parameter_hash/manifest_fingerprint/run_id) and keyed-substream model (order-invariant; no cross-label chaining).
      * Authoritative write target for hurdle events; path partitions include `{seed, parameter_hash, run_id, module, substream_label}`; `manifest_fingerprint` is embedded only.
      * Envelope now includes **blocks (uint64)** and **draws (u128 decimal string)**; budget identity defined.
    * **S1.2 Probability map**
      * Compute η via fixed-order **Neumaier** dot (binary64, RN-even; no FMA/FTZ/DAZ).
      * Logistic is **overflow-safe two-branch with explicit saturation** at **T = 37.5** → deterministic iff `pi∈{0.0,1.0}` (binary64).
      * Serialization: `pi` must round-trip exactly to binary64.
    * **S1.3 RNG substream & Bernoulli**
      * Label fixed to `"hurdle_bernoulli"`.
      * Base-counter reconstruction tuple `(seed, manifest_fingerprint, substream_label, merchant_id)`; **no counter chaining** across labels.
      * Single-uniform policy: low lane only; open-interval `u01`; consume **0 or 1** uniform.
      * Envelope budgeting must satisfy `u128(after) − u128(before) = parse_u128(draws) = blocks`.
      * Trace model clarified as **cumulative** (no per-event trace rows).
    * **S1.4 Event emission**
      * Dataset id: `rng_event_hurdle_bernoulli`; partitions as above.
      * Envelope fields enumerated (incl. `blocks` & `draws`); path↔embed equality required.
      * **Minimal authoritative payload:** `{merchant_id, pi, is_multi:boolean, deterministic:boolean, u:number|null}` with branch rules:
        * deterministic ⇒ `u=null`, `draws="0"`, `blocks=0`, `after==before`;
        * stochastic ⇒ `0<u<1`, `is_multi=(u<pi)`, `draws="1"`, `blocks=1`, `after=before+1`.
      * Canonical JSON examples updated.
    * **S1.5 Determinism & Correctness Invariants**
      * I-H0..I-H10 locked: bit-replay; single-uniform budget; payload discipline; presence-based **gating**; uniqueness & cardinality; envelope completeness; order-invariance; substream independence; diagnostics out-of-band; validator replay equations.
      * Clarify **cross-label RNG independence** (no requirement that `before(next) == after(hurdle)`).
    * **S1.6 Failure modes**
      * Full A–F taxonomy with precise predicates & detection points.
      * New/clarified checks: budget identity mismatch; cumulative trace missing/totals mismatch; partition/key drift; deterministic-branch inconsistency; presence-based gating violations.
      * Standardized failure object shape (includes registry ids, path, counters, budgets).
    * **S1.V Validator & CI**
      * Discovery via dictionary/registry; path↔embed equality on `{seed, parameter_hash, run_id, module, substream_label}` (no fingerprint in path).
      * Recompute η, π (with T), reconstruct base counter, regenerate `u` when needed; assert decision & counters.
      * Reconcile **cumulative** trace totals; enforce presence-based gating; check uniqueness & cardinality.
      * CI matrix, steps, and merge-blocking conditions pinned.

* 1:34pm
  * Finally 100% clarity in state 1 expanded doc.
