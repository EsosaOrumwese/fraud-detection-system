# Logbook
### Date: 14th August 2025
### Project: Fraud Detection System
### Issues Resolved: [SD-02](https://github.com/EsosaOrumwese/fraud-detection-system/issues/25) `in-progress`
### Reference commits: Check commits on this date (if any)

* 7:20am
  * Add an explicit derivation step for merchant currency
  * Clarified two friction points regarding policy on retry-exhaustion and K vs. candidate size M 
    * (i) what happens after 64 rejections in ZTP, and 
    * (ii) what if $K$ exceeds the number of available foreign candidates $M$. 

* 8:01am
  * Make currency->country expansion pipeline fully explicit
    - Replaced S5.2–S5.3 with tightened definitions of α=0.5, T=30, destination-level vs. global sparsity.
    - Explicit guard: require w_i > 0; abort on violation.
    - Detailed renormalisation policy: binary64 serial summation over ISO-sorted indices; tolerance 1e-12.
    - Clarified smoothing vs. raw vs. equal-split fallback conditions; preserved schema compatibility.
    - Added note in S5.4 that no schema changes are required; persistence maps to existing ccy_country_weights_cache and sparse_flag tables.

* 8:21am
  * Make Gumbel-top-k selection numerically explicit

* 10:15am
  * Dirichlet allocation overhaul: α-lookup ladder, symmetric fallback, Gumbel-order tie-break
    - Implemented governed α-vector lookup with fallback ladder:
      (home, MCC, channel, m) → (home, channel, m) → (home, m) → symmetric α=τ/m.
    - Enforced min α ≥ 1e−6; record resolved key and fallback usage in validation bundle.
    - Dirichlet sampling via Marsaglia–Tsang gamma (Batch-1 spec); single dirichlet_gamma_vector event per merchant when |C|>1.
    - Integerisation via largest-remainder rounding with residual quantisation to 8 dp.
    - Tie-break sequence updated: residual↓ → country_set.rank↑ → ISO↑.
    - Persist quantised residuals and ranks to ranking_residual_cache_1A; verified |n_i−a_i| ≤ 1 and Σ n_i = N.
