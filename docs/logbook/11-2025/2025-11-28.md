# Logbook
### Date: 28th November 2025
### Project: Fraud Detection System
### Reference commits: Check commits on this date (if any)

* 4:37am
   - Cloned the governed baseline scenario calendar into a manifest-scoped path (`config/layer2/5A/scenario/calendar/fingerprint=7a09f0d8e8695beead7077abc7a1e7478586ae1396fe7be2f5c2b0f7cdd53f69/scenario=baseline/`) so S0 no longer falls back to the repo-wide placeholder when sealing scenario artefacts for the current build. Future manifests now just need their own copy (real data once available) and the fallback remains a contingency.
   - TODO: Most of the arrangements of the items in folders in my repo and during run time, just don't make sense and also appear to be all over the place. We need to fix that

* 4:52am
   - Rewired 5A scenario calendars to be staged at runtime instead of committing manifest-specific Parquet files: the dictionary/registry now point at `data/layer2/5A/scenario/calendar/...` under the run tree, S0 auto-generates the missing files by copying from the governed templates in `config/layer2/5A/scenario/calendar/fingerprint=baseline/...`, and sealing now prefers the run base path for any dataset that lives under `data/`. 
   - Added `shared/scenario_assets.py` with `ensure_scenario_calendar` and removed the previously committed fingerprint directory so the repo stays clean between manifests.

* 4:57am
   - Implemented 5A.S3 per spec (scale×shape composer): added BaselineRunner to compose S1 profiles with S2 unit-mass shapes, enforce weekly-sum invariants, and emit schema-valid `merchant_zone_baseline_local_5A` plus class-level aggregates. Orchestrator/CLI now run S3 by default (with resumability/conflict guards) and surface baseline paths in the summary. Re-ran `make segment5a` (manifest 7a09…, parameter hash e038…) end-to-end through S0–S3; outputs and reports regenerated without spec gaps.
   
* 5:58am
   - Expanded S3 to meet the state-expanded spec: gate now enforces all upstream segments are PASS via the S0 receipt, validates S1/S2 inputs against the contract paths, asserts shape-grid contiguity, and checks domain×bucket coverage (fail-fast with `S3_*` error codes on missing shapes or bad grids).
   - Baseline join uses defaulted channel fields where absent and keeps weekly-sum invariants (scale×shape); class aggregates include channel/channel_group to match the schema anchors.
   - Idempotency/conflict guard applied to baseline writes; reran `make segment5a` (S0–S3) successfully (manifest 7a09…, parameter hash e038…) after clearing stale baselines and regenerated all reports without spec gaps.
* 6:42am
   - Added governed `baseline_intensity_policy_5A` (contracts + YAML) and wired S3 to load it for scale-source and tolerance semantics; enforced upstream PASS gating, grid contiguity, and domain×bucket coverage. S3 now resolves required inputs through the sealed inventory, auto-sealing S1/S2 outputs if missing and updating the receipt digest accordingly.
   - Reran `make segment5a` (S0–S3) cleanly after clearing stale sealed_inputs/baselines; regenerated sealed digest, baseline outputs, and reports for manifest 7a09… / parameter hash e038… under the new governance.

* 7:18pm
   - Added optional UTC baseline projection in S3 (`merchant_zone_baseline_utc_5A`), introduced governed `baseline_intensity_policy_5A` (contract + YAML) and wired S3 to consume it for scale source/tolerances, enforced sealed-inventory resolution (auto-sealing S1/S2 artefacts when missing), and reran `make segment5a` (S0–S3) cleanly for manifest 7a09… / parameter hash e038…. Baseline outputs (local + UTC) and reports regenerated under the new governance.

* 7:29pm
   - Upstreamed post-S2 sealing into S0: added `sealed_outputs_5A` snapshot generation (S0 and orchestrator refresh) so `sealed_inputs_5A` stays immutable while S1/S2 outputs stay governed for S3.
   - S3 now consumes the sealed_outputs overlay instead of mutating sealed_inputs; merged inventory only, no receipt churn. Orchestrator seals outputs before S3; manual runs can rerun S0 refresh if the snapshot is missing.
   - Quick smoke: module imports succeed with `PYTHONPATH=packages/engine/src` to catch wiring regressions.

