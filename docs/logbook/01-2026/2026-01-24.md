# Logbook
### Date: 24th January 2026
### Project: Fraud Detection System
### Reference commits: Check commits on this date (if any)

* 4:41am
  - SR: ran sanity check of ScenarioRunner submit flow with local wiring/policy. Found schema validation mismatch when validating Pydantic model_dump against JSON Schema (datetime + None fields cause failures). Logged in component_scenario_runner.impl_actual.md entry 2026-01-24 04:41:45. Proposed fix: validate model_dump(mode="json", exclude_none=True) before ingress validation.

* 4:44am
  - SR: fixed ingress schema validation to use request.model_dump(mode="json", exclude_none=True) in ScenarioRunner.submit_run. Logged in component_scenario_runner.impl_actual.md entry 2026-01-24 04:44:09.

* 4:45am
  - SR: fixed ledger schema validation to use JSON-safe dumps for RunStatus/RunPlan; re-ran local submit sanity check (passed schema validation; got lease-held response due to stale local lease). Logged in component_scenario_runner.impl_actual.md entry 2026-01-24 04:45:48.

* 4:49am
  - Read updated root AGENTS.md and noted new requirement for a living build-plan doc at docs/model_spec/platform/implementation_maps/component_{COMP}.build_plan.md before further platform implementation planning.

* 4:59am
  - Updated AGENTS.md to explicitly define "living plan" as progressive elaboration: phase list first, then phase-specific sections with definition-of-done checklists, expanding only when entering the phase.

* 5:07am
  - SR: added living build-plan doc at docs/model_spec/platform/implementation_maps/component_scenario_runner.build_plan.md with phased roadmap and Phase 2 sections + DoD checklists. Logged in component_scenario_runner.impl_actual.md entry 2026-01-24 05:07:44.

* 5:13am
  - Added proposed end-state platform repo layout to scratch_files/scratch.md for component-focused structure review.

* 5:17am
  - Updated README.md repository layout section to reflect the proposed end-state platform component layout.

* 5:23am
  - SR: drafted Phase 2 implementation plan (durable storage + idempotency) in component_scenario_runner.impl_actual.md (Entry: 2026-01-24 05:20:30).

* 5:30am
  - SR: implemented Phase 2 storage + authority store changes (ObjectStore + S3 backend, DB-backed equivalence/leases, wiring updates, psycopg dependency, tests). Logged in component_scenario_runner.impl_actual.md entry 2026-01-24 05:28:30. Ran pytest for authority store (2 passed).

* 5:35am
  - SR: recorded Phase 2 hardening gap and updated build plan with Phase 2.5 hardening DoD checklist (component_scenario_runner.build_plan.md). Logged in component_scenario_runner.impl_actual.md entry 2026-01-24 05:35:58.

* 5:42am
  - SR: locked target platform stack to AWS (S3 + RDS Postgres + ECS Fargate + Kinesis). Updated SR build plan and impl_actual; added config/platform/sr/wiring_aws.yaml.

* 5:47am
  - SR: wrote Phase 2.5 hardening plan in component_scenario_runner.impl_actual.md (Entry: 2026-01-24 05:47:18).

* 5:50am
  - SR: implemented Phase 2.5 hardening (immutability guards, S3 CAS append, lease validation/renew). Updated impl_actual (Entry: 2026-01-24 05:50:29). Ran pytest for authority store (2 passed).

* 5:58am
  - SR: added Phase 2.5 tests (Postgres smoke, concurrency, S3 CAS/unit + integration) and fixed plan_hash JSON serialization in runner. Ran pytest for new tests: 2 passed, 2 skipped (env‑gated). Logged in component_scenario_runner.impl_actual.md entry 2026-01-24 05:58:14.

* 7:09am
  - Renamed platform implementation map/build plan files to drop `component_` prefix (scenario_runner.impl_actual.md and scenario_runner.build_plan.md). Updated AGENTS.md and implementation_maps README accordingly; logged in scenario_runner.impl_actual.md entry 2026-01-24 07:09:54.

* 9:58am
  - SR: clarified local dev stack guidance (MinIO + Postgres recommended; FS + SQLite allowed) in scenario_runner.build_plan.md. Logged in scenario_runner.impl_actual.md entry 2026-01-24 09:58:16.

* 9:59am
  - SR: corrected local dev guidance to state FS + SQLite are not recommended (smoke only) and Phase 2.5 hardening must run on MinIO + Postgres. Logged in scenario_runner.impl_actual.md entry 2026-01-24 09:59:41.

* 10:40am
  - SR: planned local parity profiles (MinIO + Postgres) and wiring changes; logged in scenario_runner.impl_actual.md entry 2026-01-24 10:40:41.

* 10:41am
  - SR: implemented local parity profile and S3 endpoint overrides; updated SR service README. Logged in scenario_runner.impl_actual.md entry 2026-01-24 10:41:47.

* 11:08am
  - SR: added local parity docker compose stack (infra/local/docker-compose.sr-parity.yaml). Attempted to bring up stack; Docker engine not available (desktop-linux pipe missing; default pipe requires elevated/Docker Desktop running). Awaiting user to start Docker Desktop or provide running Docker daemon.

* 11:24am
  - SR: documented Phase 2.5 local-parity decision trail (MinIO/Postgres setup, docker context, image tag choice, S3 creds/bucket, Postgres port conflict) in scenario_runner.impl_actual.md entry 2026-01-24 11:24:39. Updated wiring_local_parity to port 5433 and README to reflect Postgres port.

* 11:26am
  - SR: finalized local parity stack (MinIO + Postgres) with updated compose (minio/mc latest, MC_HOST_local init, Postgres port 5433). Installed psycopg in venv. Ran S3 + Postgres integration tests with MinIO creds; all 3 tests passed. Logged in scenario_runner.impl_actual.md entry 2026-01-24 11:26:44 and marked Phase 2.5 complete in build plan.

* 11:36am
  - Added SR local parity test env vars to .env and documented how to run Phase 2.5 integration tests in services/scenario_runner/README.md.

* 11:37am
  - Corrected README test instructions to use a PowerShell-safe .env loader command.

* 11:39am
  - Fixed the PowerShell .env loader in services/scenario_runner/README.md after verifying the prior command failed; confirmed new command sets env vars correctly.

* 11:59am
  - Stopped the local parity stack (docker compose down) after successful Phase 2.5 tests.

* 12:01pm
  - Confirmed Phase 1 and Phase 2 completion in scenario_runner.impl_actual.md (Entry: 2026-01-24 12:01:45) and marked Phase 2 complete in scenario_runner.build_plan.md.

* 12:04pm
  - Phase 3 planning: added decision trail in scenario_runner.impl_actual.md (Entry: 2026-01-24 12:04:07) and expanded Phase 3 sections + DoD in scenario_runner.build_plan.md.

* 12:13pm
  - Adjusted impl_actual process to live decision notes (append small notes as decisions happen). Logged in scenario_runner.impl_actual.md entry 2026-01-24 12:13:18.

* 12:14pm
  - Re-read root AGENTS.md to refresh decision-trail + append-only requirements.

* 12:18pm
  - Impl_actual corrective expansion
  - Appended detailed Phase 3 planning expansion (decision trail + mechanics + invariants) to docs/model_spec/platform/implementation_maps/scenario_runner.impl_actual.md to replace the earlier summary-style entry.

* 12:29pm
  - Phase 3 implementation start
  - Appended live decision trail for Phase 3 strict evidence + schema alignment in docs/model_spec/platform/implementation_maps/scenario_runner.impl_actual.md before code changes.

* 12:38pm
  - Phase 3 implementation decisions
  - Logged mid-implementation decisions: evidence schema alignment, engine contract validation, gate scope tokens, locator pins logic, instance-proof bridge handling, and policy digest recompute.

* 12:39pm
  - Tests
  - pytest tests/services/scenario_runner/test_scenario_runner_concurrency.py
    - Result: 1 passed (RefResolver deprecation warnings from jsonschema).

* 12:42pm
  - Tests
  - pytest tests/services/scenario_runner/test_instance_proof_bridge.py
    - Result: 2 passed (RefResolver deprecation warnings from jsonschema).

* 12:43pm
  - Engine schema ref resolution shim
  - Added fallback in SchemaRegistry to resolve interface_pack refs that point at non-existent interface_pack/layer-1 paths (strip interface_pack/ when missing).

* 12:43pm
  - Build plan update
  - Marked Phase 3 status as in progress in docs/model_spec/platform/implementation_maps/scenario_runner.build_plan.md with note about instance-proof receipt gap + pending integration tests.

* 12:44pm
  - Output availability handling
  - Added availability to SR OutputCatalogue and treat optional outputs as non-blocking.

* 12:54pm
  - Impl_actual errata
  - Appended an errata entry correcting control characters/missing letters in recent Phase 3 notes (kept originals intact per AGENTS.md).

* 12:56pm
  - Impl_actual rewrite cleanup
  - Rewrote corrupted entries (12:29:03–12:44:12) in docs/model_spec/platform/implementation_maps/scenario_runner.impl_actual.md with clean text; removed the errata block as requested.

* 1:01pm
  - Phase 3 extension start
  - Logged decisions for instance-proof receipts + SR consumption + downstream compatibility in impl_actual.

* 1:07pm
  - Tests
  - pytest tests/services/scenario_runner/test_gate_verification_integration.py
    - Result: 1 passed (RefResolver deprecation warnings from jsonschema).

* 1:08pm
  - Instance-proof receipts + SR updates
  - Added instance-proof receipt schema + example to engine interface pack; documented path convention.
  - SR now loads/validates instance receipts and emits instance_receipts in run_facts_view.
  - Added gate verification integration test with real gate map artifacts.
  - Updated run_facts_view contract README and platform blueprint compatibility note.

* 1:59pm
  - Normalized 2026-01-24 logbook timing entries and restored details for the 12:18pm–1:08pm block.

* 2:01pm
  - Cleaned control characters/tabs and repaired corrupted words in docs/model_spec/platform/implementation_maps/scenario_runner.impl_actual.md (tests/target_* tokens).

* 2:05pm
  - Cleaned lingering text corruption in docs/model_spec/platform/implementation_maps/scenario_runner.impl_actual.md (fixed double-t prefixes; verified no standalone misspellings or control chars).

* 2:08pm
  - Fixed missing letters in scenario_runner.impl_actual.md (allow_instance_proof_bridge, test_gate_verification_integration, run_facts_view line).

* 2:36pm
  - SR: appended detailed black-box instance-proof implementation plan (SR-verifier receipts) in docs/model_spec/platform/implementation_maps/scenario_runner.impl_actual.md (Entry: 2026-01-24 14:36:13) before code changes.
  - SR: fixed missing-letter typos in earlier impl_actual entries for readability (no semantic changes).

* 2:43pm
  - SR: implemented black-box instance-proof receipts (SR verifier receipts stored under fraud-platform/sr/instance_receipts) and removed engine-receipt lookup in scenario_runner runner logic.
  - SR: updated instance-proof test to assert receipt emission and READY; ran pytest tests/services/scenario_runner/test_instance_proof_bridge.py (1 passed; RefResolver deprecation warnings).
  - SR: fixed YAML regex escaping in docs/model_spec/data-engine/interface_pack/contracts/instance_proof_receipt.schema.yaml.
  - Docs: clarified SR verifier receipt path in data_engine_interface.md, storage_layout_v1.md, interface_pack README, SR contract README, and services/scenario_runner/README.md.

* 2:48pm
  - SR: appended pre-change decision entry for Phase 3 follow-ups (remove bridge flag, add receipt-drift test, update build plan) in docs/model_spec/platform/implementation_maps/scenario_runner.impl_actual.md.

* 2:50pm
  - SR: removed allow_instance_proof_bridge from PolicyProfile, policy_v0.yaml, and related tests; recomputed policy content_digest.
  - SR: added receipt-drift test (pre-seeded mismatching receipt -> FAIL with INSTANCE_RECEIPT_DRIFT).
  - SR: updated Phase 3 build plan status/DoD to reflect black-box verifier receipts and drift test.
  - Tests: pytest tests/services/scenario_runner/test_instance_proof_bridge.py (2 passed; RefResolver deprecation warnings).

* 2:51pm
  - SR: appended implementation-map entry documenting bridge removal, drift test, and build plan update (Entry: 2026-01-24 14:50:32).

* 3:05pm
  - SR: added a decision entry to align interface_pack gate map with engine policy for 6B hashing law before making code changes (scenario_runner.impl_actual.md Entry: 2026-01-24 15:05:10).

* 3:20pm
  - SR: updated interface_pack gate map for 6B to use index_json_ascii_lex_raw_bytes hashing law; implemented GateVerifier support for index-driven raw-bytes hashing.
  - Tests: pytest tests/services/scenario_runner/test_gate_verifier.py (2 passed; RefResolver deprecation warnings).
