# Logbook
### Date: 9th January 2026
### Project: Fraud Detection System
### Reference commits: Check commits on this date (if any)

* 12:02am
   - Checked the local system time with `Get-Date` before formalizing the 2A merchant_mcc_map contract.
   - Reviewed the 2A data-intake guide, the 2A dictionary/registry, and the ingress schema pack to determine where to register `merchant_mcc_map`.
   - Planned to add a `merchant_mcc_map` schema anchor in `schemas.ingress.layer1.yaml`, register it as optional reference_data in the 2A dictionary, and add a matching cross-layer pointer in the 2A registry.

* 12:05am
   - Added the `merchant_mcc_map` table schema to `docs/model_spec/data-engine/layer-1/specs/contracts/1A/schemas.ingress.layer1.yaml`.
   - Registered `merchant_mcc_map` as an optional ingress reference in `docs/model_spec/data-engine/layer-1/specs/contracts/2A/dataset_dictionary.layer1.2A.yaml` and added the matching cross-layer pointer to `docs/model_spec/data-engine/layer-1/specs/contracts/2A/artefact_registry_2A.yaml`.
   - Updated `docs/model_spec/data-engine/layer-1/specs/data-intake/2A/merchant_mcc_map_derivation-guide.md` and `docs/model_spec/data-engine/layer-1/specs/data-intake/layer-1_data.md` to point at the new schema anchor.

* 12:06am
   - Ran a repository search to confirm `merchant_mcc_map` references now point at the new schema anchor across layer-1 specs.

* 12:13am
   - Updated `docs/model_spec/data-engine/layer-1/specs/state-flow/2A/state.2A.s2.expanded.md` to name `merchant_mcc_map` (schema `schemas.ingress.layer1.yaml#/merchant_mcc_map`) as the optional MCC mapping anchor instead of a programme-specific placeholder.

* 12:17am
   - Read the 2B data-intake policy guides (alias_layout_policy_v1, day_effect_policy_v1, route_rng_policy_v1, virtual_edge_policy_v1) and compared them to `docs/model_spec/data-engine/layer-1/specs/contracts/2B/schemas.2B.yaml` to assess schema coverage.

* 12:19am
   - Recommended using `pad_byte_hex` as the canonical padding key and adopting a moderately strict schema posture (required keys + basic type/enum constraints, `extensions` allowed) for the 2B policy schemas.

* 12:22am
   - Added moderately strict schema shapes for `route_rng_policy_v1`, `alias_layout_policy_v1`, and `day_effect_policy_v1` in `docs/model_spec/data-engine/layer-1/specs/contracts/2B/schemas.2B.yaml`, keeping `extensions` as the expansion bucket.
   - Updated the 2B policy guides to reference schema anchors and aligned the alias layout padding key to `pad_byte_hex`.

* 12:23am
   - Sanity-checked 2B dictionary/registry policy schema refs and confirmed they point to the updated `schemas.2B.yaml#/policy/*` anchors.

* 12:26am
   - Tightened 3A policy schema anchors in `docs/model_spec/data-engine/layer-1/specs/contracts/3A/schemas.3A.yaml` to require rules for `zone_mixture_policy_v1`, enforce allowed metrics/decision reasons, and require positive `alpha` values for `country_zone_alphas_v1`.

* 12:36am
   - Audited 3B data-intake guides against `docs/model_spec/data-engine/layer-1/specs/contracts/3B/schemas.3B.yaml` and tightened schema anchors for external weights, virtual rules, CDN weights, validation policy, key digest, and settlement coordinates.
   - Added a new `virtual_logging_policy_v1` schema anchor and registered the policy in the 3B dictionary and registry.
   - Aligned 3B intake guides with contract paths and schema anchors (cdn weights external path, pelias cached dataset id, virtual logging policy schema reference).

* 12:44am
   - Recommended splitting the Pelias SQLite bundle metadata into its own contract entry (pelias_cached_bundle) and giving the sqlite file a minimal file-level schema anchor to avoid mismatched schema references.

* 12:50am
   - Added `pelias_cached_bundle_v1` and `pelias_cached_sqlite_v1` reference anchors in `docs/model_spec/data-engine/layer-1/specs/contracts/3B/schemas.3B.yaml`.
   - Updated `docs/model_spec/data-engine/layer-1/specs/contracts/3B/dataset_dictionary.layer1.3B.yaml` to point `pelias_cached_sqlite` at `pelias_cached_sqlite_v1` and registered `pelias_cached_bundle` with its own schema anchor.
   - Updated `docs/model_spec/data-engine/layer-1/specs/contracts/3B/artefact_registry_3B.yaml` to align schema refs and add the `pelias_cached_bundle` registry entry with a dependency on `pelias_cached_sqlite`.
   - Updated `docs/model_spec/data-engine/layer-1/specs/data-intake/3B/pelias_cached.sqlite_acquisition-guide.md` to document the sqlite + metadata bundle pair and their schema anchors.
   - Ran `rg` and `Get-Content` checks to confirm the new Pelias bundle entries are present in the contracts and guide.

* 12:53am
   - Reviewed the 3A data-intake guides (`zone_mixture_policy_3A.md`, `zone_floor_policy_3A.md`, `country_zone_alphas_3A.md`) and confirmed each already names the correct `schemas.3A.yaml#/policy/*` schema authority anchor.
   - No edits required for the 3A schema-anchoring pass.

* 12:56am
   - Reviewed the 5A data-intake guides in `docs/model_spec/data-engine/layer-2/specs/data-intake/5A` for schema anchors.
   - Added the missing schema anchor reference to `docs/model_spec/data-engine/layer-2/specs/data-intake/5A/scenario_calendar_5A_derivation-guide.md`.

* 1:02am
   - Tightened the 5A policy and scenario schemas in `docs/model_spec/data-engine/layer-2/specs/contracts/5A/schemas.5A.yaml` to match the 5A data-intake guides (merchant class, demand scale, baseline intensity, shape library, scenario horizon, scenario overlay, scenario calendar).
   - Left `scenario_metadata`, `overlay_ordering_policy_5A`, `scenario_overlay_validation_policy_5A`, and `shape_time_grid_policy_5A` permissive pending dedicated guide coverage.

* 1:21am
   - Reviewed 5A state-flow specs for references to additional policy/config artefacts and compared them to 5A contracts/guide coverage.
   - Confirmed which items are referenced in specs but lack data-intake guides or contract entries (e.g., shape_time_grid_policy_5A, baseline_validation_policy_5A, overlay_ordering_policy_5A, scenario_overlay_validation_policy_5A, validation_policy_5A, spec_compatibility_config_5A, class_shape_templates_5A, zone_shape_modifiers_5A, channel_shape_modifiers_5A).
