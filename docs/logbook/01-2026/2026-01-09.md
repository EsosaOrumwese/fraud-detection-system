# Logbook
### Date: 9th January 2026
### Project: Fraud Detection System
### Reference commits: Check commits on this date (if any)

* 12:02am
   - Checked the local system time with `Get-Date` before formalizing the 2A merchant_mcc_map contract.
   - Reviewed the 2A data-intake guide, the 2A dictionary/registry, and the ingress schema pack to determine where to register `merchant_mcc_map`.
   - Planned to add a `merchant_mcc_map` schema anchor in `schemas.ingress.layer1.yaml`, register it as optional reference_data in the 2A dictionary, and add a matching cross-layer pointer in the 2A registry.

* 12:05am
   - Added the `merchant_mcc_map` table schema to `docs/model_spec/data-engine/layer-1/specs/contracts/1A/schemas.ingress.layer1.yaml`.
   - Registered `merchant_mcc_map` as an optional ingress reference in `docs/model_spec/data-engine/layer-1/specs/contracts/2A/dataset_dictionary.layer1.2A.yaml` and added the matching cross-layer pointer to `docs/model_spec/data-engine/layer-1/specs/contracts/2A/artefact_registry_2A.yaml`.
   - Updated `docs/model_spec/data-engine/layer-1/specs/data-intake/2A/merchant_mcc_map_derivation-guide.md` and `docs/model_spec/data-engine/layer-1/specs/data-intake/layer-1_data.md` to point at the new schema anchor.

* 12:06am
   - Ran a repository search to confirm `merchant_mcc_map` references now point at the new schema anchor across layer-1 specs.

* 12:13am
   - Updated `docs/model_spec/data-engine/layer-1/specs/state-flow/2A/state.2A.s2.expanded.md` to name `merchant_mcc_map` (schema `schemas.ingress.layer1.yaml#/merchant_mcc_map`) as the optional MCC mapping anchor instead of a programme-specific placeholder.

* 12:17am
   - Read the 2B data-intake policy guides (alias_layout_policy_v1, day_effect_policy_v1, route_rng_policy_v1, virtual_edge_policy_v1) and compared them to `docs/model_spec/data-engine/layer-1/specs/contracts/2B/schemas.2B.yaml` to assess schema coverage.

* 12:19am
   - Recommended using `pad_byte_hex` as the canonical padding key and adopting a moderately strict schema posture (required keys + basic type/enum constraints, `extensions` allowed) for the 2B policy schemas.

* 12:22am
   - Added moderately strict schema shapes for `route_rng_policy_v1`, `alias_layout_policy_v1`, and `day_effect_policy_v1` in `docs/model_spec/data-engine/layer-1/specs/contracts/2B/schemas.2B.yaml`, keeping `extensions` as the expansion bucket.
   - Updated the 2B policy guides to reference schema anchors and aligned the alias layout padding key to `pad_byte_hex`.

* 12:23am
   - Sanity-checked 2B dictionary/registry policy schema refs and confirmed they point to the updated `schemas.2B.yaml#/policy/*` anchors.

* 12:26am
   - Tightened 3A policy schema anchors in `docs/model_spec/data-engine/layer-1/specs/contracts/3A/schemas.3A.yaml` to require rules for `zone_mixture_policy_v1`, enforce allowed metrics/decision reasons, and require positive `alpha` values for `country_zone_alphas_v1`.

* 12:36am
   - Audited 3B data-intake guides against `docs/model_spec/data-engine/layer-1/specs/contracts/3B/schemas.3B.yaml` and tightened schema anchors for external weights, virtual rules, CDN weights, validation policy, key digest, and settlement coordinates.
   - Added a new `virtual_logging_policy_v1` schema anchor and registered the policy in the 3B dictionary and registry.
   - Aligned 3B intake guides with contract paths and schema anchors (cdn weights external path, pelias cached dataset id, virtual logging policy schema reference).

* 12:44am
   - Recommended splitting the Pelias SQLite bundle metadata into its own contract entry (pelias_cached_bundle) and giving the sqlite file a minimal file-level schema anchor to avoid mismatched schema references.

* 12:50am
   - Added `pelias_cached_bundle_v1` and `pelias_cached_sqlite_v1` reference anchors in `docs/model_spec/data-engine/layer-1/specs/contracts/3B/schemas.3B.yaml`.
   - Updated `docs/model_spec/data-engine/layer-1/specs/contracts/3B/dataset_dictionary.layer1.3B.yaml` to point `pelias_cached_sqlite` at `pelias_cached_sqlite_v1` and registered `pelias_cached_bundle` with its own schema anchor.
   - Updated `docs/model_spec/data-engine/layer-1/specs/contracts/3B/artefact_registry_3B.yaml` to align schema refs and add the `pelias_cached_bundle` registry entry with a dependency on `pelias_cached_sqlite`.
   - Updated `docs/model_spec/data-engine/layer-1/specs/data-intake/3B/pelias_cached.sqlite_acquisition-guide.md` to document the sqlite + metadata bundle pair and their schema anchors.
   - Ran `rg` and `Get-Content` checks to confirm the new Pelias bundle entries are present in the contracts and guide.

* 12:53am
   - Reviewed the 3A data-intake guides (`zone_mixture_policy_3A.md`, `zone_floor_policy_3A.md`, `country_zone_alphas_3A.md`) and confirmed each already names the correct `schemas.3A.yaml#/policy/*` schema authority anchor.
   - No edits required for the 3A schema-anchoring pass.

* 12:56am
   - Reviewed the 5A data-intake guides in `docs/model_spec/data-engine/layer-2/specs/data-intake/5A` for schema anchors.
   - Added the missing schema anchor reference to `docs/model_spec/data-engine/layer-2/specs/data-intake/5A/scenario_calendar_5A_derivation-guide.md`.

* 1:02am
   - Tightened the 5A policy and scenario schemas in `docs/model_spec/data-engine/layer-2/specs/contracts/5A/schemas.5A.yaml` to match the 5A data-intake guides (merchant class, demand scale, baseline intensity, shape library, scenario horizon, scenario overlay, scenario calendar).
   - Left `scenario_metadata`, `overlay_ordering_policy_5A`, `scenario_overlay_validation_policy_5A`, and `shape_time_grid_policy_5A` permissive pending dedicated guide coverage.

* 1:21am
   - Reviewed 5A state-flow specs for references to additional policy/config artefacts and compared them to 5A contracts/guide coverage.
   - Confirmed which items are referenced in specs but lack data-intake guides or contract entries (e.g., shape_time_grid_policy_5A, baseline_validation_policy_5A, overlay_ordering_policy_5A, scenario_overlay_validation_policy_5A, validation_policy_5A, spec_compatibility_config_5A, class_shape_templates_5A, zone_shape_modifiers_5A, channel_shape_modifiers_5A).

* 1:41am
   - Re-checked `docs/model_spec/data-engine/layer-2/specs/state-flow/5A/state.5A.s2.expanded.md` to confirm how the specs describe time-grid config vs shape library policies for 5A.

* 1:53am
   - Removed the grid contract from `docs/model_spec/data-engine/layer-2/specs/data-intake/5A/shape_library_5A_authoring-guide.md` and updated section numbering to make `shape_time_grid_policy_5A` the sole grid authority.
   - Updated `docs/model_spec/data-engine/layer-2/specs/contracts/5A/schemas.5A.yaml` to drop the `shape_library_5A.grid` schema and add a strict schema for `shape_time_grid_policy_5A`.

* 1:55am
   - Scanned the 5A state-flow docs to check for any wording that assumes the local-week grid lives inside `shape_library_5A`.

* 1:59am
   - Added a one-line rule in `docs/model_spec/data-engine/layer-2/specs/state-flow/5A/state.5A.s2.expanded.md` clarifying that `shape_time_grid_policy_5A` is the sole grid authority and `shape_library_5A` must not redefine it.

* 3:23am
   - Reviewed the newly added 5A data-intake guides for zone modifiers, overlay ordering/validation, validation policy, and spec compatibility to assess alignment with contracts and schema anchors.

* 3:33am
   - Added strict schema definitions in docs/model_spec/data-engine/layer-2/specs/contracts/5A/schemas.5A.yaml for zone_shape_modifiers_5A, overlay_ordering_policy_5A, scenario_overlay_validation_policy_5A, alidation_policy_5A, and spec_compatibility_config_5A, plus a shared overlay_type_aggregation_v1  helper.
   - Added zone_shape_modifiers_5A, alidation_policy_5A, and spec_compatibility_config_5A entries to docs/model_spec/data-engine/layer-2/specs/contracts/5A/dataset_dictionary.layer2.5A.yaml and updated the shape_library_5A description to remove grid authority wording.
   - Updated docs/model_spec/data-engine/layer-2/specs/contracts/5A/dataset_dictionary.layer2.5A.yaml and docs/model_spec/data-engine/layer-2/specs/contracts/5A/artefact_registry_5A.yaml to point overlay_ordering_policy_5A at the new policy schema anchor.
   - Added registry entries for zone_shape_modifiers_5A, alidation_policy_5A, and spec_compatibility_config_5A in docs/model_spec/data-engine/layer-2/specs/contracts/5A/artefact_registry_5A.yaml.

* 3:40am
   - Added schema anchor bullets to docs/model_spec/data-engine/layer-2/specs/data-intake/5A/zone_shape_modifiers_5A-_authoring-guide.md, docs/model_spec/data-engine/layer-2/specs/data-intake/5A/scenario_overlay_validation_policy_5A_authoring-guide.md, and docs/model_spec/data-engine/layer-2/specs/data-intake/5A/spec_compatibility_config_5A_authoring-guide.md.

* 3:42am
   - Swept docs/model_spec/data-engine/layer-2/specs/data-intake/5A for schema anchor lines; found channel_shape_modifiers_5A_authoring-guide.md missing an anchor and noted that class_shape_templates_5A_authoring-guide.md and aseline_validation_policy_5A_authoring-guide.md point to anchors not present in docs/model_spec/data-engine/layer-2/specs/contracts/5A/schemas.5A.yaml.

* 3:48am
   - Added the missing schema anchor line to docs/model_spec/data-engine/layer-2/specs/data-intake/5A/channel_shape_modifiers_5A_authoring-guide.md.
   - Added schema definitions for aseline_validation_policy_5A and class_shape_templates_5A in docs/model_spec/data-engine/layer-2/specs/contracts/5A/schemas.5A.yaml to match the data-intake guides.

* 3:51am
   - Added the channel_shape_modifiers_5A schema and its shared channel_modifier_profile_v1 definition to docs/model_spec/data-engine/layer-2/specs/contracts/5A/schemas.5A.yaml to align with the 5A data-intake guide.

* 3:57am
   - Scanned docs/model_spec/data-engine/layer-2/specs/data-intake/5B guides for schema anchors and compared them to docs/model_spec/data-engine/layer-2/specs/contracts/5B/schemas.5B.yaml. All guides have schema anchor lines, but three point to #/policy/* while the schema pack exposes them under #/config/* (arrival_routing_policy_5B, arrival_time_placement_policy_5B, validation_policy_5B).

* 4:06am
   - Replaced the permissive 5B config schemas in docs/model_spec/data-engine/layer-2/specs/contracts/5B/schemas.5B.yaml with strict shapes for time_grid_policy_5B, grouping_policy_5B, arrival_lgcp_config_5B, arrival_count_config_5B, arrival_time_placement_policy_5B, arrival_routing_policy_5B, arrival_rng_policy_5B, and validation_policy_5B per the data-intake guides.
   - Updated the 5B guide schema anchors for arrival_routing_policy_5B, arrival_time_placement_policy_5B, and validation_policy_5B to use schemas.5B.yaml#/config/* to match the contract schema locations.

* 4:09am
   - Confirmed 5B schema_ref anchors in docs/model_spec/data-engine/layer-2/specs/contracts/5B/dataset_dictionary.layer2.5B.yaml and docs/model_spec/data-engine/layer-2/specs/contracts/5B/artefact_registry_5B.yaml resolve to entries present in docs/model_spec/data-engine/layer-2/specs/contracts/5B/schemas.5B.yaml.

* 4:12am
   - Scanned 5B state-flow docs for schema anchor references and found a single mismatch: schemas.5B.yaml#/control/sealed_inputs_5B in state.5B.s0.expanded.md (the schema pack exposes sealed_inputs_5B under alidation).

* 4:13am
   - Fixed the sealed-inputs schema anchor in docs/model_spec/data-engine/layer-2/specs/state-flow/5B/state.5B.s0.expanded.md to schemas.5B.yaml#/validation/sealed_inputs_5B.

* 4:19am
   - Listed 6A data-intake guides in docs/model_spec/data-engine/layer-3/specs/data-intake/6A and noted none currently include schema anchor lines; opened docs/model_spec/data-engine/layer-3/specs/contracts/6A/schemas.6A.yaml to prep for adding strict policy/prior/taxonomy shapes.

* 4:36am
   - Added shared schema defs (id_token, probability, range helpers) to `docs/model_spec/data-engine/layer-3/specs/contracts/6A/schemas.6A.yaml`.
   - Expanded 6A prior schemas in `docs/model_spec/data-engine/layer-3/specs/contracts/6A/schemas.6A.yaml` to cover population, segmentation, account_per_party, product_mix, instrument_per_account, instrument_mix, device_count, ip_count, and S5 role priors with required keys and typed sub-structures.
   - Expanded 6A taxonomy schemas in `docs/model_spec/data-engine/layer-3/specs/contracts/6A/schemas.6A.yaml` for party, account_types, instrument_types, devices, and ips to match the data-intake guides.
   - Added detailed policy schemas for `graph_linkage_rules_6A` and `device_linkage_rules_6A` in `docs/model_spec/data-engine/layer-3/specs/contracts/6A/schemas.6A.yaml`.

* 4:42am
   - Added missing schema anchor lines to the 6A taxonomy guides (account_types, instrument_types, devices, ips) to match `schemas.6A.yaml#/taxonomy/*`.

* 5:01am
   - Added shared schema defs (id_token, probability, range helpers) to docs/model_spec/data-engine/layer-3/specs/contracts/6B/schemas.6B.yaml.
   - Expanded the 6B policy schemas in docs/model_spec/data-engine/layer-3/specs/contracts/6B/schemas.6B.yaml to capture the data-intake guide structures for S1-S5 policies.

* 5:15am
   - Tightened nested schema shapes in docs/model_spec/data-engine/layer-3/specs/contracts/6B/schemas.6B.yaml (policy vocabularies, RNG policy substructures, delay/timing/campaign/fraud/truth/bank/case validation shapes, and stricter enums/required fields).
   - Added the missing schema_ref line to docs/model_spec/data-engine/layer-3/specs/data-intake/6B/fraud_campaign_catalogue_config_6B_authoring-guide.md and cleaned schema anchor notes in delay_models_6B and rng_policy_6B guides.

* 5:50am
   - Tightened remaining nested policy sections in docs/model_spec/data-engine/layer-3/specs/contracts/6B/schemas.6B.yaml (behaviour_config guardrails, behaviour_prior_pack submodels, flow_shape branching and enums, timing composition rules, delay models, fraud campaign/overlay structures, RNG policy substructures, and bank/truth/case vocab constraints).
   - Added/cleaned schema anchors in 6B guides and ran a focused anchor audit confirming all guide schema refs resolve.

* 5:58am
   - Added strict amount/distribution and delay distribution schema defs in docs/model_spec/data-engine/layer-3/specs/contracts/6B/schemas.6B.yaml (lognormal/lognormal mix/gamma/discrete price points for amounts; QF distributions for delays).
   - Tightened amount_model_6B and delay_models_6B policy shapes to bind to the new distribution schemas and require the guide-specified fields (rules, constraints, rounding, guardrails, realism targets).

* 6:05am
   - Read docs/tmp/artefact_list_review.md and compared layer-2/3 policy/config mentions against schemas.5A.yaml, schemas.5B.yaml, schemas.6A.yaml, and schemas.6B.yaml.
   - Identified which layer-2/3 policy IDs are present in their schema packs vs mismatched or upstream-only references.

* 6:12am
   - Updated docs/tmp/artefact_list_review.md to align layer-2/3 policy names with schema IDs and expanded 6A priors/taxonomies/policies into explicit contract IDs.

* 6:15am
   - Ran a consistency pass comparing policy/config/prior/taxonomy ids in docs/tmp/artefact_list_review.md against the layer-2/3 schema packs; confirmed all segment-local items resolve, with only upstream policy references and one report metric flagged.
