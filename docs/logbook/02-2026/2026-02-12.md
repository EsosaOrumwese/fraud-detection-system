# Logbook
### Date: 12th February 2026
### Project: Fraud Detection System
### Reference commits: Check commits on this date (if any)

* 4:30AM
  - Captured migration challenge raised by USER in active platform planning:
    - problem: moving from local-compute success to managed dev-substrate portability lacked an explicit cross-phase checklist.
  - Added binding section to `docs/model_spec/platform/implementation_maps/dev_substrate/platform.build_plan.md`:
    - `## Local-to-Managed Compute Migration Playbook (binding across phases)`.
  - Section now pins required migration mechanics:
    - local coupling inventory,
    - managed execution package contract,
    - managed-lane preflight,
    - cutover/rollback criteria,
    - portability acceptance proof (`run anywhere` evidence).
  - Tightened Phase `3.C` progression rule:
    - each component migration gate must satisfy this playbook before acceptance-valid status.
  - Related implementation-map entries appended:
    - pre-change lock + applied closure in `docs/model_spec/platform/implementation_maps/dev_substrate/platform.impl_actual.md`.
  - Cost posture:
    - docs-only pass; no paid services touched.

* 4:46AM
  - Added explicit migration-solution lock requested by USER in active plan:
    - migration must start with a full decomposition of "what worked locally" (every process/subprocess), not only service-level labels.
  - Updated `docs/model_spec/platform/implementation_maps/dev_substrate/platform.build_plan.md`:
    - inserted `0. Local run process decomposition baseline (mandatory first)` inside the local-to-managed playbook,
    - required artifact: `Local Run Process Inventory Matrix`,
    - added DoD item requiring matrix completion per active corridor before acceptance progression.
  - Updated `docs/model_spec/platform/implementation_maps/dev_substrate/platform.impl_actual.md`:
    - appended pre-change lock + applied closure entries.
  - Cost posture:
    - docs-only pass; no paid services touched.

* 4:50AM
  - Created first concrete `Local Run Process Inventory Matrix` artifact for migration baseline:
    - `docs/model_spec/platform/implementation_maps/dev_substrate/local_run_process_inventory_matrix.md`
  - Matrix now inventories local-run process depth across full parity chain plus active dev-substrate operator lane:
    - infra/bootstrap,
    - Oracle sync/pack/sort,
    - SR/WSP/IG/EB boundary,
    - RTDL core + decision,
    - case/label,
    - learning jobs,
    - obs/gov,
    - dev-substrate phase3 local operator commands.
  - Added explicit artifact-path reference in active build plan playbook section:
    - `docs/model_spec/platform/implementation_maps/dev_substrate/platform.build_plan.md`
  - Process ID coverage in this pass:
    - `65` inventory rows with stable corridor-prefixed IDs.
  - Related implementation-map entry appended:
    - `docs/model_spec/platform/implementation_maps/dev_substrate/platform.impl_actual.md`.
  - Cost posture:
    - docs-only pass; no paid services touched.

* 5:29AM
  - Resumed dev_substrate migration planning and pinned migration baseline scope to **Spine Green v0**.
  - Updated `docs/model_spec/platform/implementation_maps/dev_substrate/platform.build_plan.md`:
    - added `Migration Baseline Gate (Spine Green v0)` section,
    - baseline includes C&I + RTDL + Case/Labels + Run/Operate/Obs/Gov,
    - Learning/Registry full closure (`OFS/MF/MPR`) marked out of scope for this migration phase.
  - Decision trail recorded in `docs/model_spec/platform/implementation_maps/dev_substrate/platform.impl_actual.md` (pre-change lock + applied entry).
  - Cost posture:
    - docs-only pass; no paid services touched.

* 5:45AM
  - Captured a dedicated ordered process-flow artifact for what "Spine Green runs locally" means end-to-end.
  - Added:
    - `docs/model_spec/platform/implementation_maps/dev_substrate/local_run_spine_green_major_process_flow.md`
  - Artifact scope:
    - Spine Green v0 only (`CI`, `RTDL`, `Case/Labels`, `Run/Operate`, `Obs/Gov`),
    - Learning (`OFS/MF/MPR`) explicitly excluded.
  - Each ordered step now records:
    - process name,
    - entry point (`make` / CLI / run_operate step id),
    - one-line inputs -> outputs,
    - one green-proof artifact path/topic.
  - Decision/action trail appended in:
    - `docs/model_spec/platform/implementation_maps/dev_substrate/platform.impl_actual.md`.
  - Cost posture:
    - docs-only pass; no paid services touched.

* 5:55AM
  - Opened execution track for USER-requested local parity proof of `Spine Green v0` at `200` bounded events using:
    - `docs/runbooks/platform_parity_walkthrough_v0.md`
  - Logged pre-run detailed plan and acceptance criteria in:
    - `docs/model_spec/platform/implementation_maps/dev_substrate/platform.impl_actual.md`
  - Scope lock for this run:
    - in scope: `Control+Ingress`, `RTDL`, `Case+Labels`, `Run/Operate+Obs/Gov`
    - out of scope: `Learning/Registry (OFS/MF/MPR)` migration closure
  - Next actions queued:
    - parity stack bootstrap/status,
    - oracle sync/seal/sort for `c25a2675fbfbacd952b13bb594880e92`,
    - run/operate spine packs + SR/WSP bounded `200` pass,
    - artifact/health/governance evidence closeout and drift assessment.

* 7:59AM
  - Completed full local parity execution for Spine Green v0 verification on run:
    - `platform_20260212T075128Z`
  - Runtime actions completed:
    - parity stack up/bootstrap/status,
    - oracle sync + pack + strict check,
    - stream-sort built for `s3_event_stream_with_fraud_6B`, `arrival_events_5B`, `s1_arrival_entities_6B`, `s3_flow_anchor_with_fraud_6B`,
    - run/operate packs up for `control_ingress`, `rtdl_core`, `rtdl_decision_lane`, `case_labels`, `obs_gov`,
    - SR READY publish and bounded WSP stream (`200` per output).
  - Evidence highlights:
    - WSP stop markers show all four outputs ended at `emitted=200`,
    - IG receipts count: `1581`, sampled receipts include `offset_kind=kinesis_sequence`,
    - conformance artifact status is `PASS`,
    - governance stream includes `RUN_STARTED`, `RUN_READY_SEEN`, `RUN_ENDED`, `RUN_REPORT_GENERATED`.
  - Material findings (prevents strict all-green declaration):
    - `decision_log_audit` remains `AMBER` (`UNRESOLVED_AMBER`, `lineage_unresolved_total=1`),
    - `platform-operate-parity-status` fails when Learning env vars are absent (`PARITY_OFS_RUN_LEDGER_DSN`) despite Learning being out-of-scope,
    - IG `/v1/ops/health` without auth header yields `500`; authenticated request returns `GREEN`.
  - Notes appended to implementation maps:
    - `docs/model_spec/platform/implementation_maps/dev_substrate/platform.impl_actual.md`
    - `docs/model_spec/platform/implementation_maps/local_parity/platform.impl_actual.md`

* 8:35AM
  - Opened remediation pass after USER direction to proceed with both fixes:
    - parity status env behavior for spine-only checks,
    - DLA unresolved lineage issue.
  - Added pre-change lock entry to:
    - `docs/model_spec/platform/implementation_maps/dev_substrate/platform.impl_actual.md`
  - Root-cause notes pinned in that entry:
    - learning pack strict env expansion caused `platform-operate-parity-status` failure when explicit OFS/MF DSNs were not present,
    - DLA unresolved chain traced to missed decision/intent ingestion with outcome present; local parity DLA kinesis start at `latest` with no checkpoint is a likely miss path for early run events.
  - Remediation plan pinned:
    - add default-safe learning DSN expansion in learning pack,
    - harden DLA intake start/skip behavior for run-scoped parity,
    - run targeted tests,
    - re-run 200-event parity verification and reassess Spine Green v0 closure.

* 9:01AM
  - Applied remediation code/config updates:
    - `config/platform/run_operate/packs/local_parity_learning_jobs.v0.yaml`
      - OFS/MF ledger DSN env expansion now fallback-safe.
    - `src/fraud_detection/decision_log_audit/intake.py`
      - `RUN_SCOPE_MISMATCH` path now checkpoint-skip without quarantine write.
      - first kinesis read with no checkpoint + required run pin forces `trim_horizon`.
    - `src/fraud_detection/action_layer/worker.py`
      - first kinesis read with no checkpoint + required run pin forces `trim_horizon`.
    - `tests/services/decision_log_audit/test_dla_phase3_intake.py`
      - added run-scope skip and kinesis first-read behavior coverage.
  - Targeted tests executed:
    - `tests/services/decision_log_audit/test_dla_phase3_intake.py` -> `12 passed`.
    - `tests/services/decision_log_audit/test_dla_phase4_lineage.py` -> `5 passed`.
    - `tests/services/action_layer/test_phase8_validation_matrix.py` -> `3 passed`.
  - Fresh local parity verification run executed:
    - run id: `platform_20260212T085637Z`
    - bounded stream: `WSP_MAX_EVENTS_PER_OUTPUT=200`
    - WSP stop markers observed at `08:58:56`/`08:59:39`/`08:59:40` with `emitted=200` across expected outputs.
  - Closure evidence:
    - `make platform-operate-parity-status` now clean and all packs ready.
    - `runs/fraud-platform/platform_20260212T085637Z/decision_log_audit/health/last_health.json` -> `GREEN`, `lineage_unresolved_total=0`.
    - `runs/fraud-platform/platform_20260212T085637Z/decision_fabric/health/last_health.json` -> `GREEN`.
    - `runs/fraud-platform/platform_20260212T085637Z/action_layer/health/last_health.json` -> `GREEN` with intake/outcome parity.
    - `runs/fraud-platform/platform_20260212T085637Z/obs/environment_conformance.json` -> `status=PASS`.
  - Notes appended:
    - `docs/model_spec/platform/implementation_maps/dev_substrate/platform.impl_actual.md`
    - `docs/model_spec/platform/implementation_maps/local_parity/platform.impl_actual.md`
  - Post-apply correction completed:
    - nested env-token fallback in `local_parity_learning_jobs.v0.yaml` proved incompatible with run-operate token parser.
    - updated approach:
      - keep pack tokens flat (`${PARITY_OFS_RUN_LEDGER_DSN:-}`, `${PARITY_MF_RUN_LEDGER_DSN:-}`),
      - inject resolved parity DSN vars from make defaults in `platform-operate-learning-jobs-{up,down,restart,status}`.
    - validation:
      - `make platform-operate-learning-jobs-status` clean,
      - malformed literal artifact removed after learning-jobs restart.

* 10:31AM
  - Opened targeted IG auth-remediation pass for ops endpoints after USER request.
  - Problem pinned:
    - unauthenticated `GET /v1/ops/health` currently returns `500` instead of `401`.
  - Root cause pinned in implementation map:
    - `ops_health` and `ops_lookup` call `_require_auth` without `IngestionError` handling.
  - Plan:
    - align ops route error mapping with `ingest_push` (`IngestionError -> _error_status`),
    - add/extend tests for unauthorized and authorized ops endpoint behavior,
    - validate locally.

* 10:37AM
  - Applied IG ops endpoint auth error mapping fix:
    - updated `src/fraud_detection/ingestion_gate/service.py` so `/v1/ops/lookup` and `/v1/ops/health` catch `IngestionError` and return mapped status codes.
  - Added regression tests:
    - `tests/services/ingestion_gate/test_phase5_auth_rate.py`
      - `test_ops_health_requires_api_key`
      - `test_ops_lookup_requires_api_key`
  - Test validation:
    - `pytest tests/services/ingestion_gate/test_phase5_auth_rate.py tests/services/ingestion_gate/test_phase4_service.py -q`
    - result: `7 passed`.
  - Runtime validation after `make platform-operate-control-ingress-restart`:
    - unauth `GET /v1/ops/health` -> `401` with `{"error":"UNAUTHORIZED"}`,
    - auth `GET /v1/ops/health` (`X-IG-Api-Key: local-parity-wsp`) -> `200` with `{"state":"GREEN","reasons":[]}`.
  - Notes appended:
    - `docs/model_spec/platform/implementation_maps/dev_substrate/platform.impl_actual.md`
    - `docs/model_spec/platform/implementation_maps/local_parity/platform.impl_actual.md`
