# 2026-02-21


## 2026-02-21 02:06:41 +00:00 - 5A POPT.2 planned to execution-grade (S4 hotspot)
- Expanded `POPT.2` in `segment_5A.build_plan.md` from placeholder to bounded subphases:
  - `POPT.2.1` scorer/equivalence contract,
  - `POPT.2.2` S4 lane instrumentation + hotspot reconfirm,
  - `POPT.2.3` input validation/load-path optimization,
  - `POPT.2.4` overlay compute + mapping optimization,
  - `POPT.2.5` witness rerun + closure scoring,
  - `POPT.2.6` closure/handoff/prune sync.
- Pinned post-POPT.1 baseline authority for POPT.2 planning:
  - run-id `ce57da0ead0d4404a5725ca3f4b6e3be`,
  - `S4 wall=456.687s`.
- Pinned quantified closure gate:
  - `S4 <= 360.0s` OR `>=20%` reduction vs active baseline (`<=365.350s`).
- Pinned structural veto rails:
  - stable S4 counters (`domain/event/horizon/overlay/scenario`),
  - no error surface,
  - warning rails non-regression,
  - downstream `S4->S5 PASS`.
- Rerun/prune posture:
  - S4 edits rerun `S4->S5`,
  - S5 support edits rerun `S5` and re-score,
  - prune superseded failed candidate run folders before expensive reruns.
- Phase status sync:
  - `POPT` now recorded as `POPT.0 + POPT.1 closed; POPT.2 expanded/planned on S4, execution pending`.

## 2026-02-21 02:09:23 +00:00 - M10.F bounded rerun started (B1/B5/B8-only)
- USER directive: rerun M10.F with bounded plan focused only on clearing blockers M10F-B1, M10F-B5, M10F-B8 before any M10.G progression.
- Execution id pinned: m10_20260221T020923Z.
- Bounded rerun contract:
  1. B5: use IG Postgres eceipts window counts as authoritative attempt-scoped source (no run_report delta basis).
  2. B8: enforce runtime budget guard by hard stop policy (target window >=15m and <=90m, operator cap ~16-20m for this attempt).
  3. B1: compute multiplier from window ADMIT/min against M10.E baseline (418.66295264623955 admits/min), plus admit-ratio gate (>=0.995).
- Non-goals in this rerun: no new lane scope, no M10.G progression, no unrelated infra changes.

## 2026-02-21 02:15:33 +00:00 - 5A POPT.2 full execution started
- Started full `POPT.2` execution (`POPT.2.1 -> POPT.2.6`) with documentation-first posture.
- Baseline authority at start:
  - run-id `ce57da0ead0d4404a5725ca3f4b6e3be`,
  - `S4 wall=456.687s`,
  - closure gate `S4<=360s` OR `>=20%` reduction.
- Pre-code evidence review from run log:
  - dominant drag is row-wise validation of `merchant_zone_baseline_local_5A` (~414s before compute/output lanes).
- Execution order pinned:
  1) scorer contract + lane tooling,
  2) S4 instrumentation witness,
  3) strict vectorized validation fast-path for S4 inputs,
  4) bounded compute-path tuning only if needed,
  5) witness rerun + closure scoring,
  6) close decision + prune sync.
- Guardrails reaffirmed:
  - no policy/coeff tuning,
  - fail-closed semantics unchanged,
  - downstream `S4->S5 PASS` remains hard veto.

## 2026-02-21 02:22:07 +00:00 - 5A POPT.2.1/.2 tooling + S4 instrumentation landed
- Added scorer tools:
  - `tools/score_segment5a_popt2_lane_timing.py` (S4 lane decomposition artifact),
  - `tools/score_segment5a_popt2_closure.py` (runtime/veto closure decision artifact).
- Updated `s4_calendar_overlays/runner.py` with deterministic S4 phase markers:
  - begin,
  - input_load_schema_validation complete,
  - domain_horizon_mapping complete,
  - overlay_compute complete,
  - output_schema_validation complete,
  - output_write complete.
- Extended `_StepTimer.info` to support formatted marker payloads.
- Added strict fast-path-ready `frame` validation lane in `_validate_array_rows` for heavy S4 input anchors with fallback to row-wise validator (no fail-closed relaxation).
- Compile sanity passed:
  - `runner.py`, `score_segment5a_popt2_lane_timing.py`, `score_segment5a_popt2_closure.py`.
- Next action:
  - run new candidate witness (`S4->S5`) and emit lane-timing + closure artifacts.

## 2026-02-21 02:17:12 +00:00 - 5A POPT.2 execution incident: staging/run-root issues identified
- Attempted candidate run-id `86aa72dbd8254b0d93063e9e4365fc08` failed in first make calls.
- Diagnosed two issues:
  1) missing explicit `RUNS_ROOT` in make command (defaulted to `runs/local_full_run-5`),
  2) cloned candidate folder retained prior S4 outputs causing idempotent publish conflict (`S4_OUTPUT_CONFLICT`) once execution progressed.
- Decision:
  - pin `RUNS_ROOT=runs/fix-data-engine/segment_5A` in all POPT.2 commands,
  - use clean-stage candidate pattern (copy required upstream inputs but exclude S4/S5 output dirs).

## 2026-02-21 02:23:10 +00:00 - 5A POPT.2 corrected witness run started (clean-stage)
- Staged clean candidate run-id `7f20e9d97dad4ff5ac639bbc41749fb0` from `ce57...`:
  - copied upstream/required S0-S3 inputs,
  - excluded S4/S5 outputs (`merchant_zone_scenario_local`, `merchant_zone_overlay_factors`, `merchant_zone_scenario_utc`, `validation`).
- Executed `S4` with explicit run root:
  - `make segment5a-s4 RUNS_ROOT=runs/fix-data-engine/segment_5A SEG5A_S4_RUN_ID=7f20e9d97dad4ff5ac639bbc41749fb0`
  - result: PASS.
  - S4 wall dropped to `54.875s`.

## 2026-02-21 02:24:15 +00:00 - 5A POPT.2 witness chain closure run completed
- Executed `S5` on same candidate:
  - `make segment5a-s5 RUNS_ROOT=runs/fix-data-engine/segment_5A SEG5A_S5_RUN_ID=7f20e9d97dad4ff5ac639bbc41749fb0`
  - result: PASS.
- Emitted scoring artifacts:
  - baseline profile: `segment5a_popt0_baseline_7f20e9d97dad4ff5ac639bbc41749fb0.json`
  - lane timing: `segment5a_popt2_lane_timing_7f20e9d97dad4ff5ac639bbc41749fb0.json`
  - closure: `segment5a_popt2_closure_7f20e9d97dad4ff5ac639bbc41749fb0.json`.

## 2026-02-21 02:28:38 +00:00 - 5A POPT.2 closed; UNLOCK_POPT3 + prune sync
- Closure decision:
  - `UNLOCK_POPT3`.
- Gate summary:
  - `S4 baseline=456.687s`, `candidate=54.875s`, improvement `87.98%`.
  - runtime gate PASS (`<=360s` or `>=20%` reduction).
  - structural veto rails PASS (counts/warnings/status + downstream S5 PASS).
- Lane summary:
  - input validation lane reduced to `1.48s` (`2.70%` share);
  - dominant residual lane is now overlay compute (`34.11s`, `62.16%`) but absolute runtime remains strongly within budget.
- Storage prune applied:
  - `python tools/prune_run_folders_keep_set.py --runs-root runs/fix-data-engine/segment_5A --keep 7b08449ccffc44beaa99e64bf0201efc --keep ac363a2f127d43d1a6e7e2308c988e5e --keep ce57da0ead0d4404a5725ca3f4b6e3be --keep 7f20e9d97dad4ff5ac639bbc41749fb0 --yes`
  - removed superseded failed run-id folder `86aa72dbd8254b0d93063e9e4365fc08`.
- Build plan + implementation map synced to reflect full POPT.2 closure and handoff to POPT.3.

## 2026-02-21 02:26:40 +00:00 - M10.F bounded rerun control-plane timeout blocker
- During bounded poll/stop control, AWS CLI calls started timing out (cs describe-tasks, sts get-caller-identity).
- Impact: temporary inability to enforce the planned bounded stop window for active burst task 9cc52d0f16df4dcc8693b98dc7f714a4.
- Fail-closed action:
  1. paused further lane progression,
  2. entered retry loop for control-plane restoration,
  3. no M10.G movement while this blocker is unresolved.

## 2026-02-21 02:45:20 +00:00 - 5A POPT.3 expanded to execution-grade plan (S5 hotspot)
- Expanded `POPT.3` in `segment_5A.build_plan.md` from placeholder to bounded subphases:
  - `POPT.3.1` closure scorer + equivalence contract lock,
  - `POPT.3.2` S5 lane instrumentation + hotspot reconfirm,
  - `POPT.3.3` schema/introspection + projection narrowing,
  - `POPT.3.4` recomposition/check-path compute optimization,
  - `POPT.3.5` witness rerun + closure scoring,
  - `POPT.3.6` phase closure/handoff/prune sync.
- Pinned post-POPT.2 authority baseline for POPT.3:
  - run-id `7f20e9d97dad4ff5ac639bbc41749fb0`,
  - `S5 wall=243.187s` (target `180s`, stretch `240s`),
  - `S5 core_compute=242.681s` (`99.79%` lane share).
- Pinned quantified POPT.3 closure gate:
  - `S5 <= 180.0s` OR `>=20%` reduction vs baseline (`<=194.550s`).
- Pinned structural veto rails:
  - `S5 PASS`, clean error surface,
  - unchanged S1-derived counters (`rows/merchants/countries/tzids`),
  - required validation outputs present (`index`, `report`, `_passed.flag`).
- Synced phase status:
  - `POPT` now recorded as `POPT.0 + POPT.1 + POPT.2 closed; POPT.3 expanded/planned on S5, execution pending`.

## 2026-02-21 02:47:33 +00:00 - 5A POPT.3 full execution started (documentation-first)
- Began full execution lane `POPT.3.1 -> POPT.3.6`.
- Completed S5 code reconnaissance before mutation:
  - compute lane dominates runtime (`~99.79%` in baseline),
  - repeated schema introspection in scenario loop,
  - recomposition path uses Python-heavy sample mapping + join + row loop.
- Decision:
  - proceed with bounded optimization first (scorer + markers + projection/schema hoists + targeted recomposition path cleanup),
  - hold high-blast-radius full vectorized redesign in reserve if bounded lane misses runtime gate.
- Guardrails reaffirmed:
  - no policy/config/coeff changes,
  - no validator-rule relaxation,
  - no idempotency weakening.

## 2026-02-21 02:53:02 +00:00 - 5A POPT.3 tooling + S5 optimization lane landed
- Added `POPT.3` scorer tooling:
  - `tools/score_segment5a_popt3_lane_timing.py`,
  - `tools/score_segment5a_popt3_closure.py`.
- Updated `S5` runner with deterministic phase markers and formatted timer output support.
- Applied bounded compute-path optimizations in `S5`:
  - replaced repeated `LazyFrame.columns` introspection with schema-aware helper,
  - merged repeated scenario/overlay aggregate scans,
  - reused resolved `scenario_paths` in recomposition sampling,
  - reduced minhash per-row Python object creation,
  - vectorized recomposition error calculations.
- Added path-keyed spec-version caching for repeated `s2/s3` checks across scenarios.
- Compile sanity passed:
  - `runner.py`, `score_segment5a_popt3_lane_timing.py`, `score_segment5a_popt3_closure.py`.
- Next action:
  - run clean S5 witness candidate and emit POPT.3 lane+closure artifacts.

## 2026-02-21 02:54:48 +00:00 - 5A POPT.3 witness incident and corrective patch
- First witness rerun (`run_id=3e96a67813dc4357aca9872b176f6779`) failed with `S5_VALIDATION_FAILED`.
- Failure cause identified from validation report:
  - `S4_PRESENT` check carried runtime error `cannot access local variable 'heap' where it is not associated with a value`.
- Root cause:
  - `_minhash_sample` refactor left `heap` as annotation-only (not initialized).
- Corrective decision:
  - apply minimal fix (`heap=[]`) rather than revert the full bounded optimization lane.
- Fix applied and compile sanity passed on `runner.py`.
- Next action:
  - rerun S5 witness on same candidate run-id and proceed to artifact scoring.

## 2026-02-21 02:59:28 +00:00 - 5A POPT.3 second witness defect patched
- Fresh witness candidate (`864e907d739842f28211a84b254b6358`) failed after full scan with:
  - `S4_PRESENT` detail: `'DataFrame' object has no attribute 'collect'`.
- Root cause:
  - recomposition stats logic called `.collect()` on an eager `DataFrame` result.
- Decision:
  - keep vectorized recomposition path and apply narrow API fix (remove extra `.collect()`), no rollback of lane.
- Fix compiled cleanly.
- Next action:
  - run new clean S5 witness candidate and score POPT.3 artifacts.

## 2026-02-21 03:04:58 +00:00 - 5A POPT.3 bounded reopen on minhash hotspot
- First valid closure candidate (`ec50f40c0bb14aaabd830307aeb9b2b9`) result:
  - `S5 PASS`,
  - `S5 wall=221.969s` vs baseline `243.187s` (`8.72%` improvement),
  - closure decision: `HOLD_POPT3_REOPEN` (runtime gate miss).
- Lane timing authority confirms dominant hotspot:
  - `recomposition_checks=221.44s` (~99.76% of S5 wall), with minhash scan dominating.
- Applied bounded reopen optimization (no hash-law change):
  - cached merchant/zone/horizon byte encodings in `_minhash_sample`,
  - refactored `_hash64` to consume cached bytes and avoid per-row re-encoding.
- Compile sanity passed.
- Next action:
  - run one fresh S5 witness candidate and re-score closure.

## 2026-02-21 03:10:15 +00:00 - 5A POPT.3 second bounded reopen (key-only minhash pass)
- Post-cache candidate (`aa26e278545f44aabc55cccad34ce48c`) improved to `S5 wall=217.641s` but closure remained `HOLD_POPT3_REOPEN`.
- Dominant lane remained recomposition checks (`~217.11s`).
- Applied second bounded optimization without changing hash law:
  - `_minhash_sample` now scans key columns only,
  - lambda/overlay values are fetched after sampling by joining sampled keys against `scenario_scan`.
- Compile sanity passed.
- Next action:
  - run fresh S5 witness candidate and re-score closure.

## 2026-02-21 03:14:35 +00:00 - 5A POPT.3 typed sampled-key fix after overflow incident
- Candidate `bd79bd48fbc049808874042eeb0aaca6` showed runtime near gate (`~192.95s`) but failed validation.
- Failure cause:
  - sampled-key DataFrame inference overflow (`merchant_id` large integer type mismatch) during sampled-key join.
- Correction:
  - defined explicit schema overrides for sampled keys (`merchant_id` as `UInt64`, key text columns `Utf8`, horizon index `Int64`, optional `channel_group` `Utf8`).
- Compile sanity passed.
- Next action:
  - rerun fresh S5 witness and re-score closure.

## 2026-02-21 03:19:05 +00:00 - 5A POPT.3 follow-up fix on sample_df typing
- Overflow failure persisted after sampled-key typing fix.
- Root cause isolated to later frame creation:
  - `sample_df = pl.DataFrame(sample_with_bucket)` still inferred unsafe integer type for large `merchant_id`.
- Correction:
  - added explicit schema overrides for `sample_df` (`merchant_id UInt64`, keys Utf8, bucket/horizon Int64, value columns Float64, optional channel Utf8).
- Compile sanity passed.
- Next action:
  - rerun fresh witness and close/hold POPT.3 based on scored evidence.

## 2026-02-21 03:24:20 +00:00 - 5A POPT.3 execution close (HOLD_POPT3_REOPEN)
- Completed full POPT.3 execution lane (`3.1 -> 3.6`) including bounded reopen attempts.
- Best valid candidate:
  - run-id `acd599a344e146a99f72a541834af1e0`,
  - `S5 PASS`,
  - `S5 wall=208.937s` vs baseline `243.187s` (`+14.08%` improvement).
- Closure decision:
  - `HOLD_POPT3_REOPEN` (runtime gate miss; target is `<=180s` or `>=20%` reduction).
- Closure artifacts:
  - `segment5a_popt3_closure_acd599a344e146a99f72a541834af1e0.json/.md`,
  - `segment5a_popt3_lane_timing_acd599a344e146a99f72a541834af1e0.json/.md`.
- Storage prune sync executed:
  - kept: `7b08449ccffc44beaa99e64bf0201efc`, `ac363a2f127d43d1a6e7e2308c988e5e`, `ce57da0ead0d4404a5725ca3f4b6e3be`, `7f20e9d97dad4ff5ac639bbc41749fb0`, `acd599a344e146a99f72a541834af1e0`.
  - pruned: `3e96a67813dc4357aca9872b176f6779`, `864e907d739842f28211a84b254b6358`, `ec50f40c0bb14aaabd830307aeb9b2b9`, `aa26e278545f44aabc55cccad34ce48c`, `bd79bd48fbc049808874042eeb0aaca6`, `fc78bd20c54f47e981a3312106559571`.

## 2026-02-21 02:36:05 +00:00 - M10.F bounded rerun reconciled after control-plane recovery
- Restored control via boto3 and reconciled active burst task state.
- Captured bounded attempt window from ECS task truth:
  - start: `2026-02-21T02:12:59.915000+00:00`
  - stop: `2026-02-21T02:35:46.010000+00:00`
  - elapsed: `1366.095s`.
- Evidence:
  - `runs/dev_substrate/m10/m10_20260221T020923Z/m10_f_rerun_wsp_task_result.json`.

## 2026-02-21 02:46:21 +00:00 - M10.F B5 closure lane executed (reporter refresh + in-VPC DB query)
- Reporter refresh one-shot executed to refresh run-scoped evidence surfaces:
  - task `60c0437e5905465fb5ef1502b2c4ced8`, exit `0`.
- Local host DB access to private RDS was non-viable; switched to managed in-VPC query task using reporter task-definition secret injection (`IG_ADMISSION_DSN`).
- Query-task execution path was corrected from failing `python -c` newline escaping to heredoc script injection.
- Successful query task emitted deterministic marker payload:
  - task `a48e2c0e16de4944bc7b08d7f0f82905`
  - stream `ecs/obs_gov/reporter/reporter/a48e2c0e16de4944bc7b08d7f0f82905`
  - payload file: `runs/dev_substrate/m10/m10_20260221T020923Z/m10_f_rerun_receipts_window_metrics.json`.

## 2026-02-21 02:52:23 +00:00 - M10.F bounded rerun blocker adjudication published (B1/B5/B8 only)
- Built and published bounded rerun closure snapshot:
  - local: `runs/dev_substrate/m10/m10_20260221T020923Z/m10_f_burst_snapshot.json`
  - durable run-control: `s3://fraud-platform-dev-min-evidence/evidence/dev_min/run_control/m10_20260221T020923Z/m10_f_burst_snapshot.json`
  - durable run-scoped: `s3://fraud-platform-dev-min-evidence/evidence/runs/platform_20260219T234150Z/m10/m10_f_burst_snapshot.json`.
- Blocker outcomes:
  - `M10F-B8` cleared (runtime budget pass, `1366.095s <= 5400s`).
  - `M10F-B5` cleared (attempt-scoped receipt truth now deterministic from IG Postgres window query).
  - `M10F-B1` remains fail-closed (`DUPLICATE=10002`, `ADMIT=0`, multiplier/admit-ratio miss).
- Lane posture remains blocked on `M10F-B1`; no M10.G progression.

## 2026-02-21 03:07:10 +00:00 - M10F-B1 remediation lane pinned and implemented
- Root posture from bounded rerun remained duplicate-only (`DUPLICATE=10002`, `ADMIT=0`), so B1 stayed fail-closed.
- Implemented remediation to remove checkpoint fragility and enforce managed checkpoint durability:
  - `config/platform/profiles/dev_min.yaml`: pinned `wsp_checkpoint` to Postgres (`${WSP_CHECKPOINT_DSN}`, flush `100`).
  - `infra/terraform/modules/demo/main.tf`: WSP control-job bootstrap now writes `wsp_checkpoint` settings into runtime profile and fails closed if checkpoint DSN missing.
  - `infra/terraform/modules/demo/main.tf`: WSP control-job task-definition now injects `WSP_CHECKPOINT_DSN` from managed SSM DB DSN.
- Plan sync:
  - Added explicit B1 remediation DoD/blockers in `platform.M10.build_plan.md`.
  - Updated immediate next action in `platform.build_plan.md` to run fresh-scope B1 closure with Postgres checkpoint posture.
  - Pinned checkpoint handles in `dev_min_handles.registry.v0.md`.
- No M10.G progression; next is B1 closure rerun only.
