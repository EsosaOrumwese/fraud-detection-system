# Logbook
### Date: 5th February 2026
### Project: Fraud Detection System
### Reference commits: Check commits on this date (if any)

* 02:17AM
  - Added a detailed Planned Case + Labels flow section to flow-narrative-platform-design.md, aligned with design authority and pinned upstream decisions.

* 02:34AM
  - Added detailed P0 answers to case_and_labels.pre-design_decision.md (CaseSubjectKey, CaseTrigger shape, idempotency keys, evidence refs, ActionIntent contract, LabelSubjectKey, effective/observed time rules, writer boundary, commit/ack).

* 02:35AM
  - Added detailed P1 answers to case_and_labels.pre-design_decision.md (SLA posture, reconciliation counters/report, security/actor attribution).

* 02:35AM
  - Added detailed answers for Additional #1-4 in case_and_labels.pre-design_decision.md (external truth ingestion, workflow semantics, privacy/evidence access, CM-Label Store handshake).

* 02:36AM
  - Added detailed answers for Additional #5-8 in case_and_labels.pre-design_decision.md (label resolution, replay posture, retention, observability counters/report).

* 02:43AM
  - Applied P0 tightenings to case_and_labels.pre-design_decision.md (CaseSubjectKey-only case_id, LabelSubjectKey=(platform_run_id,event_id), stable label_assertion_id, LS writer idempotency+payload_hash, source_type+actor_id precedence).

* 02:46AM
  - Applied minimal contradiction fixes in case_and_labels.pre-design_decision.md (case create dedupe key, label_assertion_id idempotency, external truth ingestion dedupe).

* 02:48AM
  - Added P0 micro-pin for label resolved view scoping (LabelSubjectKey, label_type).

* 02:51AM
  - Tightened duplicate lines in case_and_labels.pre-design_decision.md (case create dedupe and label_assertion_id).

* 02:59AM
  - Added micro-pins to case_and_labels.pre-design_decision.md (explicit case_trigger_id and Label Store dedupe tuple + anomaly rule).

* 03:02AM
  - Added micro-pins to case_and_labels.pre-design_decision.md (trigger_type enum, label_type vocabulary/value shapes, payload_hash canonicalization).

* 09:35AM
  - Reviewed platform-wide blueprint + deployment tooling notes and learning/evolution component design authority (offline feature plane, model factory, model/policy registry) for conceptual understanding.

* 09:41AM
  - Added Learning + Evolution narrative section to flow-narrative-platform-design.md (OFS replay/as-of, MF manifest-only inputs, MPR governed activation).

* 10:03AM
  - Pinned P0.1–P0.4 answers in learning_and_evolution.pre-design_decisions.md (replay basis, dataset fingerprint, label cut policy, join scope).

* 10:04AM
  - Removed "Pin (P0):" prefixes from P0.1–P0.4 answers in learning_and_evolution.pre-design_decisions.md.

* 10:05AM
  - Added P0.5–P0.8 answers in learning_and_evolution.pre-design_decisions.md (feature authority + parity, eval harness/PASS, bundle contents/compatibility, activation scope).

* 10:08AM
  - Added P1 + Additional answers in learning_and_evolution.pre-design_decisions.md (monitoring/retrain, retention, governance, data quality, sampling, label delay, feature drift, model risk, cost, multi-run, approvals).

* 10:26AM
  - Closed remaining Learning + Evolution pre-design gaps (ScopeKey mode, origin_offset shape, EB accelerator rule, label_maturity_days field, non-bypassable PASS gate).

* 11:05AM
  - Reviewed run_and_operate.pre-design_decisions.md for alignment with pinned planes and obs/gov posture; no edits made.

* 11:08AM
  - Locked Run/Operate pins (writer-boundary authz + actor_id enforcement, run-config freeze enforcement, evidence ref access mechanisms per env).

* 11:48AM
  - Added platform-wide v0 environment resource/tooling reference (plane-by-plane + meta layers).

* 11:51AM
  - Refocused v0 environment resource/tooling reference to Control & Ingress only.

* 12:37PM
  - Reviewed v0_environment_resource_tooling_map.md for accuracy vs pinned decisions and current wiring; noted minor clarifications (control bus topic vs stream, unpinned RTDL default substrate).

* 12:45PM
  - Patched Control & Ingress v0 tooling map (control bus topic vs stream, removed Archive mention from C&I ladder).

* 01:31PM
  - Read control_and_ingress.pre-design_decision.md and v0_environment_resource_tooling_map.md to prep for Control & Ingress plane assessment.

* 01:45PM
  - Reviewed platform + SR/WSP/IG/EB build plans/impl_actual for Control & Ingress comparison against control_and_ingress.pre-design_decision.md; preparing gap/mismatch matrix.

* 01:52PM
  - Reviewed flow-narrative-platform-design.md to assess Control & Ingress narrative alignment; prepared alignment status response.

* 02:08PM
  - Appended Control & Ingress alignment plan entries to platform/SR/WSP/IG impl_actual maps and updated platform + component build plans with locked pins (run identity, dedupe+payload_hash, admission state machine, WSP retry).

* 02:12PM
  - Phase 1: Updated SR run_facts_view + run_ready_signal schemas to require platform_run_id/scenario_run_id and added READY message_id/run_config_digest; updated IG ingestion_receipt schema to include event_class, payload_hash, admitted_at_utc, platform_run_id and conditional scenario_run_id/payload_hash/admitted_at_utc for ADMIT/DUPLICATE.

* 02:27PM
  - Phase 2: Implemented SR READY/run_facts_view pinning (platform_run_id + scenario_run_id), READY message_id derivation using both run ids, and run_config_digest emission; updated READY re-emit path and obs pins. Updated WSP READY consumer + SR reemit tests to satisfy new schema fields and standardized test run_prefix/platform_run_id values.

* 02:56PM
  - Phase 3: Implemented WSP READY validation (platform/scenario run id match), envelope pins, and bounded IG push retries; added WSP retry config defaults and tests. Implemented IG dedupe tuple (platform_run_id,event_class,event_id), payload_hash anomaly detection, admission state machine (in-flight/admitted/ambiguous), updated receipts/quarantine pins, schema updates, and IG tests.

* 03:20PM
  - Began Phase 4.1 RTDL alignment: appended platform impl_actual decision log, created OFP/DF/DL/AL/DLA impl_actual + build plans, and updated RTDL contracts (decision payload, degrade posture, action intent/outcome, feature snapshot, audit record, eb_offset_basis, graph_version) plus RTDL README pin summary.

* 04:10PM
  - Closed Control & Ingress Phase 5 validation: ran `python -m pytest tests/services/scenario_runner/test_reemit.py tests/services/world_streamer_producer/test_runner.py tests/services/world_streamer_producer/test_push_retry.py tests/services/ingestion_gate/test_admission.py tests/services/ingestion_gate/test_phase5_retries.py -q` (18 passed).
  - Appended Phase 5/6 closure entries to platform/SR/WSP/IG impl_actual maps (incl. WSP stream_view test fixture alignment and IG admission receipt call/indent fixes).

* 04:16PM
  - Re-ran Phase 5 validation tests after workspace reload: python -m pytest tests/services/scenario_runner/test_reemit.py tests/services/world_streamer_producer/test_runner.py tests/services/world_streamer_producer/test_push_retry.py tests/services/ingestion_gate/test_admission.py tests/services/ingestion_gate/test_phase5_retries.py -q (18 passed).

* 04:35PM
  - Ran Control & Ingress parity flow with 200 events per output (platform_run_id=platform_20260205T162018Z). Reset Kinesis streams, started IG parity service, ran SR with new run_equivalence_key, then WSP ready-consumer once (max events per output=200). IG receipts count reached 800 and Kinesis streams contained records for traffic/context outputs. Observed receipts carry scenario_run_id from engine run receipt (c25a...) instead of SR scenario_run_id (2afa...), indicating WSP stream_engine_world still uses engine receipt run_id for scenario_run_id.


* 04:43PM
  - Implemented WSP propagation of SR scenario_run_id (READY -> stream runner), preserving engine receipt run_id in envelope un_id. Updated WSP tests to assert scenario_run_id override; ran python -m pytest tests/services/world_streamer_producer/test_runner.py -q (4 passed).

* 04:56PM
  - Re-ran parity Control & Ingress flow (200 events/output) after WSP scenario_run_id fix. platform_run_id=platform_20260205T164840Z. IG receipts count=800; sample receipt scenario_run_id matches SR run_facts_view (4df8e90cb798686a65f7be99208a1f69).

* 04:57PM
  - EB spot-check: sampled first record from traffic/context Kinesis streams; each record carried platform_run_id=platform_20260205T164840Z and scenario_run_id=4df8e90cb798686a65f7be99208a1f69.

* 05:02PM
  - Added Control & Ingress Parity Validation Report (local-parity v0) to platform.impl_actual.md with exact run IDs and evidence paths.

* 05:16PM
  - Planned IG bus health probe (describe mode) to replace BUS_HEALTH_UNKNOWN in parity; recorded plan in ingestion_gate.impl_actual.md and platform.impl_actual.md.

* 05:20PM
  - Implemented IG bus health probe (Kinesis describe mode), added health_bus_probe_mode to profiles, updated v0 tooling map, and ran python -m pytest tests/services/ingestion_gate/test_health_governance.py -q (2 passed).

* 05:32PM
  - Ran local-parity Control & Ingress sanity (20 events/output) after enabling bus describe probe. platform_run_id=platform_20260205T172824Z. IG /v1/ops/health returned GREEN. Receipts count=80; sample receipt scenario_run_id matches SR run_facts_view (c1bb6fb86558ddac3a9e76d2616741ea).

* 05:45PM
  - Created pre-analysis Segment 5B design-vs-implementation report (arrival realisation) at docs/reports/reports/eda/segment_5B/segment_5B_published_report.md.

* 05:50PM
  - Cleaned RTDL Phase 4.1 consistency items: fixed indentation in degrade_posture.schema.yaml and updated Phase 4.1.A DoD pins to include platform_run_id/scenario_run_id with run_id as legacy alias.

* 06:02PM
  - Cleared RTDL pre-design gating questions section in platform.build_plan.md and linked to the pinned decisions doc (real-time_decision_loop.pre-design_decision.md).

* 06:10PM
  - Added Segment 5B preliminary realism findings (S2/S3/S4 stats, conservation, dispersion, routing, DST mismatch) to docs/reports/reports/eda/segment_5B/segment_5B_published_report.md.

* 06:24PM
  - Expanded Phase 4.2 (IEG projector) in platform.build_plan.md with detailed sub-sections and DoD aligned to RTDL pre-design decisions.

* 06:25PM
  - Ran Segment 5B A/B statistical checks on S2/S3/S4 (latent field distribution/persistence, count law dispersion, conservation, zero rates, key duplication) for run c25a...; no report edits.

* 06:29PM
  - Refined IEG component build plan (Phase 4.2) with detailed v0 DoD aligned to RTDL pre-design decisions and flow narrative.

* 06:38PM
  - Expanded Segment 5B report A/B realism explanations (human-readable interpretations) in docs/reports/reports/eda/segment_5B/segment_5B_published_report.md.

* 06:40PM
  - Expanded 5B A/B realism explanations with explicit reasoning (human-readable) in docs/reports/reports/eda/segment_5B/segment_5B_published_report.md.

* 06:42PM
  - Removed duplicate trailing copy of Section 8 in segment_5B_published_report.md (left one canonical 8.4 block).

* 07:20PM
  - Added Phase 1 implementation plan entry to identity_entity_graph.impl_actual.md covering EB intake, validation, classification, idempotency, checkpointing, and graph_version derivation.

* 07:50PM
  - Implemented IEG Phase 1 projector package (config, classification, hints, ids, store, projector) and added Kinesis read adapter in event_bus/kinesis.py.

* 07:52PM
  - Added IEG config artifacts (classification, identity hints, topics) and wired `ieg` sections into local/local_parity/dev/prod platform profiles.

* 07:55PM
  - Added IEG store unit tests (idempotency, payload_hash mismatch, graph_version) and ran python -m pytest tests/services/identity_entity_graph/test_projection_store.py -q (3 passed).

* 08:12PM
  - Added v0 IEG identity-hints field mapping in config/platform/ieg/identity_hints_v0.yaml for arrival events, arrival entities, flow anchors, and traffic streams (payload-level mapping).

* 08:20PM
  - Fixed IEG topics list to use fp.bus.traffic.fraud.v1 + fp.bus.traffic.baseline.v1 (replacing fp.bus.traffic.v1) to match v0 stream naming.

* 08:24PM
  - Ran IEG projector pass (local_parity, once) with PLATFORM_RUN_ID=platform_20260205T172824Z after fixing topics; projection written to runs/fraud-platform/platform_20260205T172824Z/ieg/projection/ieg.db.
  - Projection counts: ieg_dedupe=80, ieg_entities=175, ieg_identifiers=175, ieg_apply_failures=0, ieg_checkpoints=4, ieg_graph_versions=1.

* 08:31PM
  - Switched IEG default run-scoped projection path to full name `identity_entity_graph/` and mapped logging component `ieg` → `identity_entity_graph`.

* 06:48PM
  - Ran 5B C/D statistical checks (intra-bucket timing uniformity, hour-of-day/weekday shape, tz-local vs UTC mismatch analysis and DST clustering) for run c25a...; no report edits.

* 06:52PM
  - Ran deeper C/D checks: expected vs observed weekend share from S2/S1 vs arrivals, quantified DST mismatch impact on hour/day features, and DST-window attribution of mismatches; no report edits.

* 06:56PM
  - Appended 5B C/D findings (micro-time placement, weekend share alignment, DST impact/attribution) with detailed explanations to segment_5B_published_report.md.

* 06:58PM
  - Expanded C/D sections in segment_5B_published_report.md with full interpretive reasoning (C1–C3, D1–D3) and hour-of-day context.

* 07:08PM
  - Ran 5B E/F statistical analysis (routing concentration for sites/edges, virtual vs physical temporal profile, merchant heavy-tail, tz concentration, weekend share by routing class) for run c25a...; no report edits.

* 07:16PM
  - Computed site/edge Gini concentration, virtual vs physical tz skew, and arrivals vs intensity heavy-tail alignment for 5B; no report edits.

* 07:20PM
  - Added 5B E/F findings (routing mix, concentration, temporal separation, heavy-tail vs intensity, tz skew, Gini) to segment_5B_published_report.md.

* 07:30PM
  - Patched 5B report wording to reflect analysis now included, corrected expectation on bucket mean alignment, and clarified Gini meaning in-context.

* 07:43PM
  - Added 5B realism grade (B+), strengths, gaps, and upgrade levers to segment_5B_published_report.md.

* 07:44PM
  - Expanded the 5B 'What would move this to A-/A' section with additional rationale and implications.

* 09:12PM
  - Implemented IEG Phase 2 (retention + replay manifest): added retention config files and per-profile retention_ref, IegRetention loader, prune/reset/replay_basis in store, replay manifest parsing + range processing in projector, and replay basis table.
  - Added replay/retention tests and ran python -m pytest tests/services/identity_entity_graph -q (7 passed).

[2026-02-05 00:00] Created 6A design-vs-implementation report stub for realism assessment: docs/reports/reports/eda/segment_6A/segment_6A_published_report.md (design intent, implementation posture, datasets of interest, expectations).

* 08:15PM
  - Ran a small IEG replay-manifest validation run (local_parity, replay) with platform_run_id=platform_20260205T201203Z.
  - Replay processed=80, graph_version computed, and replay basis recorded. Projection DB: runs/fraud-platform/platform_20260205T201203Z/identity_entity_graph/projection/identity_entity_graph.db.
  - Counts: ieg_dedupe=80, ieg_entities=175, ieg_identifiers=175, ieg_apply_failures=0, ieg_checkpoints=4, ieg_graph_versions=1, ieg_replay_basis=1.

* 08:18PM
  - Planned IEG Phase 3 query surface: Flask read-only endpoints (resolve/profile/neighbors/status), ContextPins-scoped queries, deterministic ordering + keyset pagination, explicit conflicts (no merges), integrity_status from apply_failures.

* 08:23PM
  - Implemented IEG Phase 3 query surface (resolve/profile/neighbors/status) with ContextPins validation, deterministic ordering, keyset pagination tokens, and integrity_status from apply_failures.
  - Added query service wrapper and query tests; ran python -m pytest tests/services/identity_entity_graph -q (10 passed).

* 08:30PM
  - Installed Flask 2.2.5 locally (dependency already pinned in pyproject) to run the IEG query service demo.
  - Started IEG query service on 127.0.0.1:8091 (profile local_parity) and executed live HTTP queries (status/resolve/profile/neighbors) against projection DB.

* 08:35PM
  - Planned IEG Phase 4 (ops + degrade signals): metrics counters, health posture (watermark/lag thresholds), integrity signal, and reconciliation artifact writer.

* 08:45PM
  - Implemented IEG Phase 4 ops/degrade signals: metrics counters table, status health posture with watermark/checkpoint ages, reconciliation endpoint + CLI artifact writer.
  - Ran python -m pytest tests/services/identity_entity_graph -q (11 passed) and wrote reconciliation artifact for platform_20260205T201203Z.

* 09:00PM
  - Implemented IEG Phase 5 performance hardening: bounded per-partition buffering + batch drain (max_inflight, batch_size) and wired profile knobs; tests already green (11 passed).

* 09:01PM
  - Re-ran IEG test suite: python -m pytest tests/services/identity_entity_graph -q (11 passed).

* 09:07PM
  - Ran local-parity IEG projector pass (buffering check) with platform_run_id=platform_20260205T210721Z. Processed counts: run_once=80, second run_once=0. Projection DB: runs/fraud-platform/platform_20260205T210721Z/identity_entity_graph/projection/identity_entity_graph.db. Counts: ieg_dedupe=80, ieg_entities=175, ieg_identifiers=175, ieg_apply_failures=0, ieg_checkpoints=4, ieg_graph_versions=1. Note: volume did not exceed batch_size=50 per partition, so buffering/backlog was not stressed in this pass.

* 09:50PM
  - Ran parity Control & Ingress flow for buffering test: platform_run_id=platform_20260205T212544Z, scenario_run_id=dce02beeb230f669e01fad7f9d061f11. Reset Kinesis streams, restarted IG service on new run_id, re‑emitted READY, and streamed WSP with --max-events-per-output=200 (speedup temporarily 6000 then reverted to 600). WSP emitted 800 total. IG receipts=800 under s3://fraud-platform/platform_20260205T212544Z/ig/receipts/. EB counts (localstack): traffic.fraud=200, arrival_events=200, arrival_entities=194, flow_anchor.fraud=196 (duplicates dropped by IG). IEG projector pass processed counts [200,200,200,190,0] (total 790) and produced projection DB at runs/fraud-platform/platform_20260205T212544Z/identity_entity_graph/projection/identity_entity_graph.db (ieg_dedupe=790, apply_failures=0).

* 10:08PM
  - Implemented IEG run-scope hardening: required/locked platform_run_id, run-scoped stream_id, dedupe_key includes platform_run_id, apply_failures now store platform_run_id, graph_scope surfaced in query/reconcile outputs, and store rebind logic for first-seen run scope. Added apply_failures scope index and schema auto-migrations for new columns. Updated IEG tests and ran python -m pytest tests/services/identity_entity_graph -q (11 passed).

* 10:16PM
  - Created Segment 6B design-vs-implementation report (design intent, implementation posture, datasets of interest, expectations) at docs/reports/reports/eda/segment_6B/segment_6B_published_report.md.

* 10:22PM
  - Ran 20-event parity sanity for run-scope enforcement. platform_run_id=platform_20260205T221623Z, scenario_run_id=dd02ded24679625099d7902785ec1206. WSP streamed 80 total (20 per output). IG receipts=80. IEG normal run (required_platform_run_id=platform_20260205T221623Z) processed 80 with 0 apply_failures. Mismatch run (required_platform_run_id=platform_mismatch, projection at runs/fraud-platform/platform_20260205T221623Z_mismatch/identity_entity_graph/projection/identity_entity_graph.db) recorded 80 apply_failures, all RUN_SCOPE_MISMATCH.

* 10:25PM
  - Computed 6B primary dataset overview (row counts, files, partitions, scenario/seed coverage) from runs\local_full_run-5\c25a2675fbfbacd952b13bb594880e92\data\layer3\6B to prep statistical assessment.

* 10:33PM
  - Implemented Phase 6 IEG validation tests (replay determinism, watermark monotonicity, and file-bus integration projection). Added tests in tests/services/identity_entity_graph/test_projector_determinism.py and ran python -m pytest tests/services/identity_entity_graph -q (14 passed).

* 10:33PM
  - Phase 0 (6B) policy extraction completed: mapped config/layer3/6B policy packs to S1–S5 surfaces and captured expected statistical posture vs lean implementation for the sealed run.

* 10:39PM
  - Began Phase 7 IEG implementation for run_config_digest persistence + query/reconcile exposure (config/store/query/projector/tests).

* 10:43PM
  - Implemented Phase 7 run_config_digest pinning for IEG (config digest computation, graph_versions persistence, query/reconcile exposure).
  - Ran python -m pytest tests/services/identity_entity_graph -q (14 passed).

* 10:50PM
  - Ran small local_parity IEG projector + reconciliation pass for run_config_digest visibility.
  - platform_run_id=platform_20260205T224824Z; graph_version=83885500259ad6413d95a9eeae12a1f02ac2985af20a941b24bd388359f3d8d6; run_config_digest=d30b0d7f38d1eb5df612fbc019d4fb212644a53cd6b2dd2fa25f9fab8bbae47c.
  - Reconciliation artifact: runs/fraud-platform/platform_20260205T224824Z/identity_entity_graph/reconciliation/reconciliation.json
  - Query status run_config_digest surfaced (scenario_run_id=dd02ded24679625099d7902785ec1206).

* 10:51PM
  - Queried IEG status for platform_20260205T224824Z; health_state=RED due to WATERMARK_TOO_OLD (expected for one-off pass).

* 10:55PM
  - Ran local_parity IEG green-check pass with fresh event to update watermark.
  - platform_run_id=platform_20260205T225503Z; scenario_run_id=5b049dd9464b6cdc342a0fa8c41d47ab.
  - status=GREEN (no health_reasons); graph_version=b9462937e73eacf0578facde6cc7de359cee65c0e7f0869ff9b4e3dfb3bdafd0; run_config_digest=d30b0d7f38d1eb5df612fbc019d4fb212644a53cd6b2dd2fa25f9fab8bbae47c.
  - reconciliation artifact: runs/fraud-platform/platform_20260205T225503Z/identity_entity_graph/reconciliation/reconciliation.json

* 11:10PM
  - Phase 1 (6B) structural integrity checks computed: row counts, event-type/seq distributions, null key fields, sample-based PK/coverage checks, and case timeline event-type counts for the sealed run.

* 11:01PM
  - Updated platform.build_plan Phase 4.2 to include remaining IEG integration + ops hardening items (OFP/DF integration, OTel export, archive replay tooling, explicit migrations).
  - Updated identity_entity_graph.build_plan with Phase 8 Integration + ops hardening DoD.
