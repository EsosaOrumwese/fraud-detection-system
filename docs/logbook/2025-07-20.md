# Logbook
### Date: 20th July 2025
### Project: Fraud Detection System
### Issues Resolved: [SD-02](https://github.com/EsosaOrumwese/fraud-detection-system/issues/25) `in-progress`
### Reference commits: Check commits on this date (if any)

* 4:24am
  * Ran through assumptions and narrative for "From merchants to physical sites" subsegment (1A) and found 40 (+1 later) holes
  * Resolved holes 1–40; formalize RNG logging, schema, and provenance
  * Summary:
    - Clarified hurdle vs NB design matrices; NB mean excludes developmental bucket; dispersion includes log(GDPpc).
    - Enforced true zero-truncated Poisson for K; removed unreachable K=0 branch; added retry cap + monitoring thresholds.
    - Standardized outlet stub schema (home_country_iso, legal_country_iso, site_id fixed 6 digits, non-null types).
    - Added deterministic currency→country expansion (proportional with sparse fallback + smoothing) and artefact paths/digests.
    - Specified NB Poisson–Gamma mixture mapping (μ,φ→r,p) and universal RNG audit schema (event_type, counters, parameters).
    - Defined Gumbel-top-k selection for foreign countries (one uniform per candidate) with logged keys.
    - Locked numeric environment: IEEE-754 binary64, 8 dp residual quantization, disabled FMA for Dirichlet & rounding steps.
    - Introduced post-write validation replay (μ, φ, K, Dirichlet, allocations, ordering, site_id sequence) with abort on mismatch.
    - Added monitoring corridors: NB rejection rate (≤6%), ZTP rejection percentiles, rounding deviation stats, sparse_flag incidence.
    - Documented artefact provenance (digests for coefficient & hyperparameter YAMLs, GDP bucket map, currency splits).
    - Added statistical significance metadata for θ₁ and stationarity test digest; enumerated YAML aggregation into parameter_hash.
    - Established sequence overflow policy (abort > 999,999 per merchant+country).
    - Rewrote ambiguous narrative phrases (“geographic sprawl” now explicitly K) and removed “No other assumptions are latent” overclaim.
  * Breaking changes:
    - Schema: added columns (`home_country_iso`, `legal_country_iso`, `raw_nb_outlet_draw`, `final_country_outlet_count`, `global_seed`, `tie_break_rank`), fixed site_id to 6-char string.
    - RNG log: new event types (`hurdle_bernoulli`, `gamma_component`, `poisson_component`, `dirichlet_gamma_vector`, `gumbel_key`, `stream_jump`, `nb_final`, `ztp_retry_exhausted`, `sequence_finalize`).
    - Manifest: new digest fields (`crossborder_hyperparams_digest`, `hurdle_coefficients_digest`, `gdp_bucket_map_digest`, `settlement_shares_digest`, `currency_country_split_digest`, `stationarity_test_digest`).
  * Migration:
    - Older catalogues (pre-fingerprint X) lack new columns and expanded audit events; comparison tooling must branch on schema_version.
    - Rebuild required to produce compatible downstream artefacts.

* 4:31am
  * Added old assumptions and narrative txt files to respective `assumptions/` and `narrative/` in `docs/prompt_engr/model_spec/data-gen` for version control purposes
  * Linked my short-lived branches with my remote repo (`origin`) to prevent loss of progress should my laptop decide to have issues.
  * Resolved hole 41: clarify logistic coefficient provenance
    - Added explicit statements in narrative and assumptions that GDP bucket dummy coefficients are part of the single hurdle coefficient vector in hurdle_coefficients.yaml (no separate γ_dev artefact).

* 5:13pm
  * Adjusted the output skeleton for the Hole Fixer v3.1 to stop the model from wasting tokens on reprinting the paragraph for each hole fixed. 
    * Also added a `DELTA MODE` rule to reinforce this.

* 6:00pm
  * Adjusted timelines for my milestones (sprint deadlines) because I want to hash out this generator once and for all.
  * Sprint 02 – Spec Freeze ＋ Feature Store _[2 Jul → 16 Aug (3 ½ wks)]_:
    * Finish the Segment 1A specs you’re already writing and close the 8 Feature‑Store tickets. 
    * No code downstream can start until the spec is locked, so keep this focus.
  * Sprint 03 – Train ＋ Serve (merge old 03 & 04)	_[19 Aug → 13 Sep (4 wks)]_:
    * SageMaker pipeline, model registry, API Gateway router. 
    * With specs frozen the pipeline’s schema is stable.
  * Sprint 04 – Explainability ＋ Monitoring ＋ Hardening (merge old 05, 06, 08)	_[16 Sep → 18 Oct (5 wks)]_:
    * SHAP/feature‑store explainers, GDPR hooks, Grafana/cost/drift dashboards and the 30‑day soak / hardening tests—because soak runs mostly unattended once started, it can overlap monitoring build work.
  * Sprint 05 – Content, Docs ＋ Polish & Release v1 (merge old 09 & 10) _[21 Oct → 06 Dec (6 ½ wks)]_:
    * Write blog + demo, final clean‑ups, tag v1.0. 
    * Longish window lets you keep shipping bug‑fixes that surface during the soak while polishing comms.
  * Slack / Hot‑fix buffer _[09 Dec → 31 Dec (3 wks)]_:
    * Pure runway for any spill‑over, holiday freeze, last‑minute compliance sign‑off.

* 6:46pm
  * Ran through assumptions and narrative for "Placing outlets on the planet" subsegment (1B) and found 51 holes
  * Formalize spatial placement spec & provenance (holes 1–51 closed)
  * Summary:
    - Introduce governed `spatial_manifest.json` with composite digest column `spatial_manifest_digest`.
    - Add full provenance for HRSL 100m, WorldPop 1km (fallback), Natural Earth land mask v5.1.2, OSM road graph snapshot, capitals dataset.
    - Standardize blending pipeline: EPSG:4326, 1/1200° grid, bilinear (continuous) / nearest (categorical), nodata→0, content-addressed blended raster path.
    - Eager Fenwick build with uint64 scaling (overflow-safe) and concurrency lock; pixel center mapping deterministic.
    - Replace polygon rejection with triangulation + alias sampling; formal polyline geodesic arc-length sampling.
    - Define zero-support fallback semantics and governed `fallback_policy.yml` with reason codes.
    - Replace tz heuristic with governed zone→ISO mapping (`tz_world_metadata.json`) and anomaly whitelist; structured mismatch logging.
    - Add dedicated footfall RNG sub-stream, calibration slice spec (seed, bracket, Fano target), two-pass winsorisation governed by `winsor.yml`.
    - Enumerate full RNG audit events & per-site/site-draw `site_rng_index`; switch to SHA-256 stride derivation.
    - Implement termination cap & Wilson-based acceptance monitoring (10k samples/prior).
    - Extend tagging schema: pixel/feature indices, triangle_id, segment_frac, barycentric u,v, cdf_threshold_u, raw & normalized weights.
    - Clarify road graph distance (length only), elevation omission, refined closing claim (undocumented behaviour = defect).
  * Breaking:
    - New required columns in site catalogue (`spatial_manifest_digest`, indexing & weight fields).
    - New mandatory governed artefacts (blend, winsor, fallback, calibration, tz metadata).
  * Version:
    - Sub-segment 1B bumped to 1B.1.0
    - Engine minor version incremented accordingly.
  * Updated changelog: `docs/prompt_engr/model_spec/data-gen/change_log_assump_narr.md`