<<<PP‑FIX id=1>>
Name: Virtual‑merchant classification flag  
Symbol: is_virtual  
Scope: merchant_location  
---------------------------------

PRIOR:
type: Deterministic boolean  
hyperparameters:
  source_file: config/virtual/mcc_channel_rules.yaml  
units: boolean  
default_policy: abort on missing config  
justification: Classifies merchants as purely virtual based on MCC/channel rules.

CALIBRATION_RECIPE:
input_path: N/A  
objective: Not applicable  
algorithm: Not applicable  
random_seed: N/A  
convergence_tol: N/A  
script_digest: N/A  

INTERFACE_CONSUMER:
artefact_name: derive_is_virtual.py  
function: load_is_virtual_flag  
description: Reads MCC/channel rules and sets `is_virtual` in merchant_master.

POSTERIOR_VALIDATION:
metric: classification drift count  
acceptance_range: [0, 0]  
sample_size: all merchants  

PROVENANCE_TAG:
artefact_name: config/virtual/mcc_channel_rules.yaml  
sha256: <to‑be‑populated>  

SHORT_DESCRIPTION:
Boolean flag marking a merchant as virtual per MCC rules.

TEST_PATHWAY:
test: CI is_virtual consistency test  
input: is_virtual_diff.log  
assert: no changes in `is_virtual` between builds  

Confidence=HIGH
<<<END PP‑FIX>>>

<<<PP‑FIX id=2>>
Name: Settlement‑node SHA1 key derivation  
Symbol: site_id = SHA1(merchant_id ∥ "SETTLEMENT")  
Scope: merchant_location  
---------------------------------

PRIOR:
type: Deterministic function  
hyperparameters:
  hash_algo: SHA1  
  suffix: "SETTLEMENT"  
units: hex string (40 chars)  
default_policy: abort on error  
justification: Generates unique site_id for virtual‑merchant settlement node.

CALIBRATION_RECIPE:
input_path: N/A  
objective: Not applicable  
algorithm: Not applicable  
random_seed: N/A  
convergence_tol: N/A  
script_digest: N/A  

INTERFACE_CONSUMER:
artefact_name: derive_virtual.py  
function: create_settlement_node  
description: Computes SHA1-based site_id for virtual settlement outlet.

POSTERIOR_VALIDATION:
metric: uniqueness violation count  
acceptance_range: [0, 0]  
sample_size: all virtual merchants  

PROVENANCE_TAG:
artefact_name: derive_virtual.py  
sha256: <to‑be‑populated>  

SHORT_DESCRIPTION:
SHA1-based generation of settlement node site_id.

TEST_PATHWAY:
test: CI settlement-node key test  
input: settlement_key_stats.log  
assert: all `site_id`s unique and correctly formatted  

Confidence=HIGH
<<<END PP‑FIX>>>

<<<PP‑FIX id=3>>
Name: Geocode evidence validation sample size  
Symbol: n_geo  
Scope: merchant_location  
---------------------------------

PRIOR:
type: Fixed constant  
hyperparameters:
  value: 10  
units: count  
default_policy: abort on missing log  
justification: Number of random merchants sampled nightly for geocode evidence.

CALIBRATION_RECIPE:
input_path: N/A  
objective: Not applicable  
algorithm: Not applicable  
random_seed: N/A  
convergence_tol: N/A  
script_digest: N/A  

INTERFACE_CONSUMER:
artefact_name: ci/verify_coords_evidence.py  
function: sample_geocode_evidence  
description: Pulls `n_geo` rows for distance verification.

POSTERIOR_VALIDATION:
metric: sample-size override count  
acceptance_range: [0, 0]  
sample_size: nightly CI run  

PROVENANCE_TAG:
artefact_name: ci/verify_coords_evidence.py  
sha256: <to‑be‑populated>  

SHORT_DESCRIPTION:
Nightly sample size for geocode evidence checks.

TEST_PATHWAY:
test: CI geocode‐sample size test  
input: geocode_sample_stats.log  
assert: exactly `n_geo` rows processed  

Confidence=HIGH
<<<END PP‑FIX>>>

<<<PP‑FIX id=4>>
Name: Geocode distance threshold  
Symbol: d_max  
Scope: merchant_location  
---------------------------------

PRIOR:
type: Fixed constant  
hyperparameters:
  value: 5000  
units: metres  
default_policy: abort on violation  
justification: Maximum allowed distance for coordinate‐evidence validation.

CALIBRATION_RECIPE:
input_path: N/A  
objective: Not applicable  
algorithm: Not applicable  
random_seed: N/A  
convergence_tol: N/A  
script_digest: N/A  

INTERFACE_CONSUMER:
artefact_name: ci/verify_coords_evidence.py  
function: validate_geo_distance  
description: Asserts Haversine distance ≤ `d_max`.

POSTERIOR_VALIDATION:
metric: distance violation count  
acceptance_range: [0, 0]  
sample_size: nightly CI run  

PROVENANCE_TAG:
artefact_name: ci/verify_coords_evidence.py  
sha256: <to‑be‑populated>  

SHORT_DESCRIPTION:
Max Haversine distance for geocode evidence CI checks.

TEST_PATHWAY:
test: CI geocode‐distance threshold test  
input: geocode_distance_stats.log  
assert: no sample > `d_max`  

Confidence=HIGH
<<<END PP‑FIX>>>

<<<PP‑FIX id=5>>
Name: Earth radius for Haversine  
Symbol: R  
Scope: merchant_location  
---------------------------------

PRIOR:
type: Fixed constant  
hyperparameters:
  value: 6371000  
units: metres  
default_policy: abort on mis‐compute  
justification: Radius value used in Haversine distance formula.

CALIBRATION_RECIPE:
input_path: N/A  
objective: Not applicable  
algorithm: Not applicable  
random_seed: N/A  
convergence_tol: N/A  
script_digest: N/A  

INTERFACE_CONSUMER:
artefact_name: ci/verify_coords_evidence.py  
function: compute_haversine_distance  
description: Uses R to compute geocode distances.

POSTERIOR_VALIDATION:
metric: distance calculation error  
acceptance_range: [0.0, 1e-6]  
sample_size: 1000  

PROVENANCE_TAG:
artefact_name: ci/verify_coords_evidence.py  
sha256: <to‑be‑populated>  

SHORT_DESCRIPTION:
Earth radius constant for distance computation.

TEST_PATHWAY:
test: CI haversine‐R test  
input: haversine_stats.log  
assert: computed `d` stable within tolerance  

Confidence=HIGH
<<<END PP‑FIX>>>

<<<PP‑FIX id=6>>
Name: CDN‑edge scale factor  
Symbol: E  
Scope: merchant_location  
---------------------------------

PRIOR:
type: Fixed constant  
hyperparameters:
  value: 500  
units: count  
default_policy: abort on missing config  
justification: Global multiplier for virtual‑merchant edge‑node counts.

CALIBRATION_RECIPE:
input_path: config/virtual/edge_scale.yaml  
objective: Not applicable  
algorithm: Not applicable  
random_seed: N/A  
convergence_tol: N/A  
script_digest: sha256:<to‑be‑populated>  

INTERFACE_CONSUMER:
artefact_name: build_edge_catalogue.py  
function: apply_edge_scale  
description: Multiplies raw country weights by E before rounding.

POSTERIOR_VALIDATION:
metric: edge‐catalogue size bounds check  
acceptance_range: [50, 800]  
sample_size: all virtual merchants  

PROVENANCE_TAG:
artefact_name: config/virtual/edge_scale.yaml  
sha256: <to‑be‑populated>  

SHORT_DESCRIPTION:
Integer scale factor for edge‑catalogue generation.

TEST_PATHWAY:
test: CI edge_scale bounds test  
input: edge_size_stats.log  
assert: 50 ≤ count ≤ 800  

Confidence=HIGH
<<<END PP‑FIX>>>

<<<PP‑FIX id=7>>
Name: Edge‑catalogue size bounds  
Symbol: k_min, k_max  
Scope: merchant_location  
---------------------------------

PRIOR:
type: Loaded constants  
hyperparameters:
  k_min: 50  
  k_max: 800  
units: count  
default_policy: abort on out‑of‑range  
justification: Enforces minimum/maximum edge nodes per merchant.

CALIBRATION_RECIPE:
input_path: N/A  
objective: Not applicable  
algorithm: Not applicable  
random_seed: N/A  
convergence_tol: N/A  
script_digest: N/A  

INTERFACE_CONSUMER:
artefact_name: build_edge_catalogue.py  
function: enforce_size_bounds  
description: Validates edge node count within [k_min, k_max].

POSTERIOR_VALIDATION:
metric: bound violation count  
acceptance_range: [0, 0]  
sample_size: all virtual merchants  

PROVENANCE_TAG:
artefact_name: build_edge_catalogue.py  
sha256: <to‑be‑populated>  

SHORT_DESCRIPTION:
Minimum and maximum edge‑node count enforcement.

TEST_PATHWAY:
test: CI edge_size bounds test  
input: edge_size_stats.log  
assert: no count outside [k_min, k_max]  

Confidence=HIGH
<<<END PP‑FIX>>>

<<<PP‑FIX id=8>>
Name: Discrete uniform integer draw  
Symbol: u ∼ Uniform{0,…,P_N−1}  
Scope: merchant_location  
---------------------------------

PRIOR:
type: Uniform discrete  
hyperparameters:
  min: 0  
  max: P_N−1  
units: dimensionless  
default_policy: abort on RNG error  
justification: Uniform integer for Fenwick sampling index.

CALIBRATION_RECIPE:
input_path: N/A  
objective: Not applicable  
algorithm: Not applicable  
random_seed: N/A  
convergence_tol: N/A  
script_digest: N/A  

INTERFACE_CONSUMER:
artefact_name: sampling/fenwick.py  
function: sample_pixel  
description: Generates uniform integer for Fenwick binary search.

POSTERIOR_VALIDATION:
metric: KS test on integer draw distribution  
acceptance_range: [0.0, 0.05]  
sample_size: 10000  

PROVENANCE_TAG:
artefact_name: sampling/fenwick.py  
sha256: <to‑be‑populated>  

SHORT_DESCRIPTION:
Uniform integer deviate for Fenwick tree selection.

TEST_PATHWAY:
test: CI fenwick‐uniform test  
input: fenwick_uniform_stats.log  
assert: KS statistic < 0.05  

Confidence=HIGH
<<<END PP‑FIX>>>

<<<PP‑FIX id=9>>
Name: Uniform real deviate for alias  
Symbol: f ∼ Uniform[0,1)  
Scope: merchant_location  
---------------------------------

PRIOR:
type: Uniform continuous  
hyperparameters:
  min: 0.0  
  max: 1.0  
units: dimensionless  
default_policy: abort on RNG error  
justification: Real draw for Vose alias sampling decision.

CALIBRATION_RECIPE:
input_path: N/A  
objective: Not applicable  
algorithm: Not applicable  
random_seed: N/A  
convergence_tol: N/A  
script_digest: N/A  

INTERFACE_CONSUMER:
artefact_name: alias/voce.py  
function: sample_alias  
description: Uses `f` to choose between `prob[m]` and `alias[m]`.

POSTERIOR_VALIDATION:
metric: KS test on real deviate  
acceptance_range: [0.0, 0.05]  
sample_size: 10000  

PROVENANCE_TAG:
artefact_name: alias/voce.py  
sha256: <to‑be‑populated>  

SHORT_DESCRIPTION:
Uniform real threshold for alias sampler.

TEST_PATHWAY:
test: CI alias‐real uniform test  
input: alias_uniform_stats.log  
assert: KS statistic < 0.05  

Confidence=HIGH
<<<END PP‑FIX>>>

<<<PP‑FIX id=10>>
Name: CDN alias‑key SHA256 policy  
Symbol: key = SHA256(global_seed ∥ "CDN" ∥ merchant_id)  
Scope: merchant_location  
---------------------------------

PRIOR:
type: Deterministic hash  
hyperparameters:
  hash_algo: SHA256  
  suffix: "CDN"  
units: hex (256‑bit)  
default_policy: abort on mismatch  
justification: Derives PRNG key for CDN sampling sub‑stream.

CALIBRATION_RECIPE:
input_path: N/A  
objective: Not applicable  
algorithm: Not applicable  
random_seed: N/A  
convergence_tol: N/A  
script_digest: N/A  

INTERFACE_CONSUMER:
artefact_name: config/routing/rng_policy.yml  
function: derive_cdn_key  
description: Computes key for virtual‑merchant CDN RNG.

POSTERIOR_VALIDATION:
metric: key digest match  
acceptance_range: [true, true]  
sample_size: one build  

PROVENANCE_TAG:
artefact_name: config/routing/rng_policy.yml  
sha256: <to‑be‑populated>  

SHORT_DESCRIPTION:
SHA256-based key derivation policy for CDN RNG.

TEST_PATHWAY:
test: CI cdn-key derivation test  
input: rng_policy.yml  
assert: computed key matches digest  

Confidence=HIGH
<<<END PP‑FIX>>>

<<<PP‑FIX id=11>>
Name: Virtual‑universe hash  
Symbol: h = SHA256(cdn_weights_digest ∥ edge_digest ∥ virtual_rules_digest)  
Scope: merchant_location  
---------------------------------

PRIOR:
type: Deterministic function  
hyperparameters:
  inputs: [cdn_weights_digest, edge_digest, virtual_rules_digest]  
units: hex (256‑bit)  
default_policy: abort on mismatch  
justification: Aggregates core virtual parameters into single digest.

CALIBRATION_RECIPE:
input_path: N/A  
objective: Not applicable  
algorithm: Not applicable  
random_seed: N/A  
convergence_tol: N/A  
script_digest: N/A  

INTERFACE_CONSUMER:
artefact_name: routing/virtual_universe_hash.py  
function: compute_virtual_universe_hash  
description: Computes `h` for virtual‑merchant drift detection.

POSTERIOR_VALIDATION:
metric: universe hash match  
acceptance_range: [true, true]  
sample_size: two independent builds  

PROVENANCE_TAG:
artefact_name: routing/virtual_universe_hash.py  
sha256: <to‑be‑populated>  

SHORT_DESCRIPTION:
Digest linking virtual‑merchant artefacts.

TEST_PATHWAY:
test: CI virtual‑universe hash test  
input: virtual_universe_hash.log  
assert: `h` identical across builds  

Confidence=HIGH
<<<END PP‑FIX>>>

<<<PP‑FIX id=12>>
Name: Country‑share tolerance  
Symbol: τ_country  
Scope: validation  
---------------------------------

PRIOR:
type: Fixed constant  
hyperparameters:
  value: 0.02  
units: dimensionless  
default_policy: abort on breach  
justification: Maximum allowed error in country‑share proportions.

CALIBRATION_RECIPE:
input_path: config/virtual/virtual_validation.yml  
objective: Not applicable  
algorithm: Not applicable  
random_seed: N/A  
convergence_tol: N/A  
script_digest: sha256:<to‑be‑populated>  

INTERFACE_CONSUMER:
artefact_name: config/virtual/virtual_validation.yml  
function: load_country_tolerance  
description: Provides `τ_country` for CI share validation.

POSTERIOR_VALIDATION:
metric: max |π̂_c − π_c|  
acceptance_range: [0.0, τ_country]  
sample_size: 30 days synthetic data  

PROVENANCE_TAG:
artefact_name: config/virtual/virtual_validation.yml  
sha256: <to‑be‑populated>  

SHORT_DESCRIPTION:
Tolerance for virtual merchant country‑share validation.

TEST_PATHWAY:
test: CI virtual‐share test  
input: virtual_share_stats.log  
assert: all |error| ≤ τ_country  

Confidence=HIGH
<<<END PP‑FIX>>>

<<<PP‑FIX id=13>>
Name: Cut‑off time tolerance  
Symbol: τ_time  
Scope: validation  
---------------------------------

PRIOR:
type: Fixed constant  
hyperparameters:
  value: 5  
units: seconds  
default_policy: abort on misalignment  
justification: Permits ±5 s deviation in daily cut‑off time.

CALIBRATION_RECIPE:
input_path: config/virtual/virtual_validation.yml  
objective: Not applicable  
algorithm: Not applicable  
random_seed: N/A  
convergence_tol: N/A  
script_digest: sha256:<to‑be‑populated>  

INTERFACE_CONSUMER:
artefact_name: config/virtual/virtual_validation.yml  
function: load_time_tolerance  
description: Provides `τ_time` for CI time alignment check.

POSTERIOR_VALIDATION:
metric: time deviation count  
acceptance_range: [0, τ_time]  
sample_size: one daily build  

PROVENANCE_TAG:
artefact_name: config/virtual/virtual_validation.yml  
sha256: <to‑be‑populated>  

SHORT_DESCRIPTION:
Allowed deviation for daily event cut‑off.

TEST_PATHWAY:
test: CI cut-off time test  
input: cutoff_time_stats.log  
assert: all deviations ≤ τ_time  

Confidence=HIGH
<<<END PP‑FIX>>>

<<<PP‑FIX id=14>>
Name: Virtual‑merchant log retention  
Symbol: retention_days  
Scope: validation  
---------------------------------

PRIOR:
type: Fixed constant  
hyperparameters:
  value: 90  
units: days  
default_policy: delete older logs  
justification: Number of days to retain edge‑progress logs.

CALIBRATION_RECIPE:
input_path: config/logging/virtual_logging.yml  
objective: Not applicable  
algorithm: Not applicable  
random_seed: N/A  
convergence_tol: N/A  
script_digest: sha256:<to‑be‑populated>  

INTERFACE_CONSUMER:
artefact_name: config/logging/virtual_logging.yml  
function: load_retention_policy  
description: Provides `retention_days` for log rotation.

POSTERIOR_VALIDATION:
metric: stale‑log age count  
acceptance_range: [0, retention_days]  
sample_size: logs directory scan  

PROVENANCE_TAG:
artefact_name: config/logging/virtual_logging.yml  
sha256: <to‑be‑populated>  

SHORT_DESCRIPTION:
Retention policy for virtual‑merchant logs.

TEST_PATHWAY:
test: CI log‑retention test  
input: log_retention_stats.log  
assert: no log older than retention_days  

Confidence=MEDIUM
<<<END PP‑FIX>>>

<<<PP‑FIX id=15>>
Name: Edge‑catalogue schema enforcement  
Symbol: schema non‑nullable  
Scope: merchant_location  
---------------------------------

PRIOR:
type: Fixed contract  
hyperparameters: {}  
units: N/A  
default_policy: abort on schema drift  
justification: Enforces Parquet schema compliance for edge outputs.

CALIBRATION_RECIPE:
input_path: N/A  
objective: Not applicable  
algorithm: Not applicable  
random_seed: N/A  
convergence_tol: N/A  
script_digest: N/A  

INTERFACE_CONSUMER:
artefact_name: edge_catalogue_schema.json  
function: validate_edge_schema  
description: Validates schema non‑nullable constraints.

POSTERIOR_VALIDATION:
metric: schema violation count  
acceptance_range: [0, 0]  
sample_size: all output files  

PROVENANCE_TAG:
artefact_name: edge_catalogue_schema.json  
sha256: <to‑be‑populated>  

SHORT_DESCRIPTION:
Contract enforcement for edge‑catalogue schema.

TEST_PATHWAY:
test: CI edge‑schema test  
input: schema_validation.log  
assert: no schema violations  

Confidence=HIGH
<<<END PP‑FIX>>>

<<<PP‑FIX id=16>>
Name: Crash‑recovery progress log policy  
Symbol: edge_progress.log idempotency  
Scope: merchant_location  
---------------------------------

PRIOR:
type: Fixed contract  
hyperparameters: {}  
units: N/A  
default_policy: abort on missing entry  
justification: Ensures idempotent resume of edge catalog build.

CALIBRATION_RECIPE:
input_path: N/A  
objective: Not applicable  
algorithm: Not applicable  
random_seed: N/A  
convergence_tol: N/A  
script_digest: N/A  

INTERFACE_CONSUMER:
artefact_name: logs/edge_progress.log  
function: read_progress_log  
description: Skips completed batches based on logged keys.

POSTERIOR_VALIDATION:
metric: missing‐entry count  
acceptance_range: [0, 0]  
sample_size: single resume run  

PROVENANCE_TAG:
artefact_name: logs/edge_progress.log  
sha256: <to‑be‑populated>  

SHORT_DESCRIPTION:
Idempotency policy for crash recovery logs.

TEST_PATHWAY:
test: CI crash‑recovery log test  
input: edge_progress_stats.log  
assert: no missing batch entries  

Confidence=HIGH
<<<END PP‑FIX>>>

##### END PARAMETER_SPEC #####  

id=1  | gaps_closed=none | notes=Flag fully specified from config  
id=2  | gaps_closed=none | notes=Key derivation deterministic, no gaps  
id=3  | gaps_closed=none | notes=Sample size fixed and validated  
id=4  | gaps_closed=none | notes=Distance threshold validated  
id=5  | gaps_closed=none | notes=Earth radius test added  
id=6  | gaps_closed=none | notes=Edge scale and bounds validated  
id=7  | gaps_closed=post | notes=Filled posterior CI for size bounds  
id=8  | gaps_closed=none | notes=Fenwick integer draw spec complete  
id=9  | gaps_closed=none | notes=Alias real uniform spec complete  
id=10 | gaps_closed=none | notes=CDN key derivation spec complete  
id=11 | gaps_closed=none | notes=Virtual‐universe hash CI test added  
id=12 | gaps_closed=none | notes=Country‐share tolerance spec complete  
id=13 | gaps_closed=none | notes=Cut‑off time tolerance CI test added  
id=14 | gaps_closed=post | notes=Added posterior log‐retention check  
id=15 | gaps_closed=none | notes=Schema enforcement spec complete  
id=16 | gaps_closed=none | notes=Crash‐recovery log test spec complete  
<<PS‑END>>