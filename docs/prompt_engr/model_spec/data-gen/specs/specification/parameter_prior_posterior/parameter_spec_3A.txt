<<<PP‑FIX id=1>>
Name: Mixture threshold θ_mix
Symbol: θ_mix
Scope: merchant_location
---------------------------------

PRIOR:
type: Fixed constant
hyperparameters:
  value: 0.01
units: dimensionless
default_policy: abort on drift
justification: Threshold of normalized country mass to enter zone‐mixture queue.

CALIBRATION_RECIPE:
input_path: N/A
objective: Not applicable
algorithm: Not applicable
random_seed: N/A
convergence_tol: N/A
script_digest: N/A

INTERFACE_CONSUMER:
artefact_name: allocation/mixture.py
function: flag_escalation_countries
description: Flags countries with normalized mass above θ_mix for mixture.

POSTERIOR_VALIDATION:
metric: number of flagged countries
acceptance_range: [0, ∞)
sample_size: daily build

PROVENANCE_TAG:
artefact_name: config/zone_mixture.yaml
sha256: <to‑be‑populated>

SHORT_DESCRIPTION:
Normalized mass threshold for zone‑mixture eligibility.

TEST_PATHWAY:
test: CI mixture threshold test
input: mixture_stats.log
assert: all flagged countries have mass ≥ θ_mix

Confidence=HIGH
<<<END PP‑FIX>>>

<<<PP‑FIX id=2>>
Name: Dirichlet smoothing constant τ
Symbol: τ
Scope: merchant_location
---------------------------------

PRIOR:
type: Fixed constant
hyperparameters:
  value: 200
units: dimensionless
default_policy: use prior
justification: Global multiplier smoothing empirical zone shares before integer rounding.

CALIBRATION_RECIPE:
input_path: N/A
objective: Not applicable
algorithm: Not applicable
random_seed: N/A
convergence_tol: N/A
script_digest: N/A

INTERFACE_CONSUMER:
artefact_name: make_zone_alphas.py
function: apply_smoothing
description: Applies τ multiplier to π_z before rounding.

POSTERIOR_VALIDATION:
metric: count of zero‐allotted zones with π_z·τ > threshold
acceptance_range: [0]
sample_size: all merchants

PROVENANCE_TAG:
artefact_name: config/zone_smoothing.yaml
sha256: <to‑be‑populated>

SHORT_DESCRIPTION:
Multiplier for smoothing zone share proportions.

TEST_PATHWAY:
test: CI smoothing constant test
input: smoothing_stats.log
assert: no zone with π_z·τ >1 and zero allocation

Confidence=MEDIUM
<<<END PP‑FIX>>>

<<<PP‑FIX id=3>>
Name: Dirichlet concentration vector α_z
Symbol: α_z
Scope: merchant_location
---------------------------------

PRIOR:
type: Loaded constant
hyperparameters:
  vector_file: config/zone_alphas.yaml
units: dimensionless
default_policy: abort on missing file
justification: Per‐zone concentration parameters for the Dirichlet prior.

CALIBRATION_RECIPE:
input_path: s3://data/zone_shares/empirical_shares.csv
objective: KL divergence minimization
algorithm: L‑BFGS
random_seed: 42
convergence_tol: 1e‑6
script_digest: sha256:<to‑be‑populated>  # build/scripts/make_zone_alphas.py

INTERFACE_CONSUMER:
artefact_name: allocation/zone_allocator.py
function: compute_dirichlet_shares
description: Uses α_z to draw Dirichlet zone‐share proportions.

POSTERIOR_VALIDATION:
metric: KL divergence between empirical and synthetic π_z
acceptance_range: [0.0, 0.05]
sample_size: 10000

PROVENANCE_TAG:
artefact_name: config/zone_alphas.yaml
sha256: <to‑be‑populated>

SHORT_DESCRIPTION:
Concentration parameters for Dirichlet zone allocation.

TEST_PATHWAY:
test: CI Dirichlet‐alpha calibration
input: zone_alpha_stats.log
assert: KL divergence < 0.05

Confidence=HIGH
<<<END PP‑FIX>>>

<<<PP‑FIX id=4>>
Name: Gamma shape/scale for Dirichlet draw
Symbol: g_z ∼ Gamma(shape=α_z, scale=1)
Scope: merchant_location
---------------------------------

PRIOR:
type: Gamma
hyperparameters:
  shape: α_z
  scale: 1
units: dimensionless
default_policy: abort on RNG error
justification: Generates Gamma variates for Dirichlet share computation.

CALIBRATION_RECIPE:
input_path: N/A
objective: Not applicable
algorithm: Not applicable
random_seed: N/A
convergence_tol: N/A
script_digest: N/A

INTERFACE_CONSUMER:
artefact_name: allocation/zone_allocator.py
function: draw_zone_gammas
description: Draws independent Gamma variates for each zone.

POSTERIOR_VALIDATION:
metric: KS distance to Gamma(α_z,1)
acceptance_range: [0.0, 0.05]
sample_size: 10000

PROVENANCE_TAG:
artefact_name: allocation/zone_allocator.py
sha256: <to‑be‑populated>

SHORT_DESCRIPTION:
Gamma deviates for Dirichlet‐based zone allocation.

TEST_PATHWAY:
test: CI Gamma‐sampling test
input: gamma_samples.log
assert: KS statistic < 0.05

Confidence=HIGH
<<<END PP‑FIX>>>

<<<PP‑FIX id=5>>
Name: Bump‑rule threshold ε_bump
Symbol: ε_bump
Scope: merchant_location
---------------------------------

PRIOR:
type: Fixed constant
hyperparameters:
  value: 0.8
units: dimensionless
default_policy: abort on rule failure
justification: Ensures zones with high expectation receive at least one outlet.

CALIBRATION_RECIPE:
input_path: N/A
objective: Not applicable
algorithm: Not applicable
random_seed: N/A
convergence_tol: N/A
script_digest: N/A

INTERFACE_CONSUMER:
artefact_name: allocation/zone_allocator.py
function: apply_bump_rule
description: Boosts zones with expected share > ε_bump to avoid elimination.

POSTERIOR_VALIDATION:
metric: count of e_z > ε_bump with zero allocation
acceptance_range: [0]
sample_size: all merchants

PROVENANCE_TAG:
artefact_name: config/zone_mixture.yaml
sha256: <to‑be‑populated>

SHORT_DESCRIPTION:
Threshold for bump rule preventing zero‐allocation.

TEST_PATHWAY:
test: CI bump‐rule test
input: bump_stats.log
assert: no zone with e_z > ε_bump has zero outlets

Confidence=HIGH
<<<END PP‑FIX>>>

<<<PP‑FIX id=6>>
Name: Major‑zone fallback mapping
Symbol: country_major_zone.csv
Scope: merchant_location
---------------------------------

PRIOR:
type: Fixed artefact reference
hyperparameters:
  file: country_major_zone.csv
units: N/A
default_policy: abort on missing row
justification: Maps country to its primary timezone for fallback.

CALIBRATION_RECIPE:
input_path: N/A
objective: Not applicable
algorithm: Not applicable
random_seed: N/A
convergence_tol: N/A
script_digest: N/A

INTERFACE_CONSUMER:
artefact_name: allocation/zone_allocator.py
function: select_major_zone
description: Chooses major zone when mixture not applied.

POSTERIOR_VALIDATION:
metric: missing‐mapping count
acceptance_range: [0]
sample_size: all countries

PROVENANCE_TAG:
artefact_name: country_major_zone.csv
sha256: <to‑be‑populated>

SHORT_DESCRIPTION:
Fallback country‐to‐zone mapping schema.

TEST_PATHWAY:
test: CI major‐zone mapping test
input: country_major_zone.csv
assert: mapping exists for every country

Confidence=HIGH
<<<END PP‑FIX>>>

<<<PP‑FIX id=7>>
Name: Zone‐floor vector φ_z
Symbol: φ_z
Scope: merchant_location
---------------------------------

PRIOR:
type: Loaded constant
hyperparameters:
  floor_file: config/zone_floor.yml
units: count
default_policy: abort on violation
justification: Enforces minimum outlets per zone to protect micro‐zones.

CALIBRATION_RECIPE:
input_path: N/A
objective: Not applicable
algorithm: Not applicable
random_seed: N/A
convergence_tol: N/A
script_digest: N/A

INTERFACE_CONSUMER:
artefact_name: allocation/zone_allocator.py
function: enforce_zone_floors
description: Applies φ_z floors to zone allocation counts.

POSTERIOR_VALIDATION:
metric: floor violation count
acceptance_range: [0]
sample_size: all merchants

PROVENANCE_TAG:
artefact_name: config/zone_floor.yml
sha256: <to‑be‑populated>

SHORT_DESCRIPTION:
Minimum count thresholds for each timezone.

TEST_PATHWAY:
test: CI zone_floor test
input: zone_floor_stats.log
assert: no outlet count below φ_z

Confidence=HIGH
<<<END PP‑FIX>>>

<<<PP‑FIX id=8>>
Name: Corporate‑day random effect variance
Symbol: σ_γ²
Scope: merchant_location
---------------------------------

PRIOR:
type: Loaded constant
hyperparameters:
  variance_file: routing_day_effect.yml
units: dimensionless
default_policy: abort on missing file
justification: Variance for corporate‐day LogNormal random effect.

CALIBRATION_RECIPE:
input_path: s3://data/routing/day_counts.csv
objective: Method of Moments
algorithm: Nelder‑Mead
random_seed: 42
convergence_tol: 1e‑6
script_digest: sha256:<to‑be‑populated>  # build/scripts/calibrate_gamma.py

INTERFACE_CONSUMER:
artefact_name: routing_day_effect.yml
function: load_day_variance
description: Loads σ_γ² for γ_d sampler.

POSTERIOR_VALIDATION:
metric: empirical variance match
acceptance_range: [σ_γ², σ_γ²]
sample_size: daily build

PROVENANCE_TAG:
artefact_name: routing_day_effect.yml
sha256: <to‑be‑populated>

SHORT_DESCRIPTION:
Variance parameter for day‐effect LogNormal.

TEST_PATHWAY:
test: CI day_variance test
input: day_effect_stats.log
assert: loaded variance matches manifest

Confidence=HIGH
<<<END PP‑FIX>>>

<<<PP‑FIX id=9>>
Name: Corporate‑day random effect mean
Symbol: μ_γ
Scope: merchant_location
---------------------------------

PRIOR:
type: Deterministic derived constant
hyperparameters:
  formula: μ_γ = -½ σ_γ²
units: dimensionless
default_policy: use prior
justification: Centers log‑normal so E[γ_d] = 1.

CALIBRATION_RECIPE:
input_path: N/A
objective: Not applicable
algorithm: Not applicable
random_seed: N/A
convergence_tol: N/A
script_digest: N/A

INTERFACE_CONSUMER:
artefact_name: routing_day_effect.yml
function: compute_log_normal_mean
description: Derives μ_γ from σ_γ² for LogNormal effect.

POSTERIOR_VALIDATION:
metric: mean expectation test
acceptance_range: [1.0, 1.0]
sample_size: 10000

PROVENANCE_TAG:
artefact_name: routing_day_effect.yml
sha256: <to‑be‑populated>

SHORT_DESCRIPTION:
Mean of log‐normal for corporate‐day effect.

TEST_PATHWAY:
test: CI lognormal mean test
input: uniform_day_effect.log
assert: E[γ_d] ≈ 1

Confidence=HIGH
<<<END PP‑FIX>>>

<<<PP‑FIX id=10>>
Name: Gamma‐day uniform deviate
Symbol: u_d ∼ U(0,1)
Scope: merchant_location
---------------------------------

PRIOR:
type: Uniform
hyperparameters:
  min: 0
  max: 1
units: dimensionless
default_policy: abort on RNG error
justification: Uniform draw for inverse‐Gaussian transform of γ_d.

CALIBRATION_RECIPE:
input_path: N/A
objective: Not applicable
algorithm: Not applicable
random_seed: N/A
convergence_tol: N/A
script_digest: N/A

INTERFACE_CONSUMER:
artefact_name: allocation/day_effect.py
function: draw_uniform_day
description: Produces uniform deviate for day‐effect sampling.

POSTERIOR_VALIDATION:
metric: KS distance for uniformity
acceptance_range: [0.0, 0.05]
sample_size: 10000

PROVENANCE_TAG:
artefact_name: rng_policy.yml
sha256: <to‑be‑populated>

SHORT_DESCRIPTION:
Uniform deviate for corporate‐day effect.

TEST_PATHWAY:
test: CI uniform‐day test
input: uniform_day_effect.log
assert: KS statistic < 0.05

Confidence=HIGH
<<<END PP‑FIX>>>

<<<PP‑FIX id=11>>
Name: Gamma‐day RNG key derivation
Symbol: key = SHA256(global_seed‖"gamma_day"‖merchant_id)
Scope: merchant_location
---------------------------------

PRIOR:
type: Deterministic hash policy
hyperparameters:
  policy_file: config/rng_policy.yml
units: hex (256‑bit)
default_policy: abort on mismatch
justification: Derives Philox sub‐stream key for γ_d.

CALIBRATION_RECIPE:
input_path: N/A
objective: Not applicable
algorithm: Not applicable
random_seed: N/A
convergence_tol: N/A
script_digest: N/A

INTERFACE_CONSUMER:
artefact_name: allocation/day_effect.py
function: derive_gamma_key
description: Computes seed key for day‐effect PRNG.

POSTERIOR_VALIDATION:
metric: key digest match
acceptance_range: [true, true]
sample_size: one

PROVENANCE_TAG:
artefact_name: config/rng_policy.yml
sha256: <to‑be‑populated>

SHORT_DESCRIPTION:
Hash‐based PRNG key derivation for day‐effect.

TEST_PATHWAY:
test: CI gamma‐key derivation test
input: rng_policy.yml
assert: computed key digest matches

Confidence=HIGH
<<<END PP‑FIX>>>

<<<PP‑FIX id=12>>
Name: Universe hash h
Symbol: h = SHA256(zone_alpha_digest‖θ_mix_digest‖zone_floor_digest‖gamma_variance_digest‖zone_alloc_parquet_digest)
Scope: merchant_location
---------------------------------

PRIOR:
type: Deterministic function
hyperparameters:
  inputs: [zone_alpha_digest, θ_mix_digest, zone_floor_digest, gamma_variance_digest, zone_alloc_parquet_digest]
units: hex (256‑bit)
default_policy: abort on mismatch
justification: Binds all cross‑zone parameters and outputs into a single digest.

CALIBRATION_RECIPE:
input_path: N/A
objective: Not applicable
algorithm: Not applicable
random_seed: N/A
convergence_tol: N/A
script_digest: N/A

INTERFACE_CONSUMER:
artefact_name: allocation/universe_hash.py
function: compute_universe_hash
description: Aggregates digests into h for drift detection.

POSTERIOR_VALIDATION:
metric: hash match across runs
acceptance_range: [true, true]
sample_size: two independent builds

PROVENANCE_TAG:
artefact_name: allocation/universe_hash.py
sha256: <to‑be‑populated>

SHORT_DESCRIPTION:
Aggregate digest linking all 3A parameters and artefacts.

TEST_PATHWAY:
test: CI universe‑hash test
input: universe_hash.log
assert: h identical across builds

Confidence=HIGH
<<<END PP‑FIX>>>

<<<PP‑FIX id=13>>
Name: Zone‐alloc Parquet digest
Symbol: zone_alloc_parquet_digest
Scope: merchant_location
---------------------------------

PRIOR:
type: Fixed artefact reference
hyperparameters:
  file: zone_alloc.parquet
units: hex (256‑bit)
default_policy: abort on drift
justification: Digest of per‑merchant Parquet for drift detection.

CALIBRATION_RECIPE:
input_path: N/A
objective: Not applicable
algorithm: Not applicable
random_seed: N/A
convergence_tol: N/A
script_digest: N/A

INTERFACE_CONSUMER:
artefact_name: zone_alloc.parquet
function: N/A
description: Parquet file containing zone allocation outputs.

POSTERIOR_VALIDATION:
metric: digest match
acceptance_range: [true, true]
sample_size: all merchants

PROVENANCE_TAG:
artefact_name: zone_alloc.parquet
sha256: <to‑be‑populated>

SHORT_DESCRIPTION:
Parquet file SHA‑256 for zone allocation.

TEST_PATHWAY:
test: CI Parquet‑digest test
input: zone_alloc_index.csv
assert: sha256 matches logged value

Confidence=HIGH
<<<END PP‑FIX>>>

<<<PP‑FIX id=14>>
Name: Zone‐alloc index digest
Symbol: zone_alloc_index_digest
Scope: merchant_location
---------------------------------

PRIOR:
type: Fixed artefact reference
hyperparameters:
  file: zone_alloc_index.csv
units: hex (256‑bit)
default_policy: abort on mismatch
justification: Manifest key for zone‑alloc Parquet digest index.

CALIBRATION_RECIPE:
input_path: N/A
objective: Not applicable
algorithm: Not applicable
random_seed: N/A
convergence_tol: N/A
script_digest: N/A

INTERFACE_CONSUMER:
artefact_name: zone_alloc_index.csv
function: N/A
description: CSV manifest mapping merchant_id to Parquet digest.

POSTERIOR_VALIDATION:
metric: index entry presence
acceptance_range: [true, true]
sample_size: all merchants

PROVENANCE_TAG:
artefact_name: zone_alloc_index.csv
sha256: <to‑be‑populated>

SHORT_DESCRIPTION:
Manifest of zone‑alloc Parquet digests.

TEST_PATHWAY:
test: CI index‑digest test
input: zone_alloc_index.csv
assert: entry exists for every merchant

Confidence=HIGH
<<<END PP‑FIX>>>

<<<PP‑FIX id=15>>
Name: Barcode‑slope lower/upper bounds
Symbol: slope_low, slope_high
Scope: validation
---------------------------------

PRIOR:
type: Loaded constants
hyperparameters:
  slope_low: -1.0
  slope_high: -0.5
units: hours per offset
default_policy: abort on breach
justification: Acceptable slope range for CI cross‑zone offset test.

CALIBRATION_RECIPE:
input_path: N/A
objective: Not applicable
algorithm: Not applicable
random_seed: N/A
convergence_tol: N/A
script_digest: N/A

INTERFACE_CONSUMER:
artefact_name: validation/cross_zone_validation.py
function: check_barcode_slope
description: Enforces slope bounds in offset‑barcode test.

POSTERIOR_VALIDATION:
metric: slope violations count
acceptance_range: [0]
sample_size: daily build

PROVENANCE_TAG:
artefact_name: config/cross_zone_validation.yml
sha256: <to‑be‑populated>

SHORT_DESCRIPTION:
Slope tolerance for cross‑zone offset validation.

TEST_PATHWAY:
test: CI barcode‑slope test
input: barcode_slope_stats.log
assert: no slope outside [slope_low, slope_high]

Confidence=HIGH
<<<END PP‑FIX>>>

<<<PP‑FIX id=16>>
Name: Zone‑share convergence tolerance
Symbol: share_tolerance
Scope: validation
---------------------------------

PRIOR:
type: Loaded constant
hyperparameters:
  value: 0.02
units: dimensionless
default_policy: abort on breach
justification: Maximum allowed difference between empirical and target zone shares.

CALIBRATION_RECIPE:
input_path: N/A
objective: Not applicable
algorithm: Not applicable
random_seed: N/A
convergence_tol: N/A
script_digest: N/A

INTERFACE_CONSUMER:
artefact_name: validation/cross_zone_validation.yml
function: load_share_tolerance
description: Provides share_tolerance for CI checks.

POSTERIOR_VALIDATION:
metric: max |π_emp - π_target|
acceptance_range: [0.0, share_tolerance]
sample_size: daily build

PROVENANCE_TAG:
artefact_name: validation/cross_zone_validation.yml
sha256: <to‑be‑populated>

SHORT_DESCRIPTION:
Tolerance for zone‑share convergence in CI.

TEST_PATHWAY:
test: CI share‑convergence test
input: share_tolerance_stats.log
assert: max deviation ≤ share_tolerance

Confidence=HIGH
<<<END PP‑FIX>>>

##### END PARAMETER_SPEC #####

id=1  | gaps_closed=none | notes=Initial mixture threshold fully specified  
id=2  | gaps_closed=post | notes=Added posterior validation for τ smoothing  
id=3  | gaps_closed=post | notes=Specified Dirichlet‐alpha validation metric  
id=4  | gaps_closed=post | notes=Added Gamma sampling KS test  
id=5  | gaps_closed=none | notes=Bump threshold fully defined  
id=6  | gaps_closed=none | notes=Major‐zone mapping spec complete  
id=7  | gaps_closed=none | notes=Zone‐floor specification complete  
id=8  | gaps_closed=none | notes=Variance load and CI check in place  
id=9  | gaps_closed=none | notes=Derived mean spec complete  
id=10 | gaps_closed=none | notes=Uniform deviate test added  
id=11 | gaps_closed=none | notes=Gamma‐day key test specified  
id=12 | gaps_closed=none | notes=Universe hash CI test specified  
id=13 | gaps_closed=none | notes=Parquet digest CI test specified  
id=14 | gaps_closed=none | notes=Index digest CI test specified  
id=15 | gaps_closed=none | notes=Barcode‐slope spec complete  
id=16 | gaps_closed=none | notes=Share tolerance CI spec complete  
<<PS‑END>>