--- PP 1 ---
Name: Polygon nudge distance (border tie-break)
Symbol: $\varepsilon$
Scope: merchant_location
Prior_type: Deterministic constant (YAML-governed)
Prior_specified: Yes
Calibration_recipe: No (fixed at 0.0001 degrees, set in config/timezone/tz_nudge.yml)
Posterior_validation: Yes (any change triggers semver and SHA-256 digest bump, checked by CI; spatial nudge event logged per site)
Provenance_tag: Yes (config/timezone/tz_nudge.yml, semver, sha256_digest, field: nudge_distance_degrees)
Units: degrees (decimal lat/lon)
Default_policy: abort (any missing or non-numeric nudge aborts build)
Interface_consumer: STR-tree polygon tie-break, site catalogue nudge fields, audit event log
Description: Scalar nudge distance applied toward centroid of smaller polygon for tie-breaks on time zone border, ensuring deterministic resolution.
Anchor: "The algorithm computes the vector from the point $x$ to the centroid of the smaller polygon...multiplies it by a scalar ε where **ε = 0.0001 degrees**, then adds the displacement to $x$...The value ε is defined in `config/timezone/tz_nudge.yml`, which carries fields `semver`, `sha256_digest`, and `nudge_distance_degrees: 0.0001`;"
Context: "If two polygons claim the point—a circumstance that occurs along borders...The algorithm computes the vector from the point $x$ to the centroid of the smaller polygon...multiplies it by a scalar ε where **ε = 0.0001 degrees**, then adds the displacement to $x$ producing $x' = x + ε\frac{c-x}{\|c-x\|}$."
Gap_flags:
  prior_missing=N
  hyperparams_missing=N
  calibration_missing=N
  posterior_missing=N
  provenance_missing=N
  units_missing=N
  default_policy_missing=N
  interface_consumer_missing=N
  description_missing=N
Confidence=HIGH
--- END PP 1 ---

--- PP 2 ---
Name: Simulation horizon (time zone timeline extraction)
Symbol: $[s, e]$
Scope: merchant_location
Prior_type: Deterministic interval (YAML-governed)
Prior_specified: Yes
Calibration_recipe: Yes (set in config/timezone/simulation_horizon.yml; ISO-8601 parsed, CI checked; digest covers both start/end and semver)
Posterior_validation: Yes (any change triggers digest and downstream cache, CI asserts all transitions in-bounds; memory test logged)
Provenance_tag: Yes (config/timezone/simulation_horizon.yml, semver, sha256_digest, fields: sim_start_iso8601, sim_end_iso8601)
Units: epoch milliseconds (int64)
Default_policy: abort (out-of-bounds transition access or cache oversize aborts build)
Interface_consumer: Transition truncation in zone extraction, memory/caching limits, output manifest
Description: Start and end of simulation time horizon for extracting relevant transition tables for each TZID; bounds timeline for legal event times.
Anchor: "The tzdata archive ... is declared with a semver field in `zoneinfo_version.yml` and its SHA‑256 recorded...Zoneinfo is queried through ... `zoneinfo.ZoneInfo` API...intersects it with the simulation horizon and writes a compact two-column timetable...A memory gauge after construction writes the exact byte size...if ... upgrade ... triples memory, CI surfaces the expansion..."
Context: "With a final `TZID` attached, the engine consults the IANA zoneinfo database version...Zoneinfo is queried...intersects it with the simulation horizon and writes a compact two-column timetable..."
Gap_flags:
  prior_missing=N
  hyperparams_missing=N
  calibration_missing=N
  posterior_missing=N
  provenance_missing=N
  units_missing=N
  default_policy_missing=N
  interface_consumer_missing=N
  description_missing=N
Confidence=HIGH
--- END PP 2 ---

--- PP 3 ---
Name: DST legality gap duration
Symbol: $\Delta$
Scope: merchant_location
Prior_type: Derived constant (function of offset change at transition)
Prior_specified: Yes
Calibration_recipe: No (computed directly per transition from tzdata offsets)
Posterior_validation: Yes (checked at every forward gap adjustment, with event log per site; output fields: dst_adjusted, gap_seconds)
Provenance_tag: Yes (tzdata_archive_digest, output in audit/event log)
Units: seconds (int64)
Default_policy: abort (illegal time not corrected triggers abort; missing audit triggers manifest drift)
Interface_consumer: DST legality test in local-to-UTC mapping; gap fields in output row
Description: Forward gap (spring-forward) duration in seconds, computed as difference in pre- and post-transition UTC offsets; used to legalize event times.
Anchor: "Here, $\Delta$ is defined as the difference between the post‑transition and pre‑transition UTC offsets in seconds (i.e. $\Delta = (o_{i+1} - o_i)\times60$)...The engine replaces it by $t_{\text{legal}} = t_i + \Delta$, sets `dst_adjusted=True` and writes `gap_seconds = t_{\text{legal}} - t_{\text{local}}`."
Context: "If $t_{\text{local}}$ lies strictly between a transition epoch and that epoch plus the forward gap length, it is illegal. Here, $\Delta$ is defined as the difference between the post‑transition and pre‑transition UTC offsets in seconds..."
Gap_flags:
  prior_missing=N
  hyperparams_missing=N
  calibration_missing=N
  posterior_missing=N
  provenance_missing=N
  units_missing=N
  default_policy_missing=N
  interface_consumer_missing=N
  description_missing=N
Confidence=HIGH
--- END PP 3 ---

--- PP 4 ---
Name: Fold disambiguation hash
Symbol: $h = \mathrm{SHA256}(B)$, $\mathrm{fold} = h[0]\bmod2$
Scope: merchant_location
Prior_type: Deterministic hash function (uses global_seed)
Prior_specified: Yes
Calibration_recipe: Not applicable (fully deterministic; not calibrated)
Posterior_validation: Yes (audit log per event; proof in docs/rng_proof.md, digest in manifest)
Provenance_tag: Yes (docs/rng_proof.md, manifest: rng_proof_digest, global_seed in manifest)
Units: integer {0, 1}
Default_policy: abort (missing hash, manifest drift, or fold ambiguity aborts build)
Interface_consumer: Fall-back fold-bit assignment for ambiguous local epoch; fold field in output row, CI and audit log
Description: Hash function used to resolve ambiguous local event times during DST fall-back; ensures deterministic, reproducible assignment.
Anchor: "If instead $t_{\text{local}}$ matches two legal instants in the fall‑back fold, the engine determines the correct fold by computing `h = SHA-256(global_seed ‖ site_id ‖ t_local)` and setting `fold = h[0] mod 2`..."
Context: "If $t_{\text{local}}$ lies strictly between a transition epoch...The engine replaces it...If instead $t_{\text{local}}$ matches two legal instants...the engine determines the correct fold by computing `h = SHA-256(global_seed ‖ site_id ‖ t_local)` and setting `fold = h[0] mod 2`..."
Gap_flags:
  prior_missing=N
  hyperparams_missing=N
  calibration_missing=N
  posterior_missing=N
  provenance_missing=N
  units_missing=N
  default_policy_missing=N
  interface_consumer_missing=N
  description_missing=N
Confidence=HIGH
--- END PP 4 ---

--- PP 5 ---
Name: Memory ceiling for in-memory zone cache
Symbol: $\mathrm{tz\_cache\_bytes} < 8 \times 2^{20}$
Scope: merchant_location
Prior_type: Deterministic (policy constant)
Prior_specified: Yes
Calibration_recipe: No (fixed threshold, hard-coded and CI-logged)
Posterior_validation: Yes (memory gauge event logged, checked on every build; overage triggers TimeTableCoverageError)
Provenance_tag: Yes (output/tz_cache_bytes.txt, manifest: tz_cache_bytes, threshold contract in manifest)
Units: bytes (int64)
Default_policy: abort (build aborts if cache exceeds threshold; no partial outputs allowed)
Interface_consumer: Memory audit, build log, manifest digest, error handling
Description: Maximum allowed memory footprint of cached transition timetables (all zones); forces explicit horizon tuning or upgrade if breached.
Anchor: "A memory gauge after construction writes the exact byte size of the entire cache into the manifest; if a future upgrade to the IANA file inadvertently triples memory, CI surfaces the expansion where a silent leak could otherwise go unnoticed."
Context: "A memory gauge after construction writes the exact byte size of the entire cache into the manifest; if a future upgrade...CI surfaces the expansion where a silent leak could otherwise go unnoticed."
Gap_flags:
  prior_missing=N
  hyperparams_missing=N
  calibration_missing=N
  posterior_missing=N
  provenance_missing=N
  units_missing=N
  default_policy_missing=N
  interface_consumer_missing=N
  description_missing=N
Confidence=HIGH
--- END PP 5 ---

<<PP‑END>>