<<<EC-FIX id=1>>
Stage: BuildSTRTreeIndex
Failure_event: Missing shapefile companion artefacts (.shx, .dbf, .prj, .cpg)
Detection:
  trigger: file existence check for all companion files under `artefacts/priors/tz_world/2025a/`
  error_code: JP-M001
Recovery:
  action: abort
  max_retries: 0
  backoff_sec: 0
Idempotence:
  guarantee: no partial index files on abort
Monitoring:
  metric_name: shapefile_companion_missing_total
  alert_thresh: shapefile_companion_missing_total > 0
Expected_format: all five files present at specified path
Interface_affected: DeriveTimeZoneModule/buildSTRTreeIndex
Test_pathway:
  type: CI
  injection: remove one companion file and run buildSTRTreeIndex()
<<<END EC-FIX>>>

<<<EC-FIX id=2>>
Stage: BuildSTRTreeIndex
Failure_event: Wrong CRS on shapefile load
Detection:
  trigger: CRS check fails if shapefile CRS ≠ EPSG:4326
  error_code: JP-M002
Recovery:
  action: abort
  max_retries: 0
  backoff_sec: 0
Idempotence:
  guarantee: no incomplete index on abort
Monitoring:
  metric_name: shapefile_crs_mismatch_total
  alert_thresh: shapefile_crs_mismatch_total > 0
Expected_format: CRS = EPSG:4326
Interface_affected: DeriveTimeZoneModule/buildSTRTreeIndex
Test_pathway:
  type: CI
  injection: provide shapefile with wrong CRS and run buildSTRTreeIndex()
<<<END EC-FIX>>>

<<<EC-FIX id=3>>
Stage: DeriveTimeZone
Failure_event: Missing or misnamed `tz_nudge.yml`
Detection:
  trigger: file existence check for `config/timezone/tz_nudge.yml`
  error_code: JP-M003
Recovery:
  action: abort
  max_retries: 0
  backoff_sec: 0
Idempotence:
  guarantee: no partial timezone assignments on abort
Monitoring:
  metric_name: tz_nudge_missing_total
  alert_thresh: tz_nudge_missing_total > 0
Expected_format: YAML file at `config/timezone/tz_nudge.yml`
Interface_affected: DeriveTimeZoneModule/deriveTimeZone
Test_pathway:
  type: CI
  injection: delete or rename tz_nudge.yml and run deriveTimeZone()
<<<END EC-FIX>>>

<<<EC-FIX id=4>>
Stage: DeriveTimeZone
Failure_event: Tie-break still yields two polygons → DSTLookupTieError
Detection:
  trigger: derivation logic catches DSTLookupTieError after nudge
  error_code: JP-M004
Recovery:
  action: abort
  max_retries: 0
  backoff_sec: 0
Idempotence:
  guarantee: no inconsistent TZ assignments on abort
Monitoring:
  metric_name: dst_tie_error_total
  alert_thresh: dst_tie_error_total > 0
Expected_format: single TZID after nudge
Interface_affected: DeriveTimeZoneModule/deriveTimeZone
Test_pathway:
  type: fuzz
  injection: craft overlapping polygons and run deriveTimeZone()
<<<END EC-FIX>>>

<<<EC-FIX id=5>>
Stage: ApplyTimeZoneOverrides
Failure_event: Missing `tz_overrides.yaml`
Detection:
  trigger: file existence check for `config/timezone/tz_overrides.yaml`
  error_code: JP-M005
Recovery:
  action: abort
  max_retries: 0
  backoff_sec: 0
Idempotence:
  guarantee: no override state on abort
Monitoring:
  metric_name: tz_overrides_missing_total
  alert_thresh: tz_overrides_missing_total > 0
Expected_format: YAML file at `config/timezone/tz_overrides.yaml`
Interface_affected: ApplyTimeZoneOverridesModule/applyOverrides
Test_pathway:
  type: CI
  injection: remove tz_overrides.yaml and run applyOverrides()
<<<END EC-FIX>>>

<<<EC-FIX id=6>>
Stage: ApplyTimeZoneOverrides
Failure_event: Invalid override entry (URL or expiry date format)
Detection:
  trigger: pre-commit hook validation fails on URL or date format
  error_code: JP-M006
Recovery:
  action: abort
  max_retries: 0
  backoff_sec: 0
Idempotence:
  guarantee: no override applied on abort
Monitoring:
  metric_name: tz_override_validation_failure_total
  alert_thresh: tz_override_validation_failure_total > 0
Expected_format: valid URL and parsable date in `evidence_url` and `expiry_yyyy_mm_dd`
Interface_affected: ApplyTimeZoneOverridesModule/applyOverrides
Test_pathway:
  type: unit
  injection: insert bad URL or date and run pre-commit hook
<<<END EC-FIX>>>

<<<EC-FIX id=7>>
Stage: ExtractZoneTimeline
Failure_event: Missing tzdata archive `tzdata2025a.tar.gz`
Detection:
  trigger: file existence check for `artefacts/priors/tzdata/tzdata2025a.tar.gz`
  error_code: JP-M007
Recovery:
  action: abort
  max_retries: 0
  backoff_sec: 0
Idempotence:
  guarantee: no partial extraction on abort
Monitoring:
  metric_name: tzdata_archive_missing_total
  alert_thresh: tzdata_archive_missing_total > 0
Expected_format: tar.gz archive at specified path
Interface_affected: ExtractZoneTimelineModule/extractZoneTimeline
Test_pathway:
  type: CI
  injection: remove tzdata2025a.tar.gz and run extractZoneTimeline()
<<<END EC-FIX>>>

<<<EC-FIX id=8>>
Stage: ExtractZoneTimeline
Failure_event: Missing `simulation_horizon.yml`
Detection:
  trigger: file existence check for `config/timezone/simulation_horizon.yml`
  error_code: JP-M008
Recovery:
  action: abort
  max_retries: 0
  backoff_sec: 0
Idempotence:
  guarantee: no partial timeline on abort
Monitoring:
  metric_name: simulation_horizon_missing_total
  alert_thresh: simulation_horizon_missing_total > 0
Expected_format: YAML file at `config/timezone/simulation_horizon.yml`
Interface_affected: ExtractZoneTimelineModule/extractZoneTimeline
Test_pathway:
  type: CI
  injection: delete simulation_horizon.yml and run extractZoneTimeline()
<<<END EC-FIX>>>

<<<EC-FIX id=9>>
Stage: ExtractZoneTimeline
Failure_event: Missing memory-gauge check for tz_cache size
Detection:
  trigger: CI assertion on `tz_cache_bytes` > 8 MiB
  error_code: JP-M009
Recovery:
  action: abort
  max_retries: 0
  backoff_sec: 0
Idempotence:
  guarantee: no inconsistent cache state on abort
Monitoring:
  metric_name: tz_cache_size_exceeded_total
  alert_thresh: tz_cache_size_exceeded_total > 0
Expected_format: integer < 8388608
Interface_affected: ExtractZoneTimelineModule/extractZoneTimeline
Test_pathway:
  type: CI
  injection: set tz_cache_bytes > 8 MiB and run extractZoneTimeline()
<<<END EC-FIX>>>

<<<EC-FIX id=10>>
Stage: DeriveTimeZone
Failure_event: Missing audit log `tz_assignment_audit.log`
Detection:
  trigger: file existence check for `logs/tz_assignment_audit.log`
  error_code: JP-M010
Recovery:
  action: abort
  max_retries: 0
  backoff_sec: 0
Idempotence:
  guarantee: no missing audit entries on abort
Monitoring:
  metric_name: tz_assignment_audit_missing_total
  alert_thresh: tz_assignment_audit_missing_total > 0
Expected_format: log file at `logs/tz_assignment_audit.log`
Interface_affected: DeriveTimeZoneModule/deriveTimeZone
Test_pathway:
  type: CI
  injection: remove audit log and run deriveTimeZone()
<<<END EC-FIX>>>

<<<EC-FIX id=11>>
Stage: ApplyTimeZoneOverrides
Failure_event: Missing CI override-validation log `ci_override_validation.log`
Detection:
  trigger: file existence check for `logs/ci_override_validation.log`
  error_code: JP-M011
Recovery:
  action: abort
  max_retries: 0
  backoff_sec: 0
Idempotence:
  guarantee: no missing CI validation on abort
Monitoring:
  metric_name: ci_override_validation_missing_total
  alert_thresh: ci_override_validation_missing_total > 0
Expected_format: log file at `logs/ci_override_validation.log`
Interface_affected: ApplyTimeZoneOverridesModule/validateOverrides
Test_pathway:
  type: CI
  injection: skip CI validation step and run validateOverrides()
<<<END EC-FIX>>>

<<<EC-FIX id=12>>
Stage: ExtractZoneTimeline
Failure_event: Missing cache-size record `tz_cache_bytes.txt`
Detection:
  trigger: file existence check for `output/tz_cache_bytes.txt`
  error_code: JP-M012
Recovery:
  action: abort
  max_retries: 0
  backoff_sec: 0
Idempotence:
  guarantee: no missing cache record on abort
Monitoring:
  metric_name: tz_cache_bytes_missing_total
  alert_thresh: tz_cache_bytes_missing_total > 0
Expected_format: text file at `output/tz_cache_bytes.txt`
Interface_affected: ExtractZoneTimelineModule/extractZoneTimeline
Test_pathway:
  type: CI
  injection: suppress memory-gauge write and run extractZoneTimeline()
<<<END EC-FIX>>>

<<<EC-FIX id=13>>
Stage: LicenceProvenance
Failure_event: Missing licence files in `LICENSES/`
Detection:
  trigger: verifyLicences() finds missing files under `LICENSES/`
  error_code: JP-M013
Recovery:
  action: abort
  max_retries: 0
  backoff_sec: 0
Idempotence:
  guarantee: no unlicensed artefacts on abort
Monitoring:
  metric_name: licence_files_missing_total
  alert_thresh: licence_files_missing_total > 0
Expected_format: licence files under `LICENSES/`
Interface_affected: LicenceManager/verifyLicences
Test_pathway:
  type: CI
  injection: remove a licence file and run verifyLicences()
<<<END EC-FIX>>>

##### END EDGE-CASE SPEC #####

id=1  | Confidence=HIGH | Notes=Guarantee full shapefile load completeness.  
id=2  | Confidence=MEDIUM | Notes=Enforce correct CRS and log occurrences.  
id=3  | Confidence=HIGH | Notes=Ensure tz_nudge config presence.  
id=4  | Confidence=MEDIUM | Notes=Abort on DST tie to prevent ambiguous timezone.  
id=5  | Confidence=HIGH | Notes=Require override rules for timezone deviations.  
id=6  | Confidence=MEDIUM | Notes=Validate override format via CI pre-commit.  
id=7  | Confidence=HIGH | Notes=Enforce tzdata archive availability.  
id=8  | Confidence=HIGH | Notes=Guarantee simulation horizon config.  
id=9  | Confidence=MEDIUM | Notes=Monitor cache size to avoid memory bloat.  
id=10 | Confidence=HIGH | Notes=Ensure audit trace for tz assignments.  
id=11 | Confidence=HIGH | Notes=Enforce CI validation logs for overrides.  
id=12 | Confidence=HIGH | Notes=Require cache-size record for reproducibility.  
id=13 | Confidence=HIGH | Notes=Ensure licence files accompany artefacts.  

<<ES-END>>