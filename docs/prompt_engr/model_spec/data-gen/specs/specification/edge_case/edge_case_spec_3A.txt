<<<EC-FIX id=1>>
Stage: FlagEscalationCountries
Failure_event: Missing `config/allocation/zone_mixture_policy.yml`
Detection:
  trigger: file existence check for `config/allocation/zone_mixture_policy.yml`
  error_code: JP-M001
Recovery:
  action: abort
  max_retries: 0
  backoff_sec: 0
Idempotence:
  guarantee: no partial allocations on abort
Monitoring:
  metric_name: zone_mixture_policy_missing_total
  alert_thresh: zone_mixture_policy_missing_total > 0
Expected_format: YAML at `config/allocation/zone_mixture_policy.yml` with keys `theta_mix`, `semver`, `sha256_digest`
Interface_affected: FlagEscalationCountriesModule/flagEscalationCountries
Test_pathway:
  type: CI
  injection: remove `zone_mixture_policy.yml` and run flagEscalationCountries()
<<<END EC-FIX>>>

<<<EC-FIX id=2>>
Stage: FlagEscalationCountries
Failure_event: Invalid `theta_mix` value (≤0 or ≥1)
Detection:
  trigger: validation check on loaded `theta_mix` value
  error_code: JP-M002
Recovery:
  action: abort
  max_retries: 0
  backoff_sec: 0
Idempotence:
  guarantee: no country flags on abort
Monitoring:
  metric_name: invalid_theta_mix_total
  alert_thresh: invalid_theta_mix_total > 0
Expected_format: 0 < `theta_mix` < 1
Interface_affected: FlagEscalationCountriesModule/flagEscalationCountries
Test_pathway:
  type: CI
  injection: set `theta_mix=0` or `1` and run CI test_mix_threshold.py
<<<END EC-FIX>>>

<<<EC-FIX id=3>>
Stage: ComputeDirichletShares
Failure_event: Missing `config/allocation/country_zone_alphas.yaml`
Detection:
  trigger: file existence check for `country_zone_alphas.yaml`
  error_code: JP-M003
Recovery:
  action: abort
  max_retries: 0
  backoff_sec: 0
Idempotence:
  guarantee: no Dirichlet shares persisted on abort
Monitoring:
  metric_name: country_zone_alphas_missing_total
  alert_thresh: country_zone_alphas_missing_total > 0
Expected_format: YAML mapping ISO→{TZID: positive integer α}
Interface_affected: ComputeDirichletSharesModule/computeDirichletShares
Test_pathway:
  type: CI
  injection: delete `country_zone_alphas.yaml` and run computeDirichletShares()
<<<END EC-FIX>>>

<<<EC-FIX id=4>>
Stage: ComputeDirichletShares
Failure_event: Non-positive α in `country_zone_alphas.yaml`
Detection:
  trigger: validation check for α_z ≤ 0
  error_code: JP-M004
Recovery:
  action: abort
  max_retries: 0
  backoff_sec: 0
Idempotence:
  guarantee: no shares computed on abort
Monitoring:
  metric_name: invalid_alpha_total
  alert_thresh: invalid_alpha_total > 0
Expected_format: α_z ∈ ℕ⁺
Interface_affected: ComputeDirichletSharesModule/computeDirichletShares
Test_pathway:
  type: fuzz
  injection: set α to 0 or negative and run computeDirichletShares()
<<<END EC-FIX>>>

<<<EC-FIX id=5>>
Stage: ApplyDeterministicRounding
Failure_event: Missing functional spec `docs/round_ints.md`
Detection:
  trigger: file existence check for `docs/round_ints.md`
  error_code: JP-M005
Recovery:
  action: abort
  max_retries: 0
  backoff_sec: 0
Idempotence:
  guarantee: no rounding applied on abort
Monitoring:
  metric_name: rounding_spec_missing_total
  alert_thresh: rounding_spec_missing_total > 0
Expected_format: Markdown file at `docs/round_ints.md`
Interface_affected: ApplyDeterministicRoundingModule/applyDeterministicRounding
Test_pathway:
  type: CI
  injection: remove `docs/round_ints.md` and run ci/test_rounding_conservation.py
<<<END EC-FIX>>>

<<<EC-FIX id=6>>
Stage: EnforceZoneFloors
Failure_event: Missing `config/allocation/zone_floor.yml`
Detection:
  trigger: file existence check for `zone_floor.yml`
  error_code: JP-M006
Recovery:
  action: abort
  max_retries: 0
  backoff_sec: 0
Idempotence:
  guarantee: no floor enforcement on abort
Monitoring:
  metric_name: zone_floor_missing_total
  alert_thresh: zone_floor_missing_total > 0
Expected_format: YAML at `config/allocation/zone_floor.yml`
Interface_affected: EnforceZoneFloorsModule/enforceZoneFloors
Test_pathway:
  type: CI
  injection: delete `zone_floor.yml` and run ci/test_zone_floor.py
<<<END EC-FIX>>>

<<<EC-FIX id=7>>
Stage: EnforceZoneFloors
Failure_event: Non-integer or negative floor values in `zone_floor.yml`
Detection:
  trigger: validation check for φ_z ∉ ℕ₀
  error_code: JP-M007
Recovery:
  action: abort
  max_retries: 0
  backoff_sec: 0
Idempotence:
  guarantee: no allocations on abort
Monitoring:
  metric_name: invalid_floor_value_total
  alert_thresh: invalid_floor_value_total > 0
Expected_format: φ_z ∈ ℕ₀
Interface_affected: EnforceZoneFloorsModule/enforceZoneFloors
Test_pathway:
  type: unit
  injection: set floor to –1 or decimal and run ci/test_zone_floor.py
<<<END EC-FIX>>>

<<<EC-FIX id=8>>
Stage: ComputeMajorZoneFallback
Failure_event: Missing `artefacts/allocation/country_major_zone.csv`
Detection:
  trigger: file existence check for `country_major_zone.csv`
  error_code: JP-M008
Recovery:
  action: abort
  max_retries: 0
  backoff_sec: 0
Idempotence:
  guarantee: no fallback applied on abort
Monitoring:
  metric_name: country_major_zone_missing_total
  alert_thresh: country_major_zone_missing_total > 0
Expected_format: CSV at `artefacts/allocation/country_major_zone.csv`
Interface_affected: ComputeMajorZoneFallbackModule/computeMajorZoneFallback
Test_pathway:
  type: CI
  injection: remove `country_major_zone.csv` and run computeMajorZoneFallback()
<<<END EC-FIX>>>

<<<EC-FIX id=9>>
Stage: WriteZoneAllocParquet
Failure_event: Missing per-merchant Parquet `<merchant_id>_zone_alloc.parquet`
Detection:
  trigger: file existence check for `<merchant_id>_zone_alloc.parquet`
  error_code: JP-M009
Recovery:
  action: abort
  max_retries: 0
  backoff_sec: 0
Idempotence:
  guarantee: no partial writes on abort
Monitoring:
  metric_name: zone_alloc_parquet_missing_total
  alert_thresh: zone_alloc_parquet_missing_total > 0
Expected_format: Parquet at `artefacts/allocation/<merchant_id>_zone_alloc.parquet`
Interface_affected: WriteZoneAllocParquetModule/writeZoneAllocParquet
Test_pathway:
  type: CI
  injection: skip Parquet write and run writeZoneAllocParquet()
<<<END EC-FIX>>>

<<<EC-FIX id=10>>
Stage: AppendZoneAllocIndex
Failure_event: Missing or incomplete `zone_alloc_index.csv` entry
Detection:
  trigger: missing line `<merchant_id>,<sha256>` in `zone_alloc_index.csv`
  error_code: JP-M010
Recovery:
  action: abort
  max_retries: 0
  backoff_sec: 0
Idempotence:
  guarantee: no index update on abort
Monitoring:
  metric_name: zone_alloc_index_missing_total
  alert_thresh: zone_alloc_index_missing_total > 0
Expected_format: one `<merchant_id>,<sha256>` line per merchant in CSV
Interface_affected: AppendZoneAllocIndexModule/appendZoneAllocIndex
Test_pathway:
  type: CI
  injection: omit append and run appendZoneAllocIndex()
<<<END EC-FIX>>>

<<<EC-FIX id=11>>
Stage: ComputeCorporateDayEffect
Failure_event: Missing `config/routing/routing_day_effect.yml`
Detection:
  trigger: file existence check for `routing_day_effect.yml`
  error_code: JP-M011
Recovery:
  action: abort
  max_retries: 0
  backoff_sec: 0
Idempotence:
  guarantee: no day-effect output on abort
Monitoring:
  metric_name: routing_day_effect_missing_total
  alert_thresh: routing_day_effect_missing_total > 0
Expected_format: YAML at `config/routing/routing_day_effect.yml` with `sigma_gamma_sq`
Interface_affected: CorporateDayEffectModule/computeDayEffect
Test_pathway:
  type: CI
  injection: delete `routing_day_effect.yml` and run computeDayEffect()
<<<END EC-FIX>>>

<<<EC-FIX id=12>>
Stage: ComputeCorporateDayEffect
Failure_event: Missing `config/routing/rng_policy.yml` for key derivation
Detection:
  trigger: file existence check for `rng_policy.yml`
  error_code: JP-M012
Recovery:
  action: abort
  max_retries: 0
  backoff_sec: 0
Idempotence:
  guarantee: no gamma key on abort
Monitoring:
  metric_name: rng_policy_missing_total
  alert_thresh: rng_policy_missing_total > 0
Expected_format: YAML at `config/routing/rng_policy.yml` defining gamma-day policy
Interface_affected: CorporateDayEffectModule/deriveGammaKey
Test_pathway:
  type: CI
  injection: remove `rng_policy.yml` and run computeDayEffect()
<<<END EC-FIX>>>

<<<EC-FIX id=13>>
Stage: VerifyRandomStreamIsolation
Failure_event: Missing proof document `docs/rng_proof.md`
Detection:
  trigger: file existence check for `docs/rng_proof.md`
  error_code: JP-M013
Recovery:
  action: abort
  max_retries: 0
  backoff_sec: 0
Idempotence:
  guarantee: no undocumented RNG behavior
Monitoring:
  metric_name: rng_proof_missing_total
  alert_thresh: rng_proof_missing_total > 0
Expected_format: Markdown at `docs/rng_proof.md`
Interface_affected: N/A
Test_pathway:
  type: CI
  injection: remove `docs/rng_proof.md` and run ci/replay_zone_alloc.py
<<<END EC-FIX>>>

<<<EC-FIX id=14>>
Stage: CrossZoneValidation
Failure_event: Missing `config/validation/cross_zone_validation.yml`
Detection:
  trigger: file existence check for `cross_zone_validation.yml`
  error_code: JP-M014
Recovery:
  action: abort
  max_retries: 0
  backoff_sec: 0
Idempotence:
  guarantee: no validation on abort
Monitoring:
  metric_name: cross_zone_validation_missing_total
  alert_thresh: cross_zone_validation_missing_total > 0
Expected_format: YAML at `config/validation/cross_zone_validation.yml` with keys `barcode_slope_low`, `barcode_slope_high`, `share_tolerance`
Interface_affected: CrossZoneValidationModule/validateCrossZone
Test_pathway:
  type: CI
  injection: delete `cross_zone_validation.yml` and run ci/test_cross_zone_validation.py
<<<END EC-FIX>>>

##### END EDGE-CASE SPEC #####

id=1  | Confidence=HIGH   | Notes=Ensure mixture policy config to derive θ reliably.  
id=2  | Confidence=MEDIUM | Notes=Enforce valid θ_mix to prevent silent queue bypass.  
id=3  | Confidence=HIGH   | Notes=Require Dirichlet hyper-parameters for share computation.  
id=4  | Confidence=MEDIUM | Notes=Block non-positive α to maintain valid probability law.  
id=5  | Confidence=HIGH   | Notes=Include rounding spec to guarantee integer conservation.  
id=6  | Confidence=HIGH   | Notes=Ensure zone floors config presence for consistency.  
id=7  | Confidence=MEDIUM | Notes=Validate floor values to prevent negative allocations.  
id=8  | Confidence=HIGH   | Notes=Require major-zone CSV for fallback logic.  
id=9  | Confidence=HIGH   | Notes=Ensure merchant-scale Parquet outputs.  
id=10 | Confidence=HIGH   | Notes=Guarantee index CSV entries for quick lookup.  
id=11 | Confidence=HIGH   | Notes=Require day-effect config for corporate scheduling.  
id=12 | Confidence=HIGH   | Notes=Ensure RNG policy for gamma key derivation.  
id=13 | Confidence=LOW    | Notes=Provide RNG proof doc for audit and reproducibility.  
id=14 | Confidence=HIGH   | Notes=Include cross-zone validation config for consistency.  

<<ES-END>>