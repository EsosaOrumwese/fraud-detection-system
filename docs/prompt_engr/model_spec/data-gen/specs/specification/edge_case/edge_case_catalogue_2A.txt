--- EC 1 | Stage=BuildSTRTreeIndex | Severity=High ---
Failure_event: Missing shapefile companion artefacts (.shx, .dbf, .prj, .cpg)
Anchor: "The shapefile and its companion resources reside under `artefacts/priors/tz_world/2025a/` including `tz_world_2025a.shp`, `tz_world_2025a.shx`, `tz_world_2025a.dbf`, `tz_world_2025a.prj`, and `tz_world_2025a.cpg`"
Current_handled: No
Detection_gap: Yes
Recovery_gap: Yes
Idempotence_gap: Yes
Metrics_gap: Yes
Expected_format: all five files present at specified path
Interfaces_affected: DeriveTimeZoneModule/buildSTRTreeIndex
Test_type: CI
Test_injection: remove one companion file and run buildSTRTreeIndex()
Context: “… every premise, data-source dependency … shapefile and its companion resources … complete provenance for the entire layer.”
Confidence=HIGH
--- END EC 1 ---

--- EC 2 | Stage=BuildSTRTreeIndex | Severity=Med ---
Failure_event: Wrong CRS on shapefile load
Anchor: "Fiona must open them with CRS EPSG:4326 or the build aborts."
Current_handled: Yes
Detection_gap: No
Recovery_gap: No
Idempotence_gap: No
Metrics_gap: Yes
Expected_format: CRS = EPSG:4326
Interfaces_affected: DeriveTimeZoneModule/buildSTRTreeIndex
Test_type: CI
Test_injection: supply shapefile with wrong CRS and run buildSTRTreeIndex()
Context: “Each file declares metadata … Fiona must open them with CRS EPSG:4326 or the build aborts.”
Confidence=MEDIUM
--- END EC 2 ---

--- EC 3 | Stage=DeriveTimeZone | Severity=High ---
Failure_event: Missing or misnamed `tz_nudge.yml`
Anchor: "ε is read from `config/timezone/tz_nudge.yml` (fields `semver`, `sha256_digest`, `nudge_distance_degrees: 0.0001`)."
Current_handled: No
Detection_gap: Yes
Recovery_gap: Yes
Idempotence_gap: Yes
Metrics_gap: Yes
Expected_format: YAML file at `config/timezone/tz_nudge.yml`
Interfaces_affected: DeriveTimeZoneModule/deriveTimeZone
Test_type: CI
Test_injection: delete or rename tz_nudge.yml and run deriveTimeZone()
Context: “tie-break … where ε is read from `config/timezone/tz_nudge.yml` … its digest is recorded as `tz_nudge_digest`.”
Confidence=HIGH
--- END EC 3 ---

--- EC 4 | Stage=DeriveTimeZone | Severity=Med ---
Failure_event: Tie-break still yields two polygons → DSTLookupTieError
Anchor: "In the rare event that two polygons still claim the nudged point, the engine raises `DSTLookupTieError` … and aborts."
Current_handled: Partial
Detection_gap: No
Recovery_gap: No
Idempotence_gap: No
Metrics_gap: Yes
Expected_format: single `TZID` after nudge
Interfaces_affected: DeriveTimeZoneModule/deriveTimeZone
Test_type: fuzz
Test_injection: craft two nearly overlapping polygons and run deriveTimeZone()
Context: “… two hits trigger a deterministic nudge … if two polygons still claim … raises `DSTLookupTieError` …”
Confidence=MEDIUM
--- END EC 4 ---

--- EC 5 | Stage=ApplyTimeZoneOverrides | Severity=High ---
Failure_event: Missing `tz_overrides.yaml`
Anchor: "The governed artefact `config/timezone/tz_overrides.yaml` …; any modification updates `tz_overrides_digest`."
Current_handled: No
Detection_gap: Yes
Recovery_gap: Yes
Idempotence_gap: Yes
Metrics_gap: Yes
Expected_format: YAML file at `config/timezone/tz_overrides.yaml`
Interfaces_affected: ApplyTimeZoneOverridesModule/applyOverrides
Test_type: CI
Test_injection: remove tz_overrides.yaml and run applyOverrides()
Context: “All deviations are centralised in the file `config/timezone/tz_overrides.yaml` …”
Confidence=HIGH
--- END EC 5 ---

--- EC 6 | Stage=ApplyTimeZoneOverrides | Severity=Med ---
Failure_event: Invalid override entry (URL or expiry date format)
Anchor: "Git pre-commit validates URL and date formats."
Current_handled: Partial
Detection_gap: Yes
Recovery_gap: Yes
Idempotence_gap: Yes
Metrics_gap: Yes
Expected_format: `evidence_url` valid URL, `expiry_yyyy_mm_dd` parsable date
Interfaces_affected: ApplyTimeZoneOverridesModule/applyOverrides
Test_type: unit
Test_injection: insert bad URL or date in tz_overrides.yaml and run pre-commit hook
Context: “… pre-commit Git hook verifies that `evidence_url` is a valid URL and that `expiry_yyyy_mm_dd` is parsable.”
Confidence=MEDIUM
--- END EC 6 ---

--- EC 7 | Stage=ExtractZoneTimeline | Severity=High ---
Failure_event: Missing tzdata archive `tzdata2025a.tar.gz`
Anchor: "The tzdata archive `artefacts/priors/tzdata/tzdata2025a.tar.gz` … its SHA-256 is recorded as `tzdata_archive_digest`."
Current_handled: No
Detection_gap: Yes
Recovery_gap: Yes
Idempotence_gap: Yes
Metrics_gap: Yes
Expected_format: tar.gz archive at specified path
Interfaces_affected: ExtractZoneTimelineModule/extractZoneTimeline
Test_type: CI
Test_injection: remove tzdata2025a.tar.gz and run extractZoneTimeline()
Context: “… tzdata archive `artefacts/priors/tzdata/tzdata2025a.tar.gz` … guarantees the exact rule set.”
Confidence=HIGH
--- END EC 7 ---

--- EC 8 | Stage=ExtractZoneTimeline | Severity=High ---
Failure_event: Missing `simulation_horizon.yml`
Anchor: "values read from `config/timezone/simulation_horizon.yml`, fields `semver`, `sha256_digest`, `sim_start_iso8601`, `sim_end_iso8601`."
Current_handled: No
Detection_gap: Yes
Recovery_gap: Yes
Idempotence_gap: Yes
Metrics_gap: Yes
Expected_format: YAML file at `config/timezone/simulation_horizon.yml`
Interfaces_affected: ExtractZoneTimelineModule/extractZoneTimeline
Test_type: CI
Test_injection: delete simulation_horizon.yml and run extractZoneTimeline()
Context: “… truncates the arrays to the configured horizon `[sim_start, sim_end]` (values read from `config/timezone/simulation_horizon.yml` …).”
Confidence=HIGH
--- END EC 8 ---

--- EC 9 | Stage=ExtractZoneTimeline | Severity=Med ---
Failure_event: Missing memory-gauge check for tz_cache size
Anchor: "CI asserts that `tz_cache_bytes` … < 8 MiB; any increase triggers a build failure."
Current_handled: Partial
Detection_gap: Yes
Recovery_gap: Yes
Idempotence_gap: Yes
Metrics_gap: No
Expected_format: integer < 8388608
Interfaces_affected: ExtractZoneTimelineModule/extractZoneTimeline
Test_type: CI
Test_injection: simulate tz_cache_bytes > 8 MiB and run extractZoneTimeline()
Context: “… CI asserts that `tz_cache_bytes` (manifest field) remains < 8 MiB; any increase triggers a build failure.”
Confidence=MEDIUM
--- END EC 9 ---

--- EC 10 | Stage=DeriveTimeZone | Severity=High ---
Failure_event: Missing audit log `tz_assignment_audit.log`
Anchor: "An audit routine serialises the constructed STR-tree …"
Current_handled: No
Detection_gap: Yes
Recovery_gap: Yes
Idempotence_gap: Yes
Metrics_gap: Yes
Expected_format: log file at `logs/tz_assignment_audit.log`
Interfaces_affected: DeriveTimeZoneModule/deriveTimeZone
Test_type: CI
Test_injection: remove audit log and run deriveTimeZone()
Context: “An audit routine serialises the constructed STR-tree … computes a SHA-256 digest … stored as `tz_index_digest`, ensuring consistent hashing …”
Confidence=HIGH
--- END EC 10 ---

--- EC 11 | Stage=ApplyTimeZoneOverrides | Severity=High ---
Failure_event: Missing CI override-validation log `ci_override_validation.log`
Anchor: "Nightly CI reloads the site catalogue … asserts … zero differences block the merge."
Current_handled: No
Detection_gap: Yes
Recovery_gap: Yes
Idempotence_gap: Yes
Metrics_gap: Yes
Expected_format: log file at `logs/ci_override_validation.log`
Interfaces_affected: ApplyTimeZoneOverridesModule/validateOverrides
Test_type: CI
Test_injection: skip CI validation step and check merge
Context: “… Nightly CI reloads the site catalogue … asserts that at least one row would change … zero differences block the merge.”
Confidence=HIGH
--- END EC 11 ---

--- EC 12 | Stage=ExtractZoneTimeline | Severity=High ---
Failure_event: Missing cache-size record `tz_cache_bytes.txt`
Anchor: "A memory gauge after construction writes the exact byte size … into the manifest."
Current_handled: No
Detection_gap: Yes
Recovery_gap: Yes
Idempotence_gap: Yes
Metrics_gap: Yes
Expected_format: text file at `output/tz_cache_bytes.txt`
Interfaces_affected: ExtractZoneTimelineModule/extractZoneTimeline
Test_type: CI
Test_injection: suppress memory-gauge write and run extractZoneTimeline()
Context: “… memory gauge after construction writes the exact byte size of the entire cache into the manifest …”
Confidence=HIGH
--- END EC 12 ---

--- EC 13 | Stage=LicenceProvenance | Severity=High ---
Failure_event: Missing licence files in `LICENSES/`
Anchor: "All shapefiles and tzdata archives carry licences in `LICENSES/` …"
Current_handled: No
Detection_gap: Yes
Recovery_gap: Yes
Idempotence_gap: Yes
Metrics_gap: Yes
Expected_format: licence files under `LICENSES/` directory
Interfaces_affected: LicenceManager/verifyLicences
Test_type: CI
Test_injection: remove a licence file and run verifyLicences()
Context: “All shapefiles and tzdata archives carry licences in `LICENSES/` (CC BY 4.0 for `tz_world`, public domain for IANA).”
Confidence=HIGH
--- END EC 13 ---

<<EC-END>>