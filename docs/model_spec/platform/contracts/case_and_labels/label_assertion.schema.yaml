$schema: https://json-schema.org/draft/2020-12/schema
$id: label_assertion.schema.yaml
title: Label Assertion
type: object
additionalProperties: false
required:
  - label_assertion_id
  - case_timeline_event_id
  - label_subject_key
  - pins
  - label_type
  - label_value
  - effective_time
  - observed_time
  - source_type
  - evidence_refs
  - payload_hash
properties:
  label_assertion_id:
    $ref: "#/$defs/hex32"
  case_timeline_event_id:
    $ref: "#/$defs/hex32"
  label_subject_key:
    $ref: "#/$defs/label_subject_key"
  pins:
    $ref: "#/$defs/pins"
  label_type:
    type: string
    enum: [fraud_disposition, chargeback_status, account_takeover]
  label_value:
    type: string
    minLength: 1
    maxLength: 128
  effective_time:
    $ref: "#/$defs/rfc3339_micros"
  observed_time:
    $ref: "#/$defs/rfc3339_micros"
  source_type:
    type: string
    enum: [HUMAN, EXTERNAL, AUTO, SYSTEM]
  actor_id:
    type: string
    minLength: 1
    maxLength: 256
  evidence_refs:
    type: array
    items:
      $ref: "#/$defs/evidence_ref"
  payload_hash:
    $ref: "#/$defs/hex64"
  label_payload:
    type: object
    additionalProperties: true
allOf:
  - if:
      properties:
        source_type:
          const: HUMAN
      required: [source_type]
    then:
      required: [actor_id]
  - if:
      properties:
        label_type:
          const: fraud_disposition
      required: [label_type]
    then:
      properties:
        label_value:
          enum: [FRAUD_CONFIRMED, FRAUD_SUSPECTED, LEGIT_CONFIRMED]
  - if:
      properties:
        label_type:
          const: chargeback_status
      required: [label_type]
    then:
      properties:
        label_value:
          enum: [CHARGEBACK, NO_CHARGEBACK, PENDING]
  - if:
      properties:
        label_type:
          const: account_takeover
      required: [label_type]
    then:
      properties:
        label_value:
          enum: [ATO_CONFIRMED, ATO_SUSPECTED, ATO_NOT_CONFIRMED]
$defs:
  hex32:
    type: string
    pattern: "^[0-9a-f]{32}$"
  hex64:
    type: string
    pattern: "^[0-9a-f]{64}$"
  platform_run_id:
    type: string
    pattern: "^platform_[0-9]{8}T[0-9]{6}Z$"
  uint64:
    type: integer
    minimum: 0
  rfc3339_micros:
    type: string
    minLength: 1
  label_subject_key:
    type: object
    additionalProperties: false
    required: [platform_run_id, event_id]
    properties:
      platform_run_id:
        $ref: "#/$defs/platform_run_id"
      event_id:
        type: string
        minLength: 1
        maxLength: 256
  pins:
    type: object
    additionalProperties: false
    required:
      - platform_run_id
      - scenario_run_id
      - manifest_fingerprint
      - parameter_hash
      - scenario_id
      - seed
    properties:
      platform_run_id:
        $ref: "#/$defs/platform_run_id"
      scenario_run_id:
        $ref: "#/$defs/hex32"
      manifest_fingerprint:
        $ref: "#/$defs/hex64"
      parameter_hash:
        $ref: "#/$defs/hex64"
      scenario_id:
        type: string
        minLength: 1
        maxLength: 256
      seed:
        $ref: "#/$defs/uint64"
      run_id:
        $ref: "#/$defs/hex32"
  evidence_ref:
    type: object
    additionalProperties: false
    required: [ref_type, ref_id]
    properties:
      ref_type:
        type: string
        enum:
          - DLA_AUDIT_RECORD
          - DECISION
          - ACTION_OUTCOME
          - EB_ORIGIN_OFFSET
          - CASE_EVENT
          - EXTERNAL_REF
      ref_id:
        type: string
        minLength: 1
        maxLength: 2048
      ref_scope:
        type: string
        maxLength: 256
