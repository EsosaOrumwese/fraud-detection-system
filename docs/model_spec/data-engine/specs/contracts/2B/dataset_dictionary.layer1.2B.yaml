# Layer-1 · Segment 2B — Dataset Dictionary
version: "v1.0.0"

lifecycle:
  phase: alpha
  last_reviewed:
  approver: "Layer 1 Governance"

ci_policy:
  allow_placeholders: true
  placeholder_markers: [TBD, null]
  block_on_phase: [beta, stable]

layer:
  id: layer1
  name: Merchant Location Realism

datasets:
  # === 2B.S0 outputs ===
  - id: s0_gate_receipt_2B
    path: data/layer1/2B/s0_gate_receipt_2B/fingerprint={manifest_fingerprint}/s0_gate_receipt_2B.json
    partitioning: [fingerprint]
    format: json
    schema_ref: schemas.2B.yaml#/validation/s0_gate_receipt_v1
    status: approved

  - id: sealed_inputs_v1
    path: data/layer1/2B/sealed_inputs_v1/fingerprint={manifest_fingerprint}/sealed_inputs_v1.json
    partitioning: [fingerprint]
    format: json
    schema_ref: schemas.2B.yaml#/validation/sealed_inputs_v1
    status: approved

  # === Upstream gate (1B) ===
  - id: validation_bundle_1B
    path: data/layer1/1B/validation/fingerprint={manifest_fingerprint}/
    format: folder
    schema_ref: schemas.1A.yaml#/validation/validation_bundle.index_schema
    status: approved

  - id: passed_flag_1B
    path: data/layer1/1B/validation/fingerprint={manifest_fingerprint}/_passed.flag
    format: text
    schema_ref: schemas.1B.yaml#/validation/passed_flag
    status: approved

  # === Cross-segment egress consumed by 2B ===
  - id: site_locations
    path: data/layer1/1B/site_locations/seed={seed}/fingerprint={manifest_fingerprint}/
    partitioning: [seed, fingerprint]
    format: parquet
    ordering: [merchant_id, legal_country_iso, site_order]
    schema_ref: schemas.1B.yaml#/egress/site_locations
    status: approved

  # === Optional pins from 2A (all-or-none; read-only) ===
  - id: site_timezones
    path: data/layer1/2A/site_timezones/seed={seed}/fingerprint={manifest_fingerprint}/
    partitioning: [seed, fingerprint]
    format: parquet
    schema_ref: schemas.2A.yaml#/egress/site_timezones
    status: optional

  - id: tz_timetable_cache
    path: data/layer1/2A/tz_timetable_cache/fingerprint={manifest_fingerprint}/
    partitioning: [fingerprint]
    format: folder
    schema_ref: schemas.2A.yaml#/cache/tz_timetable_cache
    status: optional

  # === 2B policy packs (captured/digested by S0) ===
  - id: route_rng_policy_v1
    path: contracts/policy/2B/route_rng_policy_v1.json
    format: json
    schema_ref: schemas.2B.yaml#/policy/route_rng_policy_v1
    status: approved

  - id: virtual_edge_policy_v1
    path: contracts/policy/2B/virtual_edge_policy_v1.json
    format: json
    schema_ref: schemas.2B.yaml#/policy/virtual_edge_policy_v1
    status: approved

  - id: alias_layout_policy_v1
    path: contracts/policy/2B/alias_layout_policy_v1.json
    format: json
    schema_ref: schemas.2B.yaml#/policy/alias_layout_policy_v1
    status: approved

  - id: day_effect_policy_v1
    path: contracts/policy/2B/day_effect_policy_v1.json
    format: json
    schema_ref: schemas.2B.yaml#/policy/day_effect_policy_v1
    status: approved

  # === 2B.S1 output ===
  - id: s1_site_weights
    path: data/layer1/2B/s1_site_weights/seed={seed}/fingerprint={manifest_fingerprint}/
    partitioning: [seed, fingerprint]
    ordering: [merchant_id, legal_country_iso, site_order]
    format: parquet
    schema_ref: schemas.2B.yaml#/plan/s1_site_weights
    status: approved

  # === 2B.S2 outputs ===
  - id: s2_alias_index
    path: data/layer1/2B/s2_alias_index/seed={seed}/fingerprint={manifest_fingerprint}/index.json
    partitioning: [seed, fingerprint]
    format: json
    ordering: [merchant_id]
    schema_ref: schemas.2B.yaml#/plan/s2_alias_index
    status: approved

  - id: s2_alias_blob
    path: data/layer1/2B/s2_alias_blob/seed={seed}/fingerprint={manifest_fingerprint}/alias.bin
    partitioning: [seed, fingerprint]
    format: binary
    schema_ref: schemas.2B.yaml#/binary/s2_alias_blob
    status: approved

  # === 2B.S3 output ===
  - id: s3_day_effects
    path: data/layer1/2B/s3_day_effects/seed={seed}/fingerprint={manifest_fingerprint}/
    partitioning: [seed, fingerprint]
    ordering: [merchant_id, utc_day, tz_group_id]
    format: parquet
    schema_ref: schemas.2B.yaml#/plan/s3_day_effects
    status: approved

  # === 2B.S4 output ===
  - id: s4_group_weights
    path: data/layer1/2B/s4_group_weights/seed={seed}/fingerprint={manifest_fingerprint}/
    partitioning: [seed, fingerprint]
    ordering: [merchant_id, utc_day, tz_group_id]
    format: parquet
    schema_ref: schemas.2B.yaml#/plan/s4_group_weights
    status: approved

  # === 2B.S5 (optional) selection log ===
  - id: s5_selection_log
    path: data/layer1/2B/s5_selection_log/seed={seed}/parameter_hash={parameter_hash}/run_id={run_id}/utc_day={utc_day}/selection_log.jsonl
    partitioning: [seed, parameter_hash, run_id, utc_day]
    ordering: [utc_timestamp]
    format: jsonl
    schema_ref: schemas.2B.yaml#/trace/s5_selection_log_row
    status: optional

  - id: s6_edge_log
    path: logs/edge/seed={seed}/parameter_hash={parameter_hash}/run_id={run_id}/utc_day={utc_day}/s6_edge_log.jsonl
    partitioning: [seed, parameter_hash, run_id, utc_day]
    ordering: [utc_timestamp]
    format: jsonl
    schema_ref: schemas.2B.yaml#/trace/s6_edge_log_row
    status: optional
  # === 2B.S7 — audit report (authoritative) ===
  - id: s7_audit_report
    path: data/layer1/2B/s7_audit_report/seed={seed}/fingerprint={manifest_fingerprint}/s7_audit_report.json
    partitioning: [seed, fingerprint]
    ordering: []
    format: json
    schema_ref: schemas.2B.yaml#/validation/s7_audit_report_v1
    status: approved
    status: optional
