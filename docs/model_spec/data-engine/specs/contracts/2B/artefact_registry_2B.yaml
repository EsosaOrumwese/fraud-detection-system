# Layer-1 · Segment 2B — Artefact Registry
version: "v1.0.0"

artifacts:
  # === 2B.S0 outputs ===
  - name: s0_gate_receipt_2B
    path: data/layer1/2B/s0_gate_receipt_2B/fingerprint={manifest_fingerprint}/s0_gate_receipt_2B.json
    type: dataset
    category: validation
    semver: '{semver}'
    version: '{manifest_fingerprint}'
    license: Proprietary-Internal
    role: "Gate receipt attesting upstream verification, identity, and catalogue-only resolution."
    source: internal
    owner: { owner_team: "l1-2b-core" }
    environment: [runtime]
    schema: schemas.2B.yaml#/validation/s0_gate_receipt_v1
    dependencies:
      - validation_bundle_1B
      - passed_flag_1B
      - site_locations
      - route_rng_policy_v1
      - alias_layout_policy_v1
      - day_effect_policy_v1

  - name: sealed_inputs_v1
    path: data/layer1/2B/sealed_inputs_v1/fingerprint={manifest_fingerprint}/sealed_inputs_v1.json
    type: dataset
    category: validation
    semver: '{semver}'
    version: '{manifest_fingerprint}'
    license: Proprietary-Internal
    role: "Authoritative list of all assets sealed by 2B.S0 (IDs, tags, digests, paths, partitions)."
    source: internal
    owner: { owner_team: "l1-2b-core" }
    environment: [runtime]
    schema: schemas.2B.yaml#/validation/sealed_inputs_v1
    dependencies:
      - validation_bundle_1B
      - passed_flag_1B
      - site_locations
      - route_rng_policy_v1
      - alias_layout_policy_v1
      - day_effect_policy_v1

  # === Upstream gate (1B) ===
  - name: validation_bundle_1B
    path: data/layer1/1B/validation/fingerprint={manifest_fingerprint}/
    type: bundle
    category: validation
    license: Proprietary-Internal
    role: "Fingerprint-scoped PASS bundle for 1B; 2B.S0 recomputes hash before any read (No PASS → No read)."
    notes: "Hashing law: ASCII-lex order of index.path; hash raw bytes; flag excluded."
    cross_layer: true
    source: internal
    owner: { owner_team: "mlr-1b-validation" }
    environment: [runtime]
    schema:
      index_schema_ref: schemas.1A.yaml#/validation/validation_bundle.index_schema

  - name: passed_flag_1B
    path: data/layer1/1B/validation/fingerprint={manifest_fingerprint}/_passed.flag
    type: file
    category: validation
    license: Proprietary-Internal
    role: "Companion flag carrying bundle digest (sha256_hex = <hex64>)."
    cross_layer: true
    source: internal
    owner: { owner_team: "mlr-1b-validation" }
    environment: [runtime]
    schema: schemas.1B.yaml#/validation/passed_flag

  - name: site_locations
    path: data/layer1/1B/site_locations/seed={seed}/fingerprint={manifest_fingerprint}/
    type: dataset
    category: output
    license: Proprietary-Internal
    role: "Per-site lon/lat from 1B; consumed by 2B."
    cross_layer: true
    source: internal
    owner: { owner_team: "mlr-1b-core" }
    environment: [runtime]
    schema: schemas.1B.yaml#/egress/site_locations

  # === Optional pins from 2A (read-only) ===
  - name: site_timezones
    path: data/layer1/2A/site_timezones/seed={seed}/fingerprint={manifest_fingerprint}/
    type: dataset
    category: output
    license: Proprietary-Internal
    role: "Per-site tzid (2A egress); optional coherence pin."
    cross_layer: true
    source: internal
    owner: { owner_team: "l1-2a-core" }
    environment: [runtime]
    schema: schemas.2A.yaml#/egress/site_timezones

  - name: tz_timetable_cache
    path: data/layer1/2A/tz_timetable_cache/fingerprint={manifest_fingerprint}/
    type: bundle
    category: cache
    license: Proprietary-Internal
    role: "Pinned IANA tz transitions cache (2A S3); optional coherence pin."
    cross_layer: true
    source: internal
    owner: { owner_team: "l1-2a-core" }
    environment: [runtime]
    schema: schemas.2A.yaml#/cache/tz_timetable_cache

  # === 2B policy packs captured by S0 ===
  - name: route_rng_policy_v1
    path: contracts/policy/2B/route_rng_policy_v1.json
    type: policy
    category: config
    license: Proprietary-Internal
    role: "Philox sub-stream layout & budgets for routing states."
    source: internal
    owner: { owner_team: "l1-2b-governance" }
    environment: [runtime]
    schema: schemas.2B.yaml#/policy/route_rng_policy_v1

  - name: alias_layout_policy_v1
    path: contracts/policy/2B/alias_layout_policy_v1.json
    type: policy
    category: config
    license: Proprietary-Internal
    role: "Alias table byte layout, endianness & alignment."
    source: internal
    owner: { owner_team: "l1-2b-governance" }
    environment: [runtime]
    schema: schemas.2B.yaml#/policy/alias_layout_policy_v1

  - name: day_effect_policy_v1
    path: contracts/policy/2B/day_effect_policy_v1.json
    type: policy
    category: config
    license: Proprietary-Internal
    role: "Daily modulation cadence/variance/clipping for S3."
    source: internal
    owner: { owner_team: "l1-2b-governance" }
    environment: [runtime]
    schema: schemas.2B.yaml#/policy/day_effect_policy_v1

  # === 2B.S1 output ===
  - name: s1_site_weights
    path: data/layer1/2B/s1_site_weights/seed={seed}/fingerprint={manifest_fingerprint}/
    type: dataset
    category: plan
    semver: '{semver}'
    version: '{seed}.{manifest_fingerprint}'
    license: Proprietary-Internal
    role: "Frozen per-site probability law used by alias construction and routing."
    source: internal
    owner: { owner_team: "l1-2b-core" }
    environment: [runtime]
    schema: schemas.2B.yaml#/plan/s1_site_weights
    dependencies:
      - site_locations
      - alias_layout_policy_v1
    notes: |
      Writer sort: [merchant_id, legal_country_iso, site_order]; write-once; atomic publish.

  # === 2B.S2 outputs ===
  - name: s2_alias_index
    path: data/layer1/2B/s2_alias_index/seed={seed}/fingerprint={manifest_fingerprint}/index.json
    type: dataset
    category: plan
    semver: '{semver}'
    version: '{seed}.{manifest_fingerprint}'
    license: Proprietary-Internal
    role: "Alias index: directory for alias blob slices; decode invariants and blob digest."
    source: internal
    owner: { owner_team: "l1-2b-core" }
    environment: [runtime]
    schema: schemas.2B.yaml#/plan/s2_alias_index
    dependencies:
      - s1_site_weights
      - alias_layout_policy_v1
      - s2_alias_blob

  - name: s2_alias_blob
    path: data/layer1/2B/s2_alias_blob/seed={seed}/fingerprint={manifest_fingerprint}/alias.bin
    type: dataset
    category: plan
    semver: '{semver}'
    version: '{seed}.{manifest_fingerprint}'
    license: Proprietary-Internal
    role: "Contiguous binary blob containing per-merchant alias tables."
    source: internal
    owner: { owner_team: "l1-2b-core" }
    environment: [runtime]
    schema: schemas.2B.yaml#/binary/s2_alias_blob
    dependencies:
      - s1_site_weights
      - alias_layout_policy_v1

  # === 2B.S3 output ===
  - name: s3_day_effects
    path: data/layer1/2B/s3_day_effects/seed={seed}/fingerprint={manifest_fingerprint}/
    type: dataset
    category: plan
    semver: '{semver}'
    version: '{seed}.{manifest_fingerprint}'
    license: Proprietary-Internal
    role: "Per-merchant × per-UTC-day × per-tz-group gamma multipliers for day-scale co-movement."
    source: internal
    owner: { owner_team: "l1-2b-core" }
    environment: [runtime]
    schema: schemas.2B.yaml#/plan/s3_day_effects
    dependencies:
      - s1_site_weights
      - site_timezones
      - day_effect_policy_v1
    notes: "Writer order: [merchant_id, utc_day, tz_group_id]; write-once; atomic publish."
    
  # === 2B.S4 output ===
  - name: s4_group_weights
    path: data/layer1/2B/s4_group_weights/seed={seed}/fingerprint={manifest_fingerprint}/
    type: dataset
    category: plan
    semver: '{semver}'
    version: '{seed}.{manifest_fingerprint}'
    license: Proprietary-Internal
    role: "Per-merchant × per-UTC-day × per-tz-group day mix; used to pick tz-group before static site alias."
    source: internal
    owner: { owner_team: "l1-2b-core" }
    environment: [runtime]
    schema: schemas.2B.yaml#/plan/s4_group_weights
    dependencies:
      - s1_site_weights
      - site_timezones
      - s3_day_effects
    notes: "Writer order: [merchant_id, utc_day, tz_group_id]; write-once; atomic publish."

  # === 2B.S5 (optional) selection log ===
  - name: s5_selection_log
    path: data/layer1/2B/s5_selection_log/seed={seed}/parameter_hash={parameter_hash}/run_id={run_id}/utc_day={utc_day}/selection_log.jsonl
    type: dataset
    category: diagnostic
    semver: '{semver}'
    version: '{seed}.{parameter_hash}.{run_id}'
    license: Proprietary-Internal
    role: "Optional per-arrival trace for routing selections; arrival-ordered."
    source: internal
    owner: { owner_team: "l1-2b-core" }
    environment: [runtime]
    schema: schemas.2B.yaml#/trace/s5_selection_log_row
    dependencies:
      - s4_group_weights
      - s2_alias_index
      - s2_alias_blob
      - site_timezones
    notes: "Partitions: [seed, parameter_hash, run_id, utc_day]; writer order = arrival order; write-once; atomic publish."
