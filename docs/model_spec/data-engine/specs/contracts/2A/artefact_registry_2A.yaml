version: '1.0'
programme: layer1
subsegments:
- id: 2A
  name: Civil Time
  artifacts:

  # ── S0 receipt (gate) ───────────────────────────────────────────────────
  - name: s0_gate_receipt_2A
    path: data/layer1/2A/s0_gate_receipt/fingerprint={manifest_fingerprint}/s0_gate_receipt.json
    type: dataset
    category: validation
    semver: '{semver}'
    version: '{manifest_fingerprint}'
    digest: '{sha256}'
    manifest_key: mlr.2A.validation.s0_gate_receipt
    license: Proprietary-Internal
    role: "Receipt proving 1B PASS for fingerprint; enumerates sealed inputs for 2A."
    dependencies: [validation_bundle_1B, validation_passed_flag_1B]
    source: internal
    owner: {owner_team: "mlr-2a-core"}
    last_updated: '{iso8601_timestamp}'
    environment: [runtime]
    schema: schemas.2A.yaml#/validation/s0_gate_receipt_v1
    cross_layer: false
    notes: "Partition fingerprint={manifest_fingerprint}; path↔embed equality enforced."

  # ── Cross-layer inputs (explicit for single-pane visibility) ────────────
  - name: validation_bundle_1B
    path: data/layer1/1B/validation/fingerprint={manifest_fingerprint}/
    type: bundle
    category: validation
    semver: '{semver}'
    version: '{manifest_fingerprint}'
    manifest_key: mlr.1B.validation.bundle
    license: Proprietary-Internal
    role: "Fingerprint-scoped PASS bundle for 1B; S0 recomputes hash before any read (No PASS → No read)."
    dependencies: []
    source: internal
    owner: {owner_team: "mlr-1b-validation"}
    environment: [runtime]
    schema:
      index_schema_ref: schemas.1A.yaml#/validation/validation_bundle.index_schema  # 1A index law reused
    cross_layer: true

  - name: validation_passed_flag_1B
    path: data/layer1/1B/validation/fingerprint={manifest_fingerprint}/_passed.flag
    type: manifest
    category: validation
    semver: '{semver}'
    version: '{manifest_fingerprint}'
    manifest_key: mlr.1B.validation.passed
    license: Proprietary-Internal
    role: "Single-line hash per ASCII-lex+raw-bytes recipe."
    dependencies: [validation_bundle_1B]
    source: internal
    owner: {owner_team: "mlr-1b-validation"}
    environment: [runtime]

  # ── Policy/config sealed by S0 ──────────────────────────────────────────
  - name: tz_overrides
    path: config/timezone/tz_overrides.yaml
    type: config
    category: policy
    semver: '{semver}'
    version: '{semver}'
    digest: '{sha256}'
    manifest_key: mlr.2A.policy.tz_overrides
    license: Proprietary-Internal
    role: "Governed override list; precedence site » mcc » country."
    dependencies: []
    source: internal
    owner: {owner_team: "mlr-2a-policy"}
    environment: [runtime]
    schema: schemas.2A.yaml#/policy/tz_overrides_v1

  - name: tz_nudge
    path: config/timezone/tz_nudge.yml
    type: config
    category: policy
    semver: '{semver}'
    version: '{semver}'
    digest: '{sha256}'
    manifest_key: mlr.2A.policy.tz_nudge
    license: Proprietary-Internal
    role: "Deterministic ε at borders; sealed for reproducibility."
    dependencies: []
    source: internal
    owner: {owner_team: "mlr-2a-policy"}
    environment: [runtime]
    schema: schemas.2A.yaml#/policy/tz_nudge_v1

  - name: tzdb_release
    path: artefacts/priors/tzdata/{release_tag}/
    type: dataset
    category: reference
    semver: '{semver}'
    version: '{release_tag}'
    digest: '{sha256}'
    manifest_key: mlr.2A.ingress.tzdb_release
    license: CC-BY-4.0
    role: "Pinned IANA tzdata archive + tag."
    dependencies: []
    source: external
    owner: {owner_team: "mlr-ingress"}
    environment: [runtime]
    schema: schemas.2A.yaml#/ingress/tzdb_release_v1
    cross_layer: true

  # Cross-layer pointer to ingress tz polygons used by 2A sealing
  - name: tz_world_2025a
    path: reference/spatial/tz_world/2025a/tz_world.parquet
    type: dataset
    category: reference
    semver: '{semver}'
    version: '2025a'
    manifest_key: mlr.ingress.tz_world_2025a
    license: ODbL-1.0
    role: "Time-zone world polygons; sealed by 2A.S0."
    dependencies: []
    source: external
    owner: {owner_team: "mlr-ingress"}
    environment: [runtime]
    schema: schemas.ingress.layer1.yaml#/tz_world_2025a
    cross_layer: true

  # ── 2A datasets ─────────────────────────────────────────────────────────
  - name: s1_tz_lookup
    path: data/layer1/2A/s1_tz_lookup/seed={seed}/fingerprint={manifest_fingerprint}/
    type: dataset
    category: plan
    semver: '{semver}'
    version: '{seed}.{manifest_fingerprint}'
    digest: '{sha256}'
    manifest_key: mlr.2A.s1.tz_lookup
    license: Proprietary-Internal
    role: "Deterministic tz lookup per site."
    dependencies: [site_locations, tz_world_2025a, tz_nudge]
    source: internal
    owner: {owner_team: "mlr-2a-core"}
    environment: [runtime]
    schema: schemas.2A.yaml#/plan/s1_tz_lookup

  - name: site_timezones
    path: data/layer1/2A/site_timezones/seed={seed}/fingerprint={manifest_fingerprint}/
    type: dataset
    category: output
    semver: '{semver}'
    version: '{seed}.{manifest_fingerprint}'
    digest: '{sha256}'
    manifest_key: mlr.2A.egress.site_timezones
    license: Proprietary-Internal
    role: "Per-site IANA tzid with provenance; order-free."
    dependencies: [s1_tz_lookup, tzdb_release]
    source: internal
    owner: {owner_team: "mlr-2a-core"}
    environment: [runtime]
    schema: schemas.2A.yaml#/egress/site_timezones

  - name: tz_timetable_cache
    path: data/layer1/2A/tz_timetable_cache/fingerprint={manifest_fingerprint}/
    type: dataset
    category: cache
    semver: '{semver}'
    version: '{manifest_fingerprint}'
    digest: '{sha256}'
    manifest_key: mlr.2A.cache.tz_timetable
    license: Proprietary-Internal
    role: "Fingerprint-scoped compact timetable manifest."
    dependencies: [tzdb_release]
    source: internal
    owner: {owner_team: "mlr-2a-core"}
    environment: [runtime]
    schema: schemas.2A.yaml#/cache/tz_timetable_cache

  - name: s4_legality_report
    path: data/layer1/2A/legality_report/seed={seed}/fingerprint={manifest_fingerprint}/s4_legality_report.json
    type: dataset
    category: validation
    semver: '{semver}'
    version: '{seed}.{manifest_fingerprint}'
    digest: '{sha256}'
    manifest_key: mlr.2A.validation.legality_report
    license: Proprietary-Internal
    role: "DST gaps/folds legality summary."
    dependencies: [site_timezones]
    source: internal
    owner: {owner_team: "mlr-2a-core"}
    environment: [runtime]
    schema: schemas.2A.yaml#/validation/s4_legality_report

  - name: validation_bundle_2A
    path: data/layer1/2A/validation/fingerprint={manifest_fingerprint}/
    type: bundle
    category: validation
    semver: '{semver}'
    version: '{manifest_fingerprint}'
    manifest_key: mlr.2A.validation.bundle
    license: Proprietary-Internal
    role: "Fingerprint-scoped PASS bundle for 2A; consumers of 2A egress MUST verify _passed.flag."
    dependencies: [site_timezones, tz_timetable_cache]
    source: internal
    owner: {owner_team: "mlr-2a-validation"}
    environment: [runtime]
    schema:
      index_schema_ref: schemas.2A.yaml#/validation/bundle_index_v1
    notes: "Hashing law: ASCII-lex order of index.path; hash raw bytes; flag excluded."

  - name: validation_passed_flag_2A
    path: data/layer1/2A/validation/fingerprint={manifest_fingerprint}/_passed.flag
    type: manifest
    category: validation
    semver: '{semver}'
    version: '{manifest_fingerprint}'
    manifest_key: mlr.2A.validation.passed
    license: Proprietary-Internal
    role: "Single-line hash per bundle index law."
    dependencies: [validation_bundle_2A]
    source: internal
    owner: {owner_team: "mlr-2a-validation"}
    environment: [runtime]
    schema: schemas.2A.yaml#/validation/passed_flag
