# Dataset dictionary for Layer-3 / Segment 6B

# --- S0: gate & sealed inputs ---

version: '1.0.0'

lifecycle:
  phase: planning
  last_reviewed:
  approver:

ci_policy:
  allow_placeholders: false
  placeholder_markers: [TBD]
  block_on_phase: [beta, stable]

layer:
  id: layer3
  name: Layer-3 (Segment 6B)

reference_data:
  # Upstream HashGate artefacts sealed by 6B.S0
  - id: validation_bundle_1A
    owner_layer: 1
    owner_segment: 1A
    status: required
    description: Validator outputs for 1A (metrics, plots, diffs).
    version: '{manifest_fingerprint}'
    path: data/layer1/1A/validation/manifest_fingerprint={manifest_fingerprint}/
    partitioning: [manifest_fingerprint]
    ordering: []
    schema_ref: schemas.1A.yaml#/validation/validation_bundle
    columns_strict: false
    lineage:
      produced_by: [ '1A.validation' ]
      consumed_by: [ '6B.S0' ]
    pii_class: none
    retention_class: engine_control_plane

  - id: validation_passed_flag_1A
    owner_layer: 1
    owner_segment: 1A
    status: required
    description: HashGate PASS flag for the 1A validation bundle.
    version: '{manifest_fingerprint}'
    path: data/layer1/1A/validation/manifest_fingerprint={manifest_fingerprint}/_passed.flag
    partitioning: [manifest_fingerprint]
    ordering: []
    schema_ref: schemas.layer1.yaml#/validation/passed_flag
    columns_strict: false
    lineage:
      produced_by: [ '1A.validation' ]
      consumed_by: [ '6B.S0' ]
    pii_class: none
    retention_class: engine_control_plane

  - id: validation_bundle_1B
    owner_layer: 1
    owner_segment: 1B
    status: required
    description: Validation bundle for 1B publish (one per manifest_fingerprint).
    version: '{manifest_fingerprint}'
    path: data/layer1/1B/validation/manifest_fingerprint={manifest_fingerprint}/
    partitioning: [manifest_fingerprint]
    ordering: []
    schema_ref: schemas.1B.yaml#/validation/validation_bundle_1B
    columns_strict: false
    lineage:
      produced_by: [ '1B.S9' ]
      consumed_by: [ '6B.S0' ]
    pii_class: none
    retention_class: engine_control_plane

  - id: validation_passed_flag_1B
    owner_layer: 1
    owner_segment: 1B
    status: required
    description: HashGate PASS flag for the 1B validation bundle.
    version: '{manifest_fingerprint}'
    path: data/layer1/1B/validation/manifest_fingerprint={manifest_fingerprint}/_passed.flag
    partitioning: [manifest_fingerprint]
    ordering: []
    schema_ref: schemas.1B.yaml#/validation/passed_flag
    columns_strict: false
    lineage:
      produced_by: [ '1B.S9' ]
      consumed_by: [ '6B.S0' ]
    pii_class: none
    retention_class: engine_control_plane

  - id: validation_bundle_2A
    owner_layer: 1
    owner_segment: 2A
    status: required
    description: Validation bundle for 2A publish (one per fingerprint).
    version: '{manifest_fingerprint}'
    path: data/layer1/2A/validation/manifest_fingerprint={manifest_fingerprint}/
    partitioning: [manifest_fingerprint]
    ordering: []
    schema_ref: schemas.2A.yaml#/validation/validation_bundle_2A
    columns_strict: false
    lineage:
      produced_by: [ '2A.S5' ]
      consumed_by: [ '6B.S0' ]
    pii_class: none
    retention_class: engine_control_plane

  - id: validation_passed_flag_2A
    owner_layer: 1
    owner_segment: 2A
    status: required
    description: HashGate PASS flag for the 2A validation bundle.
    version: '{manifest_fingerprint}'
    path: data/layer1/2A/validation/manifest_fingerprint={manifest_fingerprint}/_passed.flag
    partitioning: [manifest_fingerprint]
    ordering: []
    schema_ref: schemas.2A.yaml#/validation/passed_flag
    columns_strict: false
    lineage:
      produced_by: [ '2A.S5' ]
      consumed_by: [ '6B.S0' ]
    pii_class: none
    retention_class: engine_control_plane

  - id: validation_bundle_2B
    owner_layer: 1
    owner_segment: 2B
    status: required
    description: Fingerprint-scoped PASS bundle index for Segment 2B.
    version: '{manifest_fingerprint}'
    path: data/layer1/2B/validation/manifest_fingerprint={manifest_fingerprint}/index.json
    partitioning: [manifest_fingerprint]
    ordering: []
    schema_ref: schemas.layer1.yaml#/validation/validation_bundle/index_schema
    columns_strict: false
    lineage:
      produced_by: [ '2B.S8' ]
      consumed_by: [ '6B.S0' ]
    pii_class: none
    retention_class: engine_control_plane

  - id: validation_passed_flag_2B
    owner_layer: 1
    owner_segment: 2B
    status: required
    description: HashGate PASS flag for the 2B validation bundle.
    version: '{manifest_fingerprint}'
    path: data/layer1/2B/validation/manifest_fingerprint={manifest_fingerprint}/_passed.flag
    partitioning: [manifest_fingerprint]
    ordering: []
    schema_ref: schemas.1B.yaml#/validation/passed_flag
    columns_strict: false
    lineage:
      produced_by: [ '2B.S8' ]
      consumed_by: [ '6B.S0' ]
    pii_class: none
    retention_class: engine_control_plane

  - id: validation_bundle_3A
    owner_layer: 1
    owner_segment: 3A
    status: required
    description: Fingerprint-scoped validation bundle for Segment 3A.
    version: '{manifest_fingerprint}'
    path: data/layer1/3A/validation/manifest_fingerprint={manifest_fingerprint}/
    partitioning: [manifest_fingerprint]
    ordering: []
    schema_ref: schemas.layer1.yaml#/validation/validation_bundle_index_3A
    columns_strict: false
    lineage:
      produced_by: [ '3A.S7' ]
      consumed_by: [ '6B.S0' ]
    pii_class: none
    retention_class: engine_control_plane

  - id: validation_passed_flag_3A
    owner_layer: 1
    owner_segment: 3A
    status: required
    description: HashGate PASS flag for the 3A validation bundle.
    version: '{manifest_fingerprint}'
    path: data/layer1/3A/validation/manifest_fingerprint={manifest_fingerprint}/_passed.flag
    partitioning: [manifest_fingerprint]
    ordering: []
    schema_ref: schemas.layer1.yaml#/validation/passed_flag_3A
    columns_strict: false
    lineage:
      produced_by: [ '3A.S7' ]
      consumed_by: [ '6B.S0' ]
    pii_class: none
    retention_class: engine_control_plane

  - id: validation_bundle_3B
    owner_layer: 1
    owner_segment: 3B
    status: required
    description: Fingerprint-scoped validation bundle for Segment 3B.
    version: '{manifest_fingerprint}'
    path: data/layer1/3B/validation/manifest_fingerprint={manifest_fingerprint}/
    partitioning: [manifest_fingerprint]
    ordering: []
    schema_ref: schemas.layer1.yaml#/validation/validation_bundle_index_3B
    columns_strict: false
    lineage:
      produced_by: [ '3B.S5' ]
      consumed_by: [ '6B.S0' ]
    pii_class: none
    retention_class: engine_control_plane

  - id: validation_passed_flag_3B
    owner_layer: 1
    owner_segment: 3B
    status: required
    description: HashGate PASS flag for the 3B validation bundle.
    version: '{manifest_fingerprint}'
    path: data/layer1/3B/validation/manifest_fingerprint={manifest_fingerprint}/_passed.flag
    partitioning: [manifest_fingerprint]
    ordering: []
    schema_ref: schemas.layer1.yaml#/validation/passed_flag_3B
    columns_strict: false
    lineage:
      produced_by: [ '3B.S5' ]
      consumed_by: [ '6B.S0' ]
    pii_class: none
    retention_class: engine_control_plane

  - id: validation_bundle_5A
    owner_layer: 2
    owner_segment: 5A
    status: required
    description: Directory artefact containing the 5A validation bundle.
    version: '{manifest_fingerprint}'
    path: data/layer2/5A/validation/manifest_fingerprint={manifest_fingerprint}/
    partitioning: [manifest_fingerprint]
    ordering: []
    schema_ref: schemas.layer2.yaml#/validation/validation_bundle_index_5A
    columns_strict: false
    lineage:
      produced_by: [ '5A.S5' ]
      consumed_by: [ '6B.S0' ]
    pii_class: none
    retention_class: engine_control_plane

  - id: validation_passed_flag_5A
    owner_layer: 2
    owner_segment: 5A
    status: required
    description: HashGate PASS flag for the 5A validation bundle.
    version: '{manifest_fingerprint}'
    path: data/layer2/5A/validation/manifest_fingerprint={manifest_fingerprint}/_passed.flag
    partitioning: [manifest_fingerprint]
    ordering: []
    schema_ref: schemas.layer2.yaml#/validation/passed_flag_5A
    columns_strict: false
    lineage:
      produced_by: [ '5A.S5' ]
      consumed_by: [ '6B.S0' ]
    pii_class: none
    retention_class: engine_control_plane

  - id: validation_bundle_5B
    owner_layer: 2
    owner_segment: 5B
    status: required
    description: Directory artefact containing the 5B validation bundle.
    version: '{manifest_fingerprint}'
    path: data/layer2/5B/validation/manifest_fingerprint={manifest_fingerprint}/
    partitioning: [manifest_fingerprint]
    ordering: []
    schema_ref: schemas.layer2.yaml#/validation/validation_bundle_index_5B
    columns_strict: false
    lineage:
      produced_by: [ '5B.S5' ]
      consumed_by: [ '6B.S0' ]
    pii_class: none
    retention_class: engine_control_plane

  - id: validation_passed_flag_5B
    owner_layer: 2
    owner_segment: 5B
    status: required
    description: HashGate PASS flag for the 5B validation bundle.
    version: '{manifest_fingerprint}'
    path: data/layer2/5B/validation/manifest_fingerprint={manifest_fingerprint}/_passed.flag
    partitioning: [manifest_fingerprint]
    ordering: []
    schema_ref: schemas.layer2.yaml#/validation/passed_flag_5B
    columns_strict: false
    lineage:
      produced_by: [ '5B.S5' ]
      consumed_by: [ '6B.S0' ]
    pii_class: none
    retention_class: engine_control_plane

  # Upstream Layer-3 HashGate artefacts sealed by 6B.S0
  - id: validation_bundle_6A
    owner_layer: 3
    owner_segment: 6A
    status: required
    description: >
      Validation bundle directory for Layer-3 / Segment 6A, containing the
      evidence index and HashGate outputs for this manifest_fingerprint.
    version: '{manifest_fingerprint}'
    path: data/layer3/6A/validation/manifest_fingerprint={manifest_fingerprint}/
    partitioning: [manifest_fingerprint]
    ordering: []
    schema_ref: null
    columns_strict: false
    lineage:
      produced_by: [ '6A.S5' ]
      consumed_by:
        - '6B.S0'
        - '6B.S1'
    pii_class: none
    retention_class: engine_control_plane

  - id: validation_passed_flag_6A
    owner_layer: 3
    owner_segment: 6A
    status: required
    description: >
      HashGate flag for Layer-3 / Segment 6A. Contains the SHA-256
      digest over the validation bundle for this manifest_fingerprint.
    version: '{manifest_fingerprint}'
    path: data/layer3/6A/validation/manifest_fingerprint={manifest_fingerprint}/_passed.flag
    partitioning: [manifest_fingerprint]
    ordering: []
    schema_ref: schemas.layer3.yaml#/validation/6A/passed_flag_6A
    columns_strict: true
    lineage:
      produced_by: [ '6A.S5' ]
      consumed_by:
        - '6B.S0'
        - '6B.S1'
    pii_class: none
    retention_class: engine_control_plane

  # Upstream sealed inputs sealed by 6B.S0
  - id: sealed_inputs_5A
    owner_layer: 2
    owner_segment: 5A
    status: required
    description: Inventory of sealed artefacts 5A is allowed to read for a fingerprint.
    version: '{manifest_fingerprint}'
    path: data/layer2/5A/sealed_inputs/manifest_fingerprint={manifest_fingerprint}/sealed_inputs_5A.json
    partitioning: [manifest_fingerprint]
    ordering: []
    schema_ref: schemas.5A.yaml#/validation/sealed_inputs_5A
    columns_strict: false
    lineage:
      produced_by: [ '5A.S0' ]
      consumed_by: [ '6B.S0' ]
    pii_class: none
    retention_class: engine_control_plane

  - id: sealed_inputs_5B
    owner_layer: 2
    owner_segment: 5B
    status: required
    description: Inventory of artefacts 5B is allowed to read for a fingerprint.
    version: '{manifest_fingerprint}'
    path: data/layer2/5B/sealed_inputs/manifest_fingerprint={manifest_fingerprint}/sealed_inputs_5B.json
    partitioning: [manifest_fingerprint]
    ordering: [owner_segment, artifact_id, role]
    schema_ref: schemas.5B.yaml#/validation/sealed_inputs_5B
    columns_strict: false
    lineage:
      produced_by: [ '5B.S0' ]
      consumed_by: [ '6B.S0' ]
    pii_class: none
    retention_class: engine_control_plane

  - id: sealed_inputs_6A
    owner_layer: 3
    owner_segment: 6A
    status: required
    description: Sealed list of all artefacts 6A is allowed to read for a given manifest_fingerprint.
    version: '{manifest_fingerprint}'
    path: data/layer3/6A/sealed_inputs/manifest_fingerprint={manifest_fingerprint}/sealed_inputs_6A.json
    partitioning: [manifest_fingerprint]
    ordering: [owner_layer, owner_segment, manifest_key]
    schema_ref: schemas.layer3.yaml#/gate/6A/sealed_inputs_6A
    columns_strict: false
    lineage:
      produced_by: [ '6A.S0' ]
      consumed_by: [ '6B.S0' ]
    pii_class: none
    retention_class: engine_control_plane

  # Upstream data-plane surfaces sealed by 6B.S0
  - id: arrival_events_5B
    owner_layer: 2
    owner_segment: 5B
    status: required
    description: Canonical arrival skeleton stream per scenario and seed.
    version: '{seed}.{manifest_fingerprint}.{scenario_id}'
    path: data/layer2/5B/arrival_events/seed={seed}/manifest_fingerprint={manifest_fingerprint}/scenario_id={scenario_id}/part-*.parquet
    partitioning: [seed, manifest_fingerprint, scenario_id]
    ordering: [scenario_id, merchant_id, ts_utc, arrival_seq]
    schema_ref: schemas.5B.yaml#/egress/s4_arrival_events_5B
    columns_strict: false
    lineage:
      produced_by: [ '5B.S4' ]
      consumed_by: [ '6B.S0' ]
    pii_class: synthetic_customer
    retention_class: engine_control_plane

  - id: s1_party_base_6A
    owner_layer: 3
    owner_segment: 6A
    status: required
    description: >
      Base party/customer universe for Layer-3 / Segment 6A.
      One row per party per (manifest_fingerprint, seed), including type,
      home geography and static segment attributes.
    version: '{seed}.{manifest_fingerprint}.{parameter_hash}'
    path: data/layer3/6A/s1_party_base_6A/seed={seed}/parameter_hash={parameter_hash}/manifest_fingerprint={manifest_fingerprint}/s1_party_base_6A.parquet
    partitioning: [seed, manifest_fingerprint, parameter_hash]
    ordering: [country_iso, segment_id, party_type, party_id]
    schema_ref: schemas.6A.yaml#/s1/party_base
    columns_strict: true
    lineage:
      produced_by: [ '6A.S1' ]
      consumed_by:
        - '6A.S2'
        - '6A.S3'
        - '6A.S4'
        - '6A.S5'
        - '6B.S0'
        - '6B.S1'
    pii_class: synthetic_customer
    retention_class: core_entity

  - id: s2_account_base_6A
    owner_layer: 3
    owner_segment: 6A
    status: required
    description: >
      Account and product universe for Layer-3 / Segment 6A.
      One row per account per (manifest_fingerprint, seed), including owner
      references, account type, currency and static account attributes.
    version: '{seed}.{manifest_fingerprint}.{parameter_hash}'
    path: data/layer3/6A/s2_account_base_6A/seed={seed}/parameter_hash={parameter_hash}/manifest_fingerprint={manifest_fingerprint}/s2_account_base_6A.parquet
    partitioning: [seed, manifest_fingerprint, parameter_hash]
    ordering: [country_iso, account_type, owner_party_id, account_id]
    schema_ref: schemas.6A.yaml#/s2/account_base
    columns_strict: true
    lineage:
      produced_by: [ '6A.S2' ]
      consumed_by:
        - '6A.S3'
        - '6A.S4'
        - '6A.S5'
        - '6B.S0'
        - '6B.S1'
    pii_class: synthetic_customer
    retention_class: core_entity

  - id: s3_instrument_base_6A
    owner_layer: 3
    owner_segment: 6A
    status: required
    description: >
      Instrument and payment-credential universe for Layer-3 / Segment 6A.
      One row per instrument per (manifest_fingerprint, seed), including
      owner account, owner party/merchant (if modelled), instrument type,
      scheme/network, masked identifier, expiry, and static flags.
    version: '{seed}.{manifest_fingerprint}.{parameter_hash}'
    path: data/layer3/6A/s3_instrument_base_6A/seed={seed}/parameter_hash={parameter_hash}/manifest_fingerprint={manifest_fingerprint}/s3_instrument_base_6A.parquet
    partitioning: [seed, manifest_fingerprint, parameter_hash]
    ordering: [account_id, instrument_type, scheme, instrument_id]
    schema_ref: schemas.6A.yaml#/s3/instrument_base
    columns_strict: true
    lineage:
      produced_by: [ '6A.S3' ]
      consumed_by:
        - '6A.S4'
        - '6A.S5'
        - '6B.S0'
        - '6B.S1'
    pii_class: synthetic_customer
    retention_class: core_entity

  - id: s3_account_instrument_links_6A
    owner_layer: 3
    owner_segment: 6A
    status: required
    description: >
      Per-account instrument linkage surface for Layer-3 / Segment 6A.
      Derived from s3_instrument_base_6A and s2_account_base_6A; provides
      either per-instrument or aggregated per-account, per-instrument-type
      views of instrument ownership.
    version: '{seed}.{manifest_fingerprint}.{parameter_hash}'
    path: data/layer3/6A/s3_account_instrument_links_6A/seed={seed}/parameter_hash={parameter_hash}/manifest_fingerprint={manifest_fingerprint}/s3_account_instrument_links_6A.parquet
    partitioning: [seed, manifest_fingerprint, parameter_hash]
    ordering: [account_id, instrument_type, scheme, instrument_id]
    schema_ref: schemas.6A.yaml#/s3/account_instrument_links
    columns_strict: true
    lineage:
      produced_by: [ '6A.S3' ]
      consumed_by:
        - '6A.S4'
        - '6A.S5'
        - '6B.S0'
    pii_class: synthetic_customer
    retention_class: core_entity

  - id: s4_device_base_6A
    owner_layer: 3
    owner_segment: 6A
    status: required
    description: >
      Device universe for Layer-3 / Segment 6A. One row per device per
      (manifest_fingerprint, seed), with device classification, primary
      owner context and static device risk/capability flags.
    version: '{seed}.{manifest_fingerprint}.{parameter_hash}'
    path: data/layer3/6A/s4_device_base_6A/seed={seed}/parameter_hash={parameter_hash}/manifest_fingerprint={manifest_fingerprint}/s4_device_base_6A.parquet
    partitioning: [seed, manifest_fingerprint, parameter_hash]
    ordering: [device_type, primary_party_id, primary_merchant_id, device_id]
    schema_ref: schemas.6A.yaml#/s4/device_base
    columns_strict: true
    lineage:
      produced_by: [ '6A.S4' ]
      consumed_by:
        - '6A.S5'
        - '6B.S0'
        - '6B.S1'
    pii_class: synthetic_customer
    retention_class: core_entity

  - id: s4_ip_base_6A
    owner_layer: 3
    owner_segment: 6A
    status: required
    description: >
      IP / network endpoint universe for Layer-3 / Segment 6A. One row
      per IP/endpoint per (manifest_fingerprint, seed), including masked
      representation, ip_type, asn_class, geo hints and static risk tags.
    version: '{seed}.{manifest_fingerprint}.{parameter_hash}'
    path: data/layer3/6A/s4_ip_base_6A/seed={seed}/parameter_hash={parameter_hash}/manifest_fingerprint={manifest_fingerprint}/s4_ip_base_6A.parquet
    partitioning: [seed, manifest_fingerprint, parameter_hash]
    ordering: [ip_type, asn_class, country_iso, ip_id]
    schema_ref: schemas.6A.yaml#/s4/ip_base
    columns_strict: true
    lineage:
      produced_by: [ '6A.S4' ]
      consumed_by:
        - '6A.S5'
        - '6B.S0'
        - '6B.S1'
    pii_class: synthetic_customer
    retention_class: core_entity

  - id: s4_device_links_6A
    owner_layer: 3
    owner_segment: 6A
    status: required
    description: >
      Device-to-entity edges for Layer-3 / Segment 6A. Links each
      device_id to one or more parties/accounts/instruments/merchants
      with a link_role describing the semantics.
    version: '{seed}.{manifest_fingerprint}.{parameter_hash}'
    path: data/layer3/6A/s4_device_links_6A/seed={seed}/parameter_hash={parameter_hash}/manifest_fingerprint={manifest_fingerprint}/s4_device_links_6A.parquet
    partitioning: [seed, manifest_fingerprint, parameter_hash]
    ordering: [device_id, party_id, account_id, instrument_id, merchant_id, link_role]
    schema_ref: schemas.6A.yaml#/s4/device_links
    columns_strict: true
    lineage:
      produced_by: [ '6A.S4' ]
      consumed_by:
        - '6A.S5'
        - '6B.S0'
        - '6B.S1'
    pii_class: synthetic_customer
    retention_class: core_entity

  - id: s5_party_fraud_roles_6A
    owner_layer: 3
    owner_segment: 6A
    status: required
    description: >
      Static fraud posture for parties in Layer-3 / Segment 6A.
      One row per party per (manifest_fingerprint, seed).
    version: '{seed}.{manifest_fingerprint}.{parameter_hash}'
    path: data/layer3/6A/s5_party_fraud_roles_6A/seed={seed}/parameter_hash={parameter_hash}/manifest_fingerprint={manifest_fingerprint}/s5_party_fraud_roles_6A.parquet
    partitioning: [seed, manifest_fingerprint, parameter_hash]
    ordering: [party_id]
    schema_ref: schemas.6A.yaml#/s5/party_fraud_roles
    columns_strict: true
    lineage:
      produced_by: [ '6A.S5' ]
      consumed_by:
        - '6B.S0'
        - '6B.S1'
        - '6B.S2'
    pii_class: synthetic_customer
    retention_class: core_entity

  - id: s5_account_fraud_roles_6A
    owner_layer: 3
    owner_segment: 6A
    status: required
    description: >
      Static fraud posture for accounts in Layer-3 / Segment 6A.
      One row per account per (manifest_fingerprint, seed).
    version: '{seed}.{manifest_fingerprint}.{parameter_hash}'
    path: data/layer3/6A/s5_account_fraud_roles_6A/seed={seed}/parameter_hash={parameter_hash}/manifest_fingerprint={manifest_fingerprint}/s5_account_fraud_roles_6A.parquet
    partitioning: [seed, manifest_fingerprint, parameter_hash]
    ordering: [account_id]
    schema_ref: schemas.6A.yaml#/s5/account_fraud_roles
    columns_strict: true
    lineage:
      produced_by: [ '6A.S5' ]
      consumed_by:
        - '6B.S0'
        - '6B.S1'
        - '6B.S2'
    pii_class: synthetic_customer
    retention_class: core_entity

  - id: s5_merchant_fraud_roles_6A
    owner_layer: 3
    owner_segment: 6A
    status: required
    description: >
      Static fraud posture for merchants in Layer-3 / Segment 6A.
      One row per merchant, keyed by merchant_id.
    version: '{seed}.{manifest_fingerprint}.{parameter_hash}'
    path: data/layer3/6A/s5_merchant_fraud_roles_6A/seed={seed}/parameter_hash={parameter_hash}/manifest_fingerprint={manifest_fingerprint}/s5_merchant_fraud_roles_6A.parquet
    partitioning: [seed, manifest_fingerprint, parameter_hash]
    ordering: [merchant_id]
    schema_ref: schemas.6A.yaml#/s5/merchant_fraud_roles
    columns_strict: true
    lineage:
      produced_by: [ '6A.S5' ]
      consumed_by:
        - '6B.S0'
        - '6B.S1'
        - '6B.S2'
    pii_class: synthetic_customer
    retention_class: core_entity

  - id: s5_device_fraud_roles_6A
    owner_layer: 3
    owner_segment: 6A
    status: required
    description: >
      Static fraud posture for devices in Layer-3 / Segment 6A.
      One row per device per (manifest_fingerprint, seed).
    version: '{seed}.{manifest_fingerprint}.{parameter_hash}'
    path: data/layer3/6A/s5_device_fraud_roles_6A/seed={seed}/parameter_hash={parameter_hash}/manifest_fingerprint={manifest_fingerprint}/s5_device_fraud_roles_6A.parquet
    partitioning: [seed, manifest_fingerprint, parameter_hash]
    ordering: [device_id]
    schema_ref: schemas.6A.yaml#/s5/device_fraud_roles
    columns_strict: true
    lineage:
      produced_by: [ '6A.S5' ]
      consumed_by:
        - '6B.S0'
        - '6B.S1'
    pii_class: synthetic_customer
    retention_class: core_entity

  - id: s5_ip_fraud_roles_6A
    owner_layer: 3
    owner_segment: 6A
    status: required
    description: >
      Static fraud posture for IPs/endpoints in Layer-3 / Segment 6A.
      One row per ip_id per (manifest_fingerprint, seed).
    version: '{seed}.{manifest_fingerprint}.{parameter_hash}'
    path: data/layer3/6A/s5_ip_fraud_roles_6A/seed={seed}/parameter_hash={parameter_hash}/manifest_fingerprint={manifest_fingerprint}/s5_ip_fraud_roles_6A.parquet
    partitioning: [seed, manifest_fingerprint, parameter_hash]
    ordering: [ip_id]
    schema_ref: schemas.6A.yaml#/s5/ip_fraud_roles
    columns_strict: true
    lineage:
      produced_by: [ '6A.S5' ]
      consumed_by:
        - '6B.S0'
        - '6B.S1'
    pii_class: synthetic_customer
    retention_class: core_entity

  # --- S5 validation & HashGate (fingerprint-scoped) ---

datasets:
  - id: s0_gate_receipt_6B
    owner_layer: 3
    owner_segment: 6B
    status: required
    description: >
      Behavioural gate receipt for 6B; one JSON object per manifest_fingerprint
      summarising upstream gates, contracts_6B and sealed_inputs_digest_6B.
    version: '{manifest_fingerprint}'
    format: json
    path: data/layer3/6B/s0_gate_receipt/manifest_fingerprint={manifest_fingerprint}/s0_gate_receipt_6B.json
    partitioning: [manifest_fingerprint]
    primary_key: [manifest_fingerprint]
    ordering: []
    schema_ref: schemas.layer3.yaml#/gate/6B/s0_gate_receipt_6B
    lineage:
      produced_by: [ '6B.S0' ]
      consumed_by: [ '6B.S1', '6B.S2', '6B.S3', '6B.S4', '6B.S5', '4A', '4B' ]

  - id: sealed_inputs_6B
    owner_layer: 3
    owner_segment: 6B
    status: required
    description: >
      Sealed list of all artefacts 6B is allowed to read for a given
      manifest_fingerprint, with roles, schema_refs and digests.
    version: '{manifest_fingerprint}'
    format: parquet
    path: data/layer3/6B/sealed_inputs/manifest_fingerprint={manifest_fingerprint}/sealed_inputs_6B.json
    partitioning: [manifest_fingerprint]
    primary_key: [manifest_fingerprint, owner_layer, owner_segment, manifest_key]
    ordering: [owner_layer, owner_segment, manifest_key]
    schema_ref: schemas.layer3.yaml#/gate/6B/sealed_inputs_6B
    lineage:
      produced_by: [ '6B.S0' ]
      consumed_by: [ '6B.S1', '6B.S2', '6B.S3', '6B.S4', '6B.S5' ]

  # --- S0 sealed inputs (policy/config) ---

  - id: attachment_policy_6B
    owner_layer: 3
    owner_segment: 6B
    status: required
    description: Attachment policy for entity selection and linking (S1).
    version: 'v1'
    format: yaml
    path: config/layer3/6B/attachment_policy_6B.yaml
    partitioning: []
    ordering: []
    schema_ref: schemas.6B.yaml#/policy/attachment_policy_6B
    lineage:
      produced_by: []
      consumed_by: [ '6B.S0', '6B.S1' ]

  - id: sessionisation_policy_6B
    owner_layer: 3
    owner_segment: 6B
    status: required
    description: Session key and inactivity gap policy (S1).
    version: 'v1'
    format: yaml
    path: config/layer3/6B/sessionisation_policy_6B.yaml
    partitioning: []
    ordering: []
    schema_ref: schemas.6B.yaml#/policy/sessionisation_policy_6B
    lineage:
      produced_by: []
      consumed_by: [ '6B.S0', '6B.S1' ]

  - id: behaviour_config_6B
    owner_layer: 3
    owner_segment: 6B
    status: optional
    description: Optional feature flags and guardrails for 6B behaviour.
    version: 'v1'
    format: yaml
    path: config/layer3/6B/behaviour_config_6B.yaml
    partitioning: []
    ordering: []
    schema_ref: schemas.6B.yaml#/policy/behaviour_config_6B
    lineage:
      produced_by: []
      consumed_by: [ '6B.S0', '6B.S1', '6B.S2', '6B.S3', '6B.S4', '6B.S5' ]

  - id: behaviour_prior_pack_6B
    owner_layer: 3
    owner_segment: 6B
    status: required
    description: Behaviour priors pack for 6B (distributions/parameters used by S1-S4; sealed by S0).
    version: 'v1'
    format: yaml
    path: config/layer3/6B/behaviour_prior_pack_6B.yaml
    partitioning: []
    ordering: []
    schema_ref: schemas.6B.yaml#/policy/behaviour_prior_pack_6B
    lineage:
      produced_by: []
      consumed_by: [ '6B.S0', '6B.S1', '6B.S2', '6B.S3', '6B.S4' ]

  - id: rng_profile_layer3
    owner_layer: 3
    owner_segment: 6B
    status: required
    description: Layer-3 RNG profile (Philox parameters and invariants).
    version: 'v1'
    format: yaml
    path: config/layer3/6B/rng_profile_layer3.yaml
    partitioning: []
    ordering: []
    schema_ref: schemas.6B.yaml#/policy/rng_profile_layer3
    lineage:
      produced_by: []
      consumed_by: [ '6B.S0', '6B.S1', '6B.S2', '6B.S3', '6B.S4' ]

  - id: rng_policy_6B
    owner_layer: 3
    owner_segment: 6B
    status: required
    description: RNG family mapping for S1 decision families.
    version: 'v1'
    format: yaml
    path: config/layer3/6B/rng_policy_6B.yaml
    partitioning: []
    ordering: []
    schema_ref: schemas.6B.yaml#/policy/rng_policy_6B
    lineage:
      produced_by: []
      consumed_by: [ '6B.S0', '6B.S1' ]

  - id: flow_shape_policy_6B
    owner_layer: 3
    owner_segment: 6B
    status: required
    description: Flow shape policy for S2.
    version: 'v1'
    format: yaml
    path: config/layer3/6B/flow_shape_policy_6B.yaml
    partitioning: []
    ordering: []
    schema_ref: schemas.6B.yaml#/policy/flow_shape_policy_6B
    lineage:
      produced_by: []
      consumed_by: [ '6B.S0', '6B.S2' ]

  - id: amount_model_6B
    owner_layer: 3
    owner_segment: 6B
    status: required
    description: Amount model policy for S2.
    version: 'v1'
    format: yaml
    path: config/layer3/6B/amount_model_6B.yaml
    partitioning: []
    ordering: []
    schema_ref: schemas.6B.yaml#/policy/amount_model_6B
    lineage:
      produced_by: []
      consumed_by: [ '6B.S0', '6B.S2' ]

  - id: timing_policy_6B
    owner_layer: 3
    owner_segment: 6B
    status: required
    description: Timing policy for S2.
    version: 'v1'
    format: yaml
    path: config/layer3/6B/timing_policy_6B.yaml
    partitioning: []
    ordering: []
    schema_ref: schemas.6B.yaml#/policy/timing_policy_6B
    lineage:
      produced_by: []
      consumed_by: [ '6B.S0', '6B.S2' ]

  - id: flow_rng_policy_6B
    owner_layer: 3
    owner_segment: 6B
    status: required
    description: RNG policy for S2 flows.
    version: 'v1'
    format: yaml
    path: config/layer3/6B/flow_rng_policy_6B.yaml
    partitioning: []
    ordering: []
    schema_ref: schemas.6B.yaml#/policy/flow_rng_policy_6B
    lineage:
      produced_by: []
      consumed_by: [ '6B.S0', '6B.S2' ]

  - id: fraud_campaign_catalogue_config_6B
    owner_layer: 3
    owner_segment: 6B
    status: required
    description: Fraud campaign catalogue configuration for S3.
    version: 'v1'
    format: yaml
    path: config/layer3/6B/fraud_campaign_catalogue_config_6B.yaml
    partitioning: []
    ordering: []
    schema_ref: schemas.6B.yaml#/policy/fraud_campaign_catalogue_config_6B
    lineage:
      produced_by: []
      consumed_by: [ '6B.S0', '6B.S3' ]

  - id: fraud_overlay_policy_6B
    owner_layer: 3
    owner_segment: 6B
    status: required
    description: Fraud overlay policy for S3.
    version: 'v1'
    format: yaml
    path: config/layer3/6B/fraud_overlay_policy_6B.yaml
    partitioning: []
    ordering: []
    schema_ref: schemas.6B.yaml#/policy/fraud_overlay_policy_6B
    lineage:
      produced_by: []
      consumed_by: [ '6B.S0', '6B.S3' ]

  - id: fraud_rng_policy_6B
    owner_layer: 3
    owner_segment: 6B
    status: required
    description: RNG policy for S3 fraud overlays.
    version: 'v1'
    format: yaml
    path: config/layer3/6B/fraud_rng_policy_6B.yaml
    partitioning: []
    ordering: []
    schema_ref: schemas.6B.yaml#/policy/fraud_rng_policy_6B
    lineage:
      produced_by: []
      consumed_by: [ '6B.S0', '6B.S3' ]

  - id: truth_labelling_policy_6B
    owner_layer: 3
    owner_segment: 6B
    status: required
    description: Truth labelling policy for S4.
    version: 'v1'
    format: yaml
    path: config/layer3/6B/truth_labelling_policy_6B.yaml
    partitioning: []
    ordering: []
    schema_ref: schemas.6B.yaml#/policy/truth_labelling_policy_6B
    lineage:
      produced_by: []
      consumed_by: [ '6B.S0', '6B.S4' ]

  - id: bank_view_policy_6B
    owner_layer: 3
    owner_segment: 6B
    status: required
    description: Bank-view policy for S4.
    version: 'v1'
    format: yaml
    path: config/layer3/6B/bank_view_policy_6B.yaml
    partitioning: []
    ordering: []
    schema_ref: schemas.6B.yaml#/policy/bank_view_policy_6B
    lineage:
      produced_by: []
      consumed_by: [ '6B.S0', '6B.S4' ]

  - id: delay_models_6B
    owner_layer: 3
    owner_segment: 6B
    status: required
    description: Delay models for S4.
    version: 'v1'
    format: yaml
    path: config/layer3/6B/delay_models_6B.yaml
    partitioning: []
    ordering: []
    schema_ref: schemas.6B.yaml#/policy/delay_models_6B
    lineage:
      produced_by: []
      consumed_by: [ '6B.S0', '6B.S4' ]

  - id: case_policy_6B
    owner_layer: 3
    owner_segment: 6B
    status: required
    description: Case policy for S4.
    version: 'v1'
    format: yaml
    path: config/layer3/6B/case_policy_6B.yaml
    partitioning: []
    ordering: []
    schema_ref: schemas.6B.yaml#/policy/case_policy_6B
    lineage:
      produced_by: []
      consumed_by: [ '6B.S0', '6B.S4' ]

  - id: label_rng_policy_6B
    owner_layer: 3
    owner_segment: 6B
    status: required
    description: RNG policy for S4 labelling.
    version: 'v1'
    format: yaml
    path: config/layer3/6B/label_rng_policy_6B.yaml
    partitioning: []
    ordering: []
    schema_ref: schemas.6B.yaml#/policy/label_rng_policy_6B
    lineage:
      produced_by: []
      consumed_by: [ '6B.S0', '6B.S4' ]

  - id: segment_validation_policy_6B
    owner_layer: 3
    owner_segment: 6B
    status: required
    description: Segment validation policy for S5.
    version: 'v1'
    format: yaml
    path: config/layer3/6B/segment_validation_policy_6B.yaml
    partitioning: []
    ordering: []
    schema_ref: schemas.6B.yaml#/policy/segment_validation_policy_6B
    lineage:
      produced_by: []
      consumed_by: [ '6B.S0', '6B.S5' ]


  # --- RNG logs & event tables ---

  - id: rng_audit_log
    owner_layer: 3
    owner_segment: 6B
    status: required
    description: Run-scoped RNG audit envelope for 6B runs.
    version: '{run_id}'
    format: jsonl
    path: logs/layer3/6B/rng/audit/seed={seed}/parameter_hash={parameter_hash}/run_id={run_id}/rng_audit_log.jsonl
    partitioning: [seed, parameter_hash, run_id]
    ordering: []
    schema_ref: schemas.layer3.yaml#/rng/core/rng_audit_log
    lineage:
      produced_by: [ '6B.S1', '6B.S2', '6B.S3', '6B.S4' ]
      consumed_by: [ '6B.S5' ]

  - id: rng_trace_log
    owner_layer: 3
    owner_segment: 6B
    status: required
    description: Aggregated RNG trace log for 6B runs (per event family draws/blocks).
    version: '{run_id}'
    format: jsonl
    path: logs/layer3/6B/rng/trace/seed={seed}/parameter_hash={parameter_hash}/run_id={run_id}/rng_trace_log.jsonl
    partitioning: [seed, parameter_hash, run_id]
    ordering: []
    schema_ref: schemas.layer3.yaml#/rng/core/rng_trace_log
    lineage:
      produced_by: [ '6B.S1', '6B.S2', '6B.S3', '6B.S4' ]
      consumed_by: [ '6B.S5' ]

  - id: rng_event_flow_anchor_baseline
    owner_layer: 3
    owner_segment: 6B
    status: required
    description: RNG events for 6B.S2 baseline flow anchor draws.
    version: '{run_id}'
    format: jsonl
    path: logs/layer3/6B/rng/events/flow_anchor_baseline/seed={seed}/parameter_hash={parameter_hash}/run_id={run_id}/part-*.jsonl
    partitioning: [seed, parameter_hash, run_id]
    ordering: []
    schema_ref: schemas.layer3.yaml#/rng/events/flow_anchor_baseline
    lineage:
      produced_by: [ '6B.S2' ]
      consumed_by: [ '6B.S5' ]

  - id: rng_event_event_stream_baseline
    owner_layer: 3
    owner_segment: 6B
    status: required
    description: RNG events for 6B.S2 baseline event stream draws.
    version: '{run_id}'
    format: jsonl
    path: logs/layer3/6B/rng/events/event_stream_baseline/seed={seed}/parameter_hash={parameter_hash}/run_id={run_id}/part-*.jsonl
    partitioning: [seed, parameter_hash, run_id]
    ordering: []
    schema_ref: schemas.layer3.yaml#/rng/events/event_stream_baseline
    lineage:
      produced_by: [ '6B.S2' ]
      consumed_by: [ '6B.S5' ]

  - id: rng_event_fraud_campaign_pick
    owner_layer: 3
    owner_segment: 6B
    status: required
    description: RNG events for 6B.S3 fraud campaign selection.
    version: '{run_id}'
    format: jsonl
    path: logs/layer3/6B/rng/events/fraud_campaign_pick/seed={seed}/parameter_hash={parameter_hash}/run_id={run_id}/part-*.jsonl
    partitioning: [seed, parameter_hash, run_id]
    ordering: []
    schema_ref: schemas.layer3.yaml#/rng/events/fraud_campaign_pick
    lineage:
      produced_by: [ '6B.S3' ]
      consumed_by: [ '6B.S5' ]

  - id: rng_event_fraud_overlay_apply
    owner_layer: 3
    owner_segment: 6B
    status: required
    description: RNG events for 6B.S3 fraud overlay application.
    version: '{run_id}'
    format: jsonl
    path: logs/layer3/6B/rng/events/fraud_overlay_apply/seed={seed}/parameter_hash={parameter_hash}/run_id={run_id}/part-*.jsonl
    partitioning: [seed, parameter_hash, run_id]
    ordering: []
    schema_ref: schemas.layer3.yaml#/rng/events/fraud_overlay_apply
    lineage:
      produced_by: [ '6B.S3' ]
      consumed_by: [ '6B.S5' ]

  - id: rng_event_truth_label
    owner_layer: 3
    owner_segment: 6B
    status: required
    description: RNG events for 6B.S4 truth-label sampling.
    version: '{run_id}'
    format: jsonl
    path: logs/layer3/6B/rng/events/truth_label/seed={seed}/parameter_hash={parameter_hash}/run_id={run_id}/part-*.jsonl
    partitioning: [seed, parameter_hash, run_id]
    ordering: []
    schema_ref: schemas.layer3.yaml#/rng/events/truth_label
    lineage:
      produced_by: [ '6B.S4' ]
      consumed_by: [ '6B.S5' ]

  - id: rng_event_bank_view_label
    owner_layer: 3
    owner_segment: 6B
    status: required
    description: RNG events for 6B.S4 bank-view label sampling.
    version: '{run_id}'
    format: jsonl
    path: logs/layer3/6B/rng/events/bank_view_label/seed={seed}/parameter_hash={parameter_hash}/run_id={run_id}/part-*.jsonl
    partitioning: [seed, parameter_hash, run_id]
    ordering: []
    schema_ref: schemas.layer3.yaml#/rng/events/bank_view_label
    lineage:
      produced_by: [ '6B.S4' ]
      consumed_by: [ '6B.S5' ]
  # --- S1: arrivals â†’ entities & sessions ---

  - id: s1_arrival_entities_6B
    owner_layer: 3
    owner_segment: 6B
    status: required
    description: >
      Arrival events from 5B enriched with entity attachments and session
      identifiers for Layer-3 behaviour; one row per arrival.
    version: '{seed}.{manifest_fingerprint}.{parameter_hash}.{scenario_id}'
    format: parquet
    path: data/layer3/6B/s1_arrival_entities_6B/seed={seed}/parameter_hash={parameter_hash}/manifest_fingerprint={manifest_fingerprint}/scenario_id={scenario_id}/part-*.parquet
    partitioning: [seed, manifest_fingerprint, parameter_hash, scenario_id]
    primary_key:
      - seed
      - manifest_fingerprint
      - scenario_id
      - merchant_id
      - arrival_seq
    ordering: [seed, manifest_fingerprint, scenario_id, merchant_id, arrival_seq]
    schema_ref: schemas.6B.yaml#/s1/arrival_entities_6B
    lineage:
      produced_by: [ '6B.S1' ]
      consumed_by: [ '6B.S2', '6B.S3', '6B.S4', '6B.S5' ]

  - id: s1_session_index_6B
    owner_layer: 3
    owner_segment: 6B
    status: required
    description: >
      Session index for 6B arrivals; one row per session with party/device/IP
      relationships and anchor metadata.
    version: '{seed}.{manifest_fingerprint}.{parameter_hash}.{scenario_id}'
    format: parquet
    path: data/layer3/6B/s1_session_index_6B/seed={seed}/parameter_hash={parameter_hash}/manifest_fingerprint={manifest_fingerprint}/scenario_id={scenario_id}/part-*.parquet
    partitioning: [seed, manifest_fingerprint, parameter_hash, scenario_id]
    primary_key:
      - seed
      - manifest_fingerprint
      - scenario_id
      - session_id
    ordering: [seed, manifest_fingerprint, scenario_id, session_id]
    schema_ref: schemas.6B.yaml#/s1/session_index_6B
    lineage:
      produced_by: [ '6B.S1' ]
      consumed_by: [ '6B.S2', '6B.S3', '6B.S4', '6B.S5' ]

  # --- S2: baseline flows & events ---

  - id: s2_flow_anchor_baseline_6B
    owner_layer: 3
    owner_segment: 6B
    status: required
    description: >
      Baseline flow anchors (all-legit) for 6B. One row per flow_id per
      (seed, manifest_fingerprint, scenario_id).
    version: '{seed}.{manifest_fingerprint}.{parameter_hash}.{scenario_id}'
    format: parquet
    path: data/layer3/6B/s2_flow_anchor_baseline_6B/seed={seed}/parameter_hash={parameter_hash}/manifest_fingerprint={manifest_fingerprint}/scenario_id={scenario_id}/part-*.parquet
    partitioning: [seed, manifest_fingerprint, parameter_hash, scenario_id]
    primary_key:
      - seed
      - manifest_fingerprint
      - scenario_id
      - flow_id
    ordering: [seed, manifest_fingerprint, scenario_id, flow_id]
    schema_ref: schemas.6B.yaml#/s2/flow_anchor_baseline_6B
    lineage:
      produced_by: [ '6B.S2' ]
      consumed_by: [ '6B.S3', '6B.S4', '6B.S5' ]

  - id: s2_event_stream_baseline_6B
    owner_layer: 3
    owner_segment: 6B
    status: required
    description: >
      Baseline event stream for each flow (auth/clearing/refund/etc.).
    version: '{seed}.{manifest_fingerprint}.{parameter_hash}.{scenario_id}'
    format: parquet
    path: data/layer3/6B/s2_event_stream_baseline_6B/seed={seed}/parameter_hash={parameter_hash}/manifest_fingerprint={manifest_fingerprint}/scenario_id={scenario_id}/part-*.parquet
    partitioning: [seed, manifest_fingerprint, parameter_hash, scenario_id]
    primary_key:
      - seed
      - manifest_fingerprint
      - scenario_id
      - flow_id
      - event_seq
    ordering: [seed, manifest_fingerprint, scenario_id, flow_id, event_seq]
    schema_ref: schemas.6B.yaml#/s2/event_stream_baseline_6B
    lineage:
      produced_by: [ '6B.S2' ]
      consumed_by: [ '6B.S3', '6B.S4', '6B.S5' ]

  # --- S3: fraud overlays ---

  - id: s3_campaign_catalogue_6B
    owner_layer: 3
    owner_segment: 6B
    status: required
    description: >
      Catalogue of realised fraud/abuse campaigns with campaign_id, fraud_type,
      parameters and the flows affected.
    version: '{seed}.{manifest_fingerprint}.{parameter_hash}.{scenario_id}'
    format: parquet
    path: data/layer3/6B/s3_campaign_catalogue_6B/seed={seed}/parameter_hash={parameter_hash}/manifest_fingerprint={manifest_fingerprint}/scenario_id={scenario_id}/s3_campaign_catalogue_6B.parquet
    partitioning: [seed, manifest_fingerprint, parameter_hash, scenario_id]
    primary_key:
      - seed
      - manifest_fingerprint
      - scenario_id
      - campaign_id
    ordering: [campaign_id]
    schema_ref: schemas.6B.yaml#/s3/campaign_catalogue_6B
    lineage:
      produced_by: [ '6B.S3' ]
      consumed_by: [ '6B.S4', '6B.S5' ]

  - id: s3_flow_anchor_with_fraud_6B
    owner_layer: 3
    owner_segment: 6B
    status: required
    description: >
      Flow anchors after fraud overlays and campaign adjustments are applied.
    version: '{seed}.{manifest_fingerprint}.{parameter_hash}.{scenario_id}'
    format: parquet
    path: data/layer3/6B/s3_flow_anchor_with_fraud_6B/seed={seed}/parameter_hash={parameter_hash}/manifest_fingerprint={manifest_fingerprint}/scenario_id={scenario_id}/part-*.parquet
    partitioning: [seed, manifest_fingerprint, parameter_hash, scenario_id]
    primary_key:
      - seed
      - manifest_fingerprint
      - scenario_id
      - flow_id
    ordering: [seed, manifest_fingerprint, scenario_id, flow_id]
    schema_ref: schemas.6B.yaml#/s3/flow_anchor_with_fraud_6B
    lineage:
      produced_by: [ '6B.S3' ]
      consumed_by: [ '6B.S4', '6B.S5' ]

  - id: s3_event_stream_with_fraud_6B
    owner_layer: 3
    owner_segment: 6B
    status: required
    description: >
      Event stream after fraud overlays. Contains synthetic fraud behaviours
      for training/labelling flows.
    version: '{seed}.{manifest_fingerprint}.{parameter_hash}.{scenario_id}'
    format: parquet
    path: data/layer3/6B/s3_event_stream_with_fraud_6B/seed={seed}/parameter_hash={parameter_hash}/manifest_fingerprint={manifest_fingerprint}/scenario_id={scenario_id}/part-*.parquet
    partitioning: [seed, manifest_fingerprint, parameter_hash, scenario_id]
    primary_key:
      - seed
      - manifest_fingerprint
      - scenario_id
      - flow_id
      - event_seq
    ordering: [seed, manifest_fingerprint, scenario_id, flow_id, event_seq]
    schema_ref: schemas.6B.yaml#/s3/event_stream_with_fraud_6B
    lineage:
      produced_by: [ '6B.S3' ]
      consumed_by: [ '6B.S4', '6B.S5' ]

  # --- S4: truth labels, bank view, case timeline ---

  - id: s4_flow_truth_labels_6B
    owner_layer: 3
    owner_segment: 6B
    status: required
    description: >
      Flow-level ground truth labels used by 4A/4B and model training.
    version: '{seed}.{manifest_fingerprint}.{parameter_hash}.{scenario_id}'
    format: parquet
    path: data/layer3/6B/s4_flow_truth_labels_6B/seed={seed}/parameter_hash={parameter_hash}/manifest_fingerprint={manifest_fingerprint}/scenario_id={scenario_id}/part-*.parquet
    partitioning: [seed, manifest_fingerprint, parameter_hash, scenario_id]
    primary_key:
      - seed
      - manifest_fingerprint
      - scenario_id
      - flow_id
    ordering: [seed, manifest_fingerprint, scenario_id, flow_id]
    schema_ref: schemas.6B.yaml#/s4/flow_truth_labels_6B
    lineage:
      produced_by: [ '6B.S4' ]
      consumed_by: [ '6B.S5', '4A', '4B', 'model_training' ]

  - id: s4_flow_bank_view_6B
    owner_layer: 3
    owner_segment: 6B
    status: required
    description: >
      Bank-view classification of each flow (what the institution sees / would act on).
    version: '{seed}.{manifest_fingerprint}.{parameter_hash}.{scenario_id}'
    format: parquet
    path: data/layer3/6B/s4_flow_bank_view_6B/seed={seed}/parameter_hash={parameter_hash}/manifest_fingerprint={manifest_fingerprint}/scenario_id={scenario_id}/part-*.parquet
    partitioning: [seed, manifest_fingerprint, parameter_hash, scenario_id]
    primary_key:
      - seed
      - manifest_fingerprint
      - scenario_id
      - flow_id
    ordering: [seed, manifest_fingerprint, scenario_id, flow_id]
    schema_ref: schemas.6B.yaml#/s4/flow_bank_view_6B
    lineage:
      produced_by: [ '6B.S4' ]
      consumed_by: [ '6B.S5', '4A', '4B', 'model_training' ]

  - id: s4_event_labels_6B
    owner_layer: 3
    owner_segment: 6B
    status: required
    description: >
      Event-level truth and bank-view labels keyed to s3_event_stream_with_fraud_6B.
    version: '{seed}.{manifest_fingerprint}.{parameter_hash}.{scenario_id}'
    format: parquet
    path: data/layer3/6B/s4_event_labels_6B/seed={seed}/parameter_hash={parameter_hash}/manifest_fingerprint={manifest_fingerprint}/scenario_id={scenario_id}/part-*.parquet
    partitioning: [seed, manifest_fingerprint, parameter_hash, scenario_id]
    primary_key:
      - seed
      - manifest_fingerprint
      - scenario_id
      - flow_id
      - event_seq
    ordering: [seed, manifest_fingerprint, scenario_id, flow_id, event_seq]
    schema_ref: schemas.6B.yaml#/s4/event_labels_6B
    lineage:
      produced_by: [ '6B.S4' ]
      consumed_by: [ '6B.S5', '4A', '4B', 'model_training' ]

  - id: s4_case_timeline_6B
    owner_layer: 3
    owner_segment: 6B
    status: required
    description: >
      Case timeline events for flows promoted to manual review or automated cases.
    version: '{seed}.{manifest_fingerprint}.{parameter_hash}.{scenario_id}'
    format: parquet
    path: data/layer3/6B/s4_case_timeline_6B/seed={seed}/parameter_hash={parameter_hash}/manifest_fingerprint={manifest_fingerprint}/scenario_id={scenario_id}/part-*.parquet
    partitioning: [seed, manifest_fingerprint, parameter_hash, scenario_id]
    primary_key:
      - seed
      - manifest_fingerprint
      - scenario_id
      - case_id
      - case_event_seq
    ordering: [case_id, case_event_seq]
    schema_ref: schemas.6B.yaml#/s4/case_timeline_6B
    lineage:
      produced_by: [ '6B.S4' ]
      consumed_by: [ '6B.S5', '4A', '4B', 'model_training' ]

  # --- S5: validation artefacts ---

  - id: s5_validation_report_6B
    owner_layer: 3
    owner_segment: 6B
    status: required
    description: >
      Segment 6B world-level validation report; one JSON document summarising
      the results of S5 checks across S1-S4 artefacts.
    version: '{manifest_fingerprint}'
    format: json
    path: data/layer3/6B/validation/manifest_fingerprint={manifest_fingerprint}/s5_validation_report_6B.json
    partitioning: [manifest_fingerprint]
    primary_key: [manifest_fingerprint]
    ordering: []
    schema_ref: schemas.layer3.yaml#/validation/6B/s5_validation_report
    lineage:
      produced_by: [ '6B.S5' ]
      consumed_by: [ '6B.S5_bundle', '4A', '4B', 'ops_tooling' ]

  - id: s5_issue_table_6B
    owner_layer: 3
    owner_segment: 6B
    status: optional
    description: >
      Structured list of validation issues for 6B (one row per failing/warning check).
    version: '{manifest_fingerprint}'
    format: parquet
    path: data/layer3/6B/validation/manifest_fingerprint={manifest_fingerprint}/s5_issue_table_6B.parquet
    partitioning: [manifest_fingerprint]
    primary_key:
      - manifest_fingerprint
      - check_id
      - issue_id
    ordering: [manifest_fingerprint, check_id, issue_id]
    schema_ref: schemas.layer3.yaml#/validation/6B/s5_issue_table
    lineage:
      produced_by: [ '6B.S5' ]
      consumed_by: [ '6B.S5_bundle', 'ops_tooling' ]

  - id: validation_bundle_6B
    owner_layer: 3
    owner_segment: 6B
    status: required
    description: >
      World-level validation bundle for Segment 6B; directory of validation artefacts
      plus index.json and _passed.flag.
    version: '{manifest_fingerprint}'
    format: directory
    path: data/layer3/6B/validation/manifest_fingerprint={manifest_fingerprint}/
    partitioning: [manifest_fingerprint]
    primary_key: [manifest_fingerprint]
    ordering: []
    schema_ref: null
    lineage:
      produced_by: [ '6B.S5' ]
      consumed_by: [ '6B.S5', '4A', '4B', 'ops_tooling' ]

  - id: validation_bundle_index_6B
    owner_layer: 3
    owner_segment: 6B
    status: required
    description: >
      Index for the Segment 6B validation bundle, listing evidence files
      and their SHA-256 digests.
    version: '{manifest_fingerprint}'
    format: json
    path: data/layer3/6B/validation/manifest_fingerprint={manifest_fingerprint}/index.json
    partitioning: [manifest_fingerprint]
    primary_key: [manifest_fingerprint]
    ordering: []
    schema_ref: schemas.layer3.yaml#/validation/6B/validation_bundle_index_6B
    lineage:
      produced_by: [ '6B.S5' ]
      consumed_by: [ '6B.S5', '4A', '4B', 'ops_tooling' ]

  - id: validation_passed_flag_6B
    owner_layer: 3
    owner_segment: 6B
    status: required
    description: >
      Segment 6B HashGate flag; encodes SHA-256 digest over the 6B validation bundle.
    version: '{manifest_fingerprint}'
    format: text
    path: data/layer3/6B/validation/manifest_fingerprint={manifest_fingerprint}/_passed.flag
    partitioning: [manifest_fingerprint]
    primary_key: [manifest_fingerprint]
    ordering: []
    schema_ref: schemas.layer3.yaml#/validation/6B/passed_flag_6B
    lineage:
      produced_by: [ '6B.S5' ]
      consumed_by: [ '6B.S5', '4A', '4B', 'ops_tooling' ]
