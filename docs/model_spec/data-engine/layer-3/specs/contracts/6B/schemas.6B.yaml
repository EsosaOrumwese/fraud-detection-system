$schema: "https://json-schema.org/draft/2020-12/schema"
$id: schemas.6B.yaml
title: "Layer-3 / Segment 6B - business dataset schemas"
description: >-
  Anchors for the Layer-3 / Segment 6B business datasets (S1-S4). Each anchor
  will be fleshed out with concrete properties as implementation proceeds.
type: object
additionalProperties: false

$defs:
  hex64:
    $ref: "schemas.layer3.yaml#/$defs/hex64"
  id_token:
    type: string
    pattern: "^[A-Z][A-Z0-9_]{1,63}$"
  probability:
    type: number
    minimum: 0
    maximum: 1
  range_min_max:
    type: object
    additionalProperties: false
    required:
      - min
      - max
    properties:
      min: { type: number }
      max: { type: number }
  range_min_max_int:
    type: object
    additionalProperties: false
    required:
      - min
      - max
    properties:
      min: { type: integer }
      max: { type: integer }
  amount_dist_lognormal_v1:
    type: object
    additionalProperties: false
    required: [dist_id, mu_log, sigma_log]
    properties:
      dist_id: { type: string, const: LOGNORMAL_V1 }
      mu_log: { type: number }
      sigma_log: { type: number }
  amount_dist_lognormal_mix_v1:
    type: object
    additionalProperties: false
    required: [dist_id, components]
    properties:
      dist_id: { type: string, const: LOGNORMAL_MIX_V1 }
      components:
        type: array
        minItems: 2
        maxItems: 3
        items:
          type: object
          additionalProperties: false
          required: [weight, mu_log, sigma_log]
          properties:
            weight: { $ref: "#/$defs/probability" }
            mu_log: { type: number }
            sigma_log: { type: number }
  amount_dist_gamma_v1:
    type: object
    additionalProperties: false
    required: [dist_id, shape_k, scale_theta]
    properties:
      dist_id: { type: string, const: GAMMA_V1 }
      shape_k: { type: number }
      scale_theta: { type: number }
  amount_dist_tail_v1:
    oneOf:
      - $ref: "#/$defs/amount_dist_lognormal_v1"
      - $ref: "#/$defs/amount_dist_lognormal_mix_v1"
      - $ref: "#/$defs/amount_dist_gamma_v1"
  amount_dist_discrete_price_points_v1:
    type: object
    additionalProperties: false
    required: [dist_id, price_points_minor, point_mass_total, tail]
    properties:
      dist_id: { type: string, const: DISCRETE_PRICE_POINTS_V1 }
      price_points_minor:
        type: array
        minItems: 1
        items: { type: integer }
      point_mass_total: { $ref: "#/$defs/probability" }
      tail: { $ref: "#/$defs/amount_dist_tail_v1" }
  amount_distribution_v1:
    oneOf:
      - $ref: "#/$defs/amount_dist_lognormal_v1"
      - $ref: "#/$defs/amount_dist_lognormal_mix_v1"
      - $ref: "#/$defs/amount_dist_gamma_v1"
      - $ref: "#/$defs/amount_dist_discrete_price_points_v1"
  delay_dist_exponential_qf_v1:
    type: object
    additionalProperties: false
    required: [dist_id, rate_lambda]
    properties:
      dist_id: { type: string, const: EXPONENTIAL_QF_V1 }
      rate_lambda: { type: number }
  delay_dist_lognormal_qf_v1:
    type: object
    additionalProperties: false
    required: [dist_id, mu_log, sigma_log]
    properties:
      dist_id: { type: string, const: LOGNORMAL_QF_V1 }
      mu_log: { type: number }
      sigma_log: { type: number }
  delay_dist_gamma_qf_v1:
    type: object
    additionalProperties: false
    required: [dist_id, shape_k, scale_theta]
    properties:
      dist_id: { type: string, const: GAMMA_QF_V1 }
      shape_k: { type: number }
      scale_theta: { type: number }
  delay_dist_discrete_points_v1:
    type: object
    additionalProperties: false
    required: [dist_id, points_seconds, probs]
    properties:
      dist_id: { type: string, const: DISCRETE_POINTS_V1 }
      points_seconds:
        type: array
        minItems: 1
        items: { type: number }
      probs:
        type: array
        minItems: 1
        items: { $ref: "#/$defs/probability" }
  delay_dist_tail_qf_v1:
    oneOf:
      - $ref: "#/$defs/delay_dist_lognormal_qf_v1"
      - $ref: "#/$defs/delay_dist_gamma_qf_v1"
      - $ref: "#/$defs/delay_dist_exponential_qf_v1"
  delay_dist_point_mass_plus_tail_v1:
    type: object
    additionalProperties: false
    required: [dist_id, point_mass, tail]
    properties:
      dist_id: { type: string, const: POINT_MASS_PLUS_TAIL_V1 }
      point_mass:
        type: object
        additionalProperties: false
        required: [seconds, prob]
        properties:
          seconds: { type: number }
          prob: { $ref: "#/$defs/probability" }
      tail: { $ref: "#/$defs/delay_dist_tail_qf_v1" }
  delay_dist_mixture_qf_v1:
    type: object
    additionalProperties: false
    required: [dist_id, components]
    properties:
      dist_id: { type: string, const: MIXTURE_QF_V1 }
      components:
        type: array
        minItems: 2
        items:
          type: object
          additionalProperties: false
          required: [weight, dist]
          properties:
            weight: { $ref: "#/$defs/probability" }
            dist:
              oneOf:
                - $ref: "#/$defs/delay_dist_lognormal_qf_v1"
                - $ref: "#/$defs/delay_dist_gamma_qf_v1"
                - $ref: "#/$defs/delay_dist_exponential_qf_v1"
  delay_distribution_qf_v1:
    oneOf:
      - $ref: "#/$defs/delay_dist_exponential_qf_v1"
      - $ref: "#/$defs/delay_dist_lognormal_qf_v1"
      - $ref: "#/$defs/delay_dist_gamma_qf_v1"
      - $ref: "#/$defs/delay_dist_discrete_points_v1"
      - $ref: "#/$defs/delay_dist_point_mass_plus_tail_v1"
      - $ref: "#/$defs/delay_dist_mixture_qf_v1"

policy:
  description: "6B policy/config inputs sealed at S0"
  additionalProperties: false
  properties:
    attachment_policy_6B:
      $id: "#/policy/attachment_policy_6B"
      type: object
      description: "Attachment policy for entity selection and linking (S1)."
      additionalProperties: false
      required:
        - schema_version
        - policy_id
        - policy_version
        - dependencies
        - attachment_steps_order
        - channel_model
        - requiredness
        - party_policy
        - account_policy
        - instrument_policy
        - device_policy
        - ip_policy
        - provenance
      properties:
        schema_version: { type: integer, const: 1 }
        policy_id: { type: string, const: attachment_policy_6B }
        policy_version: { type: string, const: v1 }
        dependencies:
          type: object
          additionalProperties: false
          required:
            - rng_profile_layer3
            - rng_policy_6B
          properties:
            rng_profile_layer3:
              type: object
              additionalProperties: false
              required: [policy_id, required]
              properties:
                policy_id: { type: string, const: rng_profile_layer3 }
                required: { type: boolean }
            rng_policy_6B:
              type: object
              additionalProperties: false
              required: [policy_id, required]
              properties:
                policy_id: { type: string, const: rng_policy_6B }
                required: { type: boolean }
            behaviour_config_6B:
              type: object
              additionalProperties: false
              required: [policy_id, required]
              properties:
                policy_id: { type: string, const: behaviour_config_6B }
                required: { type: boolean }
        attachment_steps_order:
          type: array
          items:
            type: string
            enum: [PARTY, ACCOUNT, INSTRUMENT, DEVICE, IP]
        channel_model:
          type: object
          additionalProperties: false
          required:
            - channel_field
            - default_channel_group
            - known_channel_groups
          properties:
            channel_field: { type: string }
            default_channel_group:
              type: string
              enum: [ECOM, POS, ATM, BANK_RAIL, HYBRID]
            known_channel_groups:
              type: array
              items:
                type: string
                enum: [ECOM, POS, ATM, BANK_RAIL, HYBRID]
        requiredness:
          type: object
          additionalProperties: false
          required: [PARTY, ACCOUNT, INSTRUMENT, DEVICE, IP]
          properties:
            PARTY:
              type: object
              additionalProperties: false
              required: [by_channel]
              properties:
                by_channel:
                  type: object
                  additionalProperties:
                    type: string
                    enum: [REQUIRED, OPTIONAL]
            ACCOUNT:
              type: object
              additionalProperties: false
              required: [by_channel]
              properties:
                by_channel:
                  type: object
                  additionalProperties:
                    type: string
                    enum: [REQUIRED, OPTIONAL]
            INSTRUMENT:
              type: object
              additionalProperties: false
              required: [by_channel]
              properties:
                by_channel:
                  type: object
                  additionalProperties:
                    type: string
                    enum: [REQUIRED, OPTIONAL]
            DEVICE:
              type: object
              additionalProperties: false
              required: [by_channel]
              properties:
                by_channel:
                  type: object
                  additionalProperties:
                    type: string
                    enum: [REQUIRED, OPTIONAL]
            IP:
              type: object
              additionalProperties: false
              required: [by_channel]
              properties:
                by_channel:
                  type: object
                  additionalProperties:
                    type: string
                    enum: [REQUIRED, OPTIONAL]
        party_policy:
          type: object
          additionalProperties: false
          required:
            - candidate_sources
            - mixture
            - scoring
          properties:
            candidate_sources:
              type: array
              items:
                type: object
                additionalProperties: false
                required: [source_id, definition]
                properties:
                  source_id: { type: string }
                  definition: { type: string }
            mixture:
              type: object
              additionalProperties: false
              required: [p_primary_source_by_channel]
              properties:
                p_primary_source_by_channel:
                  type: object
                  additionalProperties: { $ref: "#/$defs/probability" }
            scoring:
              type: object
              additionalProperties: false
              required: [mode]
              properties:
                mode: { type: string }
                components:
                  type: array
                  items:
                    type: object
                    additionalProperties: false
                    required: [name]
                    properties:
                      name: { type: string }
                      value: { type: number }
                      weight: { type: number }
                min_weight_eps: { type: number }
        account_policy:
          type: object
          additionalProperties: false
          required:
            - candidates
            - scoring
            - fallback
          properties:
            candidates: { type: string }
            group_preferences_by_channel:
              type: object
              additionalProperties:
                type: array
                items: { type: string }
            scoring:
              type: object
              additionalProperties: false
              required: [mode]
              properties:
                mode: { type: string }
                min_weight_eps: { type: number }
            fallback:
              type: object
              additionalProperties: false
              properties:
                if_no_candidates: { type: string }
        instrument_policy:
          type: object
          additionalProperties: false
          required:
            - candidates
            - scoring
            - fallback
          properties:
            candidates: { type: string }
            allowed_instrument_types_by_channel:
              type: object
              additionalProperties:
                type: array
                items:
                  type: string
                  enum: [CARD_LIKE, ANY]
            scoring:
              type: object
              additionalProperties: false
              required: [mode]
              properties:
                mode: { type: string }
            fallback:
              type: object
              additionalProperties: false
              properties:
                if_required_and_empty: { type: string }
        device_policy:
          type: object
          additionalProperties: false
          required:
            - mode_by_channel
            - scoring
            - fallback
          properties:
            mode_by_channel:
              type: object
              additionalProperties:
                type: string
                enum: [CUSTOMER_DEVICE, MERCHANT_TERMINAL_DEVICE]
            customer_device_candidates: { type: string }
            terminal_device_candidates: { type: string }
            scoring:
              type: object
              additionalProperties: false
              required: [mode]
              properties:
                mode: { type: string }
                min_weight_eps: { type: number }
            fallback:
              type: object
              additionalProperties: false
              properties:
                if_required_and_empty: { type: string }
        ip_policy:
          type: object
          additionalProperties: false
          required:
            - mode_by_channel
            - scoring
            - fallback
          properties:
            candidates_by_device: { type: string }
            candidates_by_merchant: { type: string }
            mode_by_channel:
              type: object
              additionalProperties:
                type: string
                enum: [FROM_DEVICE, FROM_MERCHANT]
            scoring:
              type: object
              additionalProperties: false
              required: [mode]
              properties:
                mode: { type: string }
                allow_proxy_share_max: { type: number }
            fallback:
              type: object
              additionalProperties: false
              properties:
                if_required_and_empty: { type: string }
        provenance:
          type: object
          additionalProperties: false
          properties:
            attach_rule_id_enabled: { type: boolean }
            attach_score_enabled: { type: boolean }
            attach_rng_family_field: { type: string }
    sessionisation_policy_6B:
      $id: "#/policy/sessionisation_policy_6B"
      type: object
      description: "Session key + inactivity gap policy (S1)."
      additionalProperties: false
      required:
        - schema_version
        - policy_id
        - policy_version
        - session_key
        - boundary_rules
        - stochastic_boundary
        - session_id
        - session_summary
        - guardrails
      properties:
        schema_version: { type: integer, const: 1 }
        policy_id: { type: string, const: sessionisation_policy_6B }
        policy_version: { type: string, const: v1 }
        session_key:
          type: object
          additionalProperties: false
          required: [fields]
          properties:
            fields:
              type: array
              items: { type: string }
            normalisation:
              type: object
              additionalProperties: true
            encoding:
              type: object
              additionalProperties: true
        boundary_rules:
          type: object
          additionalProperties: false
          required:
            - hard_timeout_seconds
            - hard_break_seconds
          properties:
            hard_timeout_seconds: { type: number, minimum: 0 }
            hard_break_seconds: { type: number, minimum: 0 }
            break_on_day_boundary: { type: boolean }
            break_on_channel_change: { type: boolean }
        stochastic_boundary:
          type: object
          additionalProperties: false
          required: [enabled]
          properties:
            enabled: { type: boolean }
            key_ids:
              type: array
              items: { type: string }
        session_id:
          type: object
          additionalProperties: true
        session_summary:
          type: object
          additionalProperties: true
        guardrails:
          type: object
          additionalProperties: false
          properties:
            max_sessions_per_seed_scenario: { type: integer }
            max_flows_per_session: { type: integer }
            max_events_per_flow: { type: integer }
            max_campaigns_active_per_day: { type: integer }
            max_cases_per_seed_scenario: { type: integer }
        notes: { type: string }
    behaviour_config_6B:
      $id: "#/policy/behaviour_config_6B"
      type: object
      description: "Optional feature flags and guardrails for 6B."
      additionalProperties: false
      required:
        - schema_version
        - config_id
        - config_version
        - scope_filters
        - feature_flags
        - guardrails
        - degrade_posture
      properties:
        schema_version: { type: integer, const: 1 }
        config_id: { type: string, const: behaviour_config_6B }
        config_version: { type: string, const: v1 }
        scope_filters:
          type: object
          additionalProperties: false
          properties:
            scenario_id_allowlist:
              type: array
              items: { type: string }
            scenario_id_blocklist:
              type: array
              items: { type: string }
            seed_allowlist:
              type: array
              items: { type: integer }
            seed_blocklist:
              type: array
              items: { type: integer }
            campaign_type_allowlist:
              type: array
              items: { type: string }
            campaign_type_blocklist:
              type: array
              items: { type: string }
        feature_flags:
          type: object
          additionalProperties: false
          properties:
            s1:
              type: object
              additionalProperties: false
              properties:
                enable_attachment_steps:
                  type: object
                  additionalProperties: false
                  properties:
                    ATTACH_PARTY: { type: boolean }
                    ATTACH_ACCOUNT: { type: boolean }
                    ATTACH_INSTRUMENT: { type: boolean }
                    ATTACH_DEVICE: { type: boolean }
                    ATTACH_IP: { type: boolean }
                enable_sessionisation: { type: boolean }
                enable_stochastic_session_boundary: { type: boolean }
            s2:
              type: object
              additionalProperties: false
              properties:
                enable_multi_flow_sessions: { type: boolean }
                enable_refunds: { type: boolean }
                enable_reversals: { type: boolean }
                enable_partial_clearing: { type: boolean }
                allowed_flow_types:
                  type: array
                  items: { type: string }
            s3:
              type: object
              additionalProperties: false
              properties:
                enable_fraud_overlay: { type: boolean }
                allowed_campaign_types:
                  type: array
                  items: { type: string }
                allowed_tactic_types:
                  type: array
                  items: { type: string }
            s4:
              type: object
              additionalProperties: false
              properties:
                enable_truth_labelling: { type: boolean }
                enable_bank_view: { type: boolean }
                enable_cases: { type: boolean }
                enable_delays: { type: boolean }
            s5:
              type: object
              additionalProperties: false
              properties:
                validation_scope_mode:
                  type: string
                  enum: [FULL, SCOPED]
                validation_scope:
                  type: object
                  additionalProperties: true
        guardrails:
          type: object
          additionalProperties: true
        degrade_posture:
          type: object
          additionalProperties: false
          required:
            - on_scope_filter_miss
            - on_guardrail_exceeded
            - on_optional_policy_missing
          properties:
            on_scope_filter_miss:
              type: string
              enum: [SKIP_PARTITION, FAIL]
            on_guardrail_exceeded:
              type: string
              enum: [CLAMP_AND_WARN, FAIL]
            on_optional_policy_missing:
              type: string
              enum: [DISABLE_FEATURE, FAIL]
        notes: { type: string }
        behaviour_prior_pack_6B:
      $id: "#/policy/behaviour_prior_pack_6B"
      type: object
      description: "Behaviour priors pack for 6B (sealed by S0; used by S1-S4)."
      additionalProperties: false
      required:
        - schema_version
        - pack_id
        - pack_version
        - vocabulary
        - geo_affinity
        - account_preferences
        - instrument_preferences
        - device_preferences
        - ip_preferences
        - guardrails
        - realism_targets
      properties:
        schema_version: { type: integer, const: 1 }
        pack_id: { type: string, const: behaviour_prior_pack_6B }
        pack_version: { type: string, const: v1 }
        vocabulary:
          type: object
          additionalProperties: false
          required:
            - channel_groups
            - ledger_classes
            - instrument_kinds
            - ip_groups
          properties:
            channel_groups:
              type: array
              items: { type: string }
            ledger_classes:
              type: array
              items: { type: string }
            instrument_kinds:
              type: array
              items: { type: string }
            ip_groups:
              type: array
              items: { type: string }
        geo_affinity:
          type: object
          additionalProperties: false
          required:
            - mode
            - p_home_geo_by_segment_channel
          properties:
            mode:
              type: string
              enum: [home_vs_global_mixture_v1]
            p_home_geo_by_segment_channel:
              type: object
              additionalProperties:
                type: object
                additionalProperties: { $ref: "#/$defs/probability" }
        account_preferences:
          type: object
          additionalProperties: false
          required:
            - mode
            - weights_by_segment_channel
          properties:
            mode:
              type: string
              enum: [weights_by_ledger_class_v1]
            weights_by_segment_channel:
              type: object
              additionalProperties:
                type: object
                additionalProperties:
                  type: object
                  additionalProperties: { $ref: "#/$defs/probability" }
        instrument_preferences:
          type: object
          additionalProperties: false
          required:
            - mode
            - weights_by_segment_channel
          properties:
            mode:
              type: string
              enum: [weights_by_instrument_kind_v1]
            weights_by_segment_channel:
              type: object
              additionalProperties:
                type: object
                additionalProperties:
                  type: object
                  additionalProperties: { $ref: "#/$defs/probability" }
        device_preferences:
          type: object
          additionalProperties: false
          required:
            - mode
            - p_primary_device_by_segment_channel
          properties:
            mode:
              type: string
              enum: [primary_vs_other_v1]
            p_primary_device_by_segment_channel:
              type: object
              additionalProperties:
                type: object
                additionalProperties: { $ref: "#/$defs/probability" }
            terminal_bias_by_channel:
              type: object
              additionalProperties:
                type: object
                additionalProperties: false
                properties:
                  use_terminal_device_prob: { $ref: "#/$defs/probability" }
        ip_preferences:
          type: object
          additionalProperties: false
          required:
            - mode
            - weights_by_segment_channel
          properties:
            mode:
              type: string
              enum: [weights_by_ip_group_v1]
            weights_by_segment_channel:
              type: object
              additionalProperties:
                type: object
                additionalProperties:
                  type: object
                  additionalProperties: { $ref: "#/$defs/probability" }
        guardrails:
          type: object
          additionalProperties: false
          properties:
            max_total_campaign_instances_per_seed_scenario: { type: integer }
            max_total_targets_per_seed_scenario: { type: integer }
            max_targets_per_campaign_instance: { type: integer }
            max_windows_per_campaign_instance: { type: integer }
        realism_targets:
          type: object
          additionalProperties: false
          properties:
            min_templates_total: { type: integer }
            min_fraud_family_coverage: { type: integer }
            targeting_diversity_min: { type: integer }
            proxy_usage_presence: { type: boolean }
            campaign_prevalence_ranges:
              type: object
              additionalProperties: { $ref: "#/$defs/range_min_max" }
        notes: { type: string }
    rng_profile_layer3:
      $id: "#/policy/rng_profile_layer3"
      type: object
      description: "Layer-3 RNG profile (Philox parameters and invariants)."
      additionalProperties: false
      required:
        - policy_id
        - version
        - rng_engine
        - philox
        - counter
        - uniform_u01
        - lane_policy
        - budget_law
        - normal_z
        - substreams
        - guardrails
      properties:
        policy_id: { type: string, const: rng_profile_layer3 }
        version: { type: string }
        rng_engine: { type: string, const: philox2x64-10 }
        philox:
          type: object
          additionalProperties: false
          required:
            - rounds
            - lanes_per_block_u64
            - key_bits
            - counter_bits
          properties:
            rounds: { type: integer }
            lanes_per_block_u64: { type: integer }
            key_bits: { type: integer }
            counter_bits: { type: integer }
        counter:
          type: object
          additionalProperties: false
          required:
            - representation
            - arithmetic
            - increment_per_block
            - wrap_policy
          properties:
            representation: { type: object }
            arithmetic: { type: string }
            increment_per_block: { type: integer }
            wrap_policy: { type: string }
        uniform_u01:
          type: object
          additionalProperties: false
          required:
            - law_id
            - u_from_u64
            - forbid_decimal_substitutes
          properties:
            law_id: { type: string }
            u_from_u64:
              type: object
              additionalProperties: false
              required: [expr]
              properties:
                expr: { type: string }
            forbid_decimal_substitutes: { type: boolean }
        lane_policy:
          type: object
          additionalProperties: false
          required:
            - single_uniform
            - two_uniform
            - cache_across_events
          properties:
            single_uniform: { type: object }
            two_uniform: { type: object }
            cache_across_events: { type: boolean }
        budget_law:
          type: object
          additionalProperties: false
          required:
            - draws_type
            - blocks_type
            - blocks_from_draws
            - lane_order
            - non_consuming
          properties:
            draws_type: { type: string }
            blocks_type: { type: string }
            blocks_from_draws: { type: string }
            lane_order:
              type: array
              items: { type: string }
            non_consuming:
              type: object
              additionalProperties: false
              required: [draws, blocks]
              properties:
                draws: { type: string }
                blocks: { type: integer }
        normal_z:
          type: object
          additionalProperties: false
          required:
            - enabled
            - law_id
            - tau_hex
            - draws_per_z
            - blocks_per_z
            - discard_sine_mate
          properties:
            enabled: { type: boolean }
            law_id: { type: string }
            tau_hex: { type: string }
            draws_per_z: { type: string }
            blocks_per_z: { type: integer }
            discard_sine_mate: { type: boolean }
        substreams:
          type: object
          additionalProperties: false
          required:
            - master_domain
            - msg_domain
            - encodings
            - derivation
          properties:
            master_domain: { type: string }
            msg_domain: { type: string }
            encodings:
              type: object
              additionalProperties: true
            derivation:
              type: object
              additionalProperties: true
        guardrails:
          type: object
          additionalProperties: false
          properties:
            forbid_rng_without_policy: { type: boolean }
            forbid_event_lane_reuse: { type: boolean }
            require_open_interval_u01: { type: boolean }
        notes: { type: string }
    rng_policy_6B:
      $id: "#/policy/rng_policy_6B"
      type: object
      description: "RNG family mapping for 6B.S1 decision families."
      additionalProperties: false
      required:
        - policy_id
        - version
        - scope
        - rng_profile_ref
        - families
        - emission_rules
        - keying
        - guardrails
      properties:
        policy_id: { type: string, const: rng_policy_6B }
        version: { type: string }
        scope:
          type: object
          additionalProperties: true
        rng_profile_ref:
          type: object
          additionalProperties: false
          required: [policy_id, required]
          properties:
            policy_id: { type: string, const: rng_profile_layer3 }
            required: { type: boolean }
        families:
          type: array
          items:
            type: object
            additionalProperties: false
            required:
              - family_id
              - budgets
            properties:
              family_id: { type: string }
              purpose: { type: string }
              budgets:
                type: object
                additionalProperties: false
                required: [consuming, non_consuming]
                properties:
                  consuming:
                    type: object
                    additionalProperties: false
                    required: [draws, blocks]
                    properties:
                      draws: { type: string }
                      blocks: { type: integer }
                  non_consuming:
                    type: object
                    additionalProperties: false
                    required: [draws, blocks]
                    properties:
                      draws: { type: string }
                      blocks: { type: integer }
              step_enum:
                type: array
                items: { type: string }
        emission_rules:
          type: object
          additionalProperties: false
          properties:
            attachment_steps_order:
              type: array
              items:
                type: string
                enum: [ATTACH_PARTY, ATTACH_ACCOUNT, ATTACH_INSTRUMENT, ATTACH_DEVICE, ATTACH_IP]
            entity_attach:
              type: object
              additionalProperties: false
              properties:
                emit_event_every_step: { type: boolean }
                consume_if_candidate_count_gt: { type: integer }
                deterministic_if_candidate_count_le: { type: integer }
            session_boundary:
              type: object
              additionalProperties: false
              properties:
                enabled_by_sessionisation_policy: { type: boolean }
                emit_event_on_ambiguity_only: { type: boolean }
                consume_if_ambiguity: { type: boolean }
        keying:
          type: object
          additionalProperties: false
          properties:
            forbid_run_id_in_key: { type: boolean }
            common_ids:
              type: array
              items: { type: string }
            arrival_ids:
              type: array
              items: { type: string }
            step_id_field:
              type: object
              additionalProperties: { type: string }
        guardrails:
          type: object
          additionalProperties: true
        notes: { type: string }
    flow_shape_policy_6B:
      $id: "#/policy/flow_shape_policy_6B"
      type: object
      description: "Flow shape policy for S2."
      additionalProperties: false
      required:
        - schema_version
        - policy_id
        - policy_version
        - bindings
        - flow_count_model
        - arrival_to_flow_model
        - flow_type_catalog
        - flow_type_selection
        - event_templates
        - branching
        - provenance_fields
        - guardrails
        - realism_targets
      properties:
        schema_version: { type: integer, const: 1 }
        policy_id: { type: string, const: flow_shape_policy_6B }
        policy_version: { type: string, const: v1 }
        bindings:
          type: object
          additionalProperties: false
          required:
            - rng_family_ids_used
            - channel_groups
            - event_type_vocab
          properties:
            rng_family_ids_used:
              type: array
              items: { type: string }
            channel_groups:
              type: array
              items: { type: string }
            event_type_vocab:
              type: array
              items: { type: string }
        flow_count_model:
          type: object
          additionalProperties: false
          required: [mode]
          properties:
            mode:
              type: string
              enum: [one_flow_per_session, one_flow_per_arrival, stochastic_discrete_v1]
            support:
              type: array
              items: { type: integer }
            prob:
              type: array
              items: { $ref: "#/$defs/probability" }
            rng_family: { type: string }
            keying_ids:
              type: array
              items: { type: string }
            allow_empty_sessions: { type: boolean }
            empty_session_predicate: { type: string }
        arrival_to_flow_model:
          type: object
          additionalProperties: false
          required: [mode]
          properties:
            mode:
              type: string
              enum: [all_arrivals_one_flow, arrival_per_flow, multi_flow_orders_v1]
            max_flows_per_session: { type: integer }
            order_key_fields:
              type: array
              items: { type: string }
            tie_break_order:
              type: array
              items: { type: string }
            stochastic_assignment:
              type: object
              additionalProperties: true
        flow_type_catalog:
          type: object
          additionalProperties: false
          required: [flow_types]
          properties:
            flow_types:
              type: array
              items:
                type: object
                additionalProperties: false
                required:
                  - flow_type_id
                  - description
                  - channel_groups_allowed
                  - baseline_outcome_class
                  - requires_instrument
                  - allows_refund
                  - allows_step_up
                  - max_retry_count
                properties:
                  flow_type_id: { type: string }
                  description: { type: string }
                  channel_groups_allowed:
                    type: array
                    items: { type: string }
                  baseline_outcome_class: { type: string }
                  requires_instrument: { type: boolean }
                  allows_refund: { type: boolean }
                  allows_step_up: { type: boolean }
                  max_retry_count: { type: integer }
        flow_type_selection:
          type: object
          additionalProperties: false
          required:
            - mode
            - pi_flow_type_by_channel_group
            - deterministic_if_singleton
            - rng_family
            - keying_ids
          properties:
            mode:
              type: string
              enum: [by_channel_group_v1]
            pi_flow_type_by_channel_group:
              type: object
              additionalProperties:
                type: array
                items:
                  type: object
                  additionalProperties: false
                  required: [flow_type_id, prob]
                  properties:
                    flow_type_id: { type: string }
                    prob: { $ref: "#/$defs/probability" }
            deterministic_if_singleton: { type: boolean }
            rng_family: { type: string }
            keying_ids:
              type: array
              items: { type: string }
        event_templates:
          type: object
          additionalProperties: false
          required:
            - template_base_index
            - templates_by_flow_type
          properties:
            template_base_index:
              type: string
              enum: [0_based, 1_based]
            templates_by_flow_type:
              type: object
              additionalProperties:
                type: array
                items: { type: string }
        branching:
          type: object
          additionalProperties: false
          required:
            - retry_branch
            - step_up_branch
            - refund_branch
            - reversal_branch
          properties:
            retry_branch:
              type: object
              additionalProperties: false
              required:
                - enabled
                - applicable_flow_types
                - insertion_rule
                - decision
                - max_insertions
              properties:
                enabled: { type: boolean }
                applicable_flow_types:
                  type: array
                  items: { type: string }
                insertion_rule: { type: string }
                decision:
                  type: object
                  additionalProperties: false
                  required: [mode]
                  properties:
                    mode:
                      type: string
                      enum: [deterministic, bernoulli_v1]
                    p: { $ref: "#/$defs/probability" }
                    rng_family: { type: string }
                max_insertions: { type: integer }
            step_up_branch:
              type: object
              additionalProperties: false
              required:
                - enabled
                - applicable_flow_types
                - insertion_rule
                - decision
                - max_insertions
              properties:
                enabled: { type: boolean }
                applicable_flow_types:
                  type: array
                  items: { type: string }
                insertion_rule: { type: string }
                decision:
                  type: object
                  additionalProperties: false
                  required: [mode]
                  properties:
                    mode:
                      type: string
                      enum: [deterministic, bernoulli_v1]
                    p: { $ref: "#/$defs/probability" }
                    rng_family: { type: string }
                max_insertions: { type: integer }
            refund_branch:
              type: object
              additionalProperties: false
              required:
                - enabled
                - applicable_flow_types
                - insertion_rule
                - decision
                - max_insertions
              properties:
                enabled: { type: boolean }
                applicable_flow_types:
                  type: array
                  items: { type: string }
                insertion_rule: { type: string }
                decision:
                  type: object
                  additionalProperties: false
                  required: [mode]
                  properties:
                    mode:
                      type: string
                      enum: [deterministic, bernoulli_v1]
                    p: { $ref: "#/$defs/probability" }
                    rng_family: { type: string }
                max_insertions: { type: integer }
            reversal_branch:
              type: object
              additionalProperties: false
              required:
                - enabled
                - applicable_flow_types
                - insertion_rule
                - decision
                - max_insertions
              properties:
                enabled: { type: boolean }
                applicable_flow_types:
                  type: array
                  items: { type: string }
                insertion_rule: { type: string }
                decision:
                  type: object
                  additionalProperties: false
                  required: [mode]
                  properties:
                    mode:
                      type: string
                      enum: [deterministic, bernoulli_v1]
                    p: { $ref: "#/$defs/probability" }
                    rng_family: { type: string }
                max_insertions: { type: integer }
        provenance_fields:
          type: object
          additionalProperties: true
        guardrails:
          type: object
          additionalProperties: true
        realism_targets:
          type: object
          additionalProperties: true
        notes: { type: string }
    amount_model_6B:
      $id: "#/policy/amount_model_6B"
      type: object
      description: "Amount model policy for S2."
      additionalProperties: false
      required:
        - schema_version
        - policy_id
        - policy_version
        - bindings
        - currency_policy
        - amount_families
        - event_amount_rules
        - cross_event_constraints
        - rounding
        - guardrails
        - realism_targets
      properties:
        schema_version: { type: integer, const: 1 }
        policy_id: { type: string, const: amount_model_6B }
        policy_version: { type: string, const: v1 }
        bindings:
          type: object
          additionalProperties: false
          required:
            - rng_family_for_amount_base_draw
            - rng_family_for_amount_jitter_draw
          properties:
            rng_family_for_amount_base_draw: { type: string }
            rng_family_for_amount_jitter_draw: { type: string }
            rng_family_for_currency_cross_draw: { type: string }
        currency_policy:
          type: object
          additionalProperties: false
          required: [mode]
          properties:
            mode:
              type: string
              enum: [MERCHANT_PRIMARY_ONLY, MERCHANT_PRIMARY_PLUS_CROSS_CURRENCY]
            allowed_channel_groups:
              type: array
              items: { type: string }
            cross_currency_prob_by_channel:
              type: object
              additionalProperties: { $ref: "#/$defs/probability" }
            fx_surface_ref:
              type: object
              additionalProperties: true
        amount_families:
          type: object
          additionalProperties:
            type: object
            additionalProperties: false
            required: [base_distribution]
            properties:
              base_distribution: { $ref: "#/$defs/amount_distribution_v1" }
              notes: { type: string }
        event_amount_rules:
          type: object
          additionalProperties: false
          required: [rules]
          properties:
            rules:
              type: array
              items:
                type: object
                additionalProperties: false
                required: [rule_id, amount_family, applies_to, sign, base_draw]
                properties:
                  rule_id: { type: string }
                  amount_family: { type: string }
                  applies_to:
                    type: object
                    additionalProperties: false
                    required: [channel_groups, event_types]
                    properties:
                      channel_groups:
                        type: array
                        items: { type: string }
                      event_types:
                        type: array
                        items: { type: string }
                  sign:
                    type: string
                    enum: [POSITIVE, NEGATIVE]
                  base_draw:
                    type: object
                    additionalProperties: false
                    required: [enabled, family]
                    properties:
                      enabled: { type: boolean }
                      family: { type: string }
                  notes: { type: string }
        cross_event_constraints:
          type: object
          additionalProperties: false
          required: [clearing_amount, refund_amount, reversal_amount]
          properties:
            clearing_amount:
              type: object
              additionalProperties: false
              required: [mode, delta, apply_when_event_types_present]
              properties:
                mode:
                  type: string
                  enum: [auth_times_one_plus_delta_v1]
                delta:
                  type: object
                  additionalProperties: false
                  required: [enabled, dist_id, delta_abs_max]
                  properties:
                    enabled: { type: boolean }
                    family: { type: string }
                    dist_id:
                      type: string
                      enum: [UNIFORM_SYMMETRIC_V1]
                    delta_abs_max: { type: number }
                apply_when_event_types_present:
                  type: array
                  items: { type: string }
            refund_amount:
              type: object
              additionalProperties: false
              required: [mode, refund_fraction, sign, apply_when_event_types_present]
              properties:
                mode:
                  type: string
                  enum: [negative_fraction_of_clearing_v1]
                refund_fraction:
                  type: object
                  additionalProperties: false
                  required: [allow_partial, partial_prob, partial_fraction_range, full_prob]
                  properties:
                    allow_partial: { type: boolean }
                    partial_prob: { $ref: "#/$defs/probability" }
                    partial_fraction_range: { $ref: "#/$defs/range_min_max" }
                    full_prob: { $ref: "#/$defs/probability" }
                sign:
                  type: string
                  enum: [NEGATIVE]
                apply_when_event_types_present:
                  type: array
                  items: { type: string }
            reversal_amount:
              type: object
              additionalProperties: false
              required: [mode, sign, apply_when_event_types_present]
              properties:
                mode:
                  type: string
                  enum: [negative_of_auth_v1, negative_of_clearing_v1]
                sign:
                  type: string
                  enum: [NEGATIVE]
                apply_when_event_types_present:
                  type: array
                  items: { type: string }
        rounding:
          type: object
          additionalProperties: false
          required: [mode, rounding_mode]
          properties:
            mode:
              type: string
              enum: [minor_units]
            amount_dp_by_currency:
              type: object
              additionalProperties: { type: integer, minimum: 0 }
            default_dp: { type: integer, minimum: 0 }
            rounding_mode:
              type: string
              enum: [round_half_even]
            clamp_min_minor_by_currency:
              type: object
              additionalProperties: { type: integer }
            clamp_max_minor_by_currency:
              type: object
              additionalProperties: { type: integer }
          anyOf:
            - required: [default_dp]
            - required: [amount_dp_by_currency]
        guardrails:
          type: object
          additionalProperties: false
          properties:
            max_amount_minor_by_currency:
              type: object
              additionalProperties: { type: integer }
            min_amount_minor_by_currency:
              type: object
              additionalProperties: { type: integer }
            max_refund_fraction: { $ref: "#/$defs/probability" }
            max_clearing_delta_abs: { type: number }
            max_fee_fraction: { $ref: "#/$defs/probability" }
        realism_targets:
          type: object
          additionalProperties: false
          required:
            - median_minor_range_by_family
            - p95_minor_range_by_family
            - heavy_tail_ratio_range_by_family
            - fraction_round_price_points_min
            - decline_amount_distribution_same_as_approved
          properties:
            median_minor_range_by_family:
              type: object
              additionalProperties: { $ref: "#/$defs/range_min_max_int" }
            p95_minor_range_by_family:
              type: object
              additionalProperties: { $ref: "#/$defs/range_min_max_int" }
            heavy_tail_ratio_range_by_family:
              type: object
              additionalProperties: { $ref: "#/$defs/range_min_max" }
            fraction_round_price_points_min:
              type: object
              additionalProperties: { $ref: "#/$defs/probability" }
            decline_amount_distribution_same_as_approved: { type: boolean }
        notes: { type: string }
    timing_policy_6B:
      $id: "#/policy/timing_policy_6B"
      type: object
      description: "Timing policy for S2."
      additionalProperties: false
      required:
        - schema_version
        - policy_id
        - policy_version
        - bindings
        - time_units
        - anchor_rules
        - offset_models
        - composition_rules
        - guardrails
        - realism_targets
      properties:
        schema_version: { type: integer, const: 1 }
        policy_id: { type: string, const: timing_policy_6B }
        policy_version: { type: string, const: v1 }
        bindings:
          type: object
          additionalProperties: false
          required:
            - channel_groups
            - event_type_vocab
            - rng_family_for_timing_draw
          properties:
            channel_groups:
              type: array
              items: { type: string }
            event_type_vocab:
              type: array
              items: { type: string }
            rng_family_for_timing_draw: { type: string }
            rng_family_for_anchor_jitter: { type: string }
            no_run_id_in_key: { type: boolean }
        time_units:
          type: object
          additionalProperties: false
          required:
            - timestamp_resolution
            - offset_unit
          properties:
            timestamp_resolution:
              type: string
              enum: [microsecond]
            offset_unit:
              type: string
              enum: [seconds]
            min_positive_offset_seconds: { type: number }
        anchor_rules:
          type: object
          additionalProperties: true
        offset_models:
          type: object
          additionalProperties: true
        composition_rules:
          type: object
          additionalProperties: false
          required:
            - monotone_mode
            - if_violation
          properties:
            monotone_mode:
              type: string
              enum: [nondecreasing, strictly_increasing]
            strict_increase_epsilon_seconds: { type: number }
            if_violation:
              type: string
              enum: [FAIL]
            arrival_jitter:
              type: object
              additionalProperties: false
              properties:
                enabled: { type: boolean }
                jitter_microseconds_max: { type: integer }
                rng_family: { type: string }
        guardrails:
          type: object
          additionalProperties: true
        realism_targets:
          type: object
          additionalProperties: true
        notes: { type: string }
    flow_rng_policy_6B:
      $id: "#/policy/flow_rng_policy_6B"
      type: object
      description: "RNG policy for S2 flows."
      additionalProperties: false
      required:
        - schema_version
        - policy_id
        - policy_version
        - rng_profile_ref
        - families
        - keying
        - sampling_primitives
        - emission_rules
        - guardrails
      properties:
        schema_version: { type: integer, const: 1 }
        policy_id: { type: string, const: flow_rng_policy_6B }
        policy_version: { type: string, const: v1 }
        rng_profile_ref:
          type: object
          additionalProperties: false
          required: [policy_id, required]
          properties:
            policy_id: { type: string, const: rng_profile_layer3 }
            required: { type: boolean }
        families:
          type: array
          items:
            type: object
            additionalProperties: true
            required: [family_id]
            properties:
              family_id: { type: string }
            required: [family_id]
            properties:
              family_id: { type: string }
        keying:
          type: object
          additionalProperties: false
          properties:
            forbid_run_id_in_key: { type: boolean }
            decision_id_field: { type: string }
            event_index_field: { type: string }
        sampling_primitives:
          type: object
          additionalProperties: false
          properties:
            discrete_choice_draws: { type: string }
            timing_offset_draws_per_event_slot: { type: string }
            amount_draws_per_amount_bearing_event_slot: { type: string }
            forbid_rejection_sampling: { type: boolean }
        emission_rules:
          type: object
          additionalProperties: false
          properties:
            require_non_consuming_envelopes_when_deterministic: { type: boolean }
            forbid_data_dependent_family_selection: { type: boolean }
            forbid_data_dependent_budget_variation: { type: boolean }
        guardrails:
          type: object
          additionalProperties: false
          properties:
            forbid_unknown_families: { type: boolean }
            forbid_variable_budgets: { type: boolean }
        notes: { type: string }
    fraud_campaign_catalogue_config_6B:
      $id: "#/policy/fraud_campaign_catalogue_config_6B"
      type: object
      description: "Fraud campaign catalogue configuration for S3."
      additionalProperties: false
      required:
        - schema_version
        - config_id
        - config_version
        - vocabulary
        - templates
        - activation_models
        - schedule_models
        - quota_models
        - targeting_filters
        - guardrails
        - realism_targets
        properties:
          schema_version: { type: integer, const: 1 }
          config_id: { type: string, const: fraud_campaign_catalogue_config_6B }
          config_version: { type: string, const: v1 }
          vocabulary:
            type: object
            additionalProperties: false
            required:
              - campaign_type_vocab
              - fraud_family_vocab
              - target_kind_vocab
              - target_entity_kind_vocab
              - channel_group_vocab
            properties:
              campaign_type_vocab:
                type: array
                items: { type: string }
              fraud_family_vocab:
                type: array
                items: { type: string }
              target_kind_vocab:
                type: array
                items: { type: string }
              target_entity_kind_vocab:
                type: array
                items: { type: string }
              channel_group_vocab:
                type: array
                items: { type: string }
              tactic_vocab:
                type: array
                items: { type: string }
          templates:
            type: array
            items:
              type: object
              additionalProperties: false
              required:
                - template_id
                - campaign_type
                - fraud_family
                - description
                - target_kind
                - activation_model_id
                - schedule_model_id
                - quota_model_id
                - filters_id
                - channel_groups_allowed
                - requires_instrument
                - requires_device
                - requires_ip
                - max_instances_per_seed
                - max_targets_per_instance
                - min_targets_per_instance
              properties:
                template_id: { type: string }
                campaign_type: { type: string }
                fraud_family: { type: string }
                description: { type: string }
                target_kind: { type: string }
                target_entity_kind: { type: string }
                target_flow_scope: { type: string }
                activation_model_id: { type: string }
                schedule_model_id: { type: string }
                quota_model_id: { type: string }
                filters_id: { type: string }
                channel_groups_allowed:
                  type: array
                  items: { type: string }
                requires_instrument: { type: boolean }
                requires_device: { type: boolean }
                requires_ip: { type: boolean }
                max_instances_per_seed: { type: integer, minimum: 0 }
                max_targets_per_instance: { type: integer, minimum: 0 }
                min_targets_per_instance: { type: integer, minimum: 0 }
          activation_models:
            type: object
            additionalProperties:
              type: object
              additionalProperties: false
              required:
                - mode
                - rng_family
                - key_ids
              properties:
                mode:
                  type: string
                  enum: [DETERMINISTIC, POISSON_V1, CATEGORICAL_V1]
                n_instances: { type: integer }
                lambda: { type: number }
                support:
                  type: array
                  items: { type: integer }
                prob:
                  type: array
                  items: { $ref: "#/$defs/probability" }
                rng_family: { type: string }
                key_ids:
                  type: array
                  items: { type: string }
          schedule_models:
            type: object
            additionalProperties:
              type: object
              additionalProperties: false
              required:
                - mode
                - time_basis
              properties:
                mode:
                  type: string
                  enum: [FULL_SCENARIO, FIXED_WINDOW_V1, MULTI_WINDOW_V1]
                time_basis:
                  type: string
                  enum: [UTC, LOCAL_TZID]
                start_offset_seconds: { type: number }
                duration_seconds: { type: number }
                repeat_every_seconds: { type: number }
                repeat_count: { type: integer }
                rng_family: { type: string }
          quota_models:
            type: object
            additionalProperties:
              type: object
              additionalProperties: false
              required: [mode]
              properties:
                mode: { type: string }
                targets_per_day: { type: integer }
                burstiness: { type: number }
                rng_family: { type: string }
                key_ids:
                  type: array
                  items: { type: string }
          targeting_filters:
            type: object
            additionalProperties:
              type: object
              additionalProperties: false
              properties:
                entity_filters:
                  type: object
                  additionalProperties: true
                flow_filters:
                  type: object
                  additionalProperties: true
                device_ip_filters:
                  type: object
                  additionalProperties: true
                weighting:
                  type: object
                  additionalProperties: true
          guardrails:
            type: object
            additionalProperties: true
          realism_targets:
            type: object
            additionalProperties: true
        notes: { type: string }
    fraud_overlay_policy_6B:
      $id: "#/policy/fraud_overlay_policy_6B"
      type: object
      description: "Fraud overlay policy for S3."
      additionalProperties: false
      required:
        - schema_version
        - policy_id
        - policy_version
        - vocabulary
        - tactics
        - campaign_to_tactics
        - mutation_rules
        - constraints
        - provenance
        - guardrails
        - realism_targets
      properties:
        schema_version: { type: integer, const: 1 }
        policy_id: { type: string, const: fraud_overlay_policy_6B }
        policy_version: { type: string, const: v1 }
        vocabulary:
          type: object
          additionalProperties: false
          required:
            - tactic_vocab
            - mutation_axis_vocab
            - event_type_vocab
            - flow_type_vocab
            - channel_group_vocab
          properties:
            tactic_vocab:
              type: array
              items: { type: string }
            mutation_axis_vocab:
              type: array
              items: { type: string }
            event_type_vocab:
              type: array
              items: { type: string }
            flow_type_vocab:
              type: array
              items: { type: string }
            channel_group_vocab:
              type: array
              items: { type: string }
            routing_anomaly_vocab:
              type: array
              items: { type: string }
            identity_swap_vocab:
              type: array
              items: { type: string }
        tactics:
          type: array
          items:
            type: object
            additionalProperties: false
            required:
              - tactic_id
              - axis
              - description
              - allowed_target_kind
              - allowed_channel_groups
              - allowed_flow_types
              - requires
              - mutation_spec
            properties:
              tactic_id: { type: string }
              axis: { type: string }
              description: { type: string }
              allowed_target_kind: { type: string }
              allowed_channel_groups:
                type: array
                items: { type: string }
              allowed_flow_types:
                type: array
                items: { type: string }
              requires:
                type: object
                additionalProperties: { type: boolean }
              forbids:
                type: object
                additionalProperties: { type: boolean }
              rng_decision_points:
                type: array
                items: { type: string }
              mutation_spec:
                type: object
                additionalProperties: true
        campaign_to_tactics:
          type: array
          items:
            type: object
            additionalProperties: false
            required:
              - campaign_type
              - selection_mode
              - allowed_tactics
            properties:
              campaign_type: { type: string }
              selection_mode:
                type: string
                enum: [MIXTURE_V1]
              allowed_tactics:
                type: array
                items:
                  type: object
                  additionalProperties: false
                  required: [tactic_id, weight]
                  properties:
                    tactic_id: { type: string }
                    weight: { $ref: "#/$defs/probability" }
        mutation_rules:
          type: object
          additionalProperties: false
          required: [axis_defaults]
          properties:
            axis_defaults:
              type: object
              additionalProperties: true
        constraints:
          type: object
          additionalProperties: false
          properties:
            fail_on_missing_tactic: { type: boolean }
            fail_on_incompatible_target: { type: boolean }
            forbid_out_of_universe_routing: { type: boolean }
            forbid_schema_invariant_breaks: { type: boolean }
            forbid_time_travel: { type: boolean }
            forbid_amount_sign_violations: { type: boolean }
            forbid_unbounded_loops: { type: boolean }
        provenance:
          type: object
          additionalProperties: false
          properties:
            require_campaign_id: { type: boolean }
            require_tactic_id: { type: boolean }
            require_mutation_rule_id: { type: boolean }
            require_rng_family_and_decision_id: { type: boolean }
        guardrails:
          type: object
          additionalProperties: false
          properties:
            max_targets_total_per_seed_scenario: { type: integer }
            max_mutations_per_flow: { type: integer }
            max_new_flows_created_per_seed_scenario: { type: integer }
            max_event_inserts_per_flow: { type: integer }
            max_event_suppressions_per_flow: { type: integer }
            max_amount_multiplier: { type: number }
            max_time_multiplier: { type: number }
        realism_targets:
          type: object
          additionalProperties: false
          properties:
            mutation_axis_coverage_min: { type: integer }
            amount_shift_factor_range: { $ref: "#/$defs/range_min_max" }
            routing_anomaly_fraction_range: { $ref: "#/$defs/range_min_max" }
            identity_swap_fraction_range: { $ref: "#/$defs/range_min_max" }
            time_anomaly_fraction_range: { $ref: "#/$defs/range_min_max" }
            structure_anomaly_fraction_range: { $ref: "#/$defs/range_min_max" }
        notes: { type: string }
    fraud_rng_policy_6B:
      $id: "#/policy/fraud_rng_policy_6B"
      type: object
      description: "RNG policy for S3 fraud overlays."
      additionalProperties: false
      required:
        - schema_version
        - policy_id
        - policy_version
        - rng_profile_ref
        - families
        - keying
        - sampling_primitives
        - emission_rules
        - guardrails
      properties:
        schema_version: { type: integer, const: 1 }
        policy_id: { type: string, const: fraud_rng_policy_6B }
        policy_version: { type: string, const: v1 }
        rng_profile_ref:
          type: object
          additionalProperties: false
          required: [policy_id, required]
          properties:
            policy_id: { type: string, const: rng_profile_layer3 }
            required: { type: boolean }
        families:
          type: array
          items:
            type: object
            additionalProperties: true
            required: [family_id]
            properties:
              family_id: { type: string }
        keying:
          type: object
          additionalProperties: false
          properties:
            forbid_run_id_in_key: { type: boolean }
            decision_id_field: { type: string }
            target_id_format: { type: string }
            indices_are_zero_based: { type: boolean }
        sampling_primitives:
          type: object
          additionalProperties: false
          properties:
            discrete_choice_draws: { type: string }
            forbid_rejection_sampling: { type: boolean }
            forbid_variable_draws_per_locus: { type: boolean }
        emission_rules:
          type: object
          additionalProperties: false
          properties:
            require_non_consuming_envelopes_when_deterministic: { type: boolean }
            forbid_unknown_families: { type: boolean }
            forbid_data_dependent_budget_variation: { type: boolean }
        guardrails:
          type: object
          additionalProperties: false
          properties:
            max_mutation_steps_per_target: { type: integer }
            max_target_picks_per_campaign_instance: { type: integer }
        notes: { type: string }
    truth_labelling_policy_6B:
      $id: "#/policy/truth_labelling_policy_6B"
      type: object
      description: "Truth labelling policy for S4."
      additionalProperties: false
      required:
        - schema_version
        - policy_id
        - policy_version
        - vocabulary
        - precedence
        - direct_pattern_map
        - collateral_rules
        - posture_overrides
        - ambiguity_models
        - event_truth_roles
        - provenance
        - constraints
        - realism_targets
      properties:
        schema_version: { type: integer, const: 1 }
        policy_id: { type: string, const: truth_labelling_policy_6B }
        policy_version: { type: string, const: v1 }
        vocabulary:
          type: object
          additionalProperties: false
          required:
            - truth_label_vocab
            - truth_subtype_vocab
            - pattern_source_vocab
            - truth_event_role_vocab
          properties:
            truth_label_vocab:
              type: array
              items: { type: string }
            truth_subtype_vocab:
              type: array
              items: { type: string }
            pattern_source_vocab:
              type: array
              items: { type: string }
            truth_event_role_vocab:
              type: array
              items: { type: string }
        precedence:
          type: array
          items: { type: string }
        direct_pattern_map:
          type: array
          items:
            type: object
            additionalProperties: false
            required:
              - rule_id
              - match
              - truth_label
              - truth_subtype
              - pattern_source
              - requires_campaign_id
            properties:
              rule_id: { type: string }
              match: { type: object }
              truth_label: { type: string }
              truth_subtype: { type: string }
              pattern_source:
                type: string
                enum: [CAMPAIGN, COLLATERAL, HEURISTIC_ONLY]
              requires_campaign_id: { type: boolean }
        collateral_rules:
          type: array
          items:
            type: object
            additionalProperties: false
            required:
              - rule_id
              - anchor_condition
              - scope_entity
              - time_window_seconds
              - action
              - pattern_source
            properties:
              rule_id: { type: string }
              anchor_condition: { type: object }
              scope_entity: { type: string }
              time_window_seconds: { type: number, minimum: 0 }
              action: { type: object }
              pattern_source:
                type: string
                enum: [COLLATERAL, HEURISTIC_ONLY]
        posture_overrides:
          type: array
          items:
            type: object
            additionalProperties: true
        ambiguity_models:
          type: array
          items:
            type: object
            additionalProperties: false
            required:
              - model_id
              - when
              - candidates
              - rng_family
              - decision_id
              - draws_required
              - pattern_source
            properties:
              model_id: { type: string }
              when: { type: object }
              candidates:
                type: array
                items:
                  type: object
                  additionalProperties: false
                  required: [truth_label, truth_subtype, prob]
                  properties:
                    truth_label: { type: string }
                    truth_subtype: { type: string }
                    prob: { $ref: "#/$defs/probability" }
              rng_family: { type: string }
              decision_id: { type: string }
              draws_required: { type: string }
              pattern_source:
                type: string
                enum: [COLLATERAL, HEURISTIC_ONLY]
        event_truth_roles:
          type: object
          additionalProperties: true
        provenance:
          type: object
          additionalProperties: true
        constraints:
          type: object
          additionalProperties: false
          properties:
            fail_on_unknown_fraud_pattern_type: { type: boolean }
            fail_on_unknown_truth_subtype: { type: boolean }
            require_campaign_consistency: { type: boolean }
            require_full_flow_coverage: { type: boolean }
            require_full_event_coverage: { type: boolean }
        realism_targets:
          type: object
          additionalProperties: true
        notes: { type: string }
    bank_view_policy_6B:
      $id: "#/policy/bank_view_policy_6B"
      type: object
      description: "Bank-view policy for S4."
      additionalProperties: false
      required:
        - schema_version
        - policy_id
        - policy_version
        - vocabulary
        - inputs_allowed
        - auth_decision_model
        - detection_model
        - dispute_model
        - chargeback_model
        - case_lifecycle_model
        - final_label_map
        - event_label_hints
        - constraints
        - realism_targets
      properties:
        schema_version: { type: integer, const: 1 }
        policy_id: { type: string, const: bank_view_policy_6B }
        policy_version: { type: string, const: v1 }
        vocabulary:
          type: object
          additionalProperties: false
          required:
            - auth_decision_vocab
            - detection_outcome_vocab
            - bank_view_label_vocab
            - dispute_outcome_vocab
            - chargeback_outcome_vocab
          properties:
            auth_decision_vocab:
              type: array
              items: { type: string }
            detection_outcome_vocab:
              type: array
              items: { type: string }
            bank_view_label_vocab:
              type: array
              items: { type: string }
            chargeback_type_vocab:
              type: array
              items: { type: string }
            chargeback_outcome_vocab:
              type: array
              items: { type: string }
            dispute_outcome_vocab:
              type: array
              items: { type: string }
        inputs_allowed:
          type: object
          additionalProperties: false
          properties:
            required_sources:
              type: array
              items: { type: string }
            optional_sources:
              type: array
              items: { type: string }
        auth_decision_model:
          type: object
          additionalProperties: true
        detection_model:
          type: object
          additionalProperties: true
        dispute_model:
          type: object
          additionalProperties: true
        chargeback_model:
          type: object
          additionalProperties: true
        case_lifecycle_model:
          type: object
          additionalProperties: true
        final_label_map:
          type: object
          additionalProperties: true
        event_label_hints:
          type: object
          additionalProperties: true
        constraints:
          type: object
          additionalProperties: false
          properties:
            fail_on_unknown_enum: { type: boolean }
            require_one_row_per_flow: { type: boolean }
            require_timestamps_consistent_with_events: { type: boolean }
            forbid_time_travel: { type: boolean }
        realism_targets:
          type: object
          additionalProperties: false
          properties:
            false_positive_rate_range: { $ref: "#/$defs/range_min_max" }
            detection_rate_range_by_truth_label:
              type: object
              additionalProperties: { $ref: "#/$defs/range_min_max" }
        notes: { type: string }
    delay_models_6B:
      $id: "#/policy/delay_models_6B"
      type: object
      description: "Delay models for S4."
      additionalProperties: false
      required:
        - schema_version
        - policy_id
        - policy_version
        - time_units
        - model_vocab
        - delay_models
        - sampling_contract
        - guardrails
        - realism_targets
      properties:
        schema_version: { type: integer, const: 1 }
        policy_id: { type: string, const: delay_models_6B }
        policy_version: { type: string, const: v1 }
        time_units:
          type: object
          additionalProperties: false
          required:
            - timestamp_resolution
            - delay_unit
          properties:
            timestamp_resolution:
              type: string
              enum: [microsecond]
            delay_unit:
              type: string
              enum: [seconds]
            min_positive_delay_seconds: { type: number }
        model_vocab:
          type: object
          additionalProperties: false
          required: [dist_ids]
          properties:
            dist_ids:
              type: array
              items:
                type: string
                enum:
                  - EXPONENTIAL_QF_V1
                  - LOGNORMAL_QF_V1
                  - GAMMA_QF_V1
                  - DISCRETE_POINTS_V1
                  - POINT_MASS_PLUS_TAIL_V1
                  - MIXTURE_QF_V1
        delay_models:
          type: array
          items:
            type: object
            additionalProperties: false
            required:
              - delay_model_id
              - applies_to
              - anchor_kind
              - dist
              - min_seconds
              - max_seconds
              - rng_family
              - decision_id
            properties:
              delay_model_id: { type: string }
              applies_to:
                type: string
                enum: [POST_AUTH_DETECTION, DISPUTE, CHARGEBACK, CASE_CLOSE]
              anchor_kind:
                type: string
                enum: [AUTH_TS, CLEARING_TS, DISPUTE_TS, DETECTION_TS, CASE_OPEN_TS]
              dist:
                $ref: "#/$defs/delay_distribution_qf_v1"
              min_seconds: { type: number }
              max_seconds: { type: number }
              rng_family: { type: string }
              decision_id: { type: string }
              notes: { type: string }
        sampling_contract:
          type: object
          additionalProperties: false
          properties:
            draws_per_delay_sample: { type: string }
            forbid_rejection_sampling: { type: boolean }
            mixture_sampling:
              type: object
              additionalProperties: true
            quantile_inputs_open_interval_only: { type: boolean }
        guardrails:
          type: object
          additionalProperties: false
          properties:
            max_detection_delay_seconds: { type: number }
            max_dispute_delay_seconds: { type: number }
            max_chargeback_delay_seconds: { type: number }
            max_case_close_delay_seconds: { type: number }
            min_detection_delay_seconds: { type: number }
            min_dispute_delay_seconds: { type: number }
            min_chargeback_delay_seconds: { type: number }
        realism_targets:
          type: object
          additionalProperties: false
          properties:
            p50_seconds_range:
              type: object
              additionalProperties: { $ref: "#/$defs/range_min_max" }
            p95_seconds_range:
              type: object
              additionalProperties: { $ref: "#/$defs/range_min_max" }
            heavy_tail_ratio_range:
              type: object
              additionalProperties: { $ref: "#/$defs/range_min_max" }
            presence_requirements:
              type: object
              additionalProperties: { type: boolean }
        notes: { type: string }
    case_policy_6B:
      $id: "#/policy/case_policy_6B"
      type: object
      description: "Case policy for S4."
      additionalProperties: false
      required:
        - schema_version
        - policy_id
        - policy_version
        - vocabulary
        - case_involvement
        - case_key_model
        - case_grouping_model
        - case_id_model
        - case_event_model
        - state_machine
        - stochastic_splitting
        - guardrails
        - realism_targets
      properties:
        schema_version: { type: integer, const: 1 }
        policy_id: { type: string, const: case_policy_6B }
        policy_version: { type: string, const: v1 }
        vocabulary:
          type: object
          additionalProperties: false
          properties:
            case_event_type_vocab:
              type: array
              items: { type: string }
            case_type_vocab:
              type: array
              items: { type: string }
            case_outcome_vocab:
              type: array
              items: { type: string }
            case_key_type_vocab:
              type: array
              items: { type: string }
        case_involvement:
          type: object
          additionalProperties: false
          properties:
            case_trigger_labels:
              type: array
              items: { type: string }
            predicate: { type: string }
        case_key_model:
          type: object
          additionalProperties: false
          properties:
            precedence:
              type: array
              items: { type: string }
            encoding: { type: string }
            allow_time_bucket: { type: boolean }
            time_bucket_law: { type: string }
        case_grouping_model:
          type: object
          additionalProperties: false
          properties:
            case_anchor_ts_source: { type: string }
            group_window_seconds: { type: number }
            reopen_gap_seconds: { type: number }
            order_by:
              type: array
              items: { type: string }
        case_id_model:
          type: object
          additionalProperties: false
          properties:
            mode: { type: string }
            domain_tag: { type: string }
            inputs:
              type: array
              items: { type: string }
            output_format: { type: string }
        case_event_model:
          type: object
          additionalProperties: false
          properties:
            event_order:
              type: array
              items: { type: string }
            timestamp_sources:
              type: object
              additionalProperties: { type: string }
        state_machine:
          type: object
          additionalProperties: true
        stochastic_splitting:
          type: object
          additionalProperties: true
        guardrails:
          type: object
          additionalProperties: true
        realism_targets:
          type: object
          additionalProperties: true
        notes: { type: string }
    label_rng_policy_6B:
      $id: "#/policy/label_rng_policy_6B"
      type: object
      description: "RNG policy for S4 labelling."
      additionalProperties: false
      required:
        - schema_version
        - policy_id
        - policy_version
        - rng_profile_ref
        - families
        - keying
        - sampling_primitives
        - emission_rules
        - guardrails
      properties:
        schema_version: { type: integer, const: 1 }
        policy_id: { type: string, const: label_rng_policy_6B }
        policy_version: { type: string, const: v1 }
        rng_profile_ref:
          type: object
          additionalProperties: false
          required: [policy_id, required]
          properties:
            policy_id: { type: string, const: rng_profile_layer3 }
            required: { type: boolean }
        families:
          type: array
          items:
            type: object
            additionalProperties: true
            required: [family_id]
            properties:
              family_id: { type: string }
        keying:
          type: object
          additionalProperties: false
          properties:
            forbid_run_id_in_key: { type: boolean }
            indices_are_zero_based: { type: boolean }
            decision_id_field: { type: string }
        sampling_primitives:
          type: object
          additionalProperties: false
          properties:
            discrete_choice_draws: { type: string }
            delay_draws_per_sample: { type: string }
            forbid_rejection_sampling: { type: boolean }
            forbid_variable_draws_per_locus: { type: boolean }
        emission_rules:
          type: object
          additionalProperties: false
          properties:
            require_non_consuming_envelopes_when_deterministic: { type: boolean }
            forbid_unknown_families: { type: boolean }
            forbid_data_dependent_budget_variation: { type: boolean }
        guardrails:
          type: object
          additionalProperties: false
          properties:
            max_rng_events_per_flow: { type: integer }
            max_rng_events_per_case: { type: integer }
        notes: { type: string }
    segment_validation_policy_6B:
      $id: "#/policy/segment_validation_policy_6B"
      type: object
      description: "Validation policy for S5."
      additionalProperties: false
      required:
        - schema_version
        - policy_id
        - policy_version
        - seal_rules
        - check_groups
        - checks
        - thresholds
        - rng_accounting
        - realism_corridors
        - reporting
      properties:
        schema_version: { type: integer, const: 1 }
        policy_id: { type: string, const: segment_validation_policy_6B }
        policy_version: { type: string, const: v1 }
        seal_rules:
          type: object
          additionalProperties: false
          required:
            - fail_on_any_required_failure
            - fail_on_any_warn_failure
            - info_never_blocks_pass
            - required_check_min_coverage
            - bundle_hashing_law
          properties:
            fail_on_any_required_failure: { type: boolean }
            fail_on_any_warn_failure: { type: boolean }
            warn_still_pass_max_fraction: { $ref: "#/$defs/probability" }
            info_never_blocks_pass: { type: boolean }
            required_check_min_coverage: { $ref: "#/$defs/probability" }
            bundle_hashing_law:
              type: object
              additionalProperties: true
        check_groups:
          type: array
          items:
            type: object
            additionalProperties: false
            required: [group_id]
            properties:
              group_id: { type: string }
              description: { type: string }
        checks:
          type: array
          items:
            type: object
            additionalProperties: false
            required:
              - check_id
              - group_id
              - severity
              - applies_to
              - expected_scope
              - method
            properties:
              check_id: { type: string }
              group_id: { type: string }
              severity:
                type: string
                enum: [REQUIRED, WARN, INFO]
              applies_to:
                type: array
                items: { type: string }
              expected_scope: { type: string }
              method: { type: string }
              threshold_ref: { type: string }
              fail_message: { type: string }
              notes: { type: string }
        thresholds:
          type: object
          additionalProperties: true
        rng_accounting:
          type: object
          additionalProperties: true
        realism_corridors:
          type: object
          additionalProperties: true
        reporting:
          type: object
          additionalProperties: true
        notes: { type: string }

s1:
  description: "State 6B.S1 outputs"
  additionalProperties: false
  properties:
    arrival_entities_6B:
      $id: "#/s1/arrival_entities_6B"
      type: object
      description: "Row in s1_arrival_entities_6B (arrival enriched with session + entity attachments)."
      additionalProperties: true
      required:
        - scenario_id
        - arrival_seq
        - merchant_id
        - ts_utc
        - party_id
        - account_id
        - instrument_id
        - device_id
        - ip_id
        - session_id
        - seed
        - manifest_fingerprint
        - parameter_hash
      properties:
        scenario_id: { type: string }
        arrival_seq: { type: integer }
        merchant_id: { type: integer }
        ts_utc: { type: string }
        party_id: { type: integer }
        account_id: { type: integer }
        instrument_id: { type: integer }
        device_id: { type: integer }
        ip_id: { type: integer }
        session_id: { type: integer }
        seed: { type: integer }
        manifest_fingerprint: { $ref: "#/$defs/hex64" }
        parameter_hash: { $ref: "#/$defs/hex64" }
    session_index_6B:
      $id: "#/s1/session_index_6B"
      type: object
      description: "Row in s1_session_index_6B (one session entry with participants and anchor metadata)."
      additionalProperties: false
      required:
        - session_id
        - arrival_count
        - session_start_utc
        - session_end_utc
      properties:
        session_id: { type: integer }
        arrival_count: { type: integer }
        session_start_utc: { type: string }
        session_end_utc: { type: string }
        seed: { type: integer }
        manifest_fingerprint: { $ref: "#/$defs/hex64" }
        scenario_id: { type: string }
        party_id: { type: integer }
        device_id: { type: integer }
        account_id: { type: integer }
        instrument_id: { type: integer }
        merchant_id: { type: integer }

s2:
  description: "State 6B.S2 outputs"
  additionalProperties: false
  properties:
    flow_anchor_baseline_6B:
      $id: "#/s2/flow_anchor_baseline_6B"
      type: object
      description: "Baseline (all-legit) flow/transaction anchor row."
      additionalProperties: false
      required:
        - flow_id
        - arrival_seq
        - merchant_id
        - party_id
        - account_id
        - instrument_id
        - device_id
        - ip_id
        - ts_utc
        - amount
        - seed
        - manifest_fingerprint
        - parameter_hash
        - scenario_id
      properties:
        flow_id: { type: integer }
        arrival_seq: { type: integer }
        merchant_id: { type: integer }
        party_id: { type: integer }
        account_id: { type: integer }
        instrument_id: { type: integer }
        device_id: { type: integer }
        ip_id: { type: integer }
        ts_utc: { type: string }
        amount: { type: number }
        seed: { type: integer }
        manifest_fingerprint: { $ref: "#/$defs/hex64" }
        parameter_hash: { $ref: "#/$defs/hex64" }
        scenario_id: { type: string }
    event_stream_baseline_6B:
      $id: "#/s2/event_stream_baseline_6B"
      type: object
      description: "Baseline event stream row for authorisation/clearing/refund events."
      additionalProperties: false
      required:
        - flow_id
        - event_seq
        - event_type
        - ts_utc
        - amount
        - seed
        - manifest_fingerprint
        - parameter_hash
        - scenario_id
      properties:
        flow_id: { type: integer }
        event_seq: { type: integer }
        event_type: { type: string }
        ts_utc: { type: string }
        amount: { type: number }
        seed: { type: integer }
        manifest_fingerprint: { $ref: "#/$defs/hex64" }
        parameter_hash: { $ref: "#/$defs/hex64" }
        scenario_id: { type: string }

s3:
  description: "State 6B.S3 outputs"
  additionalProperties: false
  properties:
    campaign_catalogue_6B:
      $id: "#/s3/campaign_catalogue_6B"
      type: object
      description: "Fraud/abuse campaign catalogue row."
      additionalProperties: false
      required:
        - campaign_id
        - campaign_label
        - fraud_rate
        - scenario_id
        - seed
        - manifest_fingerprint
        - parameter_hash
      properties:
        campaign_id: { type: string }
        campaign_label: { type: string }
        fraud_rate: { type: number }
        scenario_id: { type: string }
        seed: { type: integer }
        manifest_fingerprint: { $ref: "#/$defs/hex64" }
        parameter_hash: { $ref: "#/$defs/hex64" }
    flow_anchor_with_fraud_6B:
      $id: "#/s3/flow_anchor_with_fraud_6B"
      type: object
      description: "Flow anchor row after fraud overlays have been applied."
      additionalProperties: false
      required:
        - flow_id
        - arrival_seq
        - merchant_id
        - party_id
        - account_id
        - instrument_id
        - device_id
        - ip_id
        - ts_utc
        - amount
        - seed
        - manifest_fingerprint
        - parameter_hash
        - scenario_id
        - fraud_flag
        - campaign_id
      properties:
        flow_id: { type: integer }
        arrival_seq: { type: integer }
        merchant_id: { type: integer }
        party_id: { type: integer }
        account_id: { type: integer }
        instrument_id: { type: integer }
        device_id: { type: integer }
        ip_id: { type: integer }
        ts_utc: { type: string }
        amount: { type: number }
        seed: { type: integer }
        manifest_fingerprint: { $ref: "#/$defs/hex64" }
        parameter_hash: { $ref: "#/$defs/hex64" }
        scenario_id: { type: string }
        fraud_flag: { type: boolean }
        campaign_id: { type: ["null", "string"] }
    event_stream_with_fraud_6B:
      $id: "#/s3/event_stream_with_fraud_6B"
      type: object
      description: "Event stream row with injected fraud behaviours."
      additionalProperties: false
      required:
        - flow_id
        - event_seq
        - event_type
        - ts_utc
        - amount
        - seed
        - manifest_fingerprint
        - parameter_hash
        - scenario_id
        - fraud_flag
        - campaign_id
      properties:
        flow_id: { type: integer }
        event_seq: { type: integer }
        event_type: { type: string }
        ts_utc: { type: string }
        amount: { type: number }
        seed: { type: integer }
        manifest_fingerprint: { $ref: "#/$defs/hex64" }
        parameter_hash: { $ref: "#/$defs/hex64" }
        scenario_id: { type: string }
        fraud_flag: { type: boolean }
        campaign_id: { type: ["null", "string"] }

s4:
  description: "State 6B.S4 outputs"
  additionalProperties: false
  properties:
    flow_truth_labels_6B:
      $id: "#/s4/flow_truth_labels_6B"
      type: object
      description: "Flow-level ground truth row."
      additionalProperties: false
      required:
        - flow_id
        - is_fraud_truth
        - fraud_label
        - seed
        - manifest_fingerprint
        - parameter_hash
        - scenario_id
      properties:
        flow_id: { type: integer }
        is_fraud_truth: { type: boolean }
        fraud_label: { type: ["null", "string"] }
        seed: { type: integer }
        manifest_fingerprint: { $ref: "#/$defs/hex64" }
        parameter_hash: { $ref: "#/$defs/hex64" }
        scenario_id: { type: string }
    flow_bank_view_6B:
      $id: "#/s4/flow_bank_view_6B"
      type: object
      description: "Flow view as seen by the bank/institution."
      additionalProperties: false
      required:
        - flow_id
        - is_fraud_bank_view
        - bank_label
        - seed
        - manifest_fingerprint
        - parameter_hash
        - scenario_id
      properties:
        flow_id: { type: integer }
        is_fraud_bank_view: { type: boolean }
        bank_label: { type: ["null", "string"] }
        seed: { type: integer }
        manifest_fingerprint: { $ref: "#/$defs/hex64" }
        parameter_hash: { $ref: "#/$defs/hex64" }
        scenario_id: { type: string }
    event_labels_6B:
      $id: "#/s4/event_labels_6B"
      type: object
      description: "Event-level truth/bank view labels."
      additionalProperties: false
      required:
        - flow_id
        - event_seq
        - is_fraud_truth
        - is_fraud_bank_view
        - seed
        - manifest_fingerprint
        - parameter_hash
        - scenario_id
      properties:
        flow_id: { type: integer }
        event_seq: { type: integer }
        is_fraud_truth: { type: boolean }
        is_fraud_bank_view: { type: boolean }
        seed: { type: integer }
        manifest_fingerprint: { $ref: "#/$defs/hex64" }
        parameter_hash: { $ref: "#/$defs/hex64" }
        scenario_id: { type: string }
    case_timeline_6B:
      $id: "#/s4/case_timeline_6B"
      type: object
      description: "Timeline of case events produced during adjudication."
      additionalProperties: false
      required:
        - case_id
        - case_event_seq
        - flow_id
        - case_event_type
        - ts_utc
        - seed
        - manifest_fingerprint
        - parameter_hash
        - scenario_id
      properties:
        case_id: { type: integer }
        case_event_seq: { type: integer }
        flow_id: { type: integer }
        case_event_type: { type: string }
        ts_utc: { type: string }
        seed: { type: integer }
        manifest_fingerprint: { $ref: "#/$defs/hex64" }
        parameter_hash: { $ref: "#/$defs/hex64" }
        scenario_id: { type: string }
