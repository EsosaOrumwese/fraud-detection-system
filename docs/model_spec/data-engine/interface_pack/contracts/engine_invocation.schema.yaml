# contracts/engine_invocation.schema.yaml
version: "0.3.0"
$id: engine_invocation.schema.yaml
$schema: https://json-schema.org/draft/2020-12/schema
title: Data Engine Invocation Request
description: >
  Black-box invocation contract for starting an engine run. Defines only:
  (a) world + parameter + seed identity and (b) scenario binding and correlation ids.
  It intentionally does not expose segment/state internals.

$defs:
  hex64:
    $ref: "../layer-1/specs/contracts/1A/schemas.layer1.yaml#/$defs/hex64"
  hex32:
    $ref: "../layer-1/specs/contracts/1A/schemas.layer1.yaml#/$defs/hex32"
  uint64:
    $ref: "../layer-1/specs/contracts/1A/schemas.layer1.yaml#/$defs/uint64"

  scenario_id:
    description: Scenario identifier (opaque string token).
    type: string
    minLength: 1
    maxLength: 512

  scenario_binding:
    description: >
      Scenario binding for scenario-aware segments (e.g., Layer-2/5B). Either bind a single
      scenario_id or a finite explicit scenario_set. Baseline/no-overlay runs are represented
      by a normal scenario_id whose scenario definition contains no overlays.
    oneOf:
      - type: object
        additionalProperties: false
        required: [scenario_id]
        properties:
          scenario_id:
            $ref: "#/$defs/scenario_id"
      - type: object
        additionalProperties: false
        required: [scenario_set]
        properties:
          scenario_set:
            type: array
            minItems: 1
            uniqueItems: true
            items:
              $ref: "#/$defs/scenario_id"

type: object
additionalProperties: false
required:
  - manifest_fingerprint
  - parameter_hash
  - seed
  - run_id
  - scenario_binding

properties:
  manifest_fingerprint:
    description: World identity (sealed world inputs).
    $ref: "#/$defs/hex64"

  parameter_hash:
    description: Governed parameter bundle identity.
    $ref: "#/$defs/hex64"

  seed:
    description: RNG seed for this run realisation.
    $ref: "#/$defs/uint64"

  run_id:
    description: >
      Run correlation identifier. May partition logs/events but MUST NOT change the bytes of
      outputs whose identity does not include run_id.
    $ref: "#/$defs/hex32"

  scenario_binding:
    $ref: "#/$defs/scenario_binding"

  request_id:
    description: Optional idempotency key at the invocation boundary (client-provided).
    type: string
    minLength: 1
    maxLength: 128

  invoker:
    description: Optional caller identity (non-semantic).
    type: string
    minLength: 1
    maxLength: 128

  notes:
    description: Optional human notes (non-semantic).
    type: string
    maxLength: 2048
