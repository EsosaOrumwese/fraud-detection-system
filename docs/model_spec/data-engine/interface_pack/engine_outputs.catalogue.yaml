version: v1.0.0
generated_from:
- artefact_registry_{SEG}.yaml
- dataset_dictionary.layer{L}.{SEG}.yaml
- schemas.*.yaml
- state.*.expanded.txt
outputs:
- output_id: validation_bundle_1A
  layer: layer1
  segment: 1A
  class: gate_artifact
  description: Validator outputs for 1A (metrics, plots, diffs).
  path_template: data/layer1/1A/validation/fingerprint={manifest_fingerprint}/
  partitions:
  - fingerprint
  scope: fingerprint
  schema_ref: schemas.1A.yaml#/validation/validation_bundle
  dictionary_ref: layer1.1A:validation_bundle_1A
  primary_key: []
  join_keys: []
  read_requires_gates: []
  produced_by: 1A.validation
  consumed_by:
  - release
  final_in_layer: false
- output_id: validation_passed_flag_1A
  layer: layer1
  segment: 1A
  class: gate_artifact
  description: HashGate PASS flag for the 1A validation bundle.
  path_template: data/layer1/1A/validation/fingerprint={manifest_fingerprint}/_passed.flag
  partitions:
  - fingerprint
  scope: fingerprint
  schema_ref: schemas.layer1.yaml#/validation/passed_flag
  dictionary_ref: layer1.1A:validation_passed_flag_1A
  primary_key: []
  join_keys: []
  read_requires_gates: []
  produced_by: 1A.validation
  consumed_by:
  - release
  final_in_layer: false
- output_id: ccy_country_weights_cache
  layer: layer1
  segment: 1A
  class: surface
  description: Deterministic cache of expanded currency→country weights.
  path_template: data/layer1/1A/ccy_country_weights_cache/parameter_hash={parameter_hash}/
  partitions:
  - parameter_hash
  scope: parameter
  schema_ref: schemas.1A.yaml#/prep/ccy_country_weights_cache
  dictionary_ref: layer1.1A:ccy_country_weights_cache
  primary_key:
  - currency
  - country_iso
  join_keys:
  - currency
  - country_iso
  read_requires_gates: []
  produced_by: 1A.expand_currency_to_country
  consumed_by:
  - 1A
  final_in_layer: false
- output_id: country_set
  layer: layer1
  segment: 1A
  class: surface
  description: Legacy RNG-dependent allocation set; superseded by S3 ordered candidate set. Not authoritative for inter-country
    order.
  path_template: data/layer1/1A/country_set/seed={seed}/parameter_hash={parameter_hash}/
  partitions:
  - seed
  - parameter_hash
  scope: seed_parameter_hash
  schema_ref: schemas.1A.yaml#/alloc/country_set
  dictionary_ref: layer1.1A:country_set
  primary_key:
  - merchant_id
  - country_iso
  join_keys:
  - merchant_id
  - country_iso
  read_requires_gates: []
  produced_by: 1A.select_foreign_countries
  consumed_by:
  - 1A
  - 1B
  final_in_layer: false
- output_id: crossborder_eligibility_flags
  layer: layer1
  segment: 1A
  class: surface
  description: Flags enforcing cross-border eligibility rules prior to ZTP.
  path_template: data/layer1/1A/crossborder_eligibility_flags/parameter_hash={parameter_hash}/
  partitions:
  - parameter_hash
  scope: parameter
  schema_ref: schemas.1A.yaml#/prep/crossborder_eligibility_flags
  dictionary_ref: layer1.1A:crossborder_eligibility_flags
  primary_key:
  - merchant_id
  join_keys:
  - merchant_id
  read_requires_gates: []
  produced_by: 1A.apply_eligibility_rules
  consumed_by:
  - 1A
  - validation
  final_in_layer: false
- output_id: crossborder_features
  layer: layer1
  segment: 1A
  class: surface
  description: 'Per-merchant deterministic features used by cross-border K (currently: openness scalar X_m in [0,1]).'
  path_template: data/layer1/1A/crossborder_features/parameter_hash={parameter_hash}/
  partitions:
  - parameter_hash
  scope: parameter
  schema_ref: schemas.1A.yaml#/model/crossborder_features
  dictionary_ref: layer1.1A:crossborder_features
  primary_key:
  - merchant_id
  join_keys:
  - merchant_id
  read_requires_gates: []
  produced_by: 1A.S0
  consumed_by:
  - 1A.S4
  final_in_layer: false
- output_id: hurdle_design_matrix
  layer: layer1
  segment: 1A
  class: surface
  description: Predictor matrix for hurdle (single vs multi-site) decision.
  path_template: data/layer1/1A/hurdle_design_matrix/parameter_hash={parameter_hash}/
  partitions:
  - parameter_hash
  scope: parameter
  schema_ref: schemas.1A.yaml#/model/hurdle_design_matrix
  dictionary_ref: layer1.1A:hurdle_design_matrix
  primary_key:
  - merchant_id
  join_keys:
  - merchant_id
  read_requires_gates: []
  produced_by: 1A.build_design_matrix
  consumed_by:
  - 1A
  final_in_layer: false
- output_id: hurdle_pi_probs
  layer: layer1
  segment: 1A
  class: surface
  description: Per-merchant hurdle probabilities (π) after logistic model.
  path_template: data/layer1/1A/hurdle_pi_probs/parameter_hash={parameter_hash}/
  partitions:
  - parameter_hash
  scope: parameter
  schema_ref: schemas.1A.yaml#/model/hurdle_pi_probs
  dictionary_ref: layer1.1A:hurdle_pi_probs
  primary_key:
  - merchant_id
  join_keys:
  - merchant_id
  read_requires_gates: []
  produced_by: 1A.S0_7_build_hurdle_pi_probs
  consumed_by:
  - 1A
  final_in_layer: false
- output_id: hurdle_stationarity_tests_2024Q4
  layer: layer1
  segment: 1A
  class: surface
  description: Diagnostics for hurdle model stability across vintages.
  path_template: data/layer1/1A/hurdle_stationarity_tests/parameter_hash={parameter_hash}/
  partitions:
  - parameter_hash
  scope: parameter
  schema_ref: schemas.1A.yaml#/validation/hurdle_stationarity_tests
  dictionary_ref: layer1.1A:hurdle_stationarity_tests_2024Q4
  primary_key:
  - test_id
  join_keys:
  - test_id
  read_requires_gates: []
  produced_by: 1A.validation
  consumed_by:
  - validation
  final_in_layer: false
- output_id: merchant_currency
  layer: layer1
  segment: 1A
  class: surface
  description: Per-merchant settlement currency κₘ with provenance.
  path_template: data/layer1/1A/merchant_currency/parameter_hash={parameter_hash}/
  partitions:
  - parameter_hash
  scope: parameter
  schema_ref: schemas.1A.yaml#/prep/merchant_currency
  dictionary_ref: layer1.1A:merchant_currency
  primary_key:
  - merchant_id
  join_keys:
  - merchant_id
  read_requires_gates: []
  produced_by: 1A.derive_merchant_currency
  consumed_by:
  - 1A.expand_currency_to_country
  - 1A.select_gumbel_candidates
  final_in_layer: false
- output_id: outlet_catalogue
  layer: layer1
  segment: 1A
  class: surface
  description: Immutable outlet stubs per merchant × legal_country. Does NOT encode cross-country order; consumers MUST join
    `s3_candidate_set.candidate_rank` for that. Consumers MUST only read after verifying `_passed.flag` matches SHA256(`validation_bundle_1A`)
    for the same fingerprint (see S9.9).
  path_template: data/layer1/1A/outlet_catalogue/seed={seed}/fingerprint={manifest_fingerprint}/
  partitions:
  - seed
  - fingerprint
  scope: seed_fingerprint
  schema_ref: schemas.1A.yaml#/egress/outlet_catalogue
  dictionary_ref: layer1.1A:outlet_catalogue
  primary_key:
  - merchant_id
  - legal_country_iso
  - site_order
  join_keys:
  - merchant_id
  - legal_country_iso
  - site_order
  read_requires_gates:
  - gate_1A
  produced_by: 1A
  consumed_by:
  - 1B
  final_in_layer: false
- output_id: ranking_residual_cache_1A
  layer: layer1
  segment: 1A
  class: surface
  description: Legacy residual cache for RNG integerisation; superseded by S3 deterministic integerised counts (parameter-scoped).
  path_template: data/layer1/1A/ranking_residual_cache_1A/seed={seed}/parameter_hash={parameter_hash}/
  partitions:
  - seed
  - parameter_hash
  scope: seed_parameter_hash
  schema_ref: schemas.1A.yaml#/alloc/ranking_residual_cache
  dictionary_ref: layer1.1A:ranking_residual_cache_1A
  primary_key:
  - merchant_id
  - country_iso
  join_keys:
  - merchant_id
  - country_iso
  read_requires_gates: []
  produced_by: 1A.integerise_allocations
  consumed_by:
  - 1A
  final_in_layer: false
- output_id: rng_audit_log
  layer: layer1
  segment: 1A
  class: surface
  description: Run-scoped RNG audit log (master seed, counters, substream jumps).
  path_template: logs/rng/audit/seed={seed}/parameter_hash={parameter_hash}/run_id={run_id}/rng_audit_log.jsonl
  partitions:
  - seed
  - parameter_hash
  - run_id
  scope: seed_parameter_run
  schema_ref: schemas.layer1.yaml#/rng/core/rng_audit_log
  dictionary_ref: layer1.1A:rng_audit_log
  primary_key: []
  join_keys: []
  read_requires_gates: []
  produced_by: 1A.rng_audit_emitter
  consumed_by:
  - validation
  final_in_layer: false
- output_id: rng_event_dirichlet_gamma_vector
  layer: layer1
  segment: 1A
  class: surface
  description: 'Event stream: Dirichlet gamma vectors for splitting outlets across countries.'
  path_template: logs/rng/events/dirichlet_gamma_vector/seed={seed}/parameter_hash={parameter_hash}/run_id={run_id}/part-*.jsonl
  partitions:
  - seed
  - parameter_hash
  - run_id
  scope: seed_parameter_run
  schema_ref: schemas.layer1.yaml#/rng/events/dirichlet_gamma_vector
  dictionary_ref: layer1.1A:rng_event_dirichlet_gamma_vector
  primary_key: []
  join_keys: []
  read_requires_gates: []
  produced_by: 1A.dirichlet_allocator
  consumed_by:
  - validation
  final_in_layer: false
- output_id: rng_event_gamma_component
  layer: layer1
  segment: 1A
  class: surface
  description: 'Event stream: gamma draws for NB/Dirichlet components.'
  path_template: logs/rng/events/gamma_component/seed={seed}/parameter_hash={parameter_hash}/run_id={run_id}/part-*.jsonl
  partitions:
  - seed
  - parameter_hash
  - run_id
  scope: seed_parameter_run
  schema_ref: schemas.layer1.yaml#/rng/events/gamma_component
  dictionary_ref: layer1.1A:rng_event_gamma_component
  primary_key: []
  join_keys: []
  read_requires_gates: []
  produced_by: 1A.nb_and_dirichlet_sampler
  consumed_by:
  - validation
  final_in_layer: false
- output_id: rng_event_gumbel_key
  layer: layer1
  segment: 1A
  class: surface
  description: 'Event stream: Gumbel-top-k keys for foreign-country selection.'
  path_template: logs/rng/events/gumbel_key/seed={seed}/parameter_hash={parameter_hash}/run_id={run_id}/part-*.jsonl
  partitions:
  - seed
  - parameter_hash
  - run_id
  scope: seed_parameter_run
  schema_ref: schemas.layer1.yaml#/rng/events/gumbel_key
  dictionary_ref: layer1.1A:rng_event_gumbel_key
  primary_key: []
  join_keys: []
  read_requires_gates: []
  produced_by: 1A.foreign_country_selector
  consumed_by:
  - validation
  final_in_layer: false
- output_id: rng_event_hurdle_bernoulli
  layer: layer1
  segment: 1A
  class: surface
  description: 'Event stream: hurdle Bernoulli draws per merchant (π).'
  path_template: logs/rng/events/hurdle_bernoulli/seed={seed}/parameter_hash={parameter_hash}/run_id={run_id}/part-*.jsonl
  partitions:
  - seed
  - parameter_hash
  - run_id
  scope: seed_parameter_run
  schema_ref: schemas.layer1.yaml#/rng/events/hurdle_bernoulli
  dictionary_ref: layer1.1A:rng_event_hurdle_bernoulli
  primary_key: []
  join_keys: []
  read_requires_gates: []
  produced_by: 1A.hurdle_sampler
  consumed_by:
  - validation
  final_in_layer: false
- output_id: rng_event_nb_final
  layer: layer1
  segment: 1A
  class: surface
  description: 'Event stream: final Negative Binomial draws for outlet counts.'
  path_template: logs/rng/events/nb_final/seed={seed}/parameter_hash={parameter_hash}/run_id={run_id}/part-*.jsonl
  partitions:
  - seed
  - parameter_hash
  - run_id
  scope: seed_parameter_run
  schema_ref: schemas.layer1.yaml#/rng/events/nb_final
  dictionary_ref: layer1.1A:rng_event_nb_final
  primary_key: []
  join_keys: []
  read_requires_gates: []
  produced_by: 1A.nb_sampler
  consumed_by:
  - validation
  final_in_layer: false
- output_id: rng_event_normal_box_muller
  layer: layer1
  segment: 1A
  class: surface
  description: 'Event stream: standard normal draws via Box–Muller (Z only; sine mate discarded).'
  path_template: logs/rng/events/normal_box_muller/seed={seed}/parameter_hash={parameter_hash}/run_id={run_id}/part-*.jsonl
  partitions:
  - seed
  - parameter_hash
  - run_id
  scope: seed_parameter_run
  schema_ref: schemas.layer1.yaml#/rng/events/normal_box_muller
  dictionary_ref: layer1.1A:rng_event_normal_box_muller
  primary_key: []
  join_keys: []
  read_requires_gates: []
  produced_by: L0.event_normal_box_muller
  consumed_by:
  - validation
  final_in_layer: false
- output_id: rng_event_poisson_component
  layer: layer1
  segment: 1A
  class: surface
  description: 'Event stream: Poisson draws used in NB composition / ZTP.'
  path_template: logs/rng/events/poisson_component/seed={seed}/parameter_hash={parameter_hash}/run_id={run_id}/part-*.jsonl
  partitions:
  - seed
  - parameter_hash
  - run_id
  scope: seed_parameter_run
  schema_ref: schemas.layer1.yaml#/rng/events/poisson_component
  dictionary_ref: layer1.1A:rng_event_poisson_component
  primary_key:
  - merchant_id
  - attempt
  join_keys:
  - merchant_id
  - attempt
  read_requires_gates: []
  produced_by: 1A.nb_poisson_component
  consumed_by:
  - validation
  final_in_layer: false
- output_id: rng_event_residual_rank
  layer: layer1
  segment: 1A
  class: surface
  description: 'Event stream: deterministic ranks of largest-remainder residuals for per-country integerisation.'
  path_template: logs/rng/events/residual_rank/seed={seed}/parameter_hash={parameter_hash}/run_id={run_id}/part-*.jsonl
  partitions:
  - seed
  - parameter_hash
  - run_id
  scope: seed_parameter_run
  schema_ref: schemas.layer1.yaml#/rng/events/residual_rank
  dictionary_ref: layer1.1A:rng_event_residual_rank
  primary_key: []
  join_keys: []
  read_requires_gates: []
  produced_by: 1A.integerisation
  consumed_by:
  - validation
  final_in_layer: false
- output_id: rng_event_sequence_finalize
  layer: layer1
  segment: 1A
  class: surface
  description: 'Event stream: final sequence allocation per (merchant,country) block.'
  path_template: logs/rng/events/sequence_finalize/seed={seed}/parameter_hash={parameter_hash}/run_id={run_id}/part-*.jsonl
  partitions:
  - seed
  - parameter_hash
  - run_id
  scope: seed_parameter_run
  schema_ref: schemas.layer1.yaml#/rng/events/sequence_finalize
  dictionary_ref: layer1.1A:rng_event_sequence_finalize
  primary_key: []
  join_keys: []
  read_requires_gates: []
  produced_by: 1A.site_id_allocator
  consumed_by:
  - validation
  final_in_layer: false
- output_id: rng_event_site_sequence_overflow
  layer: layer1
  segment: 1A
  class: surface
  description: 'Event stream: guardrail events when site sequence space is exhausted.'
  path_template: logs/rng/events/site_sequence_overflow/seed={seed}/parameter_hash={parameter_hash}/run_id={run_id}/part-*.jsonl
  partitions:
  - seed
  - parameter_hash
  - run_id
  scope: seed_parameter_run
  schema_ref: schemas.layer1.yaml#/rng/events/site_sequence_overflow
  dictionary_ref: layer1.1A:rng_event_site_sequence_overflow
  primary_key: []
  join_keys: []
  read_requires_gates: []
  produced_by: 1A.site_id_allocator
  consumed_by:
  - validation
  final_in_layer: false
- output_id: rng_event_stream_jump
  layer: layer1
  segment: 1A
  class: surface
  description: 'Event stream: explicit Philox stream/substream jump records.'
  path_template: logs/rng/events/stream_jump/seed={seed}/parameter_hash={parameter_hash}/run_id={run_id}/part-*.jsonl
  partitions:
  - seed
  - parameter_hash
  - run_id
  scope: seed_parameter_run
  schema_ref: schemas.layer1.yaml#/rng/events/stream_jump
  dictionary_ref: layer1.1A:rng_event_stream_jump
  primary_key: []
  join_keys: []
  read_requires_gates: []
  produced_by: 1A.rng_stream_manager
  consumed_by:
  - validation
  final_in_layer: false
- output_id: rng_event_ztp_final
  layer: layer1
  segment: 1A
  class: surface
  description: 'Event stream: S4 single acceptance record per resolved merchant (fixes K_target and run facts).'
  path_template: logs/rng/events/ztp_final/seed={seed}/parameter_hash={parameter_hash}/run_id={run_id}/part-*.jsonl
  partitions:
  - seed
  - parameter_hash
  - run_id
  scope: seed_parameter_run
  schema_ref: schemas.layer1.yaml#/rng/events/ztp_final
  dictionary_ref: layer1.1A:rng_event_ztp_final
  primary_key:
  - merchant_id
  join_keys:
  - merchant_id
  read_requires_gates: []
  produced_by: 1A.ztp_sampler
  consumed_by:
  - validation
  - 1A.S6
  final_in_layer: false
- output_id: rng_event_ztp_rejection
  layer: layer1
  segment: 1A
  class: surface
  description: 'Event stream: ZTP rejection samples and acceptance traces.'
  path_template: logs/rng/events/ztp_rejection/seed={seed}/parameter_hash={parameter_hash}/run_id={run_id}/part-*.jsonl
  partitions:
  - seed
  - parameter_hash
  - run_id
  scope: seed_parameter_run
  schema_ref: schemas.layer1.yaml#/rng/events/ztp_rejection
  dictionary_ref: layer1.1A:rng_event_ztp_rejection
  primary_key:
  - merchant_id
  - attempt
  join_keys:
  - merchant_id
  - attempt
  read_requires_gates: []
  produced_by: 1A.ztp_sampler
  consumed_by:
  - validation
  final_in_layer: false
- output_id: rng_event_ztp_retry_exhausted
  layer: layer1
  segment: 1A
  class: surface
  description: 'Event stream: ZTP retry exhaustion (diagnostic hard events).'
  path_template: logs/rng/events/ztp_retry_exhausted/seed={seed}/parameter_hash={parameter_hash}/run_id={run_id}/part-*.jsonl
  partitions:
  - seed
  - parameter_hash
  - run_id
  scope: seed_parameter_run
  schema_ref: schemas.layer1.yaml#/rng/events/ztp_retry_exhausted
  dictionary_ref: layer1.1A:rng_event_ztp_retry_exhausted
  primary_key:
  - merchant_id
  - attempts
  join_keys:
  - merchant_id
  - attempts
  read_requires_gates: []
  produced_by: 1A.ztp_sampler
  consumed_by:
  - validation
  final_in_layer: false
- output_id: rng_trace_log
  layer: layer1
  segment: 1A
  class: surface
  description: Structured per-(module,substream_label) RNG trace (saturating totals for draws/blocks/events; `draws_total`
    equals the sum of event-level draws; `blocks_total` reconciled via counters). Emit exactly one cumulative row after each
    RNG event append (per S4 §2A).
  path_template: logs/rng/trace/seed={seed}/parameter_hash={parameter_hash}/run_id={run_id}/rng_trace_log.jsonl
  partitions:
  - seed
  - parameter_hash
  - run_id
  scope: seed_parameter_run
  schema_ref: schemas.layer1.yaml#/rng/core/rng_trace_log
  dictionary_ref: layer1.1A:rng_trace_log
  primary_key: []
  join_keys: []
  read_requires_gates: []
  produced_by: 1A.rng_trace_emitter
  consumed_by:
  - validation
  final_in_layer: false
- output_id: s3_base_weight_priors
  layer: layer1
  segment: 1A
  class: surface
  description: Deterministic base-weight priors (fixed-dp strings) per candidate; not probabilities.
  path_template: data/layer1/1A/s3_base_weight_priors/parameter_hash={parameter_hash}/
  partitions:
  - parameter_hash
  scope: parameter
  schema_ref: schemas.1A.yaml#/s3/base_weight_priors
  dictionary_ref: layer1.1A:s3_base_weight_priors
  primary_key:
  - merchant_id
  - country_iso
  join_keys:
  - merchant_id
  - country_iso
  read_requires_gates: []
  produced_by: 1A.S3
  consumed_by:
  - 1A
  final_in_layer: false
- output_id: s3_candidate_set
  layer: layer1
  segment: 1A
  class: surface
  description: Deterministic ordered candidate set per merchant; single authority for inter-country order (`candidate_rank`).
  path_template: data/layer1/1A/s3_candidate_set/parameter_hash={parameter_hash}/
  partitions:
  - parameter_hash
  scope: parameter
  schema_ref: schemas.1A.yaml#/s3/candidate_set
  dictionary_ref: layer1.1A:s3_candidate_set
  primary_key:
  - merchant_id
  - country_iso
  join_keys:
  - merchant_id
  - country_iso
  read_requires_gates: []
  produced_by: 1A.S3
  consumed_by:
  - 1A
  - 1B
  final_in_layer: false
- output_id: s3_integerised_counts
  layer: layer1
  segment: 1A
  class: surface
  description: Deterministic per-country integer counts summing to N; includes residual_rank.
  path_template: data/layer1/1A/s3_integerised_counts/parameter_hash={parameter_hash}/
  partitions:
  - parameter_hash
  scope: parameter
  schema_ref: schemas.1A.yaml#/s3/integerised_counts
  dictionary_ref: layer1.1A:s3_integerised_counts
  primary_key:
  - merchant_id
  - country_iso
  join_keys:
  - merchant_id
  - country_iso
  read_requires_gates: []
  produced_by: 1A.S3
  consumed_by:
  - 1A
  final_in_layer: false
- output_id: s3_site_sequence
  layer: layer1
  segment: 1A
  class: surface
  description: Deterministic within-country site sequence (and optional 6-digit site_id).
  path_template: data/layer1/1A/s3_site_sequence/parameter_hash={parameter_hash}/
  partitions:
  - parameter_hash
  scope: parameter
  schema_ref: schemas.1A.yaml#/s3/site_sequence
  dictionary_ref: layer1.1A:s3_site_sequence
  primary_key:
  - merchant_id
  - country_iso
  - site_order
  join_keys:
  - merchant_id
  - country_iso
  - site_order
  read_requires_gates: []
  produced_by: 1A.S3
  consumed_by:
  - 1A
  final_in_layer: false
- output_id: s6_membership
  layer: layer1
  segment: 1A
  class: surface
  description: Optional convenience surface of selected foreign ISO2s per merchant; authority remains S6 RNG events; no inter-country
    order encoded.
  path_template: data/layer1/1A/s6/membership/seed={seed}/parameter_hash={parameter_hash}/
  partitions:
  - seed
  - parameter_hash
  scope: seed_parameter_hash
  schema_ref: schemas.1A.yaml#/alloc/membership
  dictionary_ref: layer1.1A:s6_membership
  primary_key:
  - merchant_id
  - country_iso
  join_keys:
  - merchant_id
  - country_iso
  read_requires_gates: []
  produced_by: 1A.S6
  consumed_by:
  - 1A
  final_in_layer: false
- output_id: s6_validation_receipt
  layer: layer1
  segment: 1A
  class: surface
  description: PASS receipt for S6; gate for S7/S8 reads.
  path_template: data/layer1/1A/s6/seed={seed}/parameter_hash={parameter_hash}/
  partitions:
  - seed
  - parameter_hash
  scope: seed_parameter_hash
  schema_ref: schemas.layer1.yaml#/validation/s6_receipt
  dictionary_ref: layer1.1A:s6_validation_receipt
  primary_key: []
  join_keys: []
  read_requires_gates: []
  produced_by: 1A.S6
  consumed_by:
  - 1A
  - 1B
  final_in_layer: false
- output_id: sparse_flag
  layer: layer1
  segment: 1A
  class: surface
  description: Per-currency sparsity flags emitted by currency→country expansion.
  path_template: data/layer1/1A/sparse_flag/parameter_hash={parameter_hash}/
  partitions:
  - parameter_hash
  scope: parameter
  schema_ref: schemas.1A.yaml#/prep/sparse_flag
  dictionary_ref: layer1.1A:sparse_flag
  primary_key:
  - currency
  join_keys:
  - currency
  read_requires_gates: []
  produced_by: 1A.expand_currency_to_country
  consumed_by:
  - 1A
  - validation
  final_in_layer: false
- output_id: s0_gate_receipt_1B
  layer: layer1
  segment: 1B
  class: gate_artifact
  description: Fingerprint-scoped receipt proving 1A PASS verification; enumerates sealed inputs for 1B.
  path_template: data/layer1/1B/s0_gate_receipt/fingerprint={manifest_fingerprint}/s0_gate_receipt.json
  partitions:
  - fingerprint
  scope: fingerprint
  schema_ref: schemas.1B.yaml#/validation/s0_gate_receipt
  dictionary_ref: layer1.1B:s0_gate_receipt_1B
  primary_key:
  - manifest_fingerprint
  join_keys:
  - manifest_fingerprint
  read_requires_gates: []
  produced_by: 1B.S0
  consumed_by:
  - 1B
  final_in_layer: false
- output_id: validation_bundle_1B
  layer: layer1
  segment: 1B
  class: gate_artifact
  description: Validation bundle for a 1B publish (one per manifest_fingerprint).
  path_template: data/layer1/1B/validation/fingerprint={manifest_fingerprint}/
  partitions:
  - fingerprint
  scope: fingerprint
  schema_ref: schemas.1B.yaml#/validation/validation_bundle_1B
  dictionary_ref: layer1.1B:validation_bundle_1B
  primary_key: []
  join_keys: []
  read_requires_gates: []
  produced_by: 1B.S9
  consumed_by:
  - 1B
  final_in_layer: false
- output_id: validation_passed_flag_1B
  layer: layer1
  segment: 1B
  class: gate_artifact
  description: PASS gate flag; equals SHA-256 of the bundle per S9 hashing rule.
  path_template: data/layer1/1B/validation/fingerprint={manifest_fingerprint}/_passed.flag
  partitions:
  - fingerprint
  scope: fingerprint
  schema_ref: schemas.1B.yaml#/validation/passed_flag
  dictionary_ref: layer1.1B:validation_passed_flag_1B
  primary_key: []
  join_keys: []
  read_requires_gates: []
  produced_by: 1B.S9
  consumed_by:
  - 1B
  final_in_layer: false
- output_id: rng_event_in_cell_jitter
  layer: layer1
  segment: 1B
  class: stream
  description: 'RNG envelope events for S6 (in_cell_jitter); ≥1 event per site (one per attempt); per-event budget: blocks=1,
    draws=2; last event corresponds to the accepted sample.'
  path_template: logs/rng/events/in_cell_jitter/seed={seed}/parameter_hash={parameter_hash}/run_id={run_id}/part-*.jsonl
  partitions:
  - seed
  - parameter_hash
  - run_id
  scope: seed_parameter_run
  schema_ref: schemas.layer1.yaml#/rng/events/in_cell_jitter
  dictionary_ref: null
  primary_key: []
  join_keys: []
  read_requires_gates: []
  produced_by: null
  consumed_by: null
  final_in_layer: false
- output_id: rng_event_site_tile_assign
  layer: layer1
  segment: 1B
  class: stream
  description: RNG envelope events for S5 (site_tile_assign); exactly one event per assigned site.
  path_template: logs/rng/events/site_tile_assign/seed={seed}/parameter_hash={parameter_hash}/run_id={run_id}/part-*.jsonl
  partitions:
  - seed
  - parameter_hash
  - run_id
  scope: seed_parameter_run
  schema_ref: schemas.layer1.yaml#/rng/events/site_tile_assign
  dictionary_ref: null
  primary_key: []
  join_keys: []
  read_requires_gates: []
  produced_by: null
  consumed_by: null
  final_in_layer: false
- output_id: s3_requirements
  layer: layer1
  segment: 1B
  class: surface
  description: Deterministic site counts per (merchant_id, legal_country_iso) for this run.
  path_template: data/layer1/1B/s3_requirements/seed={seed}/fingerprint={manifest_fingerprint}/parameter_hash={parameter_hash}/
  partitions:
  - seed
  - fingerprint
  - parameter_hash
  scope: seed_fingerprint_parameter
  schema_ref: schemas.1B.yaml#/plan/s3_requirements
  dictionary_ref: layer1.1B:s3_requirements
  primary_key:
  - merchant_id
  - legal_country_iso
  join_keys:
  - merchant_id
  - legal_country_iso
  read_requires_gates: []
  produced_by: 1B.S3
  consumed_by:
  - 1B
  final_in_layer: false
- output_id: s4_alloc_plan
  layer: layer1
  segment: 1B
  class: surface
  description: Per-tile integer allocations that sum to S3 n_sites (RNG-free; positives only).
  path_template: data/layer1/1B/s4_alloc_plan/seed={seed}/fingerprint={manifest_fingerprint}/parameter_hash={parameter_hash}/
  partitions:
  - seed
  - fingerprint
  - parameter_hash
  scope: seed_fingerprint_parameter
  schema_ref: schemas.1B.yaml#/plan/s4_alloc_plan
  dictionary_ref: layer1.1B:s4_alloc_plan
  primary_key:
  - merchant_id
  - legal_country_iso
  - tile_id
  join_keys:
  - merchant_id
  - legal_country_iso
  - tile_id
  read_requires_gates: []
  produced_by: 1B.S4
  consumed_by:
  - 1B
  final_in_layer: false
- output_id: s5_site_tile_assignment
  layer: layer1
  segment: 1B
  class: surface
  description: Site→tile assignment; one row per site; satisfies S4 per-tile quotas.
  path_template: data/layer1/1B/s5_site_tile_assignment/seed={seed}/fingerprint={manifest_fingerprint}/parameter_hash={parameter_hash}/
  partitions:
  - seed
  - fingerprint
  - parameter_hash
  scope: seed_fingerprint_parameter
  schema_ref: schemas.1B.yaml#/plan/s5_site_tile_assignment
  dictionary_ref: layer1.1B:s5_site_tile_assignment
  primary_key:
  - merchant_id
  - legal_country_iso
  - site_order
  join_keys:
  - merchant_id
  - legal_country_iso
  - site_order
  read_requires_gates: []
  produced_by: 1B.S5
  consumed_by:
  - 1B
  final_in_layer: false
- output_id: s6_site_jitter
  layer: layer1
  segment: 1B
  class: surface
  description: Per-site in-pixel jitter; effective deltas (projection into country); one row per site.
  path_template: data/layer1/1B/s6_site_jitter/seed={seed}/fingerprint={manifest_fingerprint}/parameter_hash={parameter_hash}/
  partitions:
  - seed
  - fingerprint
  - parameter_hash
  scope: seed_fingerprint_parameter
  schema_ref: schemas.1B.yaml#/plan/s6_site_jitter
  dictionary_ref: layer1.1B:s6_site_jitter
  primary_key:
  - merchant_id
  - legal_country_iso
  - site_order
  join_keys:
  - merchant_id
  - legal_country_iso
  - site_order
  read_requires_gates: []
  produced_by: 1B.S6
  consumed_by:
  - 1B
  final_in_layer: false
- output_id: s7_run_summary
  layer: layer1
  segment: 1B
  class: surface
  description: Control-plane run summary for S7 site synthesis publish.
  path_template: data/layer1/1B/s7_site_synthesis/seed={seed}/fingerprint={manifest_fingerprint}/parameter_hash={parameter_hash}/s7_run_summary.json
  partitions:
  - seed
  - fingerprint
  - parameter_hash
  scope: seed_fingerprint_parameter
  schema_ref: schemas.1B.yaml#/control/s7_run_summary
  dictionary_ref: layer1.1B:s7_run_summary
  primary_key: []
  join_keys: []
  read_requires_gates: []
  produced_by: 1B.S7
  consumed_by:
  - 1B
  final_in_layer: false
- output_id: s7_site_synthesis
  layer: layer1
  segment: 1B
  class: surface
  description: Deterministic stitch of S5 (tile) + S6 (effective deltas) + S1 geometry into per-site absolutes; RNG-free;
    1:1 with outlet_catalogue.
  path_template: data/layer1/1B/s7_site_synthesis/seed={seed}/fingerprint={manifest_fingerprint}/parameter_hash={parameter_hash}/
  partitions:
  - seed
  - fingerprint
  - parameter_hash
  scope: seed_fingerprint_parameter
  schema_ref: schemas.1B.yaml#/plan/s7_site_synthesis
  dictionary_ref: layer1.1B:s7_site_synthesis
  primary_key:
  - merchant_id
  - legal_country_iso
  - site_order
  join_keys:
  - merchant_id
  - legal_country_iso
  - site_order
  read_requires_gates: []
  produced_by: 1B.S7
  consumed_by:
  - 1B
  final_in_layer: false
- output_id: s8_run_summary
  layer: layer1
  segment: 1B
  class: surface
  description: Control-plane summary for S8 site_locations publish.
  path_template: data/layer1/1B/site_locations/seed={seed}/fingerprint={manifest_fingerprint}/s8_run_summary.json
  partitions:
  - seed
  - fingerprint
  scope: seed_fingerprint
  schema_ref: schemas.1B.yaml#/control/s8_run_summary
  dictionary_ref: layer1.1B:s8_run_summary
  primary_key: []
  join_keys: []
  read_requires_gates: []
  produced_by: 1B.S8
  consumed_by:
  - 1B
  final_in_layer: false
- output_id: site_locations
  layer: layer1
  segment: 1B
  class: surface
  description: Site locations with absolute lat/lon (post jitter + geometry stitch); partitioned by seed/fingerprint.
  path_template: data/layer1/1B/site_locations/seed={seed}/fingerprint={manifest_fingerprint}/
  partitions:
  - seed
  - fingerprint
  scope: seed_fingerprint
  schema_ref: schemas.1B.yaml#/egress/site_locations
  dictionary_ref: layer1.1B:site_locations
  primary_key:
  - merchant_id
  - legal_country_iso
  - site_order
  join_keys:
  - merchant_id
  - legal_country_iso
  - site_order
  read_requires_gates:
  - gate_1B
  produced_by: 1B.S8
  consumed_by:
  - 1B
  - 1A
  final_in_layer: true
- output_id: tile_bounds
  layer: layer1
  segment: 1B
  class: surface
  description: Rectangle bounds per eligible tile (S1 companion to tile_index).
  path_template: data/layer1/1B/tile_bounds/parameter_hash={parameter_hash}/
  partitions:
  - parameter_hash
  scope: parameter
  schema_ref: schemas.1B.yaml#/prep/tile_bounds
  dictionary_ref: layer1.1B:tile_bounds
  primary_key:
  - country_iso
  - tile_id
  join_keys:
  - country_iso
  - tile_id
  read_requires_gates: []
  produced_by: 1B.S1
  consumed_by:
  - 1B
  final_in_layer: false
- output_id: tile_index
  layer: layer1
  segment: 1B
  class: surface
  description: Eligible raster cells per country after clip.
  path_template: data/layer1/1B/tile_index/parameter_hash={parameter_hash}/
  partitions:
  - parameter_hash
  scope: parameter
  schema_ref: schemas.1B.yaml#/prep/tile_index
  dictionary_ref: layer1.1B:tile_index
  primary_key:
  - country_iso
  - tile_id
  join_keys:
  - country_iso
  - tile_id
  read_requires_gates: []
  produced_by: 1B.S1
  consumed_by:
  - 1B
  final_in_layer: false
- output_id: tile_weights
  layer: layer1
  segment: 1B
  class: surface
  description: Deterministic fixed-dp weights per tile.
  path_template: data/layer1/1B/tile_weights/parameter_hash={parameter_hash}/
  partitions:
  - parameter_hash
  scope: parameter
  schema_ref: schemas.1B.yaml#/prep/tile_weights
  dictionary_ref: layer1.1B:tile_weights
  primary_key:
  - country_iso
  - tile_id
  join_keys:
  - country_iso
  - tile_id
  read_requires_gates: []
  produced_by: 1B.S2
  consumed_by:
  - 1B
  final_in_layer: false
- output_id: s0_gate_receipt_2A
  layer: layer1
  segment: 2A
  class: gate_artifact
  description: Fingerprint-scoped receipt proving 1B PASS and recording sealed inputs for 2A.
  path_template: data/layer1/2A/s0_gate_receipt/fingerprint={manifest_fingerprint}/s0_gate_receipt.json
  partitions:
  - fingerprint
  scope: fingerprint
  schema_ref: schemas.2A.yaml#/validation/s0_gate_receipt_v1
  dictionary_ref: layer1.2A:s0_gate_receipt_2A
  primary_key:
  - manifest_fingerprint
  join_keys:
  - manifest_fingerprint
  read_requires_gates: []
  produced_by: 2A.S0
  consumed_by:
  - 2A
  final_in_layer: false
- output_id: validation_bundle_2A
  layer: layer1
  segment: 2A
  class: gate_artifact
  description: Validation bundle for 2A publish (one per fingerprint).
  path_template: data/layer1/2A/validation/fingerprint={manifest_fingerprint}/
  partitions:
  - fingerprint
  scope: fingerprint
  schema_ref: schemas.2A.yaml#/validation/validation_bundle_2A
  dictionary_ref: layer1.2A:validation_bundle_2A
  primary_key: []
  join_keys: []
  read_requires_gates: []
  produced_by: 2A.S5
  consumed_by:
  - 2B
  - 3A
  - 3B
  final_in_layer: false
- output_id: validation_passed_flag_2A
  layer: layer1
  segment: 2A
  class: gate_artifact
  description: PASS flag; equals SHA-256 of bundle per index+ASCII-lex law.
  path_template: data/layer1/2A/validation/fingerprint={manifest_fingerprint}/_passed.flag
  partitions:
  - fingerprint
  scope: fingerprint
  schema_ref: schemas.2A.yaml#/validation/passed_flag
  dictionary_ref: layer1.2A:validation_passed_flag_2A
  primary_key: []
  join_keys: []
  read_requires_gates: []
  produced_by: 2A.S5
  consumed_by:
  - 2B
  - 3A
  - 3B
  final_in_layer: false
- output_id: s1_tz_lookup
  layer: layer1
  segment: 2A
  class: surface
  description: Provisional tz lookup results per site (deterministic).
  path_template: data/layer1/2A/s1_tz_lookup/seed={seed}/fingerprint={manifest_fingerprint}/
  partitions:
  - seed
  - fingerprint
  scope: seed_fingerprint
  schema_ref: schemas.2A.yaml#/plan/s1_tz_lookup
  dictionary_ref: layer1.2A:s1_tz_lookup
  primary_key:
  - merchant_id
  - legal_country_iso
  - site_order
  join_keys:
  - merchant_id
  - legal_country_iso
  - site_order
  read_requires_gates: []
  produced_by: 2A.S1
  consumed_by:
  - 2A
  final_in_layer: false
- output_id: s4_legality_report
  layer: layer1
  segment: 2A
  class: surface
  description: Legality/DST report per seed×fingerprint (JSON summary).
  path_template: data/layer1/2A/legality_report/seed={seed}/fingerprint={manifest_fingerprint}/s4_legality_report.json
  partitions:
  - seed
  - fingerprint
  scope: seed_fingerprint
  schema_ref: schemas.2A.yaml#/validation/s4_legality_report
  dictionary_ref: layer1.2A:s4_legality_report
  primary_key: []
  join_keys: []
  read_requires_gates: []
  produced_by: 2A.S4
  consumed_by:
  - 2A
  final_in_layer: false
- output_id: sealed_inputs_v1
  layer: layer1
  segment: 2A
  class: surface
  description: Diagnostic inventory of sealed inputs for a 2A fingerprint.
  path_template: data/layer1/2A/sealed_inputs/fingerprint={manifest_fingerprint}/sealed_inputs_v1.parquet
  partitions:
  - fingerprint
  scope: fingerprint
  schema_ref: schemas.2A.yaml#/manifests/sealed_inputs_v1
  dictionary_ref: layer1.2A:sealed_inputs_v1
  primary_key:
  - manifest_fingerprint
  - asset_id
  join_keys:
  - manifest_fingerprint
  - asset_id
  read_requires_gates: []
  produced_by: 2A.S0
  consumed_by:
  - 2A
  final_in_layer: false
- output_id: site_timezones
  layer: layer1
  segment: 2A
  class: surface
  description: Final per-site IANA tzid with provenance; order-free egress.
  path_template: data/layer1/2A/site_timezones/seed={seed}/fingerprint={manifest_fingerprint}/
  partitions:
  - seed
  - fingerprint
  scope: seed_fingerprint
  schema_ref: schemas.2A.yaml#/egress/site_timezones
  dictionary_ref: layer1.2A:site_timezones
  primary_key:
  - merchant_id
  - legal_country_iso
  - site_order
  join_keys:
  - merchant_id
  - legal_country_iso
  - site_order
  read_requires_gates:
  - gate_2A
  produced_by: 2A.S2
  consumed_by:
  - 2A
  - 2B
  final_in_layer: true
- output_id: tz_timetable_cache
  layer: layer1
  segment: 2A
  class: surface
  description: Fingerprint-scoped cache manifest for tz transitions.
  path_template: data/layer1/2A/tz_timetable_cache/fingerprint={manifest_fingerprint}/
  partitions:
  - fingerprint
  scope: fingerprint
  schema_ref: schemas.2A.yaml#/cache/tz_timetable_cache
  dictionary_ref: layer1.2A:tz_timetable_cache
  primary_key: []
  join_keys: []
  read_requires_gates: []
  produced_by: 2A.S3
  consumed_by:
  - 2A
  final_in_layer: false
- output_id: s0_gate_receipt_2B
  layer: layer1
  segment: 2B
  class: gate_artifact
  description: Gate receipt attesting upstream verification, identity, and catalogue-only resolution.
  path_template: data/layer1/2B/s0_gate_receipt_2B/fingerprint={manifest_fingerprint}/s0_gate_receipt_2B.json
  partitions:
  - fingerprint
  scope: fingerprint
  schema_ref: schemas.2B.yaml#/validation/s0_gate_receipt_v1
  dictionary_ref: layer1.2B:s0_gate_receipt_2B
  primary_key: []
  join_keys: []
  read_requires_gates: []
  produced_by: 2B.S0
  consumed_by:
  - 2B
  final_in_layer: false
- output_id: validation_bundle_2B
  layer: layer1
  segment: 2B
  class: gate_artifact
  description: Fingerprint-scoped PASS bundle index for Segment 2B.
  path_template: data/layer1/2B/validation/fingerprint={manifest_fingerprint}/index.json
  partitions:
  - fingerprint
  scope: fingerprint
  schema_ref: schemas.layer1.yaml#/validation/validation_bundle/index_schema
  dictionary_ref: layer1.2B:validation_bundle_2B
  primary_key: []
  join_keys: []
  read_requires_gates: []
  produced_by: 2B.S8
  consumed_by: []
  final_in_layer: true
- output_id: validation_passed_flag_2B
  layer: layer1
  segment: 2B
  class: gate_artifact
  description: Companion flag containing the SHA-256 digest of the 2B validation bundle.
  path_template: data/layer1/2B/validation/fingerprint={manifest_fingerprint}/_passed.flag
  partitions:
  - fingerprint
  scope: fingerprint
  schema_ref: schemas.1B.yaml#/validation/passed_flag
  dictionary_ref: layer1.2B:validation_passed_flag_2B
  primary_key: []
  join_keys: []
  read_requires_gates: []
  produced_by: 2B.S8
  consumed_by: []
  final_in_layer: true
- output_id: s1_site_weights
  layer: layer1
  segment: 2B
  class: surface
  description: Frozen per-site probability law emitted by S1 for alias construction.
  path_template: data/layer1/2B/s1_site_weights/seed={seed}/fingerprint={manifest_fingerprint}/
  partitions:
  - seed
  - fingerprint
  scope: seed_fingerprint
  schema_ref: schemas.2B.yaml#/plan/s1_site_weights
  dictionary_ref: layer1.2B:s1_site_weights
  primary_key:
  - merchant_id
  - legal_country_iso
  - site_order
  join_keys:
  - merchant_id
  - legal_country_iso
  - site_order
  read_requires_gates: []
  produced_by: 2B.S1
  consumed_by:
  - 2B
  final_in_layer: false
- output_id: s2_alias_blob
  layer: layer1
  segment: 2B
  class: surface
  description: Contiguous binary blob containing per-merchant alias tables.
  path_template: data/layer1/2B/s2_alias_blob/seed={seed}/fingerprint={manifest_fingerprint}/alias.bin
  partitions:
  - seed
  - fingerprint
  scope: seed_fingerprint
  schema_ref: schemas.2B.yaml#/binary/s2_alias_blob
  dictionary_ref: layer1.2B:s2_alias_blob
  primary_key: []
  join_keys: []
  read_requires_gates: []
  produced_by: 2B.S2
  consumed_by:
  - 2B
  final_in_layer: false
- output_id: s2_alias_index
  layer: layer1
  segment: 2B
  class: surface
  description: JSON index describing alias blob slices, offsets, and digests.
  path_template: data/layer1/2B/s2_alias_index/seed={seed}/fingerprint={manifest_fingerprint}/index.json
  partitions:
  - seed
  - fingerprint
  scope: seed_fingerprint
  schema_ref: schemas.2B.yaml#/plan/s2_alias_index
  dictionary_ref: layer1.2B:s2_alias_index
  primary_key:
  - merchant_id
  join_keys:
  - merchant_id
  read_requires_gates: []
  produced_by: 2B.S2
  consumed_by:
  - 2B
  final_in_layer: false
- output_id: s3_day_effects
  layer: layer1
  segment: 2B
  class: surface
  description: Per-merchant × UTC-day × tz-group gamma multipliers for day-scale co-movement.
  path_template: data/layer1/2B/s3_day_effects/seed={seed}/fingerprint={manifest_fingerprint}/
  partitions:
  - seed
  - fingerprint
  scope: seed_fingerprint
  schema_ref: schemas.2B.yaml#/plan/s3_day_effects
  dictionary_ref: layer1.2B:s3_day_effects
  primary_key:
  - merchant_id
  - utc_day
  - tz_group_id
  join_keys:
  - merchant_id
  - utc_day
  - tz_group_id
  read_requires_gates: []
  produced_by: 2B.S3
  consumed_by:
  - 2B
  final_in_layer: false
- output_id: s4_group_weights
  layer: layer1
  segment: 2B
  class: surface
  description: Per-merchant × UTC-day × tz-group mix used to pick tz-group prior to static alias.
  path_template: data/layer1/2B/s4_group_weights/seed={seed}/fingerprint={manifest_fingerprint}/
  partitions:
  - seed
  - fingerprint
  scope: seed_fingerprint
  schema_ref: schemas.2B.yaml#/plan/s4_group_weights
  dictionary_ref: layer1.2B:s4_group_weights
  primary_key:
  - merchant_id
  - utc_day
  - tz_group_id
  join_keys:
  - merchant_id
  - utc_day
  - tz_group_id
  read_requires_gates: []
  produced_by: 2B.S4
  consumed_by:
  - 2B
  final_in_layer: false
- output_id: s5_selection_log
  layer: layer1
  segment: 2B
  class: surface
  description: Optional per-arrival trace for routing selections; arrival-ordered JSONL.
  path_template: data/layer1/2B/s5_selection_log/seed={seed}/parameter_hash={parameter_hash}/run_id={run_id}/utc_day={utc_day}/selection_log.jsonl
  partitions:
  - seed
  - parameter_hash
  - run_id
  - utc_day
  scope: seed_parameter_run
  schema_ref: schemas.2B.yaml#/trace/s5_selection_log_row
  dictionary_ref: layer1.2B:s5_selection_log
  primary_key:
  - utc_timestamp
  join_keys:
  - utc_timestamp
  read_requires_gates: []
  produced_by: 2B.S5
  consumed_by:
  - 2B
  final_in_layer: false
- output_id: s6_edge_log
  layer: layer1
  segment: 2B
  class: surface
  description: Per-arrival virtual-edge selections captured as a diagnostic log.
  path_template: logs/edge/seed={seed}/parameter_hash={parameter_hash}/run_id={run_id}/utc_day={utc_day}/s6_edge_log.jsonl
  partitions:
  - seed
  - parameter_hash
  - run_id
  - utc_day
  scope: seed_parameter_run
  schema_ref: schemas.2B.yaml#/trace/s6_edge_log_row
  dictionary_ref: layer1.2B:s6_edge_log
  primary_key:
  - utc_timestamp
  join_keys:
  - utc_timestamp
  read_requires_gates: []
  produced_by: 2B.S6
  consumed_by:
  - 2B
  final_in_layer: false
- output_id: s7_audit_report
  layer: layer1
  segment: 2B
  class: surface
  description: Deterministic audit report emitted by S7 (validators, evidence, run metadata).
  path_template: data/layer1/2B/s7_audit_report/seed={seed}/fingerprint={manifest_fingerprint}/s7_audit_report.json
  partitions:
  - seed
  - fingerprint
  scope: seed_fingerprint
  schema_ref: schemas.2B.yaml#/validation/s7_audit_report_v1
  dictionary_ref: layer1.2B:s7_audit_report
  primary_key: []
  join_keys: []
  read_requires_gates: []
  produced_by: 2B.S7
  consumed_by:
  - 2B
  final_in_layer: false
- output_id: sealed_inputs_v1
  layer: layer1
  segment: 2B
  class: surface
  description: Authoritative inventory of every asset sealed by 2B.S0 for the manifest.
  path_template: data/layer1/2B/sealed_inputs_v1/fingerprint={manifest_fingerprint}/sealed_inputs_v1.json
  partitions:
  - fingerprint
  scope: fingerprint
  schema_ref: schemas.2B.yaml#/validation/sealed_inputs_v1
  dictionary_ref: layer1.2B:sealed_inputs_v1
  primary_key: []
  join_keys: []
  read_requires_gates: []
  produced_by: 2B.S0
  consumed_by:
  - 2B
  final_in_layer: false
- output_id: s0_gate_receipt_3A
  layer: layer1
  segment: 3A
  class: gate_artifact
  description: Gate descriptor proving upstream PASS status and sealed policy set.
  path_template: data/layer1/3A/s0_gate_receipt/fingerprint={manifest_fingerprint}/s0_gate_receipt_3A.json
  partitions:
  - fingerprint
  scope: fingerprint
  schema_ref: schemas.3A.yaml#/validation/s0_gate_receipt_3A
  dictionary_ref: layer1.3A:s0_gate_receipt_3A
  primary_key: []
  join_keys: []
  read_requires_gates: []
  produced_by: 3A.S0
  consumed_by:
  - 3A.S1
  - 3A.S2
  - 3A.S3
  - 3A.S4
  - 3A.S5
  - 3A.S6
  - 3A.S7
  final_in_layer: false
- output_id: validation_bundle_3A
  layer: layer1
  segment: 3A
  class: gate_artifact
  description: Fingerprint-scoped validation bundle for Segment 3A.
  path_template: data/layer1/3A/validation/fingerprint={manifest_fingerprint}/
  partitions:
  - fingerprint
  scope: fingerprint
  schema_ref: schemas.layer1.yaml#/validation/validation_bundle_index_3A
  dictionary_ref: layer1.3A:validation_bundle_3A
  primary_key: []
  join_keys: []
  read_requires_gates: []
  produced_by: 3A.S7
  consumed_by:
  - orchestrator
  - cross_segment_validation
  final_in_layer: true
- output_id: validation_passed_flag_3A
  layer: layer1
  segment: 3A
  class: gate_artifact
  description: HashGate PASS flag accompanying the 3A validation bundle.
  path_template: data/layer1/3A/validation/fingerprint={manifest_fingerprint}/_passed.flag
  partitions:
  - fingerprint
  scope: fingerprint
  schema_ref: schemas.layer1.yaml#/validation/passed_flag_3A
  dictionary_ref: layer1.3A:validation_passed_flag_3A
  primary_key: []
  join_keys: []
  read_requires_gates: []
  produced_by: 3A.S7
  consumed_by:
  - orchestrator
  - segment_readers
  final_in_layer: true
- output_id: s1_escalation_queue
  layer: layer1
  segment: 3A
  class: surface
  description: Per-merchant escalation decisions and totals.
  path_template: data/layer1/3A/s1_escalation_queue/seed={seed}/fingerprint={manifest_fingerprint}/
  partitions:
  - seed
  - fingerprint
  scope: seed_fingerprint
  schema_ref: schemas.3A.yaml#/plan/s1_escalation_queue
  dictionary_ref: layer1.3A:s1_escalation_queue
  primary_key:
  - merchant_id
  - legal_country_iso
  join_keys:
  - merchant_id
  - legal_country_iso
  read_requires_gates:
  - gate_3A
  produced_by: 3A.S1
  consumed_by:
  - 3A.S3
  - 3A.S4
  - 3A.S5
  final_in_layer: false
- output_id: s2_country_zone_priors
  layer: layer1
  segment: 3A
  class: surface
  description: Parameter-scoped Dirichlet α-vectors per country×tzid.
  path_template: data/layer1/3A/s2_country_zone_priors/parameter_hash={parameter_hash}/
  partitions:
  - parameter_hash
  scope: parameter
  schema_ref: schemas.3A.yaml#/plan/s2_country_zone_priors
  dictionary_ref: layer1.3A:s2_country_zone_priors
  primary_key:
  - country_iso
  - tzid
  join_keys:
  - country_iso
  - tzid
  read_requires_gates: []
  produced_by: 3A.S2
  consumed_by:
  - 3A.S3
  - 3A.S4
  - 3A.S5
  final_in_layer: false
- output_id: s3_zone_shares
  layer: layer1
  segment: 3A
  class: surface
  description: Dirichlet share draws per merchant×country×zone.
  path_template: data/layer1/3A/s3_zone_shares/seed={seed}/fingerprint={manifest_fingerprint}/
  partitions:
  - seed
  - fingerprint
  scope: seed_fingerprint
  schema_ref: schemas.3A.yaml#/plan/s3_zone_shares
  dictionary_ref: layer1.3A:s3_zone_shares
  primary_key:
  - merchant_id
  - legal_country_iso
  - tzid
  join_keys:
  - merchant_id
  - legal_country_iso
  - tzid
  read_requires_gates:
  - gate_3A
  produced_by: 3A.S3
  consumed_by:
  - 3A.S4
  - 3A.S5
  final_in_layer: false
- output_id: s4_zone_counts
  layer: layer1
  segment: 3A
  class: surface
  description: Integer outlet counts per merchant×country×zone after floor/bump.
  path_template: data/layer1/3A/s4_zone_counts/seed={seed}/fingerprint={manifest_fingerprint}/
  partitions:
  - seed
  - fingerprint
  scope: seed_fingerprint
  schema_ref: schemas.3A.yaml#/plan/s4_zone_counts
  dictionary_ref: layer1.3A:s4_zone_counts
  primary_key:
  - merchant_id
  - legal_country_iso
  - tzid
  join_keys:
  - merchant_id
  - legal_country_iso
  - tzid
  read_requires_gates:
  - gate_3A
  produced_by: 3A.S4
  consumed_by:
  - 3A.S5
  final_in_layer: false
- output_id: s6_issue_table_3A
  layer: layer1
  segment: 3A
  class: surface
  description: Per-issue findings emitted by 3A.S6.
  path_template: data/layer1/3A/s6_issues/fingerprint={manifest_fingerprint}/issues.parquet
  partitions:
  - fingerprint
  scope: fingerprint
  schema_ref: schemas.3A.yaml#/validation/s6_issue_table_3A
  dictionary_ref: layer1.3A:s6_issue_table_3A
  primary_key:
  - severity
  - issue_code
  - merchant_id
  - legal_country_iso
  - tzid
  join_keys:
  - severity
  - issue_code
  - merchant_id
  - legal_country_iso
  - tzid
  read_requires_gates:
  - gate_3A
  produced_by: 3A.S6
  consumed_by:
  - 3A.S7
  - ops_tooling
  final_in_layer: false
- output_id: s6_receipt_3A
  layer: layer1
  segment: 3A
  class: surface
  description: Compact validation receipt capturing S6 outcomes.
  path_template: data/layer1/3A/s6_receipt/fingerprint={manifest_fingerprint}/s6_receipt.json
  partitions:
  - fingerprint
  scope: fingerprint
  schema_ref: schemas.3A.yaml#/validation/s6_receipt_3A
  dictionary_ref: layer1.3A:s6_receipt_3A
  primary_key: []
  join_keys: []
  read_requires_gates:
  - gate_3A
  produced_by: 3A.S6
  consumed_by:
  - 3A.S7
  final_in_layer: false
- output_id: s6_validation_report_3A
  layer: layer1
  segment: 3A
  class: surface
  description: Structural validation report emitted by 3A.S6.
  path_template: data/layer1/3A/s6_validation_report/fingerprint={manifest_fingerprint}/report.json
  partitions:
  - fingerprint
  scope: fingerprint
  schema_ref: schemas.3A.yaml#/validation/s6_validation_report_3A
  dictionary_ref: layer1.3A:s6_validation_report_3A
  primary_key: []
  join_keys: []
  read_requires_gates:
  - gate_3A
  produced_by: 3A.S6
  consumed_by:
  - 3A.S7
  - cross_segment_validation
  final_in_layer: false
- output_id: sealed_inputs_3A
  layer: layer1
  segment: 3A
  class: surface
  description: Sealed inventory of artefacts authorised for Segment 3A.
  path_template: data/layer1/3A/sealed_inputs/fingerprint={manifest_fingerprint}/sealed_inputs_3A.parquet
  partitions:
  - fingerprint
  scope: fingerprint
  schema_ref: schemas.3A.yaml#/validation/sealed_inputs_3A
  dictionary_ref: layer1.3A:sealed_inputs_3A
  primary_key:
  - owner_segment
  - artefact_kind
  - logical_id
  join_keys:
  - owner_segment
  - artefact_kind
  - logical_id
  read_requires_gates:
  - gate_3A
  produced_by: 3A.S0
  consumed_by:
  - 3A.S1
  - 3A.S2
  - 3A.S3
  - 3A.S4
  - 3A.S5
  - 3A.S6
  - 3A.S7
  final_in_layer: false
- output_id: zone_alloc
  layer: layer1
  segment: 3A
  class: surface
  description: Cross-layer zone allocation egress for routing segment.
  path_template: data/layer1/3A/zone_alloc/seed={seed}/fingerprint={manifest_fingerprint}/
  partitions:
  - seed
  - fingerprint
  scope: seed_fingerprint
  schema_ref: schemas.3A.yaml#/egress/zone_alloc
  dictionary_ref: layer1.3A:zone_alloc
  primary_key:
  - merchant_id
  - legal_country_iso
  - tzid
  join_keys:
  - merchant_id
  - legal_country_iso
  - tzid
  read_requires_gates:
  - gate_3A
  produced_by: 3A.S5
  consumed_by:
  - 2B
  - validation
  - cross_segment_validation
  final_in_layer: true
- output_id: zone_alloc_universe_hash
  layer: layer1
  segment: 3A
  class: surface
  description: Digest summary tying priors/policies to the published zone allocation.
  path_template: data/layer1/3A/zone_universe/fingerprint={manifest_fingerprint}/zone_alloc_universe_hash.json
  partitions:
  - fingerprint
  scope: fingerprint
  schema_ref: schemas.3A.yaml#/validation/zone_alloc_universe_hash
  dictionary_ref: layer1.3A:zone_alloc_universe_hash
  primary_key: []
  join_keys: []
  read_requires_gates:
  - gate_3A
  produced_by: 3A.S5
  consumed_by:
  - 2B
  - validation
  final_in_layer: false
- output_id: s0_gate_receipt_3B
  layer: layer1
  segment: 3B
  class: gate_artifact
  description: Gate receipt capturing upstream PASS status, sealed policy set and authoritative digests.
  path_template: data/layer1/3B/s0_gate_receipt/fingerprint={manifest_fingerprint}/s0_gate_receipt_3B.json
  partitions:
  - fingerprint
  scope: fingerprint
  schema_ref: schemas.3B.yaml#/validation/s0_gate_receipt_3B
  dictionary_ref: layer1.3B:s0_gate_receipt_3B
  primary_key: []
  join_keys: []
  read_requires_gates: []
  produced_by: 3B.S0
  consumed_by:
  - 3B.S1
  - 3B.S2
  - 3B.S3
  - 3B.S4
  - 3B.S5
  final_in_layer: false
- output_id: validation_bundle_3B
  layer: layer1
  segment: 3B
  class: gate_artifact
  description: Directory artefact containing manifest, digests and structural or RNG evidence.
  path_template: data/layer1/3B/validation/fingerprint={manifest_fingerprint}/
  partitions:
  - fingerprint
  scope: fingerprint
  schema_ref: schemas.layer1.yaml#/validation/validation_bundle_index_3B
  dictionary_ref: layer1.3B:validation_bundle_3B
  primary_key: []
  join_keys: []
  read_requires_gates: []
  produced_by: 3B.S5
  consumed_by:
  - HashGate
  - downstream segments
  final_in_layer: false
- output_id: validation_bundle_index_3B
  layer: layer1
  segment: 3B
  class: gate_artifact
  description: index.json enumerating evidence files plus their SHA-256 digests.
  path_template: data/layer1/3B/validation/fingerprint={manifest_fingerprint}/index.json
  partitions:
  - fingerprint
  scope: fingerprint
  schema_ref: schemas.layer1.yaml#/validation/validation_bundle_index_3B
  dictionary_ref: layer1.3B:validation_bundle_index_3B
  primary_key: []
  join_keys: []
  read_requires_gates: []
  produced_by: 3B.S5
  consumed_by:
  - HashGate
  - downstream segments
  final_in_layer: false
- output_id: validation_passed_flag_3B
  layer: layer1
  segment: 3B
  class: gate_artifact
  description: ASCII _passed.flag storing the hash of the validation bundle.
  path_template: data/layer1/3B/validation/fingerprint={manifest_fingerprint}/_passed.flag
  partitions:
  - fingerprint
  scope: fingerprint
  schema_ref: schemas.layer1.yaml#/validation/passed_flag_3B
  dictionary_ref: layer1.3B:validation_passed_flag_3B
  primary_key: []
  join_keys: []
  read_requires_gates: []
  produced_by: 3B.S5
  consumed_by:
  - HashGate
  - downstream segments
  final_in_layer: false
- output_id: edge_progress_log
  layer: layer1
  segment: 3B
  class: stream
  description: Records finished country batches for crash-safe restarts.
  path_template: logs/virtual/{run_id}/edge_progress.log
  partitions: []
  scope: unpartitioned
  schema_ref: null
  dictionary_ref: null
  primary_key: []
  join_keys: []
  read_requires_gates: []
  produced_by: null
  consumed_by: null
  final_in_layer: false
- output_id: gamma_draw_log
  layer: layer1
  segment: 3B
  class: stream
  description: Per-merchant draw record (Philox key/counter, day_index, gamma_value).
  path_template: logs/virtual/{run_id}/gamma_draw.jsonl
  partitions: []
  scope: unpartitioned
  schema_ref: gamma_draw_schema
  dictionary_ref: null
  primary_key: []
  join_keys: []
  read_requires_gates: []
  produced_by: null
  consumed_by: null
  final_in_layer: false
- output_id: virtual_audit_log
  layer: layer1
  segment: 3B
  class: stream
  description: SHA-256(batch_index ‖ cumulative_country_counts) audit lines.
  path_template: logs/virtual/{run_id}/virtual_audit.log
  partitions: []
  scope: unpartitioned
  schema_ref: null
  dictionary_ref: null
  primary_key: []
  join_keys: []
  read_requires_gates: []
  produced_by: null
  consumed_by: null
  final_in_layer: false
- output_id: edge_alias_blob_3B
  layer: layer1
  segment: 3B
  class: surface
  description: Contiguous alias blob covering every virtual merchant edge distribution.
  path_template: data/layer1/3B/edge_alias_blob/seed={seed}/fingerprint={manifest_fingerprint}/edge_alias_blob_3B.bin
  partitions:
  - seed
  - fingerprint
  scope: seed_fingerprint
  schema_ref: schemas.3B.yaml#/binary/edge_alias_blob_header_3B
  dictionary_ref: layer1.3B:edge_alias_blob_3B
  primary_key: []
  join_keys: []
  read_requires_gates:
  - gate_3B
  produced_by: 3B.S3
  consumed_by:
  - 3B.S4
  - 2B.routing
  - validation
  final_in_layer: false
- output_id: edge_alias_index_3B
  layer: layer1
  segment: 3B
  class: surface
  description: Index and checksum metadata for locating merchant alias segments inside the blob.
  path_template: data/layer1/3B/edge_alias_index/seed={seed}/fingerprint={manifest_fingerprint}/edge_alias_index_3B.parquet
  partitions:
  - seed
  - fingerprint
  scope: seed_fingerprint
  schema_ref: schemas.3B.yaml#/plan/edge_alias_index_3B
  dictionary_ref: layer1.3B:edge_alias_index_3B
  primary_key:
  - scope
  - merchant_id
  join_keys:
  - scope
  - merchant_id
  read_requires_gates:
  - gate_3B
  produced_by: 3B.S3
  consumed_by:
  - 3B.S4
  - 2B.routing
  - validation
  final_in_layer: false
- output_id: edge_catalogue_3B
  layer: layer1
  segment: 3B
  class: surface
  description: Per-edge geometry, tz semantics and weights for all virtual merchants.
  path_template: data/layer1/3B/edge_catalogue/seed={seed}/fingerprint={manifest_fingerprint}/
  partitions:
  - seed
  - fingerprint
  scope: seed_fingerprint
  schema_ref: schemas.3B.yaml#/plan/edge_catalogue_3B
  dictionary_ref: layer1.3B:edge_catalogue_3B
  primary_key:
  - merchant_id
  - edge_id
  join_keys:
  - merchant_id
  - edge_id
  read_requires_gates:
  - gate_3B
  produced_by: 3B.S2
  consumed_by:
  - 3B.S3
  - validation
  final_in_layer: false
- output_id: edge_catalogue_index_3B
  layer: layer1
  segment: 3B
  class: surface
  description: Digest summary and per-merchant counts for the edge catalogue.
  path_template: data/layer1/3B/edge_catalogue_index/seed={seed}/fingerprint={manifest_fingerprint}/edge_catalogue_index_3B.parquet
  partitions:
  - seed
  - fingerprint
  scope: seed_fingerprint
  schema_ref: schemas.3B.yaml#/plan/edge_catalogue_index_3B
  dictionary_ref: layer1.3B:edge_catalogue_index_3B
  primary_key:
  - scope
  - merchant_id
  join_keys:
  - scope
  - merchant_id
  read_requires_gates:
  - gate_3B
  produced_by: 3B.S2
  consumed_by:
  - 3B.S3
  - 3B.S5
  - routing_virtual
  final_in_layer: false
- output_id: edge_universe_hash_3B
  layer: layer1
  segment: 3B
  class: surface
  description: Fingerprint-scoped hash tying cdn weights, edge catalogue/index and alias outputs.
  path_template: data/layer1/3B/edge_universe_hash/fingerprint={manifest_fingerprint}/edge_universe_hash_3B.json
  partitions:
  - fingerprint
  scope: fingerprint
  schema_ref: schemas.3B.yaml#/validation/edge_universe_hash_3B
  dictionary_ref: layer1.3B:edge_universe_hash_3B
  primary_key: []
  join_keys: []
  read_requires_gates:
  - gate_3B
  produced_by: 3B.S3
  consumed_by:
  - 3B.S4
  - 3B.S5
  - 2B.routing
  final_in_layer: false
- output_id: gamma_draw_log_3B
  layer: layer1
  segment: 3B
  class: surface
  description: Structured Philox audit for any gamma draws in the virtual pipeline.
  path_template: logs/layer1/3B/gamma_draw/seed={seed}/fingerprint={manifest_fingerprint}/gamma_draw_log_3B.jsonl
  partitions:
  - seed
  - fingerprint
  scope: seed_fingerprint
  schema_ref: schemas.3B.yaml#/validation/gamma_draw_log_entry_3B
  dictionary_ref: layer1.3B:gamma_draw_log_3B
  primary_key:
  - merchant_id
  - day_index
  join_keys:
  - merchant_id
  - day_index
  read_requires_gates:
  - gate_3B
  produced_by: 3B.S3
  consumed_by:
  - validation
  final_in_layer: false
- output_id: s4_run_summary_3B
  layer: layer1
  segment: 3B
  class: surface
  description: Optional S4 receipt capturing policy digests and status.
  path_template: data/layer1/3B/s4_run_summary/fingerprint={manifest_fingerprint}/s4_run_summary_3B.json
  partitions:
  - fingerprint
  scope: fingerprint
  schema_ref: schemas.3B.yaml#/validation/s4_run_summary_3B
  dictionary_ref: layer1.3B:s4_run_summary_3B
  primary_key: []
  join_keys: []
  read_requires_gates:
  - gate_3B
  produced_by: 3B.S4
  consumed_by:
  - 3B.S5
  final_in_layer: false
- output_id: s5_manifest_3B
  layer: layer1
  segment: 3B
  class: surface
  description: Optional S5 manifest summarising identity, digests and validator outcomes; lives inside the bundle.
  path_template: data/layer1/3B/validation/fingerprint={manifest_fingerprint}/s5_manifest_3B.json
  partitions:
  - fingerprint
  scope: fingerprint
  schema_ref: schemas.3B.yaml#/validation/s5_manifest_3B
  dictionary_ref: layer1.3B:s5_manifest_3B
  primary_key: []
  join_keys: []
  read_requires_gates:
  - gate_3B
  produced_by: 3B.S5
  consumed_by:
  - HashGate
  - downstream segments
  final_in_layer: false
- output_id: sealed_inputs_3B
  layer: layer1
  segment: 3B
  class: surface
  description: Inventory of every artefact authorised for the manifest.
  path_template: data/layer1/3B/sealed_inputs/fingerprint={manifest_fingerprint}/sealed_inputs_3B.parquet
  partitions:
  - fingerprint
  scope: fingerprint
  schema_ref: schemas.3B.yaml#/validation/sealed_inputs_3B
  dictionary_ref: layer1.3B:sealed_inputs_3B
  primary_key:
  - owner_segment
  - artefact_kind
  - logical_id
  - path
  join_keys:
  - owner_segment
  - artefact_kind
  - logical_id
  - path
  read_requires_gates:
  - gate_3B
  produced_by: 3B.S0
  consumed_by:
  - 3B.S1
  - 3B.S2
  - 3B.S3
  - 3B.S4
  - 3B.S5
  final_in_layer: false
- output_id: virtual_classification_3B
  layer: layer1
  segment: 3B
  class: surface
  description: Merchant-level classification surface with closed vocabulary reason codes.
  path_template: data/layer1/3B/virtual_classification/seed={seed}/fingerprint={manifest_fingerprint}/
  partitions:
  - seed
  - fingerprint
  scope: seed_fingerprint
  schema_ref: schemas.3B.yaml#/plan/virtual_classification_3B
  dictionary_ref: layer1.3B:virtual_classification_3B
  primary_key:
  - merchant_id
  join_keys:
  - merchant_id
  read_requires_gates:
  - gate_3B
  produced_by: 3B.S1
  consumed_by:
  - 3B.S2
  - 3B.S3
  - 3B.S4
  - 3B.S5
  - routing_virtual
  final_in_layer: false
- output_id: virtual_routing_policy_3B
  layer: layer1
  segment: 3B
  class: surface
  description: Dual-TZ routing contract that tells 2B how to consume the virtual artefacts.
  path_template: data/layer1/3B/virtual_routing_policy/fingerprint={manifest_fingerprint}/virtual_routing_policy_3B.json
  partitions:
  - fingerprint
  scope: fingerprint
  schema_ref: schemas.3B.yaml#/egress/virtual_routing_policy_3B
  dictionary_ref: layer1.3B:virtual_routing_policy_3B
  primary_key: []
  join_keys: []
  read_requires_gates:
  - gate_3B
  produced_by: 3B.S4
  consumed_by:
  - 2B.routing
  - 3B.validation
  final_in_layer: false
- output_id: virtual_settlement_3B
  layer: layer1
  segment: 3B
  class: surface
  description: One settlement node per virtual merchant with tzid semantics and evidence URLs.
  path_template: data/layer1/3B/virtual_settlement/seed={seed}/fingerprint={manifest_fingerprint}/
  partitions:
  - seed
  - fingerprint
  scope: seed_fingerprint
  schema_ref: schemas.3B.yaml#/plan/virtual_settlement_3B
  dictionary_ref: layer1.3B:virtual_settlement_3B
  primary_key:
  - merchant_id
  join_keys:
  - merchant_id
  read_requires_gates:
  - gate_3B
  produced_by: 3B.S1
  consumed_by:
  - 3B.S2
  - 3B.S4
  - routing_virtual
  final_in_layer: false
- output_id: virtual_validation_contract_3B
  layer: layer1
  segment: 3B
  class: surface
  description: Declarative suite of validation tests (IP mix, cut-offs, alias health) scoped to the manifest.
  path_template: data/layer1/3B/virtual_validation_contract/fingerprint={manifest_fingerprint}/virtual_validation_contract_3B.parquet
  partitions:
  - fingerprint
  scope: fingerprint
  schema_ref: schemas.3B.yaml#/egress/virtual_validation_contract_3B
  dictionary_ref: layer1.3B:virtual_validation_contract_3B
  primary_key:
  - test_id
  join_keys:
  - test_id
  read_requires_gates:
  - gate_3B
  produced_by: 3B.S4
  consumed_by:
  - 3B.S5
  - 4A
  final_in_layer: false
- output_id: s0_gate_receipt_5A
  layer: layer2
  segment: 5A
  class: gate_artifact
  description: Fingerprint-scoped S0 receipt confirming upstream gates and sealed inputs.
  path_template: data/layer2/5A/s0_gate_receipt/fingerprint={manifest_fingerprint}/s0_gate_receipt_5A.json
  partitions:
  - fingerprint
  scope: fingerprint
  schema_ref: schemas.5A.yaml#/validation/s0_gate_receipt_5A
  dictionary_ref: layer2.5A:s0_gate_receipt_5A
  primary_key: []
  join_keys: []
  read_requires_gates: []
  produced_by:
  - 5A.S0
  consumed_by:
  - 5A.S1
  - 5A.S2
  - 5A.S3
  - 5A.S4
  - 5A.S5
  final_in_layer: false
- output_id: validation_bundle_index_5A
  layer: layer2
  segment: 5A
  class: gate_artifact
  description: Index and manifest for the 5A validation bundle.
  path_template: data/layer2/5A/validation/fingerprint={manifest_fingerprint}/validation_bundle_index_5A.json
  partitions:
  - fingerprint
  scope: fingerprint
  schema_ref: schemas.layer2.yaml#/validation/validation_bundle_index_5A
  dictionary_ref: layer2.5A:validation_bundle_index_5A
  primary_key: []
  join_keys: []
  read_requires_gates: []
  produced_by:
  - 5A.S5
  consumed_by:
  - 5A.S5
  - 5B
  - 6A
  final_in_layer: false
- output_id: validation_passed_flag_5A
  layer: layer2
  segment: 5A
  class: gate_artifact
  description: Pass/fail flag for the 5A validation bundle.
  path_template: data/layer2/5A/validation/fingerprint={manifest_fingerprint}/_passed.flag
  partitions:
  - fingerprint
  scope: fingerprint
  schema_ref: schemas.layer2.yaml#/validation/passed_flag_5A
  dictionary_ref: layer2.5A:validation_passed_flag_5A
  primary_key: []
  join_keys: []
  read_requires_gates: []
  produced_by:
  - 5A.S5
  consumed_by:
  - 5B
  - 6A
  - 5A.validation_tools
  final_in_layer: true
- output_id: class_shape_catalogue_5A
  layer: layer2
  segment: 5A
  class: surface
  description: Optional base shape catalogue per class (and optional channel) for each scenario.
  path_template: 'data/layer2/5A/class_shape_catalogue/parameter_hash={parameter_hash}/scenario_id={scenario_id}/class_shape_catalogue_5A.parquet

    '
  partitions:
  - parameter_hash
  - scenario_id
  scope: parameter_hash_scenario_id
  schema_ref: schemas.5A.yaml#/model/class_shape_catalogue_5A
  dictionary_ref: layer2.5A:class_shape_catalogue_5A
  primary_key:
  - demand_class
  join_keys:
  - demand_class
  read_requires_gates: []
  produced_by:
  - 5A.S2
  consumed_by:
  - 5A.S3
  - 5A.S4
  - 5A.S5
  - 5B
  - 6A
  final_in_layer: false
- output_id: class_zone_baseline_local_5A
  layer: layer2
  segment: 5A
  class: surface
  description: Optional class×zone baseline local-week intensities per scenario.
  path_template: 'data/layer2/5A/class_zone_baseline_local/fingerprint={manifest_fingerprint}/scenario_id={scenario_id}/class_zone_baseline_local_5A.parquet

    '
  partitions:
  - fingerprint
  - scenario_id
  scope: fingerprint_scenario_id
  schema_ref: schemas.5A.yaml#/model/class_zone_baseline_local_5A
  dictionary_ref: layer2.5A:class_zone_baseline_local_5A
  primary_key:
  - demand_class
  - legal_country_iso
  - tzid
  - bucket_index
  join_keys:
  - demand_class
  - legal_country_iso
  - tzid
  - bucket_index
  read_requires_gates:
  - gate_5A
  produced_by:
  - 5A.S3
  consumed_by:
  - 5A.S4
  - 5A.S5
  - 5B
  - 6A
  final_in_layer: false
- output_id: class_zone_shape_5A
  layer: layer2
  segment: 5A
  class: surface
  description: Normalised weekly shape vectors per class×zone (and optional channel) for each scenario.
  path_template: 'data/layer2/5A/class_zone_shape/parameter_hash={parameter_hash}/scenario_id={scenario_id}/class_zone_shape_5A.parquet

    '
  partitions:
  - parameter_hash
  - scenario_id
  scope: parameter_hash_scenario_id
  schema_ref: schemas.5A.yaml#/model/class_zone_shape_5A
  dictionary_ref: layer2.5A:class_zone_shape_5A
  primary_key:
  - demand_class
  - legal_country_iso
  - tzid
  - bucket_index
  join_keys:
  - demand_class
  - legal_country_iso
  - tzid
  - bucket_index
  read_requires_gates: []
  produced_by:
  - 5A.S2
  consumed_by:
  - 5A.S3
  - 5A.S4
  - 5A.S5
  - 5B
  - 6A
  final_in_layer: false
- output_id: merchant_class_profile_5A
  layer: layer2
  segment: 5A
  class: surface
  description: Merchant-level aggregate class profile derived deterministically from zone profiles.
  path_template: data/layer2/5A/merchant_class_profile/fingerprint={manifest_fingerprint}/merchant_class_profile_5A.parquet
  partitions:
  - fingerprint
  scope: fingerprint
  schema_ref: schemas.5A.yaml#/model/merchant_class_profile_5A
  dictionary_ref: layer2.5A:merchant_class_profile_5A
  primary_key:
  - merchant_id
  join_keys:
  - merchant_id
  read_requires_gates:
  - gate_5A
  produced_by:
  - 5A.S1
  consumed_by:
  - 5A.S2
  - 5A.S3
  - 5A.S4
  - 5A.S5
  - 5B
  - 6A
  final_in_layer: false
- output_id: merchant_zone_baseline_local_5A
  layer: layer2
  segment: 5A
  class: surface
  description: Merchant×zone baseline local-week intensities per scenario.
  path_template: 'data/layer2/5A/merchant_zone_baseline_local/fingerprint={manifest_fingerprint}/scenario_id={scenario_id}/merchant_zone_baseline_local_5A.parquet

    '
  partitions:
  - fingerprint
  - scenario_id
  scope: fingerprint_scenario_id
  schema_ref: schemas.5A.yaml#/model/merchant_zone_baseline_local_5A
  dictionary_ref: layer2.5A:merchant_zone_baseline_local_5A
  primary_key:
  - merchant_id
  - legal_country_iso
  - tzid
  - bucket_index
  join_keys:
  - merchant_id
  - legal_country_iso
  - tzid
  - bucket_index
  read_requires_gates:
  - gate_5A
  produced_by:
  - 5A.S3
  consumed_by:
  - 5A.S4
  - 5A.S5
  - 5B
  - 6A
  final_in_layer: false
- output_id: merchant_zone_baseline_utc_5A
  layer: layer2
  segment: 5A
  class: surface
  description: Optional merchant×zone baseline intensities expressed on a UTC grid.
  path_template: 'data/layer2/5A/merchant_zone_baseline_utc/fingerprint={manifest_fingerprint}/scenario_id={scenario_id}/merchant_zone_baseline_utc_5A.parquet

    '
  partitions:
  - fingerprint
  - scenario_id
  scope: fingerprint_scenario_id
  schema_ref: schemas.5A.yaml#/model/merchant_zone_baseline_utc_5A
  dictionary_ref: layer2.5A:merchant_zone_baseline_utc_5A
  primary_key:
  - merchant_id
  - legal_country_iso
  - tzid
  - utc_bucket_index
  join_keys:
  - merchant_id
  - legal_country_iso
  - tzid
  - utc_bucket_index
  read_requires_gates:
  - gate_5A
  produced_by:
  - 5A.S3
  consumed_by:
  - 5A.S4
  - 5A.S5
  - 5B
  - 6A
  final_in_layer: false
- output_id: merchant_zone_overlay_factors_5A
  layer: layer2
  segment: 5A
  class: surface
  description: Optional multiplicative overlay factors per merchant×zone×horizon bucket.
  path_template: 'data/layer2/5A/merchant_zone_overlay_factors/fingerprint={manifest_fingerprint}/scenario_id={scenario_id}/merchant_zone_overlay_factors_5A.parquet

    '
  partitions:
  - fingerprint
  - scenario_id
  scope: fingerprint_scenario_id
  schema_ref: schemas.5A.yaml#/model/merchant_zone_overlay_factors_5A
  dictionary_ref: layer2.5A:merchant_zone_overlay_factors_5A
  primary_key:
  - merchant_id
  - legal_country_iso
  - tzid
  - local_horizon_bucket_index
  join_keys:
  - merchant_id
  - legal_country_iso
  - tzid
  - local_horizon_bucket_index
  read_requires_gates:
  - gate_5A
  produced_by:
  - 5A.S4
  consumed_by:
  - 5A.S5
  - 5B
  - 6A
  final_in_layer: false
- output_id: merchant_zone_profile_5A
  layer: layer2
  segment: 5A
  class: surface
  description: Merchant×zone demand profile including class and scale for the local week.
  path_template: data/layer2/5A/merchant_zone_profile/fingerprint={manifest_fingerprint}/merchant_zone_profile_5A.parquet
  partitions:
  - fingerprint
  scope: fingerprint
  schema_ref: schemas.5A.yaml#/model/merchant_zone_profile_5A
  dictionary_ref: layer2.5A:merchant_zone_profile_5A
  primary_key:
  - merchant_id
  - legal_country_iso
  - tzid
  join_keys:
  - merchant_id
  - legal_country_iso
  - tzid
  read_requires_gates:
  - gate_5A
  produced_by:
  - 5A.S1
  consumed_by:
  - 5A.S2
  - 5A.S3
  - 5A.S4
  - 5A.S5
  - 5B
  - 6A
  final_in_layer: false
- output_id: merchant_zone_scenario_local_5A
  layer: layer2
  segment: 5A
  class: surface
  description: Scenario-adjusted local-week intensities per merchant×zone×horizon bucket.
  path_template: 'data/layer2/5A/merchant_zone_scenario_local/fingerprint={manifest_fingerprint}/scenario_id={scenario_id}/merchant_zone_scenario_local_5A.parquet

    '
  partitions:
  - fingerprint
  - scenario_id
  scope: fingerprint_scenario_id
  schema_ref: schemas.5A.yaml#/model/merchant_zone_scenario_local_5A
  dictionary_ref: layer2.5A:merchant_zone_scenario_local_5A
  primary_key:
  - merchant_id
  - legal_country_iso
  - tzid
  - local_horizon_bucket_index
  join_keys:
  - merchant_id
  - legal_country_iso
  - tzid
  - local_horizon_bucket_index
  read_requires_gates:
  - gate_5A
  produced_by:
  - 5A.S4
  consumed_by:
  - 5A.S5
  - 5B
  - 6A
  final_in_layer: false
- output_id: merchant_zone_scenario_utc_5A
  layer: layer2
  segment: 5A
  class: surface
  description: Scenario-adjusted UTC intensities per merchant×zone×UTC horizon bucket.
  path_template: 'data/layer2/5A/merchant_zone_scenario_utc/fingerprint={manifest_fingerprint}/scenario_id={scenario_id}/merchant_zone_scenario_utc_5A.parquet

    '
  partitions:
  - fingerprint
  - scenario_id
  scope: fingerprint_scenario_id
  schema_ref: schemas.5A.yaml#/model/merchant_zone_scenario_utc_5A
  dictionary_ref: layer2.5A:merchant_zone_scenario_utc_5A
  primary_key:
  - merchant_id
  - legal_country_iso
  - tzid
  - utc_horizon_bucket_index
  join_keys:
  - merchant_id
  - legal_country_iso
  - tzid
  - utc_horizon_bucket_index
  read_requires_gates:
  - gate_5A
  produced_by:
  - 5A.S4
  consumed_by:
  - 5A.S5
  - 5B
  - 6A
  final_in_layer: false
- output_id: scenario_manifest_5A
  layer: layer2
  segment: 5A
  class: surface
  description: Scenario-level manifest projection derived from sealed inputs.
  path_template: data/layer2/5A/scenario_manifest/fingerprint={manifest_fingerprint}/scenario_manifest_5A.parquet
  partitions:
  - fingerprint
  scope: fingerprint
  schema_ref: schemas.5A.yaml#/validation/scenario_manifest_5A
  dictionary_ref: layer2.5A:scenario_manifest_5A
  primary_key: []
  join_keys: []
  read_requires_gates:
  - gate_5A
  produced_by:
  - 5A.S0
  consumed_by:
  - 5A.S1
  - 5A.S2
  - 5A.S3
  - 5A.S4
  - 5A.S5
  final_in_layer: false
- output_id: sealed_inputs_5A
  layer: layer2
  segment: 5A
  class: surface
  description: Inventory of sealed artefacts 5A is allowed to read for a fingerprint.
  path_template: data/layer2/5A/sealed_inputs/fingerprint={manifest_fingerprint}/sealed_inputs_5A.parquet
  partitions:
  - fingerprint
  scope: fingerprint
  schema_ref: schemas.5A.yaml#/validation/sealed_inputs_5A
  dictionary_ref: layer2.5A:sealed_inputs_5A
  primary_key: []
  join_keys: []
  read_requires_gates:
  - gate_5A
  produced_by:
  - 5A.S0
  consumed_by:
  - 5A.S1
  - 5A.S2
  - 5A.S3
  - 5A.S4
  - 5A.S5
  final_in_layer: false
- output_id: shape_grid_definition_5A
  layer: layer2
  segment: 5A
  class: surface
  description: Local-week time grid definition for shapes under a parameter pack and scenario.
  path_template: 'data/layer2/5A/shape_grid_definition/parameter_hash={parameter_hash}/scenario_id={scenario_id}/shape_grid_definition_5A.parquet

    '
  partitions:
  - parameter_hash
  - scenario_id
  scope: parameter_hash_scenario_id
  schema_ref: schemas.5A.yaml#/model/shape_grid_definition_5A
  dictionary_ref: layer2.5A:shape_grid_definition_5A
  primary_key:
  - bucket_index
  join_keys:
  - bucket_index
  read_requires_gates: []
  produced_by:
  - 5A.S2
  consumed_by:
  - 5A.S3
  - 5A.S4
  - 5A.S5
  - 5B
  - 6A
  final_in_layer: false
- output_id: validation_issue_table_5A
  layer: layer2
  segment: 5A
  class: surface
  description: Optional structured list of validation issues for 5A.
  path_template: data/layer2/5A/validation/fingerprint={manifest_fingerprint}/issues/validation_issue_table_5A.parquet
  partitions:
  - fingerprint
  scope: fingerprint
  schema_ref: schemas.layer2.yaml#/validation/validation_issue_table_5A
  dictionary_ref: layer2.5A:validation_issue_table_5A
  primary_key: []
  join_keys: []
  read_requires_gates:
  - gate_5A
  produced_by:
  - 5A.S5
  consumed_by:
  - 5A.validation_tools
  final_in_layer: false
- output_id: validation_report_5A
  layer: layer2
  segment: 5A
  class: surface
  description: Human/machine readable validation report for 5A.
  path_template: data/layer2/5A/validation/fingerprint={manifest_fingerprint}/reports/validation_report_5A.json
  partitions:
  - fingerprint
  scope: fingerprint
  schema_ref: schemas.layer2.yaml#/validation/validation_report_5A
  dictionary_ref: layer2.5A:validation_report_5A
  primary_key: []
  join_keys: []
  read_requires_gates:
  - gate_5A
  produced_by:
  - 5A.S5
  consumed_by:
  - 5A.validation_tools
  - 5B
  - 6A
  final_in_layer: false
- output_id: s0_gate_receipt_5B
  layer: layer2
  segment: 5B
  class: gate_artifact
  description: Fingerprint-scoped receipt confirming upstream PASS gates and sealed inputs.
  path_template: data/layer2/5B/s0_gate_receipt/fingerprint={manifest_fingerprint}/s0_gate_receipt_5B.json
  partitions:
  - fingerprint
  scope: fingerprint
  schema_ref: schemas.5B.yaml#/validation/s0_gate_receipt_5B
  dictionary_ref: layer2.5B:s0_gate_receipt_5B
  primary_key: []
  join_keys: []
  read_requires_gates: []
  produced_by:
  - 5B.S0
  consumed_by:
  - 5B.S1
  - 5B.S2
  - 5B.S3
  - 5B.S4
  - 5B.S5
  final_in_layer: false
- output_id: validation_bundle_index_5B
  layer: layer2
  segment: 5B
  class: gate_artifact
  description: Index/manifest for the 5B validation bundle (fingerprint scope).
  path_template: data/layer2/5B/validation/fingerprint={manifest_fingerprint}/index.json
  partitions:
  - fingerprint
  scope: fingerprint
  schema_ref: schemas.layer2.yaml#/validation/validation_bundle_index_5B
  dictionary_ref: layer2.5B:validation_bundle_index_5B
  primary_key: []
  join_keys: []
  read_requires_gates: []
  produced_by:
  - 5B.S5
  consumed_by:
  - 5B.S5
  - 6A
  - 6B
  final_in_layer: false
- output_id: validation_passed_flag_5B
  layer: layer2
  segment: 5B
  class: gate_artifact
  description: HashGate flag proving the validation bundle digest for a fingerprint.
  path_template: data/layer2/5B/validation/fingerprint={manifest_fingerprint}/_passed.flag
  partitions:
  - fingerprint
  scope: fingerprint
  schema_ref: schemas.layer2.yaml#/validation/passed_flag_5B
  dictionary_ref: layer2.5B:validation_passed_flag_5B
  primary_key: []
  join_keys: []
  read_requires_gates: []
  produced_by:
  - 5B.S5
  consumed_by:
  - 6A
  - 6B
  - 5B.validation_tools
  final_in_layer: true
- output_id: arrival_events_5B
  layer: layer2
  segment: 5B
  class: surface
  description: Canonical arrival skeleton stream per scenario×seed (final egress).
  path_template: 'data/layer2/5B/arrival_events/seed={seed}/fingerprint={manifest_fingerprint}/scenario_id={scenario_id}/part-*.parquet

    '
  partitions:
  - seed
  - fingerprint
  - scenario_id
  scope: seed_scenario
  schema_ref: schemas.5B.yaml#/egress/s4_arrival_events_5B
  dictionary_ref: layer2.5B:arrival_events_5B
  primary_key:
  - scenario_id
  - merchant_id
  - ts_utc
  - arrival_seq
  join_keys:
  - scenario_id
  - merchant_id
  - ts_utc
  - arrival_seq
  read_requires_gates:
  - gate_5B
  produced_by:
  - 5B.S4
  consumed_by:
  - 5B.S5
  - 6A
  - 6B
  - enterprise_ingestion
  final_in_layer: true
- output_id: s1_grouping_5B
  layer: layer2
  segment: 5B
  class: surface
  description: Deterministic mapping from merchant×zone×channel to latent group IDs.
  path_template: 'data/layer2/5B/s1_grouping/fingerprint={manifest_fingerprint}/scenario_id={scenario_id}/s1_grouping_5B.parquet

    '
  partitions:
  - fingerprint
  - scenario_id
  scope: fingerprint_scenario_id
  schema_ref: schemas.5B.yaml#/model/s1_grouping_5B
  dictionary_ref: layer2.5B:s1_grouping_5B
  primary_key:
  - scenario_id
  - merchant_id
  - zone_representation
  - channel_group
  join_keys:
  - scenario_id
  - merchant_id
  - zone_representation
  - channel_group
  read_requires_gates:
  - gate_5B
  produced_by:
  - 5B.S1
  consumed_by:
  - 5B.S2
  - 5B.S3
  - 5B.S4
  - 5B.S5
  final_in_layer: false
- output_id: s1_time_grid_5B
  layer: layer2
  segment: 5B
  class: surface
  description: Canonical scenario-level time grid for arrivals.
  path_template: 'data/layer2/5B/s1_time_grid/fingerprint={manifest_fingerprint}/scenario_id={scenario_id}/s1_time_grid_5B.parquet

    '
  partitions:
  - fingerprint
  - scenario_id
  scope: fingerprint_scenario_id
  schema_ref: schemas.5B.yaml#/model/s1_time_grid_5B
  dictionary_ref: layer2.5B:s1_time_grid_5B
  primary_key:
  - scenario_id
  - bucket_index
  join_keys:
  - scenario_id
  - bucket_index
  read_requires_gates:
  - gate_5B
  produced_by:
  - 5B.S1
  consumed_by:
  - 5B.S2
  - 5B.S3
  - 5B.S4
  - 5B.S5
  final_in_layer: false
- output_id: s2_latent_field_5B
  layer: layer2
  segment: 5B
  class: surface
  description: Optional per-group latent field table for diagnostics.
  path_template: 'data/layer2/5B/s2_latent_field/seed={seed}/fingerprint={manifest_fingerprint}/scenario_id={scenario_id}/s2_latent_field_5B.parquet

    '
  partitions:
  - seed
  - fingerprint
  - scenario_id
  scope: seed_scenario
  schema_ref: schemas.5B.yaml#/model/s2_latent_field_5B
  dictionary_ref: layer2.5B:s2_latent_field_5B
  primary_key:
  - scenario_id
  - group_id
  - bucket_index
  join_keys:
  - scenario_id
  - group_id
  - bucket_index
  read_requires_gates:
  - gate_5B
  produced_by:
  - 5B.S2
  consumed_by:
  - 5B.S5
  - 5B.validation_tools
  final_in_layer: false
- output_id: s2_realised_intensity_5B
  layer: layer2
  segment: 5B
  class: surface
  description: Realised intensities λ_realised per entity×bucket×scenario×seed.
  path_template: 'data/layer2/5B/s2_realised_intensity/seed={seed}/fingerprint={manifest_fingerprint}/scenario_id={scenario_id}/s2_realised_intensity_5B.parquet

    '
  partitions:
  - seed
  - fingerprint
  - scenario_id
  scope: seed_scenario
  schema_ref: schemas.5B.yaml#/model/s2_realised_intensity_5B
  dictionary_ref: layer2.5B:s2_realised_intensity_5B
  primary_key:
  - scenario_id
  - merchant_id
  - zone_representation
  - channel_group
  - bucket_index
  join_keys:
  - scenario_id
  - merchant_id
  - zone_representation
  - channel_group
  - bucket_index
  read_requires_gates:
  - gate_5B
  produced_by:
  - 5B.S2
  consumed_by:
  - 5B.S3
  - 5B.S5
  final_in_layer: false
- output_id: s3_bucket_counts_5B
  layer: layer2
  segment: 5B
  class: surface
  description: Integer counts per entity×bucket×scenario×seed.
  path_template: 'data/layer2/5B/s3_bucket_counts/seed={seed}/fingerprint={manifest_fingerprint}/scenario_id={scenario_id}/s3_bucket_counts_5B.parquet

    '
  partitions:
  - seed
  - fingerprint
  - scenario_id
  scope: seed_scenario
  schema_ref: schemas.5B.yaml#/model/s3_bucket_counts_5B
  dictionary_ref: layer2.5B:s3_bucket_counts_5B
  primary_key:
  - scenario_id
  - merchant_id
  - zone_representation
  - channel_group
  - bucket_index
  join_keys:
  - scenario_id
  - merchant_id
  - zone_representation
  - channel_group
  - bucket_index
  read_requires_gates:
  - gate_5B
  produced_by:
  - 5B.S3
  consumed_by:
  - 5B.S4
  - 5B.S5
  final_in_layer: false
- output_id: s4_arrival_anomalies_5B
  layer: layer2
  segment: 5B
  class: surface
  description: Optional anomaly log for arrival routing/time-placement diagnostics.
  path_template: 'data/layer2/5B/arrival_anomalies/seed={seed}/fingerprint={manifest_fingerprint}/scenario_id={scenario_id}/s4_arrival_anomalies_5B.parquet

    '
  partitions:
  - seed
  - fingerprint
  - scenario_id
  scope: seed_scenario
  schema_ref: schemas.5B.yaml#/diagnostics/s4_arrival_anomalies_5B
  dictionary_ref: layer2.5B:s4_arrival_anomalies_5B
  primary_key:
  - scenario_id
  - anomaly_id
  join_keys:
  - scenario_id
  - anomaly_id
  read_requires_gates:
  - gate_5B
  produced_by:
  - 5B.S4
  consumed_by:
  - 5B.validation_tools
  - ops_dashboards
  final_in_layer: false
- output_id: s4_arrival_summary_5B
  layer: layer2
  segment: 5B
  class: surface
  description: Optional per-entity/bucket arrival summaries for observability.
  path_template: 'data/layer2/5B/arrival_summary/seed={seed}/fingerprint={manifest_fingerprint}/scenario_id={scenario_id}/s4_arrival_summary_5B.parquet

    '
  partitions:
  - seed
  - fingerprint
  - scenario_id
  scope: seed_scenario
  schema_ref: schemas.5B.yaml#/diagnostics/s4_arrival_summary_5B
  dictionary_ref: layer2.5B:s4_arrival_summary_5B
  primary_key:
  - scenario_id
  - merchant_id
  - zone_representation
  - bucket_index
  join_keys:
  - scenario_id
  - merchant_id
  - zone_representation
  - bucket_index
  read_requires_gates:
  - gate_5B
  produced_by:
  - 5B.S4
  consumed_by:
  - 5B.validation_tools
  - ops_dashboards
  final_in_layer: false
- output_id: sealed_inputs_5B
  layer: layer2
  segment: 5B
  class: surface
  description: Inventory of artefacts 5B is allowed to read for a fingerprint.
  path_template: data/layer2/5B/sealed_inputs/fingerprint={manifest_fingerprint}/sealed_inputs_5B.parquet
  partitions:
  - fingerprint
  scope: fingerprint
  schema_ref: schemas.5B.yaml#/validation/sealed_inputs_5B
  dictionary_ref: layer2.5B:sealed_inputs_5B
  primary_key:
  - owner_segment
  - artifact_id
  - role
  join_keys:
  - owner_segment
  - artifact_id
  - role
  read_requires_gates:
  - gate_5B
  produced_by:
  - 5B.S0
  consumed_by:
  - 5B.S1
  - 5B.S2
  - 5B.S3
  - 5B.S4
  - 5B.S5
  final_in_layer: false
- output_id: validation_issue_table_5B
  layer: layer2
  segment: 5B
  class: surface
  description: Optional structured issue table for 5B validation findings.
  path_template: data/layer2/5B/validation/fingerprint={manifest_fingerprint}/validation_issue_table_5B.parquet
  partitions:
  - fingerprint
  scope: fingerprint
  schema_ref: schemas.layer2.yaml#/validation/validation_issue_table_5B
  dictionary_ref: layer2.5B:validation_issue_table_5B
  primary_key: []
  join_keys: []
  read_requires_gates:
  - gate_5B
  produced_by:
  - 5B.S5
  consumed_by:
  - 5B.validation_tools
  - ops_dashboards
  final_in_layer: false
- output_id: validation_report_5B
  layer: layer2
  segment: 5B
  class: surface
  description: Human/machine readable 5B validation report.
  path_template: data/layer2/5B/validation/fingerprint={manifest_fingerprint}/validation_report_5B.json
  partitions:
  - fingerprint
  scope: fingerprint
  schema_ref: schemas.layer2.yaml#/validation/validation_report_5B
  dictionary_ref: layer2.5B:validation_report_5B
  primary_key: []
  join_keys: []
  read_requires_gates:
  - gate_5B
  produced_by:
  - 5B.S5
  consumed_by:
  - 5B.validation_tools
  - ops_dashboards
  final_in_layer: false
- output_id: s0_gate_receipt_6A
  layer: layer3
  segment: 6A
  class: gate_artifact
  description: Layer-3 / Segment 6A gate receipt. One row per manifest_fingerprint, summarising upstream gates and the sealed
    input universe for 6A.
  path_template: data/layer3/6A/gate_receipt/fingerprint={manifest_fingerprint}/s0_gate_receipt_6A.json
  partitions:
  - fingerprint
  scope: fingerprint
  schema_ref: schemas.layer3.yaml#/gate/6A/s0_gate_receipt_6A
  dictionary_ref: layer3.6A:s0_gate_receipt_6A
  primary_key: []
  join_keys: []
  read_requires_gates: []
  produced_by:
  - 6A.S0
  consumed_by:
  - 6A.S1
  - 6A.S2
  - 6A.S3
  - 6A.S4
  - 6A.S5
  - 6B.S0
  final_in_layer: null
- output_id: validation_bundle_index_6A
  layer: layer3
  segment: 6A
  class: gate_artifact
  description: Index for the Layer-3 / Segment 6A validation bundle, listing all evidence files and their SHA-256 digests.
  path_template: data/layer3/6A/validation/fingerprint={manifest_fingerprint}/validation_bundle_index_6A.json
  partitions:
  - fingerprint
  scope: fingerprint
  schema_ref: schemas.layer3.yaml#/validation/6A/validation_bundle_index_6A
  dictionary_ref: layer3.6A:validation_bundle_index_6A
  primary_key: []
  join_keys: []
  read_requires_gates: []
  produced_by:
  - 6A.S5
  consumed_by:
  - 6B.S0
  - 6B.S1
  final_in_layer: null
- output_id: validation_passed_flag_6A
  layer: layer3
  segment: 6A
  class: gate_artifact
  description: HashGate flag for Layer-3 / Segment 6A. Contains the SHA-256 digest over the validation bundle for this manifest_fingerprint.
  path_template: data/layer3/6A/validation/fingerprint={manifest_fingerprint}/_passed.flag
  partitions:
  - fingerprint
  scope: fingerprint
  schema_ref: schemas.layer3.yaml#/validation/6A/passed_flag_6A
  dictionary_ref: layer3.6A:validation_passed_flag_6A
  primary_key: []
  join_keys: []
  read_requires_gates: []
  produced_by:
  - 6A.S5
  consumed_by:
  - 6B.S0
  - 6B.S1
  final_in_layer: null
- output_id: s1_party_base_6A
  layer: layer3
  segment: 6A
  class: surface
  description: Base party/customer universe for Layer-3 / Segment 6A. One row per party per (manifest_fingerprint, seed),
    including type, home geography and static segment attributes.
  path_template: data/layer3/6A/s1_party_base_6A/seed={seed}/fingerprint={manifest_fingerprint}/parameter_hash={parameter_hash}/s1_party_base_6A.parquet
  partitions:
  - seed
  - fingerprint
  - parameter_hash
  scope: seed_fingerprint_parameter
  schema_ref: schemas.6A.yaml#/s1/party_base
  dictionary_ref: layer3.6A:s1_party_base_6A
  primary_key:
  - country_iso
  - segment_id
  - party_type
  - party_id
  join_keys:
  - country_iso
  - segment_id
  - party_type
  - party_id
  read_requires_gates:
  - gate_6A
  produced_by:
  - 6A.S1
  consumed_by:
  - 6A.S2
  - 6A.S3
  - 6A.S4
  - 6A.S5
  - 6B.S0
  - 6B.S1
  final_in_layer: null
- output_id: s1_party_summary_6A
  layer: layer3
  segment: 6A
  class: surface
  description: Aggregate view of the 6A party base, providing party counts by geography, segment and type for diagnostics
    and downstream sizing.
  path_template: data/layer3/6A/s1_party_summary_6A/seed={seed}/fingerprint={manifest_fingerprint}/parameter_hash={parameter_hash}/s1_party_summary_6A.parquet
  partitions:
  - seed
  - fingerprint
  - parameter_hash
  scope: seed_fingerprint_parameter
  schema_ref: schemas.6A.yaml#/s1/party_summary
  dictionary_ref: layer3.6A:s1_party_summary_6A
  primary_key:
  - country_iso
  - segment_id
  - party_type
  join_keys:
  - country_iso
  - segment_id
  - party_type
  read_requires_gates:
  - gate_6A
  produced_by:
  - 6A.S1
  consumed_by:
  - 6A.S1
  - 6A.S2
  - 6B.S0
  final_in_layer: null
- output_id: s2_account_base_6A
  layer: layer3
  segment: 6A
  class: surface
  description: Account and product universe for Layer-3 / Segment 6A. One row per account per (manifest_fingerprint, seed),
    including owner references, account type, currency and static account attributes.
  path_template: data/layer3/6A/s2_account_base_6A/seed={seed}/fingerprint={manifest_fingerprint}/parameter_hash={parameter_hash}/s2_account_base_6A.parquet
  partitions:
  - seed
  - fingerprint
  - parameter_hash
  scope: seed_fingerprint_parameter
  schema_ref: schemas.6A.yaml#/s2/account_base
  dictionary_ref: layer3.6A:s2_account_base_6A
  primary_key:
  - country_iso
  - account_type
  - owner_party_id
  - account_id
  join_keys:
  - country_iso
  - account_type
  - owner_party_id
  - account_id
  read_requires_gates:
  - gate_6A
  produced_by:
  - 6A.S2
  consumed_by:
  - 6A.S3
  - 6A.S4
  - 6A.S5
  - 6B.S0
  - 6B.S1
  final_in_layer: null
- output_id: s2_account_summary_6A
  layer: layer3
  segment: 6A
  class: surface
  description: Aggregate view of the 6A account base, providing account counts by geography, segment and account type for
    diagnostics and sizing.
  path_template: data/layer3/6A/s2_account_summary_6A/seed={seed}/fingerprint={manifest_fingerprint}/parameter_hash={parameter_hash}/s2_account_summary_6A.parquet
  partitions:
  - seed
  - fingerprint
  - parameter_hash
  scope: seed_fingerprint_parameter
  schema_ref: schemas.6A.yaml#/s2/account_summary
  dictionary_ref: layer3.6A:s2_account_summary_6A
  primary_key:
  - country_iso
  - segment_id
  - account_type
  join_keys:
  - country_iso
  - segment_id
  - account_type
  read_requires_gates:
  - gate_6A
  produced_by:
  - 6A.S2
  consumed_by:
  - 6A.S2
  - 6B.S0
  final_in_layer: null
- output_id: s2_merchant_account_base_6A
  layer: layer3
  segment: 6A
  class: surface
  description: Merchant-centric view of accounts where a merchant is an owner (e.g. settlement or acquiring accounts). Pure
    subset of s2_account_base_6A.
  path_template: data/layer3/6A/s2_merchant_account_base_6A/seed={seed}/fingerprint={manifest_fingerprint}/parameter_hash={parameter_hash}/s2_merchant_account_base_6A.parquet
  partitions:
  - seed
  - fingerprint
  - parameter_hash
  scope: seed_fingerprint_parameter
  schema_ref: schemas.6A.yaml#/s2/merchant_account_base
  dictionary_ref: layer3.6A:s2_merchant_account_base_6A
  primary_key:
  - owner_merchant_id
  - account_type
  - account_id
  join_keys:
  - owner_merchant_id
  - account_type
  - account_id
  read_requires_gates:
  - gate_6A
  produced_by:
  - 6A.S2
  consumed_by:
  - 6A.S2
  - 6B.S0
  final_in_layer: null
- output_id: s2_party_product_holdings_6A
  layer: layer3
  segment: 6A
  class: surface
  description: Per-party product holdings for Layer-3 / Segment 6A, derived from s2_account_base_6A and s1_party_base_6A.
    One row per party and product grouping (e.g. account_type), with account counts.
  path_template: data/layer3/6A/s2_party_product_holdings_6A/seed={seed}/fingerprint={manifest_fingerprint}/parameter_hash={parameter_hash}/s2_party_product_holdings_6A.parquet
  partitions:
  - seed
  - fingerprint
  - parameter_hash
  scope: seed_fingerprint_parameter
  schema_ref: schemas.6A.yaml#/s2/party_product_holdings
  dictionary_ref: layer3.6A:s2_party_product_holdings_6A
  primary_key:
  - party_id
  - account_type
  join_keys:
  - party_id
  - account_type
  read_requires_gates:
  - gate_6A
  produced_by:
  - 6A.S2
  consumed_by:
  - 6A.S3
  - 6A.S4
  - 6A.S5
  - 6B.S0
  final_in_layer: null
- output_id: s3_account_instrument_links_6A
  layer: layer3
  segment: 6A
  class: surface
  description: Per-account instrument linkage surface for Layer-3 / Segment 6A. Derived from s3_instrument_base_6A and s2_account_base_6A;
    provides either per-instrument or aggregated per-account, per-instrument-type views of instrument ownership.
  path_template: data/layer3/6A/s3_account_instrument_links_6A/seed={seed}/fingerprint={manifest_fingerprint}/parameter_hash={parameter_hash}/s3_account_instrument_links_6A.parquet
  partitions:
  - seed
  - fingerprint
  - parameter_hash
  scope: seed_fingerprint_parameter
  schema_ref: schemas.6A.yaml#/s3/account_instrument_links
  dictionary_ref: layer3.6A:s3_account_instrument_links_6A
  primary_key:
  - account_id
  - instrument_type
  - scheme
  - instrument_id
  join_keys:
  - account_id
  - instrument_type
  - scheme
  - instrument_id
  read_requires_gates:
  - gate_6A
  produced_by:
  - 6A.S3
  consumed_by:
  - 6A.S4
  - 6A.S5
  - 6B.S0
  final_in_layer: null
- output_id: s3_instrument_base_6A
  layer: layer3
  segment: 6A
  class: surface
  description: Instrument and payment-credential universe for Layer-3 / Segment 6A. One row per instrument per (manifest_fingerprint,
    seed), including owner account, owner party/merchant (if modelled), instrument type, scheme/network, masked identifier,
    expiry, and static flags.
  path_template: data/layer3/6A/s3_instrument_base_6A/seed={seed}/fingerprint={manifest_fingerprint}/parameter_hash={parameter_hash}/s3_instrument_base_6A.parquet
  partitions:
  - seed
  - fingerprint
  - parameter_hash
  scope: seed_fingerprint_parameter
  schema_ref: schemas.6A.yaml#/s3/instrument_base
  dictionary_ref: layer3.6A:s3_instrument_base_6A
  primary_key:
  - account_id
  - instrument_type
  - scheme
  - instrument_id
  join_keys:
  - account_id
  - instrument_type
  - scheme
  - instrument_id
  read_requires_gates:
  - gate_6A
  produced_by:
  - 6A.S3
  consumed_by:
  - 6A.S4
  - 6A.S5
  - 6B.S0
  - 6B.S1
  final_in_layer: null
- output_id: s3_instrument_summary_6A
  layer: layer3
  segment: 6A
  class: surface
  description: Aggregate instrument diagnostics for Layer-3 / Segment 6A, providing instrument counts by geography, segment,
    account_type and instrument_type.
  path_template: data/layer3/6A/s3_instrument_summary_6A/seed={seed}/fingerprint={manifest_fingerprint}/parameter_hash={parameter_hash}/s3_instrument_summary_6A.parquet
  partitions:
  - seed
  - fingerprint
  - parameter_hash
  scope: seed_fingerprint_parameter
  schema_ref: schemas.6A.yaml#/s3/instrument_summary
  dictionary_ref: layer3.6A:s3_instrument_summary_6A
  primary_key:
  - region_id
  - segment_id
  - account_type
  - instrument_type
  - scheme
  join_keys:
  - region_id
  - segment_id
  - account_type
  - instrument_type
  - scheme
  read_requires_gates:
  - gate_6A
  produced_by:
  - 6A.S3
  consumed_by:
  - 6A.S3
  - 6A.S4
  - 6B.S0
  final_in_layer: null
- output_id: s3_party_instrument_holdings_6A
  layer: layer3
  segment: 6A
  class: surface
  description: Per-party instrument holdings for Layer-3 / Segment 6A, derived from s3_instrument_base_6A and s1_party_base_6A;
    one row per (party_id, instrument grouping) with instrument_count.
  path_template: data/layer3/6A/s3_party_instrument_holdings_6A/seed={seed}/fingerprint={manifest_fingerprint}/parameter_hash={parameter_hash}/s3_party_instrument_holdings_6A.parquet
  partitions:
  - seed
  - fingerprint
  - parameter_hash
  scope: seed_fingerprint_parameter
  schema_ref: schemas.6A.yaml#/s3/party_instrument_holdings
  dictionary_ref: layer3.6A:s3_party_instrument_holdings_6A
  primary_key:
  - party_id
  - instrument_type
  - scheme
  join_keys:
  - party_id
  - instrument_type
  - scheme
  read_requires_gates:
  - gate_6A
  produced_by:
  - 6A.S3
  consumed_by:
  - 6A.S4
  - 6A.S5
  - 6B.S0
  final_in_layer: null
- output_id: s4_device_base_6A
  layer: layer3
  segment: 6A
  class: surface
  description: Device universe for Layer-3 / Segment 6A. One row per device per (manifest_fingerprint, seed), with device
    classification, primary owner context and static device risk/capability flags.
  path_template: data/layer3/6A/s4_device_base_6A/seed={seed}/fingerprint={manifest_fingerprint}/parameter_hash={parameter_hash}/s4_device_base_6A.parquet
  partitions:
  - seed
  - fingerprint
  - parameter_hash
  scope: seed_fingerprint_parameter
  schema_ref: schemas.6A.yaml#/s4/device_base
  dictionary_ref: layer3.6A:s4_device_base_6A
  primary_key:
  - device_type
  - primary_party_id
  - primary_merchant_id
  - device_id
  join_keys:
  - device_type
  - primary_party_id
  - primary_merchant_id
  - device_id
  read_requires_gates:
  - gate_6A
  produced_by:
  - 6A.S4
  consumed_by:
  - 6A.S5
  - 6B.S0
  - 6B.S1
  final_in_layer: null
- output_id: s4_device_links_6A
  layer: layer3
  segment: 6A
  class: surface
  description: Device-to-entity edges for Layer-3 / Segment 6A. Links each device_id to one or more parties/accounts/instruments/merchants
    with a link_role describing the semantics.
  path_template: data/layer3/6A/s4_device_links_6A/seed={seed}/fingerprint={manifest_fingerprint}/parameter_hash={parameter_hash}/s4_device_links_6A.parquet
  partitions:
  - seed
  - fingerprint
  - parameter_hash
  scope: seed_fingerprint_parameter
  schema_ref: schemas.6A.yaml#/s4/device_links
  dictionary_ref: layer3.6A:s4_device_links_6A
  primary_key:
  - device_id
  - party_id
  - account_id
  - instrument_id
  - merchant_id
  - link_role
  join_keys:
  - device_id
  - party_id
  - account_id
  - instrument_id
  - merchant_id
  - link_role
  read_requires_gates:
  - gate_6A
  produced_by:
  - 6A.S4
  consumed_by:
  - 6A.S5
  - 6B.S0
  - 6B.S1
  final_in_layer: null
- output_id: s4_entity_neighbourhoods_6A
  layer: layer3
  segment: 6A
  class: surface
  description: Per-entity graph neighbourhood metrics for Layer-3 / Segment 6A (devices per party, IPs per device, shared-device/shared-IP
    degrees, etc.), derived from S4 base and link datasets.
  path_template: data/layer3/6A/s4_entity_neighbourhoods_6A/seed={seed}/fingerprint={manifest_fingerprint}/parameter_hash={parameter_hash}/s4_entity_neighbourhoods_6A.parquet
  partitions:
  - seed
  - fingerprint
  - parameter_hash
  scope: seed_fingerprint_parameter
  schema_ref: schemas.6A.yaml#/s4/entity_neighbourhoods
  dictionary_ref: layer3.6A:s4_entity_neighbourhoods_6A
  primary_key:
  - entity_type
  - entity_id
  join_keys:
  - entity_type
  - entity_id
  read_requires_gates:
  - gate_6A
  produced_by:
  - 6A.S4
  consumed_by:
  - 6A.S5
  - 6B.S0
  final_in_layer: null
- output_id: s4_ip_base_6A
  layer: layer3
  segment: 6A
  class: surface
  description: IP / network endpoint universe for Layer-3 / Segment 6A. One row per IP/endpoint per (manifest_fingerprint,
    seed), including masked representation, ip_type, asn_class, geo hints and static risk tags.
  path_template: data/layer3/6A/s4_ip_base_6A/seed={seed}/fingerprint={manifest_fingerprint}/parameter_hash={parameter_hash}/s4_ip_base_6A.parquet
  partitions:
  - seed
  - fingerprint
  - parameter_hash
  scope: seed_fingerprint_parameter
  schema_ref: schemas.6A.yaml#/s4/ip_base
  dictionary_ref: layer3.6A:s4_ip_base_6A
  primary_key:
  - ip_type
  - asn_class
  - country_iso
  - ip_id
  join_keys:
  - ip_type
  - asn_class
  - country_iso
  - ip_id
  read_requires_gates:
  - gate_6A
  produced_by:
  - 6A.S4
  consumed_by:
  - 6A.S5
  - 6B.S0
  - 6B.S1
  final_in_layer: null
- output_id: s4_ip_links_6A
  layer: layer3
  segment: 6A
  class: surface
  description: IP-to-device/entity edges for Layer-3 / Segment 6A. Links each ip_id to one or more devices/parties/merchants
    with a link_role describing the semantics.
  path_template: data/layer3/6A/s4_ip_links_6A/seed={seed}/fingerprint={manifest_fingerprint}/parameter_hash={parameter_hash}/s4_ip_links_6A.parquet
  partitions:
  - seed
  - fingerprint
  - parameter_hash
  scope: seed_fingerprint_parameter
  schema_ref: schemas.6A.yaml#/s4/ip_links
  dictionary_ref: layer3.6A:s4_ip_links_6A
  primary_key:
  - ip_id
  - device_id
  - party_id
  - merchant_id
  - link_role
  join_keys:
  - ip_id
  - device_id
  - party_id
  - merchant_id
  - link_role
  read_requires_gates:
  - gate_6A
  produced_by:
  - 6A.S4
  consumed_by:
  - 6A.S5
  - 6B.S0
  - 6B.S1
  final_in_layer: null
- output_id: s4_network_summary_6A
  layer: layer3
  segment: 6A
  class: surface
  description: 'Aggregate graph diagnostics for Layer-3 / Segment 6A: degree distributions and sharing summaries per region/segment/account_type
    and globally.'
  path_template: data/layer3/6A/s4_network_summary_6A/seed={seed}/fingerprint={manifest_fingerprint}/parameter_hash={parameter_hash}/s4_network_summary_6A.parquet
  partitions:
  - seed
  - fingerprint
  - parameter_hash
  scope: seed_fingerprint_parameter
  schema_ref: schemas.6A.yaml#/s4/network_summary
  dictionary_ref: layer3.6A:s4_network_summary_6A
  primary_key:
  - region_id
  - segment_id
  - account_type
  - metric_id
  join_keys:
  - region_id
  - segment_id
  - account_type
  - metric_id
  read_requires_gates:
  - gate_6A
  produced_by:
  - 6A.S4
  consumed_by:
  - 6A.S4
  - 6A.S5
  - 6B.S0
  final_in_layer: null
- output_id: s5_account_fraud_roles_6A
  layer: layer3
  segment: 6A
  class: surface
  description: Static fraud posture for accounts in Layer-3 / Segment 6A. One row per account per (manifest_fingerprint, seed).
  path_template: data/layer3/6A/s5_account_fraud_roles_6A/seed={seed}/fingerprint={manifest_fingerprint}/parameter_hash={parameter_hash}/s5_account_fraud_roles_6A.parquet
  partitions:
  - seed
  - fingerprint
  - parameter_hash
  scope: seed_fingerprint_parameter
  schema_ref: schemas.6A.yaml#/s5/account_fraud_roles
  dictionary_ref: layer3.6A:s5_account_fraud_roles_6A
  primary_key:
  - account_id
  join_keys:
  - account_id
  read_requires_gates:
  - gate_6A
  produced_by:
  - 6A.S5
  consumed_by:
  - 6B.S0
  - 6B.S1
  - 6B.S2
  final_in_layer: null
- output_id: s5_device_fraud_roles_6A
  layer: layer3
  segment: 6A
  class: surface
  description: Static fraud posture for devices in Layer-3 / Segment 6A. One row per device per (manifest_fingerprint, seed).
  path_template: data/layer3/6A/s5_device_fraud_roles_6A/seed={seed}/fingerprint={manifest_fingerprint}/parameter_hash={parameter_hash}/s5_device_fraud_roles_6A.parquet
  partitions:
  - seed
  - fingerprint
  - parameter_hash
  scope: seed_fingerprint_parameter
  schema_ref: schemas.6A.yaml#/s5/device_fraud_roles
  dictionary_ref: layer3.6A:s5_device_fraud_roles_6A
  primary_key:
  - device_id
  join_keys:
  - device_id
  read_requires_gates:
  - gate_6A
  produced_by:
  - 6A.S5
  consumed_by:
  - 6B.S0
  - 6B.S1
  final_in_layer: null
- output_id: s5_ip_fraud_roles_6A
  layer: layer3
  segment: 6A
  class: surface
  description: Static fraud posture for IPs/endpoints in Layer-3 / Segment 6A. One row per ip_id per (manifest_fingerprint,
    seed).
  path_template: data/layer3/6A/s5_ip_fraud_roles_6A/seed={seed}/fingerprint={manifest_fingerprint}/parameter_hash={parameter_hash}/s5_ip_fraud_roles_6A.parquet
  partitions:
  - seed
  - fingerprint
  - parameter_hash
  scope: seed_fingerprint_parameter
  schema_ref: schemas.6A.yaml#/s5/ip_fraud_roles
  dictionary_ref: layer3.6A:s5_ip_fraud_roles_6A
  primary_key:
  - ip_id
  join_keys:
  - ip_id
  read_requires_gates:
  - gate_6A
  produced_by:
  - 6A.S5
  consumed_by:
  - 6B.S0
  - 6B.S1
  final_in_layer: null
- output_id: s5_issue_table_6A
  layer: layer3
  segment: 6A
  class: surface
  description: Row-level issue table for 6A validation, containing one row per failing/borderline check instance.
  path_template: data/layer3/6A/validation/fingerprint={manifest_fingerprint}/s5_issue_table_6A.parquet
  partitions:
  - fingerprint
  scope: fingerprint
  schema_ref: schemas.layer3.yaml#/validation/6A/validation_issue_table_6A
  dictionary_ref: layer3.6A:s5_issue_table_6A
  primary_key:
  - check_id
  - scope_type
  - issue_id
  join_keys:
  - check_id
  - scope_type
  - issue_id
  read_requires_gates:
  - gate_6A
  produced_by:
  - 6A.S5
  consumed_by:
  - 6B.S0
  - 6B.S1
  final_in_layer: null
- output_id: s5_merchant_fraud_roles_6A
  layer: layer3
  segment: 6A
  class: surface
  description: Static fraud posture for merchants in Layer-3 / Segment 6A. One row per merchant, keyed by merchant_id.
  path_template: data/layer3/6A/s5_merchant_fraud_roles_6A/seed={seed}/fingerprint={manifest_fingerprint}/parameter_hash={parameter_hash}/s5_merchant_fraud_roles_6A.parquet
  partitions:
  - seed
  - fingerprint
  - parameter_hash
  scope: seed_fingerprint_parameter
  schema_ref: schemas.6A.yaml#/s5/merchant_fraud_roles
  dictionary_ref: layer3.6A:s5_merchant_fraud_roles_6A
  primary_key:
  - merchant_id
  join_keys:
  - merchant_id
  read_requires_gates:
  - gate_6A
  produced_by:
  - 6A.S5
  consumed_by:
  - 6B.S0
  - 6B.S1
  - 6B.S2
  final_in_layer: null
- output_id: s5_party_fraud_roles_6A
  layer: layer3
  segment: 6A
  class: surface
  description: Static fraud posture for parties in Layer-3 / Segment 6A. One row per party per (manifest_fingerprint, seed).
  path_template: data/layer3/6A/s5_party_fraud_roles_6A/seed={seed}/fingerprint={manifest_fingerprint}/parameter_hash={parameter_hash}/s5_party_fraud_roles_6A.parquet
  partitions:
  - seed
  - fingerprint
  - parameter_hash
  scope: seed_fingerprint_parameter
  schema_ref: schemas.6A.yaml#/s5/party_fraud_roles
  dictionary_ref: layer3.6A:s5_party_fraud_roles_6A
  primary_key:
  - party_id
  join_keys:
  - party_id
  read_requires_gates:
  - gate_6A
  produced_by:
  - 6A.S5
  consumed_by:
  - 6B.S0
  - 6B.S1
  - 6B.S2
  final_in_layer: null
- output_id: s5_validation_report_6A
  layer: layer3
  segment: 6A
  class: surface
  description: Segment-level validation report for Layer-3 / Segment 6A, summarising the results of S5 checks across S1–S4
    and S5 fraud roles.
  path_template: data/layer3/6A/validation/fingerprint={manifest_fingerprint}/s5_validation_report_6A.json
  partitions:
  - fingerprint
  scope: fingerprint
  schema_ref: schemas.layer3.yaml#/validation/6A/validation_report_6A
  dictionary_ref: layer3.6A:s5_validation_report_6A
  primary_key: []
  join_keys: []
  read_requires_gates:
  - gate_6A
  produced_by:
  - 6A.S5
  consumed_by:
  - 6B.S0
  - 6B.S1
  final_in_layer: null
- output_id: sealed_inputs_6A
  layer: layer3
  segment: 6A
  class: surface
  description: Manifest of all artefacts 6A is authorised to depend on for a given manifest_fingerprint, with roles, digests,
    and read scopes.
  path_template: data/layer3/6A/sealed_inputs/fingerprint={manifest_fingerprint}/sealed_inputs_6A.parquet
  partitions:
  - fingerprint
  scope: fingerprint
  schema_ref: schemas.layer3.yaml#/gate/6A/sealed_inputs_6A
  dictionary_ref: layer3.6A:sealed_inputs_6A
  primary_key:
  - owner_layer
  - owner_segment
  - manifest_key
  join_keys:
  - owner_layer
  - owner_segment
  - manifest_key
  read_requires_gates:
  - gate_6A
  produced_by:
  - 6A.S0
  consumed_by:
  - 6A.S1
  - 6A.S2
  - 6A.S3
  - 6A.S4
  - 6A.S5
  - 6B.S0
  final_in_layer: null
- output_id: s0_gate_receipt_6B
  layer: layer3
  segment: 6B
  class: gate_artifact
  description: Behavioural gate receipt for 6B; one JSON object per manifest_fingerprint summarising upstream gates, contracts_6B
    and sealed_inputs_digest_6B.
  path_template: data/layer3/6B/gate_receipt/fingerprint={manifest_fingerprint}/s0_gate_receipt_6B.json
  partitions:
  - fingerprint
  scope: fingerprint
  schema_ref: schemas.layer3.yaml#/gate/6B/s0_gate_receipt_6B
  dictionary_ref: layer3.6B:s0_gate_receipt_6B
  primary_key: []
  join_keys: []
  read_requires_gates: []
  produced_by:
  - 6B.S0
  consumed_by:
  - 6B.S1
  - 6B.S2
  - 6B.S3
  - 6B.S4
  - 6B.S5
  - 4A
  - 4B
  final_in_layer: null
- output_id: validation_bundle_6B
  layer: layer3
  segment: 6B
  class: gate_artifact
  description: World-level validation bundle for Segment 6B; directory of validation artefacts plus index.json and _passed.flag.
  path_template: data/layer3/6B/validation/fingerprint={manifest_fingerprint}/
  partitions:
  - fingerprint
  scope: fingerprint
  schema_ref: schemas.layer3.yaml#/validation/6B/validation_bundle_index_6B
  dictionary_ref: layer3.6B:validation_bundle_6B
  primary_key: []
  join_keys: []
  read_requires_gates: []
  produced_by:
  - 6B.S5
  consumed_by:
  - 6B.S5
  - 4A
  - 4B
  - ops_tooling
  final_in_layer: null
- output_id: validation_passed_flag_6B
  layer: layer3
  segment: 6B
  class: gate_artifact
  description: Segment 6B HashGate flag; encodes SHA-256 digest over the 6B validation bundle.
  path_template: data/layer3/6B/validation/fingerprint={manifest_fingerprint}/_passed.flag
  partitions:
  - fingerprint
  scope: fingerprint
  schema_ref: schemas.layer3.yaml#/validation/6B/passed_flag_6B
  dictionary_ref: layer3.6B:validation_passed_flag_6B
  primary_key: []
  join_keys: []
  read_requires_gates: []
  produced_by:
  - 6B.S5
  consumed_by:
  - 6B.S5
  - 4A
  - 4B
  - ops_tooling
  final_in_layer: null
- output_id: s1_arrival_entities_6B
  layer: layer3
  segment: 6B
  class: surface
  description: Arrival events from 5B enriched with entity attachments and session identifiers for Layer-3 behaviour; one
    row per arrival.
  path_template: data/layer3/6B/s1_arrival_entities_6B/seed={seed}/fingerprint={manifest_fingerprint}/parameter_hash={parameter_hash}/scenario_id={scenario_id}/part-*.parquet
  partitions:
  - seed
  - fingerprint
  - parameter_hash
  - scenario_id
  scope: seed_scenario
  schema_ref: schemas.6B.yaml#/s1/arrival_entities_6B
  dictionary_ref: layer3.6B:s1_arrival_entities_6B
  primary_key:
  - seed
  - manifest_fingerprint
  - scenario_id
  - merchant_id
  - arrival_seq
  join_keys:
  - seed
  - manifest_fingerprint
  - scenario_id
  - merchant_id
  - arrival_seq
  read_requires_gates:
  - gate_6B
  produced_by:
  - 6B.S1
  consumed_by:
  - 6B.S2
  - 6B.S3
  - 6B.S4
  - 6B.S5
  final_in_layer: null
- output_id: s1_session_index_6B
  layer: layer3
  segment: 6B
  class: surface
  description: Session index for 6B arrivals; one row per session with party/device/IP relationships and anchor metadata.
  path_template: data/layer3/6B/s1_session_index_6B/seed={seed}/fingerprint={manifest_fingerprint}/parameter_hash={parameter_hash}/scenario_id={scenario_id}/part-*.parquet
  partitions:
  - seed
  - fingerprint
  - parameter_hash
  - scenario_id
  scope: seed_scenario
  schema_ref: schemas.6B.yaml#/s1/session_index_6B
  dictionary_ref: layer3.6B:s1_session_index_6B
  primary_key:
  - seed
  - manifest_fingerprint
  - scenario_id
  - session_id
  join_keys:
  - seed
  - manifest_fingerprint
  - scenario_id
  - session_id
  read_requires_gates:
  - gate_6B
  produced_by:
  - 6B.S1
  consumed_by:
  - 6B.S2
  - 6B.S3
  - 6B.S4
  - 6B.S5
  final_in_layer: null
- output_id: s2_event_stream_baseline_6B
  layer: layer3
  segment: 6B
  class: surface
  description: Baseline event stream for each flow (auth/clearing/refund/etc.).
  path_template: data/layer3/6B/s2_event_stream_baseline_6B/seed={seed}/fingerprint={manifest_fingerprint}/parameter_hash={parameter_hash}/scenario_id={scenario_id}/part-*.parquet
  partitions:
  - seed
  - fingerprint
  - parameter_hash
  - scenario_id
  scope: seed_scenario
  schema_ref: schemas.6B.yaml#/s2/event_stream_baseline_6B
  dictionary_ref: layer3.6B:s2_event_stream_baseline_6B
  primary_key:
  - seed
  - manifest_fingerprint
  - scenario_id
  - flow_id
  - event_seq
  join_keys:
  - seed
  - manifest_fingerprint
  - scenario_id
  - flow_id
  - event_seq
  read_requires_gates:
  - gate_6B
  produced_by:
  - 6B.S2
  consumed_by:
  - 6B.S3
  - 6B.S4
  - 6B.S5
  final_in_layer: null
- output_id: s2_flow_anchor_baseline_6B
  layer: layer3
  segment: 6B
  class: surface
  description: Baseline flow anchors (all-legit) for 6B. One row per flow_id per (seed, manifest_fingerprint, scenario_id).
  path_template: data/layer3/6B/s2_flow_anchor_baseline_6B/seed={seed}/fingerprint={manifest_fingerprint}/parameter_hash={parameter_hash}/scenario_id={scenario_id}/part-*.parquet
  partitions:
  - seed
  - fingerprint
  - parameter_hash
  - scenario_id
  scope: seed_scenario
  schema_ref: schemas.6B.yaml#/s2/flow_anchor_baseline_6B
  dictionary_ref: layer3.6B:s2_flow_anchor_baseline_6B
  primary_key:
  - seed
  - manifest_fingerprint
  - scenario_id
  - flow_id
  join_keys:
  - seed
  - manifest_fingerprint
  - scenario_id
  - flow_id
  read_requires_gates:
  - gate_6B
  produced_by:
  - 6B.S2
  consumed_by:
  - 6B.S3
  - 6B.S4
  - 6B.S5
  final_in_layer: null
- output_id: s3_campaign_catalogue_6B
  layer: layer3
  segment: 6B
  class: surface
  description: Catalogue of realised fraud/abuse campaigns with campaign_id, fraud_type, parameters and the flows affected.
  path_template: data/layer3/6B/s3_campaign_catalogue_6B/seed={seed}/fingerprint={manifest_fingerprint}/parameter_hash={parameter_hash}/scenario_id={scenario_id}/s3_campaign_catalogue_6B.parquet
  partitions:
  - seed
  - fingerprint
  - parameter_hash
  - scenario_id
  scope: seed_scenario
  schema_ref: schemas.6B.yaml#/s3/campaign_catalogue_6B
  dictionary_ref: layer3.6B:s3_campaign_catalogue_6B
  primary_key:
  - campaign_id
  join_keys:
  - campaign_id
  read_requires_gates:
  - gate_6B
  produced_by:
  - 6B.S3
  consumed_by:
  - 6B.S4
  - 6B.S5
  final_in_layer: null
- output_id: s3_event_stream_with_fraud_6B
  layer: layer3
  segment: 6B
  class: surface
  description: Event stream after fraud overlays. Contains synthetic fraud behaviours for training/labelling flows.
  path_template: data/layer3/6B/s3_event_stream_with_fraud_6B/seed={seed}/fingerprint={manifest_fingerprint}/parameter_hash={parameter_hash}/scenario_id={scenario_id}/part-*.parquet
  partitions:
  - seed
  - fingerprint
  - parameter_hash
  - scenario_id
  scope: seed_scenario
  schema_ref: schemas.6B.yaml#/s3/event_stream_with_fraud_6B
  dictionary_ref: layer3.6B:s3_event_stream_with_fraud_6B
  primary_key:
  - seed
  - manifest_fingerprint
  - scenario_id
  - flow_id
  - event_seq
  join_keys:
  - seed
  - manifest_fingerprint
  - scenario_id
  - flow_id
  - event_seq
  read_requires_gates:
  - gate_6B
  produced_by:
  - 6B.S3
  consumed_by:
  - 6B.S4
  - 6B.S5
  final_in_layer: null
- output_id: s3_flow_anchor_with_fraud_6B
  layer: layer3
  segment: 6B
  class: surface
  description: Flow anchors after fraud overlays and campaign adjustments are applied.
  path_template: data/layer3/6B/s3_flow_anchor_with_fraud_6B/seed={seed}/fingerprint={manifest_fingerprint}/parameter_hash={parameter_hash}/scenario_id={scenario_id}/part-*.parquet
  partitions:
  - seed
  - fingerprint
  - parameter_hash
  - scenario_id
  scope: seed_scenario
  schema_ref: schemas.6B.yaml#/s3/flow_anchor_with_fraud_6B
  dictionary_ref: layer3.6B:s3_flow_anchor_with_fraud_6B
  primary_key:
  - seed
  - manifest_fingerprint
  - scenario_id
  - flow_id
  join_keys:
  - seed
  - manifest_fingerprint
  - scenario_id
  - flow_id
  read_requires_gates:
  - gate_6B
  produced_by:
  - 6B.S3
  consumed_by:
  - 6B.S4
  - 6B.S5
  final_in_layer: null
- output_id: s4_case_timeline_6B
  layer: layer3
  segment: 6B
  class: surface
  description: Case timeline events for flows promoted to manual review or automated cases.
  path_template: data/layer3/6B/s4_case_timeline_6B/seed={seed}/fingerprint={manifest_fingerprint}/parameter_hash={parameter_hash}/scenario_id={scenario_id}/part-*.parquet
  partitions:
  - seed
  - fingerprint
  - parameter_hash
  - scenario_id
  scope: seed_scenario
  schema_ref: schemas.6B.yaml#/s4/case_timeline_6B
  dictionary_ref: layer3.6B:s4_case_timeline_6B
  primary_key:
  - case_id
  - case_event_seq
  join_keys:
  - case_id
  - case_event_seq
  read_requires_gates:
  - gate_6B
  produced_by:
  - 6B.S4
  consumed_by:
  - 6B.S5
  - 4A
  - 4B
  - model_training
  final_in_layer: null
- output_id: s4_event_labels_6B
  layer: layer3
  segment: 6B
  class: surface
  description: Event-level truth and bank-view labels keyed to s3_event_stream_with_fraud_6B.
  path_template: data/layer3/6B/s4_event_labels_6B/seed={seed}/fingerprint={manifest_fingerprint}/parameter_hash={parameter_hash}/scenario_id={scenario_id}/part-*.parquet
  partitions:
  - seed
  - fingerprint
  - parameter_hash
  - scenario_id
  scope: seed_scenario
  schema_ref: schemas.6B.yaml#/s4/event_labels_6B
  dictionary_ref: layer3.6B:s4_event_labels_6B
  primary_key:
  - seed
  - manifest_fingerprint
  - scenario_id
  - flow_id
  - event_seq
  join_keys:
  - seed
  - manifest_fingerprint
  - scenario_id
  - flow_id
  - event_seq
  read_requires_gates:
  - gate_6B
  produced_by:
  - 6B.S4
  consumed_by:
  - 6B.S5
  - 4A
  - 4B
  - model_training
  final_in_layer: null
- output_id: s4_flow_bank_view_6B
  layer: layer3
  segment: 6B
  class: surface
  description: Bank-view classification of each flow (what the institution sees / would act on).
  path_template: data/layer3/6B/s4_flow_bank_view_6B/seed={seed}/fingerprint={manifest_fingerprint}/parameter_hash={parameter_hash}/scenario_id={scenario_id}/part-*.parquet
  partitions:
  - seed
  - fingerprint
  - parameter_hash
  - scenario_id
  scope: seed_scenario
  schema_ref: schemas.6B.yaml#/s4/flow_bank_view_6B
  dictionary_ref: layer3.6B:s4_flow_bank_view_6B
  primary_key:
  - seed
  - manifest_fingerprint
  - scenario_id
  - flow_id
  join_keys:
  - seed
  - manifest_fingerprint
  - scenario_id
  - flow_id
  read_requires_gates:
  - gate_6B
  produced_by:
  - 6B.S4
  consumed_by:
  - 6B.S5
  - 4A
  - 4B
  - model_training
  final_in_layer: null
- output_id: s4_flow_truth_labels_6B
  layer: layer3
  segment: 6B
  class: surface
  description: Flow-level ground truth labels used by 4A/4B and model training.
  path_template: data/layer3/6B/s4_flow_truth_labels_6B/seed={seed}/fingerprint={manifest_fingerprint}/parameter_hash={parameter_hash}/scenario_id={scenario_id}/part-*.parquet
  partitions:
  - seed
  - fingerprint
  - parameter_hash
  - scenario_id
  scope: seed_scenario
  schema_ref: schemas.6B.yaml#/s4/flow_truth_labels_6B
  dictionary_ref: layer3.6B:s4_flow_truth_labels_6B
  primary_key:
  - seed
  - manifest_fingerprint
  - scenario_id
  - flow_id
  join_keys:
  - seed
  - manifest_fingerprint
  - scenario_id
  - flow_id
  read_requires_gates:
  - gate_6B
  produced_by:
  - 6B.S4
  consumed_by:
  - 6B.S5
  - 4A
  - 4B
  - model_training
  final_in_layer: null
- output_id: s5_issue_table_6B
  layer: layer3
  segment: 6B
  class: surface
  description: Structured list of validation issues for 6B (one row per failing/warning check).
  path_template: data/layer3/6B/validation/fingerprint={manifest_fingerprint}/s5_issue_table_6B.parquet
  partitions:
  - fingerprint
  scope: fingerprint
  schema_ref: schemas.layer3.yaml#/validation/6B/s5_issue_table
  dictionary_ref: layer3.6B:s5_issue_table_6B
  primary_key:
  - manifest_fingerprint
  - check_id
  - issue_id
  join_keys:
  - manifest_fingerprint
  - check_id
  - issue_id
  read_requires_gates:
  - gate_6B
  produced_by:
  - 6B.S5
  consumed_by:
  - 6B.S5_bundle
  - ops_tooling
  final_in_layer: null
- output_id: s5_validation_report_6B
  layer: layer3
  segment: 6B
  class: surface
  description: Segment 6B world-level validation report; one JSON document summarising the results of S5 checks across S1-S4
    artefacts.
  path_template: data/layer3/6B/validation/fingerprint={manifest_fingerprint}/s5_validation_report_6B.json
  partitions:
  - fingerprint
  scope: fingerprint
  schema_ref: schemas.layer3.yaml#/validation/6B/s5_validation_report
  dictionary_ref: layer3.6B:s5_validation_report_6B
  primary_key: []
  join_keys: []
  read_requires_gates:
  - gate_6B
  produced_by:
  - 6B.S5
  consumed_by:
  - 6B.S5_bundle
  - 4A
  - 4B
  - ops_tooling
  final_in_layer: null
- output_id: sealed_inputs_6B
  layer: layer3
  segment: 6B
  class: surface
  description: Sealed list of all artefacts 6B is allowed to read for a given manifest_fingerprint, with roles, schema_refs
    and digests.
  path_template: data/layer3/6B/sealed_inputs/fingerprint={manifest_fingerprint}/sealed_inputs_6B.parquet
  partitions:
  - fingerprint
  scope: fingerprint
  schema_ref: schemas.layer3.yaml#/gate/6B/sealed_inputs_6B
  dictionary_ref: layer3.6B:sealed_inputs_6B
  primary_key:
  - owner_layer
  - owner_segment
  - manifest_key
  join_keys:
  - owner_layer
  - owner_segment
  - manifest_key
  read_requires_gates:
  - gate_6B
  produced_by:
  - 6B.S0
  consumed_by:
  - 6B.S1
  - 6B.S2
  - 6B.S3
  - 6B.S4
  - 6B.S5
  final_in_layer: null
