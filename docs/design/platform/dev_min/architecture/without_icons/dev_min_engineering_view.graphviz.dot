digraph DevMinEngineeringNoIcons {
  graph [rankdir=LR, fontname="Helvetica", fontsize=11, label="Dev_min Architecture - Engineering View (No Icons)", labelloc=t, labeljust=l, pad="0.2", splines=true];
  node  [shape=box, style="rounded,filled", fillcolor="#F8FAFC", color="#CBD5E1", fontname="Helvetica", fontsize=9];
  edge  [color="#334155", penwidth=1.1, arrowsize=0.75, fontname="Helvetica", fontsize=8];

  subgraph cluster_core {
    label="Core Terraform Root";
    color="#1D4ED8"; style="rounded,dashed";
    core_s3_object [label="S3 object-store"];
    core_s3_evidence [label="S3 evidence"];
    core_s3_quarantine [label="S3 quarantine"];
    core_s3_archive [label="S3 archive"];
    core_s3_tfstate [label="S3 tfstate backend"];
    core_ddb_control [label="DynamoDB control-runs"];
    core_ddb_admission [label="DynamoDB ig-admission-state"];
    core_ddb_publish [label="DynamoDB ig-publish-state"];
    core_ddb_lock [label="DynamoDB tf-lock"];
    core_budget [label="AWS Budget"];
  }

  subgraph cluster_confluent {
    label="Confluent Terraform Root";
    color="#7C3AED"; style="rounded,dashed";
    cf_env [label="Confluent environment"];
    cf_cluster [label="Confluent kafka cluster"];
    cf_topics [label="Confluent topics"];
    cf_sa_runtime [label="Service account runtime"];
    cf_sa_manager [label="Service account topic-manager"];
    cf_api_runtime [label="Runtime kafka api key"];
    cf_api_manager [label="Topic-manager api key"];
    cf_ssm_bootstrap [label="SSM confluent/bootstrap"];
    cf_ssm_key [label="SSM confluent/api_key"];
    cf_ssm_secret [label="SSM confluent/api_secret"];
    cf_topic_catalog [label="S3 topic_catalog.json"];
  }

  subgraph cluster_demo {
    label="Demo Terraform Root";
    color="#059669"; style="rounded,dashed";
    dm_remote_state [label="data.terraform_remote_state.confluent"];
    dm_vpc [label="VPC + subnets + routing"];
    dm_sg_app [label="Security group app"];
    dm_sg_db [label="Security group db"];
    dm_logs [label="CloudWatch log group"];
    dm_ecs_cluster [label="ECS cluster"];
    dm_service_probe [label="ECS service runtime-probe"];
    dm_service_daemons [label="ECS daemon services\nig, rtdl-core, decision-lane,\ncase-trigger, case-mgmt,\nlabel-store, env-conformance"];
    dm_task_control [label="ECS control tasks\nscenario-runner + world-stream-producer"];
    dm_task_oracle [label="ECS oracle tasks\noracle-stream-sort + oracle-checker"];
    dm_task_reporter [label="ECS reporter task"];
    dm_task_migrations [label="ECS db-migrations task"];
    dm_kinesis [label="Kinesis ig_event_bus"];
    dm_rds [label="RDS runtime postgres"];
    dm_ssm_bootstrap [label="SSM runtime confluent/bootstrap"];
    dm_ssm_key [label="SSM runtime confluent/api_key"];
    dm_ssm_secret [label="SSM runtime confluent/api_secret"];
    dm_ssm_db_user [label="SSM db/user"];
    dm_ssm_db_password [label="SSM db/password"];
    dm_ssm_db_dsn [label="SSM db/dsn"];
    dm_ssm_ig_api [label="SSM ig/api_key"];
    dm_manifest [label="S3 demo manifest.json"];
    dm_catalog [label="S3 demo confluent/topic_catalog.json"];
  }

  cf_env -> cf_cluster;
  cf_cluster -> cf_topics;
  cf_sa_runtime -> cf_api_runtime;
  cf_sa_manager -> cf_api_manager;
  cf_cluster -> cf_ssm_bootstrap [label="bootstrap endpoint"];
  cf_api_runtime -> cf_ssm_key [label="api key"];
  cf_api_runtime -> cf_ssm_secret [label="api secret"];
  cf_topics -> cf_topic_catalog;
  cf_topic_catalog -> core_s3_evidence [label="write"];

  cf_cluster -> dm_remote_state [style=dashed, label="output resolution"];
  cf_topics -> dm_remote_state [style=dashed];
  dm_remote_state -> dm_ssm_bootstrap [style=dashed];
  dm_remote_state -> dm_ssm_key [style=dashed];
  dm_remote_state -> dm_ssm_secret [style=dashed];

  dm_vpc -> dm_sg_app;
  dm_vpc -> dm_sg_db;
  dm_vpc -> dm_ecs_cluster;
  dm_vpc -> dm_rds;
  dm_sg_app -> dm_ecs_cluster;
  dm_sg_db -> dm_rds;

  dm_ecs_cluster -> dm_service_probe;
  dm_ecs_cluster -> dm_service_daemons;
  dm_ecs_cluster -> dm_task_control;
  dm_ecs_cluster -> dm_task_oracle;
  dm_ecs_cluster -> dm_task_reporter;
  dm_ecs_cluster -> dm_task_migrations;

  dm_service_probe -> dm_logs;
  dm_service_daemons -> dm_logs;
  dm_task_control -> dm_logs;
  dm_task_oracle -> dm_logs;
  dm_task_reporter -> dm_logs;
  dm_task_migrations -> dm_logs;

  dm_service_daemons -> dm_kinesis;
  dm_task_control -> dm_kinesis;

  dm_service_daemons -> dm_rds;
  dm_task_control -> dm_rds;
  dm_task_reporter -> dm_rds;
  dm_task_migrations -> dm_rds;

  dm_ssm_bootstrap -> dm_service_daemons;
  dm_ssm_key -> dm_service_daemons;
  dm_ssm_secret -> dm_service_daemons;
  dm_ssm_db_dsn -> dm_service_daemons;
  dm_ssm_db_dsn -> dm_task_control;
  dm_ssm_db_dsn -> dm_task_reporter;
  dm_ssm_ig_api -> dm_service_daemons;
  dm_ssm_db_user -> dm_task_migrations;
  dm_ssm_db_password -> dm_task_migrations;

  dm_service_daemons -> cf_cluster [label="kafka produce/consume"];
  dm_task_control -> cf_cluster [label="kafka produce/consume"];
  dm_service_probe -> cf_cluster [label="metadata/readiness probe"];

  dm_service_daemons -> core_s3_object [label="object data"];
  dm_task_oracle -> core_s3_object [label="stream-view outputs"];
  dm_task_oracle -> core_s3_evidence [label="run receipts"];
  dm_task_control -> core_s3_evidence [label="control evidence"];
  dm_task_reporter -> core_s3_evidence [label="certification evidence"];
  dm_service_daemons -> core_s3_archive [label="archive writer lane"];
  dm_service_daemons -> core_s3_quarantine [label="quarantine outputs"];
  dm_manifest -> core_s3_evidence [label="manifest publish"];
  dm_catalog -> core_s3_evidence [label="catalog publish"];

  dm_service_daemons -> core_ddb_admission [label="admission state"];
  dm_service_daemons -> core_ddb_publish [label="publish state"];
  dm_task_control -> core_ddb_control [label="run control state"];
  core_s3_tfstate -> core_ddb_lock [label="state lock discipline", color="#EA580C"];
  core_budget -> dm_ecs_cluster [style=dashed, color="#EA580C", label="cost guardrail scope"];
  core_budget -> cf_cluster [style=dashed, color="#EA580C", label="cost guardrail scope"];
}
