digraph DevMinNetworkWithIcons {
  graph [rankdir=LR, fontname="Helvetica", fontsize=11, label="Dev_min Network Topology (With Icons)", labelloc=t, labeljust=l, pad="0.2", splines=true];
  node [shape=box, style="rounded,filled", fillcolor="#F8FAFC", color="#CBD5E1", fontname="Helvetica", fontsize=9, margin="0.45,0.18"];
  edge [color="#334155", penwidth=1.1, arrowsize=0.75, fontname="Helvetica", fontsize=8];

  subgraph cluster_internet {
    label="Internet Edge";
    color="#64748B"; style="rounded,dashed";
    internet [label="Public internet\n0.0.0.0/0", image="/workspace/docs/design/platform/assets/iconpack_professional_18/internet.png", imagescale=true, imagepos="ml", labelloc="b"];
  }

  subgraph cluster_vpc {
    label="VPC (aws_vpc.demo)";
    color="#2563EB"; style="rounded,dashed";
    vpc [label="VPC CIDR\nvar.vpc_cidr", image="/workspace/docs/design/platform/assets/iconpack_professional_18/vpc.png", imagescale=true, imagepos="ml", labelloc="b"];
    igw [label="Internet gateway\naws_internet_gateway.demo", image="/workspace/docs/design/platform/assets/iconpack_professional_18/gateway.png", imagescale=true, imagepos="ml", labelloc="b"];
    rt_public [label="Public route table\naws_route_table.public", image="/workspace/docs/design/platform/assets/iconpack_professional_18/route.png", imagescale=true, imagepos="ml", labelloc="b"];
    route_default [label="0.0.0.0/0 -> IGW\naws_route.internet", image="/workspace/docs/design/platform/assets/iconpack_professional_18/route.png", imagescale=true, imagepos="ml", labelloc="b"];
    subnet_a [label="Public subnet A\naws_subnet.public[0]", image="/workspace/docs/design/platform/assets/iconpack_professional_18/subnet.png", imagescale=true, imagepos="ml", labelloc="b"];
    subnet_b [label="Public subnet B\naws_subnet.public[1]", image="/workspace/docs/design/platform/assets/iconpack_professional_18/subnet.png", imagescale=true, imagepos="ml", labelloc="b"];
    rta [label="Route table associations\naws_route_table_association.public[*]", image="/workspace/docs/design/platform/assets/iconpack_professional_18/route.png", imagescale=true, imagepos="ml", labelloc="b"];

    sg_app [label="App security group\nIngress: tcp/8080 from 0.0.0.0/0\nEgress: all", image="/workspace/docs/design/platform/assets/iconpack_professional_18/security.png", imagescale=true, imagepos="ml", labelloc="b"];
    sg_db [label="DB security group\nIngress: tcp/var.db_port from App SG\nEgress: all", image="/workspace/docs/design/platform/assets/iconpack_professional_18/security.png", imagescale=true, imagepos="ml", labelloc="b"];

    ecs_probe [label="runtime-probe service\nassign_public_ip=true\nsubnets=public[*]\nsg=app", image="/workspace/docs/design/platform/assets/iconpack_professional_18/ecs.png", imagescale=true, imagepos="ml", labelloc="b"];
    ecs_daemons [label="daemon services\nassign_public_ip=true\nsubnets=public[*]\nsg=app", image="/workspace/docs/design/platform/assets/iconpack_professional_18/ecs.png", imagescale=true, imagepos="ml", labelloc="b"];

    db_subnet_group [label="aws_db_subnet_group.demo\nsubnets=public[*]", image="/workspace/docs/design/platform/assets/iconpack_professional_18/subnet.png", imagescale=true, imagepos="ml", labelloc="b"];
    rds [label="aws_db_instance.runtime\nsg=db\npublicly_accessible=var.db_publicly_accessible", image="/workspace/docs/design/platform/assets/iconpack_professional_18/rds.png", imagescale=true, imagepos="ml", labelloc="b"];

    note_no_nat [label="[NOTE] No NAT gateway provisioned", shape=note, fillcolor="#FEF3C7", color="#D97706"];
    note_no_lb [label="[NOTE] No ALB/NLB provisioned", shape=note, fillcolor="#FEF3C7", color="#D97706"];
  }

  internet -> igw [label="internet edge"];
  vpc -> igw;
  vpc -> rt_public;
  rt_public -> route_default;
  route_default -> igw;
  vpc -> subnet_a;
  vpc -> subnet_b;
  rta -> subnet_a;
  rta -> subnet_b;
  rta -> rt_public;

  vpc -> sg_app;
  vpc -> sg_db;

  subnet_a -> ecs_probe;
  subnet_b -> ecs_probe;
  subnet_a -> ecs_daemons;
  subnet_b -> ecs_daemons;
  sg_app -> ecs_probe;
  sg_app -> ecs_daemons;

  sg_app -> sg_db [label="db port access path"];
  sg_db -> rds;
  subnet_a -> db_subnet_group;
  subnet_b -> db_subnet_group;
  db_subnet_group -> rds;

  ecs_probe -> internet [style=dashed, label="egress allowed"];
  ecs_daemons -> internet [style=dashed, label="egress allowed"];
}
