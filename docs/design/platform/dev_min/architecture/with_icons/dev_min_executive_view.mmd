%%{init: {
  "theme": "base",
  "themeVariables": {
    "fontFamily": "Inter, Segoe UI, Arial",
    "primaryTextColor": "#0F172A",
    "lineColor": "#334155",
    "tertiaryColor": "#F8FAFC",
    "background": "#FFFFFF"
  }
}}%%
flowchart LR
  subgraph Core["Core Stack (Persistent Control Surfaces)"]
    CoreS3@{ icon: "simple-icons:amazons3", form: "rounded", label: "S3 buckets", pos: "b", h: 58 }
    CoreDDB@{ icon: "simple-icons:amazondynamodb", form: "rounded", label: "DynamoDB state tables", pos: "b", h: 58 }
    CoreBudget@{ icon: "mdi:cash-multiple", form: "rounded", label: "Budget guardrail", pos: "b", h: 58 }
  end

  subgraph Confluent["Confluent Stack (Managed Streaming)"]
    CCluster@{ icon: "simple-icons:apachekafka", form: "rounded", label: "Kafka cluster", pos: "b", h: 58 }
    CTopics@{ icon: "simple-icons:apachekafka", form: "rounded", label: "Platform topics", pos: "b", h: 58 }
    CCreds@{ icon: "mdi:key", form: "rounded", label: "Runtime kafka credentials", pos: "b", h: 58 }
    CCatalog@{ icon: "mdi:file-document-check", form: "rounded", label: "Topic catalog artifact", pos: "b", h: 58 }
  end

  subgraph Demo["Demo Stack (Ephemeral Runtime)"]
    DECS@{ icon: "simple-icons:amazonecs", form: "rounded", label: "ECS runtime", pos: "b", h: 58 }
    DRDS@{ icon: "simple-icons:postgresql", form: "rounded", label: "RDS postgres truth store", pos: "b", h: 58 }
    DKinesis@{ icon: "mdi:waves", form: "rounded", label: "Kinesis control bus", pos: "b", h: 58 }
    DSSM@{ icon: "mdi:key", form: "rounded", label: "SSM runtime parameters", pos: "b", h: 58 }
  end

  CCluster -->|hosts| CTopics
  CTopics -->|managed stream transport| DECS
  CCreds -->|credential materialization| DSSM
  CCatalog -->|catalog evidence| CoreS3
  DSSM -->|runtime config and auth| DECS
  DECS -->|read/write operational truth| DRDS
  DECS -->|control plane publish/read| DKinesis
  DECS -->|object/evidence/archive writes| CoreS3
  DECS -->|state ownership surfaces| CoreDDB
  CoreBudget -.->|cost governance scope| DECS
  CoreBudget -.->|cost governance scope| CCluster

  style Core fill:#EFF6FF,stroke:#2563EB,stroke-width:2px
  style Confluent fill:#FDF4FF,stroke:#9333EA,stroke-width:2px
  style Demo fill:#ECFDF5,stroke:#10B981,stroke-width:2px

  class CoreS3,CoreDDB awsdata
  class CoreBudget budget
  class CCluster,CTopics stream
  class CCreds,DSSM security
  class CCatalog artifact
  class DECS runtime
  class DRDS datastore
  class DKinesis bus

  classDef awsdata fill:#DBEAFE,stroke:#2563EB,stroke-width:1.6px,color:#0F172A;
  classDef budget fill:#FEF3C7,stroke:#D97706,stroke-width:1.8px,color:#7C2D12;
  classDef stream fill:#F3E8FF,stroke:#7E22CE,stroke-width:1.6px,color:#3B0764;
  classDef security fill:#E0F2FE,stroke:#0284C7,stroke-width:1.6px,color:#0C4A6E;
  classDef artifact fill:#F1F5F9,stroke:#64748B,stroke-width:1.4px,color:#0F172A;
  classDef runtime fill:#DCFCE7,stroke:#16A34A,stroke-width:1.8px,color:#14532D;
  classDef datastore fill:#FFE4E6,stroke:#E11D48,stroke-width:1.6px,color:#881337;
  classDef bus fill:#CCFBF1,stroke:#0F766E,stroke-width:1.6px,color:#134E4A;
