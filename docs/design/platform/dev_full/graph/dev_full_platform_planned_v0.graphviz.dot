digraph DevFullPlatformPlannedV0 {
  graph [
    label="Dev Full Platform Architecture (Planned v0, Authority-Aligned)",
    labelloc=t,
    fontsize=18,
    fontname="Helvetica",
    rankdir=LR,
    splines=true,
    pad=0.2,
    nodesep=0.35,
    ranksep=0.7
  ];

  node [
    shape=box,
    style="rounded,filled",
    fillcolor="#F8FAFC",
    color="#334155",
    fontname="Helvetica",
    fontsize=10,
    margin="0.08,0.06"
  ];

  edge [
    color="#334155",
    fontname="Helvetica",
    fontsize=9,
    arrowsize=0.8
  ];

  subgraph cluster_delivery {
    label="Delivery + Control Plane";
    color="#CBD5E1";
    style="rounded";

    gha [label="GitHub Actions\nbuild, deploy, run workflows", fillcolor="#EEF2FF"];
    tf [label="Terraform Stacks\ncore, streaming, runtime, data_ml, ops", fillcolor="#EEF2FF"];
    ecr [label="ECR Immutable Images\ngit tag -> digest", shape=folder, fillcolor="#E0E7FF"];
    sfn [label="Step Functions\nphase gates P(-1)..P17\nrun-state commit authority", fillcolor="#DBEAFE"];
    mwaa [label="MWAA Airflow\nlearning schedules", fillcolor="#DBEAFE"];
    runctl [label="Run Control Evidence\nruntime_path, cost envelopes,\nphase receipts", shape=folder, fillcolor="#E0E7FF"];
  }

  subgraph cluster_identity {
    label="Run Identity + Correlation Law";
    color="#CBD5E1";
    style="rounded";

    rid [label="platform_run_id + scenario_run_id\nphase_id + event_id + trace_id\npreserved across all lanes", fillcolor="#F1F5F9"];
  }

  subgraph cluster_substrate {
    label="Managed Substrate Backbone";
    color="#C7D2FE";
    style="rounded";

    msk [label="AWS MSK Serverless\nKafka bus + control + learning topics", shape=cylinder, fillcolor="#EDE9FE"];
    s3obj [label="S3 Object Store\narchive, receipts, quarantine,\nrun evidence", shape=cylinder, fillcolor="#ECFEFF"];
    aurora [label="Aurora PostgreSQL Serverless v2\noperational state", shape=cylinder, fillcolor="#ECFEFF"];
    redis [label="ElastiCache Redis\nlow-latency join/state cache", shape=cylinder, fillcolor="#ECFEFF"];
    ddb [label="DynamoDB\nIG idempotency boundary", shape=cylinder, fillcolor="#ECFEFF"];
    glue [label="Glue Catalog + Iceberg v2\nlearning table authority", shape=cylinder, fillcolor="#ECFEFF"];
    cw [label="CloudWatch\nmetrics, logs, alerts", shape=cylinder, fillcolor="#ECFEFF"];
    sm [label="Secrets Manager + SSM + KMS\nruntime identity + secret handles", shape=cylinder, fillcolor="#ECFEFF"];
    split [label="Active Runtime Path Split\nFlink lanes: EKS_EMR_ON_EKS (M6P6-B2)\nIG edge: APIGW+Lambda+DDB primary\nIG on EKS: fallback only", fillcolor="#E0E7FF"];
  }

  subgraph cluster_oracle {
    label="External Oracle Boundary (Read-Only to Platform)";
    color="#99F6E4";
    style="rounded";

    oracle [label="Oracle Store S3 Zone\nwarm source-of-stream\nwriter owned by Data Engine/upstream", shape=folder, fillcolor="#CCFBF1"];
  }

  subgraph cluster_ingress {
    label="Control + Ingress Plane (Managed-First)";
    color="#BFDBFE";
    style="rounded";

    sr [label="SR READY Lane\nFlink compute on EKS host path + Step Functions commit", fillcolor="#EFF6FF"];
    wsp [label="WSP Stream Lane\nFlink publication on EKS host path", fillcolor="#DBEAFE"];
    apigw [label="API Gateway\nIG public edge (primary)", fillcolor="#DBEAFE"];
    igl [label="IG Lambda Handler\nadmission boundary + envelope checks (primary)", fillcolor="#DBEAFE"];
    igrec [label="IG Receipts + Quarantine\nappend evidence surfaces", shape=folder, fillcolor="#E0F2FE"];
    tctrl [label="fp.bus.control.v1", shape=component, fillcolor="#DCFCE7"];
    ttraffic [label="fp.bus.traffic.fraud.v1", shape=component, fillcolor="#DCFCE7"];
    tctx [label="fp.bus.context.*", shape=component, fillcolor="#DCFCE7"];
    trtdl [label="fp.bus.rtdl.v1", shape=component, fillcolor="#DCFCE7"];
    tcase [label="fp.bus.case.triggers.v1", shape=component, fillcolor="#DCFCE7"];
    tlabels [label="fp.bus.labels.events.v1", shape=component, fillcolor="#DCFCE7"];
    taudit [label="fp.bus.audit.v1", shape=component, fillcolor="#DCFCE7"];
  }

  subgraph cluster_rtdl {
    label="RTDL + Decision Plane (Hybrid)";
    color="#FDE68A";
    style="rounded";

    ieg [label="IEG Stream Projection\nFlink lane on EKS host path", fillcolor="#FEF9C3"];
    ofp [label="OFP Stream Projection\nFlink lane on EKS host path", fillcolor="#FEF9C3"];
    df [label="Decision Fabric\ncustom differentiating logic (EKS)", fillcolor="#FEF3C7"];
    al [label="Action Layer\noutcome execution (EKS)", fillcolor="#FEF3C7"];
    dla [label="Decision Log & Audit\nappend-only audit truth (EKS)", fillcolor="#FEF3C7"];
    arch [label="Archive Writer\nimmutable event archive", fillcolor="#FEF9C3"];
  }

  subgraph cluster_case {
    label="Case + Label Plane (Hybrid)";
    color="#FDBA74";
    style="rounded";

    ct [label="Case Trigger\nconsume decision/outcome evidence", fillcolor="#FFEDD5"];
    cm [label="Case Management\nappend case timeline", fillcolor="#FFEDD5"];
    ls [label="Label Store\nappend label assertions", fillcolor="#FFEDD5"];
  }

  subgraph cluster_learning {
    label="Learning + Evolution Plane";
    color="#C4B5FD";
    style="rounded";

    ofs [label="OFS Dataset Build\nDatabricks jobs", fillcolor="#EDE9FE"];
    mf [label="MF Train + Eval\nSageMaker", fillcolor="#EDE9FE"];
    mlf [label="MLflow Tracking\nexperiment + model metadata", fillcolor="#EDE9FE"];
    mpr [label="MPR Promotion Corridor\npromote/rollback authority", fillcolor="#DDD6FE"];
    reg [label="Active Bundle Resolution\nruntime bundle authority", shape=folder, fillcolor="#E9D5FF"];
    tofsreq [label="fp.bus.learning.ofs.requests.v1", shape=component, fillcolor="#DCFCE7"];
    tofsevt [label="fp.bus.learning.ofs.events.v1", shape=component, fillcolor="#DCFCE7"];
    tmfreq [label="fp.bus.learning.mf.requests.v1", shape=component, fillcolor="#DCFCE7"];
    tmfevt [label="fp.bus.learning.mf.events.v1", shape=component, fillcolor="#DCFCE7"];
    treg [label="fp.bus.learning.registry.events.v1", shape=component, fillcolor="#DCFCE7"];
  }

  subgraph cluster_obsgov {
    label="Observability + Governance";
    color="#A7F3D0";
    style="rounded";

    otel [label="OpenTelemetry Correlation\nrun-scoped traces/metrics/logs", fillcolor="#ECFDF5"];
    rep [label="Run Reporter + Conformance\nfull-platform closure evidence", fillcolor="#ECFDF5"];
    gov [label="Governance Append\nrun-scoped immutable events", shape=folder, fillcolor="#F0FDF4"];
  }

  gha -> tf [label="apply infra + deploy"];
  gha -> ecr [label="build and push"];
  tf -> msk [label="provision"];
  tf -> s3obj [label="provision"];
  tf -> aurora [label="provision"];
  tf -> redis [label="provision"];
  tf -> ddb [label="provision"];
  tf -> glue [label="provision"];
  tf -> cw [label="provision"];
  tf -> sm [label="provision"];
  tf -> split [label="pin runtime path"];
  tf -> mwaa [label="provision"];
  tf -> sfn [label="provision"];

  sfn -> runctl [label="phase evidence"];
  split -> sr [style=dashed, label="active host path"];
  split -> wsp [style=dashed, label="active host path"];
  split -> ieg [style=dashed, label="active host path"];
  split -> ofp [style=dashed, label="active host path"];
  split -> apigw [style=dashed, label="primary edge path"];
  split -> igl [style=dashed, label="primary edge path"];
  sfn -> sr [label="P5 READY commit authority"];
  sfn -> rep [label="final verdict orchestration"];
  mwaa -> ofs [label="schedule OFS runs"];
  mwaa -> mf [label="schedule MF runs"];

  oracle -> sr [label="resolve required outputs"];
  oracle -> wsp [label="read stream_view parts"];
  sr -> tctrl [label="publish READY"];
  tctrl -> wsp [label="start run-scoped stream"];
  wsp -> apigw [label="push envelopes"];
  apigw -> igl [label="invoke"];
  igl -> ddb [label="idempotency key check"];
  igl -> igrec [label="write receipt/quarantine"];
  igl -> ttraffic [label="publish ADMITTED traffic"];
  igl -> tctx [label="publish ADMITTED context"];

  ttraffic -> ieg [label="consume"];
  tctx -> ieg [label="consume"];
  ttraffic -> ofp [label="consume"];
  tctx -> ofp [label="join context"];
  ttraffic -> df [label="decision trigger"];
  ieg -> aurora [label="projection state"];
  ofp -> redis [label="low-latency features"];
  ofp -> aurora [label="durable feature state"];

  df -> al [label="action intent"];
  df -> dla [label="decision facts"];
  al -> dla [label="action outcomes"];
  al -> igl [label="publish outcomes via IG"];
  dla -> taudit [label="publish audit events"];
  dla -> s3obj [label="append audit records"];

  trtdl -> ct [label="decision/outcome stream"];
  ct -> tcase [label="publish case triggers"];
  tcase -> cm [label="consume case trigger"];
  cm -> ls [label="label writer boundary"];
  ls -> tlabels [label="publish label events"];
  cm -> aurora [label="case timeline append"];
  ls -> aurora [label="label assertion append"];

  ttraffic -> arch [label="archive input"];
  tctx -> arch [label="archive input"];
  trtdl -> arch [label="archive input"];
  tcase -> arch [label="archive input"];
  tlabels -> arch [label="archive input"];
  taudit -> arch [label="archive input"];
  arch -> s3obj [label="immutable archive events"];

  tofsreq -> ofs [label="dataset build request"];
  ofs -> tofsevt [label="dataset build events"];
  ofs -> s3obj [label="dataset manifests/fingerprints"];
  ofs -> glue [label="Iceberg table update"];
  tofsevt -> tmfreq [label="candidate training input"];
  tmfreq -> mf [label="train/eval request"];
  mf -> tmfevt [label="eval events"];
  mf -> mlf [label="log experiment/model"];
  tmfevt -> mpr [label="candidate bundle"];
  mpr -> reg [label="promote or rollback"];
  mpr -> treg [label="registry events"];
  reg -> df [label="resolve active model/policy"];

  igrec -> s3obj [style=dashed, label="evidence storage"];
  runctl -> s3obj [style=dashed, label="run-control receipts"];
  rep -> s3obj [style=dashed, label="run report + final verdict"];
  gov -> s3obj [style=dashed, label="governance events"];

  otel -> cw [label="emit correlated telemetry"];
  rep -> gov [label="append governance facts"];
  sr -> otel [style=dashed, label="trace + run headers"];
  wsp -> otel [style=dashed];
  igl -> otel [style=dashed];
  ieg -> otel [style=dashed];
  ofp -> otel [style=dashed];
  df -> otel [style=dashed];
  al -> otel [style=dashed];
  dla -> otel [style=dashed];
  cm -> otel [style=dashed];
  ls -> otel [style=dashed];
  ofs -> otel [style=dashed];
  mf -> otel [style=dashed];
  mpr -> otel [style=dashed];

  rid -> sr [style=dashed, color="#0F766E", label="run scope required"];
  rid -> wsp [style=dashed, color="#0F766E"];
  rid -> igl [style=dashed, color="#0F766E"];
  rid -> df [style=dashed, color="#0F766E"];
  rid -> al [style=dashed, color="#0F766E"];
  rid -> dla [style=dashed, color="#0F766E"];
  rid -> cm [style=dashed, color="#0F766E"];
  rid -> ls [style=dashed, color="#0F766E"];
  rid -> ofs [style=dashed, color="#0F766E"];
  rid -> mf [style=dashed, color="#0F766E"];
  rid -> mpr [style=dashed, color="#0F766E"];
  rid -> rep [style=dashed, color="#0F766E"];
}
