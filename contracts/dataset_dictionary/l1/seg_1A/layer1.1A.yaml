version: '1.0'
layer: layer1
segment: seg_1A
states: [s0, s1, s2, s3]

reference:
  transaction_schema_merchant_ids:
    description: Normalised merchant universe used to seed S0 ingress.
    format: parquet
    path: reference/layer1/transaction_schema_merchant_ids/v2025-10-08/transaction_schema_merchant_ids.parquet
    schema_ref: schemas.ingress.layer1.yaml#/merchant_ids
    partitioning: []
    owner: reference
    retention_days: 365
  iso_canonical:
    description: Canonical ISO-3166 reference with UN region metadata.
    format: parquet
    path: reference/layer1/iso_canonical/v2025-10-08/iso_canonical.parquet
    schema_ref: l1/seg_1A/iso_canonical.schema.json
    partitioning: []
    owner: reference
    retention_days: 365
  world_countries:
    description: Global country polygons (EPSG:4326) derived from Natural Earth with synthetic coverage for microstates.
    format: parquet
    path: reference/spatial/world_countries/2025-10-08/world_countries.parquet
    schema_ref: l1/seg_1A/world_countries.schema.json
    partitioning: []
    owner: reference
    retention_days: 365
  tz_world_2025a:
    description: IANA timezone polygons (2025a) intersected with world countries.
    format: parquet
    path: reference/spatial/tz_world/2025-10-08/tz_world_2025a.parquet
    schema_ref: l1/seg_1A/tz_world_2025a.schema.json
    partitioning: []
    owner: reference
    retention_days: 365
  population_raster_2025:
    description: Global population raster (2025) in EPSG:4326.
    format: tif
    path: reference/spatial/population_raster/2025/population_raster_2025.tif
    schema_ref: l1/seg_1A/population_raster.schema.json
    partitioning: []
    owner: reference
    retention_days: 365
  settlement_shares_2024Q4:
    description: Currency-to-country settlement shares used by S0.
    format: parquet
    path: reference/network/settlement_shares/2025-10-08/settlement_shares.parquet
    schema_ref: l1/seg_1A/settlement_shares.schema.json
    partitioning: []
    owner: reference
    retention_days: 365
  ccy_country_shares_2024Q4:
    description: Currency-to-country usage shares consumed by S5/S6 smoothing.
    format: parquet
    path: reference/network/ccy_country_shares/2025-10-08/ccy_country_shares.parquet
    schema_ref: l1/seg_1A/ccy_country_shares.schema.json
    partitioning: []
    owner: reference
    retention_days: 365

model:
  crossborder_eligibility_flags:
    description: Parameter-scoped eligibility flags for cross-border expansion policy.
    format: parquet
    path: data/layer1/1A/crossborder_eligibility_flags/parameter_hash={parameter_hash}/part-*.parquet
    schema_ref: l1/seg_1A/s0_outputs.schema.json#/prep/crossborder_eligibility_flags
    partitioning: [parameter_hash]
    owner: 1A
    retention_days: 180

  hurdle_design_matrix:
    description: Deterministic design vectors for hurdle/NB models.
    format: parquet
    path: data/layer1/1A/hurdle_design_matrix/parameter_hash={parameter_hash}/part-*.parquet
    schema_ref: l1/seg_1A/s0_outputs.schema.json#/model/hurdle_design_matrix
    partitioning: [parameter_hash]
    owner: 1A
    retention_days: 90

  hurdle_pi_probs:
    description: Optional per-merchant hurdle logistic outputs (diagnostics).
    format: parquet
    path: data/layer1/1A/hurdle_pi_probs/parameter_hash={parameter_hash}/part-*.parquet
    schema_ref: l1/seg_1A/s0_outputs.schema.json#/model/hurdle_pi_probs
    partitioning: [parameter_hash]
    owner: 1A
    retention_days: 30

validation:
  validation_bundle:
    description: Fingerprint-scoped validation pack emitted at the end of S0.
    format: directory
    path: data/layer1/1A/validation/fingerprint={manifest_fingerprint}/
    schema_ref: l1/seg_1A/s0_outputs.schema.json#/validation_bundle
    partitioning: [fingerprint]
    owner: 1A
    retention_days: 365

rng_logs:
  rng_audit_log:
    description: Run-scoped RNG audit envelope.
    format: jsonl
    path: logs/rng/audit/seed={seed}/parameter_hash={parameter_hash}/run_id={run_id}/rng_audit_log.jsonl
    schema_ref: layer1/schemas.layer1.yaml#/rng/core/rng_audit_log/record
    partitioning: [seed, parameter_hash, run_id]
    owner: 1A
    retention_days: 365

  rng_trace_log:
    description: Cumulative RNG trace by module/substream.
    format: jsonl
    path: logs/rng/trace/seed={seed}/parameter_hash={parameter_hash}/run_id={run_id}/rng_trace_log.jsonl
    schema_ref: layer1/schemas.layer1.yaml#/rng/core/rng_trace_log/record
    partitioning: [seed, parameter_hash, run_id]
    owner: 1A
    retention_days: 365

  rng_event_anchor:
    description: Anchor event emitted once per run to prove stream availability.
    format: jsonl
    path: logs/rng/events/core/seed={seed}/parameter_hash={parameter_hash}/run_id={run_id}/part-*.jsonl
    schema_ref: layer1/schemas.layer1.yaml#/rng/events/anchor
    partitioning: [seed, parameter_hash, run_id]
    owner: 1A
    retention_days: 365

  rng_event_hurdle_bernoulli:
    description: Merchant-keyed Bernoulli draws that decide single vs multi-site (S1 output).
    format: jsonl
    path: logs/rng/events/hurdle_bernoulli/seed={seed}/parameter_hash={parameter_hash}/run_id={run_id}/part-*.jsonl
    schema_ref: layer1/schemas.layer1.yaml#/rng/events/hurdle_bernoulli
    partitioning: [seed, parameter_hash, run_id]
    owner: 1A
    retention_days: 180

  rng_event_gamma_component:
    description: Gamma draws used by the NB sampler for multi-site merchants.
    format: jsonl
    path: logs/rng/events/gamma_component/seed={seed}/parameter_hash={parameter_hash}/run_id={run_id}/part-*.jsonl
    schema_ref: layer1/schemas.layer1.yaml#/rng/events/gamma_component
    partitioning: [seed, parameter_hash, run_id]
    owner: 1A
    retention_days: 180
    gating:
      gated_by: rng_event_hurdle_bernoulli
      predicate: is_multi == true

  rng_event_poisson_component:
    description: Poisson draws used in NB composition and ZTP fallback.
    format: jsonl
    path: logs/rng/events/poisson_component/seed={seed}/parameter_hash={parameter_hash}/run_id={run_id}/part-*.jsonl
    schema_ref: layer1/schemas.layer1.yaml#/rng/events/poisson_component
    partitioning: [seed, parameter_hash, run_id]
    owner: 1A
    ordering: [merchant_id, attempt]
    retention_days: 180
    gating:
      gated_by: rng_event_hurdle_bernoulli
      predicate: is_multi == true

  rng_event_nb_final:
    description: Final Negative Binomial outlet counts (accepted draws).
    format: jsonl
    path: logs/rng/events/nb_final/seed={seed}/parameter_hash={parameter_hash}/run_id={run_id}/part-*.jsonl
    schema_ref: layer1/schemas.layer1.yaml#/rng/events/nb_final
    partitioning: [seed, parameter_hash, run_id]
    owner: 1A
    retention_days: 180
    gating:
      gated_by: rng_event_hurdle_bernoulli
      predicate: is_multi == true

crossborder:

  s3_candidate_set:
    description: Ordered cross-border candidate universe (home + admissible foreign countries).
    format: parquet
    path: data/layer1/1A/s3_candidate_set/parameter_hash={parameter_hash}/part-*.parquet
    schema_ref: l1/seg_1A/s3_outputs.schema.json#/candidate_set
    partitioning: [parameter_hash]
    owner: 1A
    retention_days: 365

  s3_base_weight_priors:
    description: Deterministic base-weight priors per candidate country (fixed-dp strings).
    format: parquet
    path: data/layer1/1A/s3_base_weight_priors/parameter_hash={parameter_hash}/part-*.parquet
    schema_ref: l1/seg_1A/s3_outputs.schema.json#/base_weight_priors
    partitioning: [parameter_hash]
    owner: 1A
    retention_days: 365

  s3_integerised_counts:
    description: Integer outlet allocations per candidate country (sum equals S2 N) with residual ranking.
    format: parquet
    path: data/layer1/1A/s3_integerised_counts/parameter_hash={parameter_hash}/part-*.parquet
    schema_ref: l1/seg_1A/s3_outputs.schema.json#/integerised_counts
    partitioning: [parameter_hash]
    owner: 1A
    retention_days: 365

  s3_site_sequence:
    description: Deterministic within-country site sequencing (optional; zero-padded IDs when enabled).
    format: parquet
    path: data/layer1/1A/s3_site_sequence/parameter_hash={parameter_hash}/part-*.parquet
    schema_ref: l1/seg_1A/s3_outputs.schema.json#/site_sequence
    partitioning: [parameter_hash]
    owner: 1A
    retention_days: 365
