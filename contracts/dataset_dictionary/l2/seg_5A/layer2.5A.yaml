# dataset_dictionary.layer2.5A.yaml — layer-2 Segment 5A contracts
version: '1.0.0'

lifecycle:
  phase: planning
  last_reviewed:
  approver:

ci_policy:
  allow_placeholders: false
  placeholder_markers: [TBD]
  block_on_phase: [beta, stable]

layer:
  id: layer2
  name: Layer-2 (Segment 5A)

reference_data: []

# Internally generated datasets
datasets:
  # 5A - Layer-2 policy & scenario config artefacts (inputs, sealed by S0)
  - id: merchant_class_policy_5A
    status: required
    owner_subsegment: 5A
    description: >
      Classing policy for 5A.S1. Maps merchantxzone features to demand_class and optional demand_subclass/profile IDs.
    version: 'v1'
    format: yaml
    path: config/layer2/5A/policy/merchant_class_policy_5A.v1.yaml
    partitioning: []
    primary_key: []
    ordering: []
    schema_ref: schemas.5A.yaml#/policy/merchant_class_policy_5A
    lineage:
      produced_by: []
      consumed_by: [5A.S0, 5A.S1, 5A.S5]
      final_in_layer: false
    retention_days: 365
    pii: false
    licence: Proprietary-Internal

  - id: demand_scale_policy_5A
    status: required
    owner_subsegment: 5A
    description: >
      Demand scale policy for 5A.S1/S3. Maps demand_class and merchant features to baseline weekly volume / scale_factor.
    version: 'v1'
    format: yaml
    path: config/layer2/5A/policy/demand_scale_policy_5A.v1.yaml
    partitioning: []
    primary_key: []
    ordering: []
    schema_ref: schemas.5A.yaml#/policy/demand_scale_policy_5A
    lineage:
      produced_by: []
      consumed_by: [5A.S0, 5A.S1, 5A.S3, 5A.S5]
      final_in_layer: false
    retention_days: 365
    pii: false
    licence: Proprietary-Internal

  - id: shape_library_5A
    status: required
    owner_subsegment: 5A
    description: >
      Shape library for 5A.S2. Defines the local-week time grid and unit-mass shape templates per demand_classxzonexchannel_group.
    version: 'v1'
    format: yaml
    path: config/layer2/5A/policy/shape_library_5A.v1.yaml
    partitioning: []
    primary_key: []
    ordering: []
    schema_ref: schemas.5A.yaml#/policy/shape_library_5A
    lineage:
      produced_by: []
      consumed_by: [5A.S0, 5A.S2, 5A.S5]
      final_in_layer: false
    retention_days: 365
    pii: false
    licence: Proprietary-Internal

  - id: scenario_horizon_config_5A
    status: required
    owner_subsegment: 5A
    description: >
      Horizon and grid configuration for 5A.S4 scenario overlays (local and UTC).
    version: 'v1'
    format: yaml
    path: config/layer2/5A/scenario/scenario_horizon_config_5A.v1.yaml
    partitioning: []
    primary_key: []
    ordering: []
    schema_ref: schemas.5A.yaml#/scenario/scenario_horizon_config_5A
    lineage:
      produced_by: []
      consumed_by: [5A.S0, 5A.S4, 5A.S5]
      final_in_layer: false
    retention_days: 365
    pii: false
    licence: Proprietary-Internal

  - id: scenario_calendar_5A
    status: required
    owner_subsegment: 5A
    description: >
      Scenario calendar for 5A.S4. Defines dated events (holidays, campaigns, outages, stress scenarios) and their scope.
    version: '{manifest_fingerprint}.{scenario_id}'
    format: parquet
    path: data/layer2/5A/scenario/calendar/fingerprint={manifest_fingerprint}/scenario={scenario_id}/scenario_calendar_5A.parquet
    partitioning: [manifest_fingerprint, scenario_id]
    primary_key: [manifest_fingerprint, scenario_id, event_id]
    ordering: []
    schema_ref: schemas.5A.yaml#/scenario/scenario_calendar_5A
    lineage:
      produced_by: []
      consumed_by: [5A.S0, 5A.S4, 5A.S5]
      final_in_layer: false
    retention_days: 365
    pii: false
    licence: Proprietary-Internal

  - id: scenario_overlay_policy_5A
    status: required
    owner_subsegment: 5A
    description: >
      Overlay policy for 5A.S4. Maps scenario events to multiplicative factors and defines precedence/combination rules.
    version: 'v1'
    format: yaml
    path: config/layer2/5A/scenario/scenario_overlay_policy_5A.v1.yaml
    partitioning: []
    primary_key: []
    ordering: []
    schema_ref: schemas.5A.yaml#/scenario/scenario_overlay_policy_5A
    lineage:
      produced_by: []
      consumed_by: [5A.S0, 5A.S4, 5A.S5]
      final_in_layer: false
    retention_days: 365
    pii: false
    licence: Proprietary-Internal

  # S0 - gate + inputs
  - id: s0_gate_receipt_5A
    status: required
    owner_subsegment: 5A
    description: Fingerprint-scoped S0 receipt confirming upstream gates and sealed inputs.
    version: '{manifest_fingerprint}'
    format: json
    path: data/layer2/5A/s0_gate_receipt/fingerprint={manifest_fingerprint}/s0_gate_receipt_5A.json
    partitioning: [fingerprint]
    primary_key: [manifest_fingerprint]
    ordering: []
    schema_ref: schemas.5A.yaml#/validation/s0_gate_receipt_5A
    lineage:
      produced_by: [5A.S0]
      consumed_by: [5A.S1, 5A.S2, 5A.S3, 5A.S4, 5A.S5]
      final_in_layer: false
    retention_days: 365
    pii: false
    licence: Proprietary-Internal

  - id: sealed_inputs_5A
    status: required
    owner_subsegment: 5A
    description: Inventory of sealed artefacts 5A is allowed to read for a fingerprint.
    version: '{manifest_fingerprint}'
    format: parquet
    path: data/layer2/5A/sealed_inputs/fingerprint={manifest_fingerprint}/sealed_inputs_5A.parquet
    partitioning: [fingerprint]
    primary_key: [manifest_fingerprint, owner_segment, artifact_id]
    ordering: []
    schema_ref: schemas.5A.yaml#/validation/sealed_inputs_5A
    lineage:
      produced_by: [5A.S0]
      consumed_by: [5A.S1, 5A.S2, 5A.S3, 5A.S4, 5A.S5]
      final_in_layer: false
    retention_days: 365
    pii: false
    licence: Proprietary-Internal

  - id: scenario_manifest_5A
    status: optional
    owner_subsegment: 5A
    description: Scenario-level manifest projection derived from sealed inputs.
    version: '{manifest_fingerprint}'
    format: parquet
    path: data/layer2/5A/scenario_manifest/fingerprint={manifest_fingerprint}/scenario_manifest_5A.parquet
    partitioning: [fingerprint]
    primary_key: [manifest_fingerprint, scenario_id]
    ordering: []
    schema_ref: schemas.5A.yaml#/validation/scenario_manifest_5A
    lineage:
      produced_by: [5A.S0]
      consumed_by: [5A.S1, 5A.S2, 5A.S3, 5A.S4, 5A.S5]
      final_in_layer: false
    retention_days: 365
    pii: false
    licence: Proprietary-Internal

  # S1 — demand profiles
  - id: merchant_zone_profile_5A
    status: required
    owner_subsegment: 5A
    description: Merchant×zone demand profile including class and scale for the local week.
    version: '{manifest_fingerprint}'
    format: parquet
    path: data/layer2/5A/merchant_zone_profile/fingerprint={manifest_fingerprint}/merchant_zone_profile_5A.parquet
    partitioning: [fingerprint]
    primary_key: [merchant_id, legal_country_iso, tzid]
    ordering: [merchant_id, legal_country_iso, tzid]
    schema_ref: schemas.5A.yaml#/model/merchant_zone_profile_5A
    lineage:
      produced_by: [5A.S1]
      consumed_by: [5A.S2, 5A.S3, 5A.S4, 5A.S5, 5B, 6A]
      final_in_layer: false
    retention_days: 365
    pii: false
    licence: Proprietary-Internal

  - id: merchant_class_profile_5A
    status: optional
    owner_subsegment: 5A
    description: Merchant-level aggregate class profile derived deterministically from zone profiles.
    version: '{manifest_fingerprint}'
    format: parquet
    path: data/layer2/5A/merchant_class_profile/fingerprint={manifest_fingerprint}/merchant_class_profile_5A.parquet
    partitioning: [fingerprint]
    primary_key: [merchant_id]
    ordering: [merchant_id]
    schema_ref: schemas.5A.yaml#/model/merchant_class_profile_5A
    lineage:
      produced_by: [5A.S1]
      consumed_by: [5A.S2, 5A.S3, 5A.S4, 5A.S5, 5B, 6A]
      final_in_layer: false
    retention_days: 365
    pii: false
    licence: Proprietary-Internal

  # S2 — weekly shape library
  - id: shape_grid_definition_5A
    status: required
    owner_subsegment: 5A
    description: Local-week time grid definition for shapes under a parameter pack and scenario.
    version: '{parameter_hash}.{scenario_id}'
    format: parquet
    path: |
      data/layer2/5A/shape_grid_definition/parameter_hash={parameter_hash}/scenario_id={scenario_id}/shape_grid_definition_5A.parquet
    partitioning: [parameter_hash, scenario_id]
    primary_key: [parameter_hash, scenario_id, bucket_index]
    ordering: [bucket_index]
    schema_ref: schemas.5A.yaml#/model/shape_grid_definition_5A
    lineage:
      produced_by: [5A.S2]
      consumed_by: [5A.S3, 5A.S4, 5A.S5, 5B, 6A]
      final_in_layer: false
    retention_days: 365
    pii: false
    licence: Proprietary-Internal

  - id: class_zone_shape_5A
    status: required
    owner_subsegment: 5A
    description: Normalised weekly shape vectors per class×zone (and optional channel) for each scenario.
    version: '{parameter_hash}.{scenario_id}'
    format: parquet
    path: |
      data/layer2/5A/class_zone_shape/parameter_hash={parameter_hash}/scenario_id={scenario_id}/class_zone_shape_5A.parquet
    partitioning: [parameter_hash, scenario_id]
    primary_key:
      - parameter_hash
      - scenario_id
      - demand_class
      - legal_country_iso
      - tzid
      - bucket_index
    ordering:
      - demand_class
      - legal_country_iso
      - tzid
      - bucket_index
    schema_ref: schemas.5A.yaml#/model/class_zone_shape_5A
    lineage:
      produced_by: [5A.S2]
      consumed_by: [5A.S3, 5A.S4, 5A.S5, 5B, 6A]
      final_in_layer: false
    retention_days: 365
    pii: false
    licence: Proprietary-Internal

  - id: class_shape_catalogue_5A
    status: optional
    owner_subsegment: 5A
    description: Optional base shape catalogue per class (and optional channel) for each scenario.
    version: '{parameter_hash}.{scenario_id}'
    format: parquet
    path: |
      data/layer2/5A/class_shape_catalogue/parameter_hash={parameter_hash}/scenario_id={scenario_id}/class_shape_catalogue_5A.parquet
    partitioning: [parameter_hash, scenario_id]
    primary_key: [parameter_hash, scenario_id, demand_class]
    ordering:
      - demand_class
    schema_ref: schemas.5A.yaml#/model/class_shape_catalogue_5A
    lineage:
      produced_by: [5A.S2]
      consumed_by: [5A.S3, 5A.S4, 5A.S5, 5B, 6A]
      final_in_layer: false
    retention_days: 365
    pii: false
    licence: Proprietary-Internal

  # S3 — baselines
  - id: merchant_zone_baseline_local_5A
    status: required
    owner_subsegment: 5A
    description: Merchant×zone baseline local-week intensities per scenario.
    version: '{manifest_fingerprint}.{scenario_id}'
    format: parquet
    path: |
      data/layer2/5A/merchant_zone_baseline_local/fingerprint={manifest_fingerprint}/scenario_id={scenario_id}/merchant_zone_baseline_local_5A.parquet
    partitioning: [fingerprint, scenario_id]
    primary_key:
      - manifest_fingerprint
      - scenario_id
      - merchant_id
      - legal_country_iso
      - tzid
      - bucket_index
    ordering:
      - merchant_id
      - legal_country_iso
      - tzid
      - bucket_index
    schema_ref: schemas.5A.yaml#/model/merchant_zone_baseline_local_5A
    lineage:
      produced_by: [5A.S3]
      consumed_by: [5A.S4, 5A.S5, 5B, 6A]
      final_in_layer: false
    retention_days: 365
    pii: false
    licence: Proprietary-Internal

  - id: class_zone_baseline_local_5A
    status: optional
    owner_subsegment: 5A
    description: Optional class×zone baseline local-week intensities per scenario.
    version: '{manifest_fingerprint}.{scenario_id}'
    format: parquet
    path: |
      data/layer2/5A/class_zone_baseline_local/fingerprint={manifest_fingerprint}/scenario_id={scenario_id}/class_zone_baseline_local_5A.parquet
    partitioning: [fingerprint, scenario_id]
    primary_key:
      - manifest_fingerprint
      - scenario_id
      - demand_class
      - legal_country_iso
      - tzid
      - bucket_index
    ordering:
      - demand_class
      - legal_country_iso
      - tzid
      - bucket_index
    schema_ref: schemas.5A.yaml#/model/class_zone_baseline_local_5A
    lineage:
      produced_by: [5A.S3]
      consumed_by: [5A.S4, 5A.S5, 5B, 6A]
      final_in_layer: false
    retention_days: 365
    pii: false
    licence: Proprietary-Internal

  - id: merchant_zone_baseline_utc_5A
    status: optional
    owner_subsegment: 5A
    description: Optional merchant×zone baseline intensities expressed on a UTC grid.
    version: '{manifest_fingerprint}.{scenario_id}'
    format: parquet
    path: |
      data/layer2/5A/merchant_zone_baseline_utc/fingerprint={manifest_fingerprint}/scenario_id={scenario_id}/merchant_zone_baseline_utc_5A.parquet
    partitioning: [fingerprint, scenario_id]
    primary_key:
      - manifest_fingerprint
      - scenario_id
      - merchant_id
      - legal_country_iso
      - tzid
      - utc_bucket_index
    ordering:
      - merchant_id
      - legal_country_iso
      - tzid
      - utc_bucket_index
    schema_ref: schemas.5A.yaml#/model/merchant_zone_baseline_utc_5A
    lineage:
      produced_by: [5A.S3]
      consumed_by: [5A.S4, 5A.S5, 5B, 6A]
      final_in_layer: false
    retention_days: 365
    pii: false
    licence: Proprietary-Internal

  # S4 — scenario overlays
  - id: merchant_zone_scenario_local_5A
    status: required
    owner_subsegment: 5A
    description: Scenario-adjusted local-week intensities per merchant×zone×horizon bucket.
    version: '{manifest_fingerprint}.{scenario_id}'
    format: parquet
    path: |
      data/layer2/5A/merchant_zone_scenario_local/fingerprint={manifest_fingerprint}/scenario_id={scenario_id}/merchant_zone_scenario_local_5A.parquet
    partitioning: [fingerprint, scenario_id]
    primary_key:
      - manifest_fingerprint
      - scenario_id
      - merchant_id
      - legal_country_iso
      - tzid
      - local_horizon_bucket_index
    ordering:
      - merchant_id
      - legal_country_iso
      - tzid
      - local_horizon_bucket_index
    schema_ref: schemas.5A.yaml#/model/merchant_zone_scenario_local_5A
    lineage:
      produced_by: [5A.S4]
      consumed_by: [5A.S5, 5B, 6A]
      final_in_layer: false
    retention_days: 365
    pii: false
    licence: Proprietary-Internal

  - id: merchant_zone_overlay_factors_5A
    status: optional
    owner_subsegment: 5A
    description: Optional multiplicative overlay factors per merchant×zone×horizon bucket.
    version: '{manifest_fingerprint}.{scenario_id}'
    format: parquet
    path: |
      data/layer2/5A/merchant_zone_overlay_factors/fingerprint={manifest_fingerprint}/scenario_id={scenario_id}/merchant_zone_overlay_factors_5A.parquet
    partitioning: [fingerprint, scenario_id]
    primary_key:
      - manifest_fingerprint
      - scenario_id
      - merchant_id
      - legal_country_iso
      - tzid
      - local_horizon_bucket_index
    ordering:
      - merchant_id
      - legal_country_iso
      - tzid
      - local_horizon_bucket_index
    schema_ref: schemas.5A.yaml#/model/merchant_zone_overlay_factors_5A
    lineage:
      produced_by: [5A.S4]
      consumed_by: [5A.S5, 5B, 6A]
      final_in_layer: false
    retention_days: 365
    pii: false
    licence: Proprietary-Internal

  - id: merchant_zone_scenario_utc_5A
    status: optional
    owner_subsegment: 5A
    description: Scenario-adjusted UTC intensities per merchant×zone×UTC horizon bucket.
    version: '{manifest_fingerprint}.{scenario_id}'
    format: parquet
    path: |
      data/layer2/5A/merchant_zone_scenario_utc/fingerprint={manifest_fingerprint}/scenario_id={scenario_id}/merchant_zone_scenario_utc_5A.parquet
    partitioning: [fingerprint, scenario_id]
    primary_key:
      - manifest_fingerprint
      - scenario_id
      - merchant_id
      - legal_country_iso
      - tzid
      - utc_horizon_bucket_index
    ordering:
      - merchant_id
      - legal_country_iso
      - tzid
      - utc_horizon_bucket_index
    schema_ref: schemas.5A.yaml#/model/merchant_zone_scenario_utc_5A
    lineage:
      produced_by: [5A.S4]
      consumed_by: [5A.S5, 5B, 6A]
      final_in_layer: false
    retention_days: 365
    pii: false
    licence: Proprietary-Internal

  # S5 — validation bundle
  - id: validation_bundle_index_5A
    status: required
    owner_subsegment: 5A
    description: Index and manifest for the 5A validation bundle.
    version: '{manifest_fingerprint}'
    format: json
    path: data/layer2/5A/validation/fingerprint={manifest_fingerprint}/validation_bundle_index_5A.json
    partitioning: [fingerprint]
    ordering: []
    schema_ref: schemas.layer2.yaml#/validation/validation_bundle_index_5A
    lineage:
      produced_by: [5A.S5]
      consumed_by: [5A.S5, 5B, 6A]
      final_in_layer: false
    retention_days: 365
    pii: false
    licence: Proprietary-Internal

  - id: validation_report_5A
    status: required
    owner_subsegment: 5A
    description: Human/machine readable validation report for 5A.
    version: '{manifest_fingerprint}'
    format: json
    path: data/layer2/5A/validation/fingerprint={manifest_fingerprint}/reports/validation_report_5A.json
    partitioning: [fingerprint]
    ordering: []
    schema_ref: schemas.layer2.yaml#/validation/validation_report_5A
    lineage:
      produced_by: [5A.S5]
      consumed_by: [5A.validation_tools, 5B, 6A]
      final_in_layer: false
    retention_days: 365
    pii: false
    licence: Proprietary-Internal

  - id: validation_issue_table_5A
    status: optional
    owner_subsegment: 5A
    description: Optional structured list of validation issues for 5A.
    version: '{manifest_fingerprint}'
    format: parquet
    path: data/layer2/5A/validation/fingerprint={manifest_fingerprint}/issues/validation_issue_table_5A.parquet
    partitioning: [fingerprint]
    ordering: []
    schema_ref: schemas.layer2.yaml#/validation/validation_issue_table_5A
    lineage:
      produced_by: [5A.S5]
      consumed_by: [5A.validation_tools]
      final_in_layer: false
    retention_days: 365
    pii: false
    licence: Proprietary-Internal

  - id: passed_flag_5A
    status: required
    owner_subsegment: 5A
    description: Pass/fail flag for the 5A validation bundle.
    version: '{manifest_fingerprint}'
    format: flag
    path: data/layer2/5A/validation/fingerprint={manifest_fingerprint}/_passed.flag_5A
    partitioning: [fingerprint]
    ordering: []
    schema_ref: schemas.layer2.yaml#/validation/passed_flag_5A
    lineage:
      produced_by: [5A.S5]
      consumed_by: [5B, 6A, 5A.validation_tools]
      final_in_layer: true
    retention_days: 365
    pii: false
    licence: Proprietary-Internal

notes:
  - "Derived from docs/model_spec/data-engine/layer-2/specs/state-flow/5A/s#.expanded.md section 5."
