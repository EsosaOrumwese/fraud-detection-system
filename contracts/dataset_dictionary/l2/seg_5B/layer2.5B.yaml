# dataset_dictionary.layer2.5B.yaml — Layer-2 Segment 5B contracts
version: '1.0.0'

lifecycle:
  phase: planning
  last_reviewed:
  approver:

ci_policy:
  allow_placeholders: false
  placeholder_markers: [TBD]
  block_on_phase: [beta, stable]

layer:
  id: layer2
  name: Layer-2 (Segment 5B)

reference_data: []

datasets:
  # 5B - policy/config artefacts (inputs, sealed by S0)
  - id: time_grid_policy_5B
    status: required
    owner_subsegment: 5B
    description: Time grid configuration for 5B.S1.
    version: 'v1'
    format: yaml
    path: config/layer2/5B/time_grid_policy_5B.yaml
    partitioning: []
    primary_key: []
    ordering: []
    schema_ref: schemas.5B.yaml#/config/time_grid_policy_5B
    lineage:
      produced_by: []
      consumed_by: [5B.S0, 5B.S1, 5B.S5]
      final_in_layer: false
    retention_days: 365
    pii: false
    licence: Proprietary-Internal

  - id: grouping_policy_5B
    status: required
    owner_subsegment: 5B
    description: Deterministic grouping policy for 5B.S1.
    version: 'v1'
    format: yaml
    path: config/layer2/5B/grouping_policy_5B.yaml
    partitioning: []
    primary_key: []
    ordering: []
    schema_ref: schemas.5B.yaml#/config/grouping_policy_5B
    lineage:
      produced_by: []
      consumed_by: [5B.S0, 5B.S1, 5B.S5]
      final_in_layer: false
    retention_days: 365
    pii: false
    licence: Proprietary-Internal

  - id: arrival_lgcp_config_5B
    status: required
    owner_subsegment: 5B
    description: Latent intensity (LGCP) configuration for 5B.S2.
    version: 'v1'
    format: yaml
    path: config/layer2/5B/arrival_lgcp_config_5B.yaml
    partitioning: []
    primary_key: []
    ordering: []
    schema_ref: schemas.5B.yaml#/config/arrival_lgcp_config_5B
    lineage:
      produced_by: []
      consumed_by: [5B.S0, 5B.S2, 5B.S5]
      final_in_layer: false
    retention_days: 365
    pii: false
    licence: Proprietary-Internal

  - id: arrival_count_config_5B
    status: required
    owner_subsegment: 5B
    description: Bucket count law configuration for 5B.S3.
    version: 'v1'
    format: yaml
    path: config/layer2/5B/arrival_count_config_5B.yaml
    partitioning: []
    primary_key: []
    ordering: []
    schema_ref: schemas.5B.yaml#/config/arrival_count_config_5B
    lineage:
      produced_by: []
      consumed_by: [5B.S0, 5B.S3, 5B.S5]
      final_in_layer: false
    retention_days: 365
    pii: false
    licence: Proprietary-Internal

  - id: arrival_time_placement_policy_5B
    status: required
    owner_subsegment: 5B
    description: Arrival time placement policy for 5B.S4.
    version: 'v1'
    format: yaml
    path: config/layer2/5B/arrival_time_placement_policy_5B.yaml
    partitioning: []
    primary_key: []
    ordering: []
    schema_ref: schemas.5B.yaml#/config/arrival_time_placement_policy_5B
    lineage:
      produced_by: []
      consumed_by: [5B.S0, 5B.S4, 5B.S5]
      final_in_layer: false
    retention_days: 365
    pii: false
    licence: Proprietary-Internal

  - id: arrival_routing_policy_5B
    status: required
    owner_subsegment: 5B
    description: Arrival routing policy for 5B.S4.
    version: 'v1'
    format: yaml
    path: config/layer2/5B/arrival_routing_policy_5B.yaml
    partitioning: []
    primary_key: []
    ordering: []
    schema_ref: schemas.5B.yaml#/config/arrival_routing_policy_5B
    lineage:
      produced_by: []
      consumed_by: [5B.S0, 5B.S4, 5B.S5]
      final_in_layer: false
    retention_days: 365
    pii: false
    licence: Proprietary-Internal

  - id: arrival_rng_policy_5B
    status: required
    owner_subsegment: 5B
    description: RNG wiring and budgets for 5B.S2-S4.
    version: 'v1'
    format: yaml
    path: config/layer2/5B/arrival_rng_policy_5B.yaml
    partitioning: []
    primary_key: []
    ordering: []
    schema_ref: schemas.5B.yaml#/config/arrival_rng_policy_5B
    lineage:
      produced_by: []
      consumed_by: [5B.S0, 5B.S2, 5B.S3, 5B.S4, 5B.S5]
      final_in_layer: false
    retention_days: 365
    pii: false
    licence: Proprietary-Internal

  - id: validation_policy_5B
    status: required
    owner_subsegment: 5B
    description: Validation policy for 5B.S5.
    version: 'v1'
    format: yaml
    path: config/layer2/5B/validation_policy_5B.yaml
    partitioning: []
    primary_key: []
    ordering: []
    schema_ref: schemas.5B.yaml#/config/validation_policy_5B
    lineage:
      produced_by: []
      consumed_by: [5B.S0, 5B.S5]
      final_in_layer: false
    retention_days: 365
    pii: false
    licence: Proprietary-Internal

  # S0 - gate & sealed inputs
  - id: s0_gate_receipt_5B
    status: required
    owner_subsegment: 5B
    description: Fingerprint-scoped receipt confirming upstream PASS gates and sealed inputs.
    version: '{manifest_fingerprint}'
    format: json
    path: data/layer2/5B/s0_gate_receipt/fingerprint={manifest_fingerprint}/s0_gate_receipt_5B.json
    partitioning: [fingerprint]
    primary_key: [manifest_fingerprint]
    ordering: []
    schema_ref: schemas.5B.yaml#/validation/s0_gate_receipt_5B
    lineage:
      produced_by: [5B.S0]
      consumed_by: [5B.S1, 5B.S2, 5B.S3, 5B.S4, 5B.S5]
      final_in_layer: false
    retention_days: 365
    pii: false
    licence: Proprietary-Internal

  - id: sealed_inputs_5B
    status: required
    owner_subsegment: 5B
    description: Inventory of artefacts 5B is allowed to read for a fingerprint.
    version: '{manifest_fingerprint}'
    format: parquet
    path: data/layer2/5B/sealed_inputs/fingerprint={manifest_fingerprint}/sealed_inputs_5B.parquet
    partitioning: [fingerprint]
    primary_key: [manifest_fingerprint, owner_segment, artifact_id]
    ordering: [owner_segment, artifact_id, role]
    schema_ref: schemas.5B.yaml#/validation/sealed_inputs_5B
    lineage:
      produced_by: [5B.S0]
      consumed_by: [5B.S1, 5B.S2, 5B.S3, 5B.S4, 5B.S5]
      final_in_layer: false
    retention_days: 365
    pii: false
    licence: Proprietary-Internal

  # S1 — time grid & grouping
  - id: s1_time_grid_5B
    status: required
    owner_subsegment: 5B
    description: Canonical scenario-level time grid for arrivals.
    version: '{manifest_fingerprint}.{scenario_id}'
    format: parquet
    path: |
      data/layer2/5B/s1_time_grid/fingerprint={manifest_fingerprint}/scenario_id={scenario_id}/s1_time_grid_5B.parquet
    partitioning: [fingerprint, scenario_id]
    primary_key:
      - manifest_fingerprint
      - scenario_id
      - bucket_index
    ordering: [scenario_id, bucket_index]
    schema_ref: schemas.5B.yaml#/model/s1_time_grid_5B
    lineage:
      produced_by: [5B.S1]
      consumed_by: [5B.S2, 5B.S3, 5B.S4, 5B.S5]
      final_in_layer: false
    retention_days: 365
    pii: false
    licence: Proprietary-Internal

  - id: s1_grouping_5B
    status: required
    owner_subsegment: 5B
    description: Deterministic mapping from merchant×zone×channel to latent group IDs.
    version: '{manifest_fingerprint}.{scenario_id}'
    format: parquet
    path: |
      data/layer2/5B/s1_grouping/fingerprint={manifest_fingerprint}/scenario_id={scenario_id}/s1_grouping_5B.parquet
    partitioning: [fingerprint, scenario_id]
    primary_key:
      - manifest_fingerprint
      - scenario_id
      - merchant_id
      - zone_representation
      - channel_group
    ordering:
      - scenario_id
      - merchant_id
      - zone_representation
      - channel_group
    schema_ref: schemas.5B.yaml#/model/s1_grouping_5B
    lineage:
      produced_by: [5B.S1]
      consumed_by: [5B.S2, 5B.S3, 5B.S4, 5B.S5]
      final_in_layer: false
    retention_days: 365
    pii: false
    licence: Proprietary-Internal

  # S2 — realised intensity (LGCP)
  - id: s2_realised_intensity_5B
    status: required
    owner_subsegment: 5B
    description: Realised intensities λ_realised per entity×bucket×scenario×seed.
    version: '{seed}.{manifest_fingerprint}.{scenario_id}'
    format: parquet
    path: |
      data/layer2/5B/s2_realised_intensity/seed={seed}/fingerprint={manifest_fingerprint}/scenario_id={scenario_id}/s2_realised_intensity_5B.parquet
    partitioning: [seed, fingerprint, scenario_id]
    primary_key:
      - seed
      - manifest_fingerprint
      - scenario_id
      - merchant_id
      - zone_representation
      - channel_group
      - bucket_index
    ordering:
      - scenario_id
      - merchant_id
      - zone_representation
      - channel_group
      - bucket_index
    schema_ref: schemas.5B.yaml#/model/s2_realised_intensity_5B
    lineage:
      produced_by: [5B.S2]
      consumed_by: [5B.S3, 5B.S5]
      final_in_layer: false
    retention_days: 365
    pii: false
    licence: Proprietary-Internal

  - id: s2_latent_field_5B
    status: optional
    owner_subsegment: 5B
    description: Optional per-group latent field table for diagnostics.
    version: '{seed}.{manifest_fingerprint}.{scenario_id}'
    format: parquet
    path: |
      data/layer2/5B/s2_latent_field/seed={seed}/fingerprint={manifest_fingerprint}/scenario_id={scenario_id}/s2_latent_field_5B.parquet
    partitioning: [seed, fingerprint, scenario_id]
    primary_key:
      - seed
      - manifest_fingerprint
      - scenario_id
      - group_id
      - bucket_index
    ordering:
      - scenario_id
      - group_id
      - bucket_index
    schema_ref: schemas.5B.yaml#/model/s2_latent_field_5B
    lineage:
      produced_by: [5B.S2]
      consumed_by: [5B.S5, 5B.validation_tools]
      final_in_layer: false
    retention_days: 365
    pii: false
    licence: Proprietary-Internal

  # S3 — bucket-level counts
  - id: s3_bucket_counts_5B
    status: required
    owner_subsegment: 5B
    description: Integer counts per entity×bucket×scenario×seed.
    version: '{seed}.{manifest_fingerprint}.{scenario_id}'
    format: parquet
    path: |
      data/layer2/5B/s3_bucket_counts/seed={seed}/fingerprint={manifest_fingerprint}/scenario_id={scenario_id}/s3_bucket_counts_5B.parquet
    partitioning: [seed, fingerprint, scenario_id]
    primary_key:
      - seed
      - manifest_fingerprint
      - scenario_id
      - merchant_id
      - zone_representation
      - channel_group
      - bucket_index
    ordering:
      - scenario_id
      - merchant_id
      - zone_representation
      - channel_group
      - bucket_index
    schema_ref: schemas.5B.yaml#/model/s3_bucket_counts_5B
    lineage:
      produced_by: [5B.S3]
      consumed_by: [5B.S4, 5B.S5]
      final_in_layer: false
    retention_days: 365
    pii: false
    licence: Proprietary-Internal

  # S4 — arrival events & diagnostics
  - id: arrival_events_5B
    status: required
    owner_subsegment: 5B
    description: Canonical arrival skeleton stream per scenario×seed (final egress).
    version: '{seed}.{manifest_fingerprint}.{scenario_id}'
    format: parquet
    path: |
      data/layer2/5B/arrival_events/seed={seed}/fingerprint={manifest_fingerprint}/scenario_id={scenario_id}/part-*.parquet
    partitioning: [seed, fingerprint, scenario_id]
    primary_key:
      - seed
      - manifest_fingerprint
      - scenario_id
      - merchant_id
      - arrival_seq
    ordering:
      - scenario_id
      - merchant_id
      - ts_utc
      - arrival_seq
    schema_ref: schemas.5B.yaml#/egress/s4_arrival_events_5B
    lineage:
      produced_by: [5B.S4]
      consumed_by: [5B.S5, 6A, 6B, enterprise_ingestion]
      final_in_layer: true
    retention_days: 365
    pii: true
    licence: Proprietary-Internal

  - id: s4_arrival_summary_5B
    status: optional
    owner_subsegment: 5B
    description: Optional per-entity/bucket arrival summaries for observability.
    version: '{seed}.{manifest_fingerprint}.{scenario_id}'
    format: parquet
    path: |
      data/layer2/5B/arrival_summary/seed={seed}/fingerprint={manifest_fingerprint}/scenario_id={scenario_id}/s4_arrival_summary_5B.parquet
    partitioning: [seed, fingerprint, scenario_id]
    primary_key:
      - seed
      - manifest_fingerprint
      - scenario_id
      - merchant_id
      - zone_representation
      - channel_group
      - bucket_index
    ordering:
      - scenario_id
      - merchant_id
      - zone_representation
      - bucket_index
    schema_ref: schemas.5B.yaml#/diagnostics/s4_arrival_summary_5B
    lineage:
      produced_by: [5B.S4]
      consumed_by: [5B.validation_tools, ops_dashboards]
      final_in_layer: false
    retention_days: 90
    pii: true
    licence: Proprietary-Internal

  - id: s4_arrival_anomalies_5B
    status: optional
    owner_subsegment: 5B
    description: Optional anomaly log for arrival routing/time-placement diagnostics.
    version: '{seed}.{manifest_fingerprint}.{scenario_id}'
    format: parquet
    path: |
      data/layer2/5B/arrival_anomalies/seed={seed}/fingerprint={manifest_fingerprint}/scenario_id={scenario_id}/s4_arrival_anomalies_5B.parquet
    partitioning: [seed, fingerprint, scenario_id]
    primary_key:
      - seed
      - manifest_fingerprint
      - scenario_id
      - anomaly_id
    ordering:
      - scenario_id
      - anomaly_id
    schema_ref: schemas.5B.yaml#/diagnostics/s4_arrival_anomalies_5B
    lineage:
      produced_by: [5B.S4]
      consumed_by: [5B.validation_tools, ops_dashboards]
      final_in_layer: false
    retention_days: 90
    pii: true
    licence: Proprietary-Internal

  # S5 — validation bundle
  - id: validation_bundle_index_5B
    status: required
    owner_subsegment: 5B
    description: Index/manifest for the 5B validation bundle (fingerprint scope).
    version: '{manifest_fingerprint}'
    format: json
    path: data/layer2/5B/validation/fingerprint={manifest_fingerprint}/index.json
    partitioning: [fingerprint]
    ordering: []
    schema_ref: schemas.layer2.yaml#/validation/validation_bundle_index_5B
    lineage:
      produced_by: [5B.S5]
      consumed_by: [5B.S5, 6A, 6B]
      final_in_layer: false
    retention_days: 365
    pii: false
    licence: Proprietary-Internal

  - id: validation_report_5B
    status: required
    owner_subsegment: 5B
    description: Human/machine readable 5B validation report.
    version: '{manifest_fingerprint}'
    format: json
    path: data/layer2/5B/validation/fingerprint={manifest_fingerprint}/validation_report_5B.json
    partitioning: [fingerprint]
    ordering: []
    schema_ref: schemas.layer2.yaml#/validation/validation_report_5B
    lineage:
      produced_by: [5B.S5]
      consumed_by: [5B.validation_tools, ops_dashboards]
      final_in_layer: false
    retention_days: 365
    pii: false
    licence: Proprietary-Internal

  - id: validation_issue_table_5B
    status: optional
    owner_subsegment: 5B
    description: Optional structured issue table for 5B validation findings.
    version: '{manifest_fingerprint}'
    format: parquet
    path: data/layer2/5B/validation/fingerprint={manifest_fingerprint}/validation_issue_table_5B.parquet
    partitioning: [fingerprint]
    ordering: []
    schema_ref: schemas.layer2.yaml#/validation/validation_issue_table_5B
    lineage:
      produced_by: [5B.S5]
      consumed_by: [5B.validation_tools, ops_dashboards]
      final_in_layer: false
    retention_days: 365
    pii: false
    licence: Proprietary-Internal

  - id: validation_passed_flag_5B
    status: required
    owner_subsegment: 5B
    description: HashGate flag proving the validation bundle digest for a fingerprint.
    version: '{manifest_fingerprint}'
    format: json
    path: data/layer2/5B/validation/fingerprint={manifest_fingerprint}/_passed.flag
    partitioning: [fingerprint]
    ordering: []
    schema_ref: schemas.layer2.yaml#/validation/passed_flag_5B
    lineage:
      produced_by: [5B.S5]
      consumed_by: [6A, 6B, 5B.validation_tools]
      final_in_layer: true
    retention_days: 365
    pii: false
    licence: Proprietary-Internal

  - id: segment_state_runs
    status: required
    owner_subsegment: 5B
    description: Global run-report journal for layer2 segment states.
    version: v1
    format: jsonl
    path: reports/l2/segment_states/segment_state_runs.jsonl
    partitioning: []
    primary_key: []
    ordering: []
    schema_ref: schemas.layer2.yaml#/run_report/segment_state_run
    lineage:
      produced_by: [5B.S0, 5B.S1, 5B.S2, 5B.S3, 5B.S4, 5B.S5]
      consumed_by: [orchestration, ops_dashboards]
      final_in_layer: false
    retention_days: 365
    pii: false
    licence: Proprietary-Internal

notes:
  - "Derived from docs/model_spec/data-engine/layer-2/specs/state-flow/5B/s#.expanded.md section 5."
