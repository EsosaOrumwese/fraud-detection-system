{
  "$id": "mlr.transaction@2",
  "title": "Transaction",
  "type": "object",
  "required": [
    "transaction_id", "merchant_id", "site_id",
    "event_time_utc", "local_time_offset",
    "tzid_settlement", "tzid_operational",
    "is_virtual", "dst_adjusted", "fold"
  ],
  "properties": {
    "transaction_id": {"type": "string"},
    "merchant_id": {"type": "integer"},
    "site_id": {"type": "integer"},
    "event_time_utc": {"type": "string", "format": "date-time"},
    "local_time_offset": {"type": "integer", "description": "minutes offset from UTC"},
    "dst_adjusted": {"type": "boolean"},
    "fold": {"type": "integer", "minimum": 0, "maximum": 1},

    "tzid_settlement": {"type": "string"},
    "tzid_operational": {"type": "string"},

    "latitude": {"type": ["number","null"]},
    "longitude": {"type": ["number","null"]},

    "ip_latitude": {"type": ["number","null"]},
    "ip_longitude": {"type": ["number","null"]},
    "ip_country": {"type": ["string","null"]},

    "amount_minor": {"type": "integer"},
    "currency": {"type": "string"},

    "site_rng_index": {"type": "integer"}
  },
  "allOf": [
    {
      "if": { "properties": { "is_virtual": { "const": true } } },
      "then": { "required": ["ip_latitude","ip_longitude","ip_country"] }
    },
    {
      "if": { "properties": { "is_virtual": { "const": false } } },
      "then": { "required": ["latitude","longitude"] }
    }
  ]
}
